function text(t,e){return t=t||1,text3D(t*textSize,e).center()}function Board(t){this.object=hub(),this.title=put(text3D(.15,t).center().colored(colorPlay).named("text"+t)).on(this.object).at(0,.7,-1.3).obj(),this.btns=[],this.btnState=[],this.type=t,range(numButtons,function(t){var e=Math.floor(t/height),i=t%height,o=10*(midWidth-e),n=10*(i-midHeight),r=box(padSize,padSize,padDepth).colored(colorOff).named("btn"+t).latLon(n,o);put(box(1.1*padSize,1.1*padSize,.9*padDepth).colored(colorPlay).named("bevel"+t)).on(r),env.registerPickableObject(r),r.onselect=this.select.bind(this,t),r.onenter=this.play.bind(this,t,0),this.object.add(r),this.btns.push(r)}.bind(this))}var height=8,width=4,numButtons=width*height,midWidth=(width-1)/2,midHeight=(height-1)/2,colorOn=16777215,colorOff=16711680,colorPlay=16776960,boards=[],t=0,measure=0,lastMeasure=null,padSize=.22,padDepth=.02,textSize=.05,skipOne=!1,perMeasure=2/height,DIST=v3(),env=new Primrose.BrowserEnvironment({groundTexture:"../images/deck.png",font:"../fonts/helvetiker_regular.typeface.json",backgroundColor:0,useFog:!0,useGaze:isMobile,drawDistance:10,fullScreenButtonContainer:"#fullScreenButtonContainer"});Board.prototype.play=function(t,e){this.highlight(t,colorPlay),this.object.getWorldDirection(DIST);var i=.85*perMeasure;env.music.play(this.type,25-numButtons+3*t,.25,i,e).at(this.object.x,this.object.y,this.object.z,DIST.x,DIST.y,DIST.z),setTimeout(this.highlight.bind(this,t),1e3*i)},Board.prototype.update=function(){if(measure!==lastMeasure)for(var t=env.audio.context.currentTime,e=perMeasure*Math.ceil(t/perMeasure),i=e-t,o=0;o<width;++o){var n=o*height+measure;this.btnState[n]&&this.play(n,i)}DIST.set(this.object.position.x,env.input.head.position.y,this.object.position.z),this.object.position.lerp(DIST,.01)},Board.prototype.highlight=function(t,e){e=e||this.btnState[t]&&colorOn||colorOff;var i=this.btns[t];i.colored(e).named(i.name)},Board.prototype.select=function(t,e){env.input.hasMouse&&"MousePointer"!==e.pointer.name||(this.btnState[t]=!this.btnState[t],this.highlight(t))},env.addEventListener("ready",function(){var t=Primrose.Audio.Music.TYPES,e=t.length;t.forEach(function(t,i){var o=new Board(t);boards.push(o),env.scene.add(o.object),o.object.latLon(0,100*(i-(e-1)/2)/e)})}),env.addEventListener("update",function(e){skipOne||(t+=e,t>perMeasure&&(t-=perMeasure,measure=(measure+1)%height),boards.forEach(function(t){t.update()}),lastMeasure=measure),skipOne=!1}),window.addEventListener("focus",function(){skipOne=!0});