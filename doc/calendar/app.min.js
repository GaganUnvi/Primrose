function deg2rad(e){return Math.PI*e/180}function rad2deg(e){return 180*e/Math.PI}function rand(){Primrose.Random.number(0,dim)}function randDegree(){Primrose.Random.number(-Math.PI,Math.PI)}function setColor(){var e=new Date,t=e.getMonth(),r=e.getDate()-1,o=this;objs.forEach(function(e,a){e.box===o?(e.box.material=primaryMaterial,e.lbl.material=secondaryMaterial,e.bev.material=secondaryMaterial):(e.box.material=t===currentMonth&&a===r?todayMaterial:secondaryMaterial,e.lbl.material=primaryMaterial,e.bev.material=primaryMaterial)})}function text(e,t){return t=t||1,text3D(t*textSize,e).center()}function hitDate(e,t){var r=new Date;r.setMonth(e),r.setDate(t),env.speech.speak(dayNames[r.getDay()]+", "+monthNames[e]+" "+t+", "+r.getFullYear())}function showMonth(e){env.ui.children.splice(0);var t=new Date,r=null;e==t.getMonth()?r=t.getDate():t.setMonth(e),t.setDate(1);var o=0,a=0,n=0;for(env.ui.add(months[e].latLon(-72,0));t.getMonth()===e;){o=t.getDay(),o<n&&++a;var i=t.getDate(),l=objs[i-1];r==i?l.box.material=todayMaterial:l.box.material=secondaryMaterial,l.box.onenter=setColor.bind(l.box),env.registerPickableObject(l.box),l.box.onselect=hitDate.bind(null,e,i),env.ui.add(l.hub.latLon(boxSpacing*(a-2)-45,boxSpacing*(3-o))),t.setDate(t.getDate()+1),n=o}env.ground.onenter=setColor.bind(env.ground)}var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months=null,currentMonth=(new Date).getMonth(),primaryColor=11571200,secondaryColor=3158064,todayColor=3170432,angleThreshold=15,primaryMaterial=material({color:primaryColor}),secondaryMaterial=material({color:secondaryColor}),todayMaterial=material({color:todayColor}),objs=[],dim=50,boxSize=dim/300,boxSpacing=50*boxSize,textSize=.333*boxSize,hDim=dim/2,env=new Primrose.BrowserEnvironment({groundTexture:"../images/deck.png",font:"../fonts/helvetiker_regular.typeface.json",backgroundColor:0,useFog:!0,drawDistance:hDim/2,enableShadows:!0,fullScreenButtonContainer:"#fullScreenButtonContainer"});env.addEventListener("ready",function(){env.insertFullScreenButtons("body"),months=monthNames.map(function(e){return text(e,3.5).colored(primaryColor).named(e)});for(var e=0;e<31;++e){var t=hub(),r=box(boxSize).colored(secondaryColor).named("box"+(e+1)),o=box(1.1*boxSize,1.1*boxSize,.9*boxSize).colored(primaryColor).named("bev"+(e+1)),a=text((e+1).toString()).colored(primaryColor).named("txt"+(e+1));a.castShadow=!0,r.receiveShadow=!0,a.position.z=.08,t.add(r),r.add(o),r.add(a),objs.push({hub:t,box:r,lbl:a,bev:o})}showMonth(currentMonth),env.ui.add(text("Turn left or right to change month",.5).colored(primaryColor).named("inst1").latLon(-20,0,1)),env.ui.add(text("Click on dates.",.5).colored(primaryColor).named("inst2").latLon(-17,0,1))});var lt=0;env.addEventListener("update",function(){var e=env.turns.degrees-lt;Math.abs(e)>angleThreshold&&(currentMonth+=e<0?1:-1,currentMonth<0?currentMonth+=12:currentMonth>=12&&(currentMonth-=12),showMonth(currentMonth),lt=env.turns.degrees)});