<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"><!-- LIVE RELOADER -->
<script src="../node_modules/socket.io-client/dist/socket.io.js"></script>
<script>
(function(path) {

function mangle(name) {
  return "_" + name;
}

function wrapFunction(send, name) {
  var orig = name;
  while (console[orig]) {
    orig = mangle(orig);
  }
  if (console[name]) {
    console[orig] = console[name];
  } else {
    orig = null;
  }
  console[name] = function () {
    var args = [];
    for (var i = 0; i < arguments.length; ++i) {
      var elem = arguments[i];
      if (elem === null) {
        args.push("null");
      } else if (elem === undefined) {
        args.push("undefined");
      } else if (typeof elem === "object" && !(elem instanceof String)) {
        var obj1 = elem,
            obj2 = {};
        for (var key in obj1) {
          obj2[key] = obj1[key];
          if (obj2[key] !== null && obj2[key] !== undefined) {
            obj2[key] = obj2[key].toString();
          }
        }
        args.push(obj2);
      } else {
        args.push(elem.toString());
      }
    }

    var obj = send({ name: name, args: args });
    if (orig && console[orig] && obj) {
      console[orig].apply(console, arguments);
    }
  };
}

var isBad = location.protocol === "file:",
  send = isBad ? function identity(data) {
      return data;
    } : function (data) {
      socket.emit("logging", data);
      return data;
    },
  redirects = ["log", "info", "error"],
  status = "enabled.",
  socket = io(path)
    .on("connect", function() {
      console.log("Live reload " + status);
      status = "reestablished.";
    })
    .on("stop", function() { dispatchEvent(new CustomEvent("stop")); })
    .on("reload", function() { location.reload(); })
    .on("command", function(cmd) {
      console._log(cmd);
      console.log(eval(cmd));
    });

if (isBad) {
  console.warn("Can't perform HTTP requests from the file system. Not going to setup the error proxy, but will setup the error catch-all.");
}

redirects.forEach(function (name) {
  return wrapFunction(send, name);
});

window.addEventListener("error", function (evt) {
  var colno = evt.colno || window.event && window.event.errorCharacter,
      done = false,
      err = evt.error,
      stack = err && err.stack;

  if (!stack) {
    if (arguments.callee) {
      var head = arguments.callee.caller;
      while (head) {
        stack.push(head.name);
        head = head.caller;
      }
    } else {
      stack = "N/A";
    }
  }

  var data = {
    type: "error",
    time: new Date().toLocaleTimeString(),
    message: evt.message,
    source: evt.filename,
    lineno: evt.lineno,
    colno: colno,
    error: err && err.message,
    stack: stack
  };

  try {
    send({name: "error", args: [data]});
  } catch (exp) {
  }
}, false);

})(location.origin.replace(/^http/, "ws"));
</script>

    <meta name="viewport" content="width=device-width, shrink-to-fit=0, initial-scale=1.0">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="black">
    <meta name="description" content="A WebVR application framework.">
    <meta name="keywords" content="WebGL, WebVR, HTML5, JavaScript, text editor, source code editor, virtual reality, Primrose">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@Primrose_VR">
    <meta property="og:site_name" content="Primrose VR">
    <meta property="og:description" content="Primrose: Framework for WebVR Applications">
    <meta name="twitter:description" content="Primrose: Framework for WebVR Applications">
    <meta property="og:url" content="http://www.primrosevr.com/undefined"><!-- start main.pug meta block -->
    <meta name="twitter:image" content="http://www.primrosevr.com/images/screenshot.jpg">
    <meta property="og:image" content="http://www.primrosevr.com/images/screenshot.jpg"><!-- end main.pug meta block -->
<!-- start main.pug title block -->
    <meta property="og:title" content="Primrose VR: WebVR Application Framework">
    <meta name="twitter:title" content="Primrose VR: WebVR Application Framework">
    <title>Primrose VR: WebVR Application Framework</title><!-- end main.pug title block -->
    <link type="text/css" rel="stylesheet" href="../doc/style.css">
    <script src="../node_modules/pliny/pliny.js"></script>
    <script src="../Primrose.js"></script>
    <script src="../doc/app.js"></script>
    <script src="../ga.js"></script>
  </head>
  <body>
    <header role="banner"><a id="logo" href="../"><img src="../doc/images/primrose40.png" alt="logo" title="Primrose logo"><span class="version-number">v0.31.13</span></a>
      <nav role="navigation">
        <ul>
          <li><a href="../demos/">Demos</a></li>
          <li><a href="../doc/">Docs</a></li>
          <li><a href="../doc/faq.html">FAQ</a></li>
          <li><a href="../doc/community.html">Community</a></li>
          <li><a href="https://github.com/capnmidnight/Primrose/" target="_blank">Github</a></li>
        </ul>
      </nav>
      <h1>Demo: physics2
      </h1>
    </header><!-- start main.pug banner block --><!-- end main.pug banner block -->
<!-- start main.pug main block -->
    <main><!-- start demo.pug banner block -->
      <p>Click on the image below to lock mouse cursor to demo. <a href="../demos/physics2" target="_blank">Open demo in new window</a>.</p>
      <iframe id="demo" src="../demos/physics2" style="width: 100%;height: 50vw;" allowfullscreen allowvr></iframe>
      <h2>Source</h2>
      <pre id="editorContainer">grammar(&quot;JavaScript&quot;);
var env = new Primrose.BrowserEnvironment({
    backgroundColor: 0x000000,
    groundTexture: &quot;../shared_assets/images/deck.png&quot;,
    useFog: true,
    drawDistance: 100,
    fullScreenButtonContainer: &quot;#fullScreenButtonContainer&quot;,
    nonstandardNeckLength: 0.15,
    nonstandardNeckDepth: 0.075,
    gravity: 0,
  }),

  groundMaterial = new CANNON.Material(&quot;groundMaterial&quot;),
  groundShape = new CANNON.Plane(),
  ground = new CANNON.Body({ mass: 0, material: groundMaterial }),

  spheres = [],
  springs = [],
  repellers = [];

function SolidSphere(m, r) {

  var shape = new CANNON.Sphere(r);
  this.body = new CANNON.Body({ mass: m &gt; 0 ? 1 : 0, material: groundMaterial });
  this.body.addShape(shape);

  this.body.position.set(
    Primrose.Random.number(-0.5, 0.5),
    Primrose.Random.number(1, 2),
    Primrose.Random.number(-1.5, -2.5));

  this.body.velocity.set(
    Primrose.Random.number(-1, 1),
    Primrose.Random.number(-1, 1),
    Primrose.Random.number(-1, 1));

  this.body.angularVelocity.set(
    Primrose.Random.number(-5, 5),
    Primrose.Random.number(-5, 5),
    Primrose.Random.number(-5, 5));

  this.body.angularDamping = 0.75;
  this.body.linearDamping = 0.5;

  this.mesh = sphere(r, 20, 20)
    .colored(Primrose.Random.color())
    .on(&quot;enter&quot;, this.jump.bind(this));

  env.physics.addBody(this.body);
  env.scene.add(this.mesh);
}

SolidSphere.prototype.jump = function() {
  this.body.velocity.y = Primrose.Random.number(5, 10);
};

SolidSphere.prototype.update = function() {
  this.mesh.position.copy(this.body.position);
  this.mesh.quaternion.copy(this.body.quaternion);
};


var TEMP = v3();

env.physics.addEventListener(&quot;preStep&quot;, function(event) {
  for(var i = 0; i &lt; repellers.length; ++i){
    var r = repellers[i],
      a = r[0],
      b = r[1],
      o = r[2];

    TEMP.copy(b.body.position).sub(a.body.position);
    var d = TEMP.length();
    TEMP.multiplyScalar(o.force / Math.pow(d, 3));
    b.body.force.vadd(TEMP, b.body.force);
    TEMP.negate();
    a.body.force.vadd(TEMP, a.body.force);
  }
});

env.physics.addEventListener(&quot;postStep&quot;, function(event) {
  for(var i = 0; i &lt; springs.length; ++i){
    springs[i].applyForce();
  }
});

env.addEventListener(&quot;update&quot;, function() {
  for(var i = 0; i &lt; spheres.length; ++i){
    spheres[i].update();
  }
});

env.addEventListener(&quot;ready&quot;, function() {

  ground.quaternion.setFromVectors(
    new CANNON.Vec3(0, 0, -1),
    new CANNON.Vec3(0, -1, 0));


  ground.addShape(groundShape);
  env.physics.addBody(ground);

  for(var i = 0; i &lt; 50; ++i){
    var a = new SolidSphere(i, Primrose.Random.number(0.1, 0.2));
    spheres.push(a);
    if(i &gt; 0) {
      for(var j = 0; j &lt; i; ++j) {
        var b = spheres[j];

        if(j === 0) {
          springs.push(new CANNON.Spring(a.body, b.body, {
            restLength: 1,
            stiffness: 500,
            damping: 5
          }));
        }
        repellers.push([a, b, { force: Primrose.Random.number(0, 0.2) }]);
      }
    }
  }
});
</pre>
    </main><!-- end main.pug main block -->
<!-- start main.pug footer block -->
    <footer>
      <div id="footerWrapper"><a href="../doc/readme.html">About</a><a href="../doc/license.html">License</a><a href="../doc/changelog.html">Changelog</a><a class="small icon github" href="https://www.github.com/capnmidnight/Primrose" target="_blank">&nbsp;</a><a class="small icon twitter" href="https://www.twitter.com/Primrose_VR" target="_blank"></a></div>
    </footer><!-- end main.pug footer block -->
  </body>
</html>