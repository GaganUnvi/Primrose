function deg2rad(e){return Math.PI*e/180}function rad2deg(e){return 180*e/Math.PI}function rand(){Primrose.Random.number(0,dim)}function randDegree(){Primrose.Random.number(-Math.PI,Math.PI)}function setColor(){var e=new Date,r=e.getMonth(),t=e.getDate()-1,o=this;objs.forEach(function(e,a){e.box===o?(e.box.material=primaryMaterial,e.lbl.material=secondaryMaterial,e.bev.material=secondaryMaterial):(e.box.material=r===currentMonth&&a===t?todayMaterial:secondaryMaterial,e.lbl.material=primaryMaterial,e.bev.material=primaryMaterial)})}function text(e,r){return r=r||1,text3D(r*textSize,e).center()}function hitDate(e,r){var t=new Date;t.setMonth(e),t.setDate(r),env.speech.speak(dayNames[t.getDay()]+", "+monthNames[e]+" "+r+", "+t.getFullYear())}function showMonth(e){env.ui.children.splice(0);var r=new Date,t=null;e==r.getMonth()?t=r.getDate():r.setMonth(e),r.setDate(1);var o=0,a=0,n=0;for(env.ui.add(months[e].latLon(-72,0));r.getMonth()===e;){o=r.getDay(),o<n&&++a;var i=r.getDate(),l=objs[i-1];t==i?l.box.material=todayMaterial:l.box.material=secondaryMaterial,l.box.onenter=setColor.bind(l.box),env.registerPickableObject(l.box),l.box.onselect=hitDate.bind(null,e,i),env.ui.add(l.hub.latLon(boxSpacing*(a-2)-45,boxSpacing*(3-o))),r.setDate(r.getDate()+1),n=o}env.ground.onenter=setColor.bind(env.ground)}var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months=null,currentMonth=(new Date).getMonth(),primaryColor=11571200,secondaryColor=3158064,todayColor=3170432,angleThreshold=15,primaryMaterial=material({color:primaryColor}),secondaryMaterial=material({color:secondaryColor}),todayMaterial=material({color:todayColor}),objs=[],dim=50,boxSize=dim/300,boxSpacing=50*boxSize,textSize=.333*boxSize,hDim=dim/2,env=new Primrose.BrowserEnvironment({groundTexture:"../images/deck.png",font:"../fonts/helvetiker_regular.typeface.json",backgroundColor:0,useFog:!0,drawDistance:hDim/2,enableShadows:!0,fullScreenButtonContainer:"#fullScreenButtonContainer",progress:Preloader.thunk});env.addEventListener("ready",function(){env.insertFullScreenButtons("body"),months=monthNames.map(function(e){return text(e,3.5).colored(primaryColor).named(e)});for(var e=0;e<31;++e){var r=hub(),t=box(boxSize).colored(secondaryColor).named("box"+(e+1)),o=box(1.1*boxSize,1.1*boxSize,.9*boxSize).colored(primaryColor).named("bev"+(e+1)),a=text((e+1).toString()).colored(primaryColor).named("txt"+(e+1));a.castShadow=!0,t.receiveShadow=!0,a.position.z=.08,r.add(t),t.add(o),t.add(a),objs.push({hub:r,box:t,lbl:a,bev:o})}showMonth(currentMonth),env.ui.add(text("Turn left or right to change month",.5).colored(primaryColor).named("inst1").latLon(-20,0,1)),env.ui.add(text("Click on dates.",.5).colored(primaryColor).named("inst2").latLon(-17,0,1)),Preloader.hide()});var lt=0;env.addEventListener("update",function(){var e=env.turns.degrees-lt;Math.abs(e)>angleThreshold&&(currentMonth+=e<0?1:-1,currentMonth<0?currentMonth+=12:currentMonth>=12&&(currentMonth-=12),showMonth(currentMonth),lt=env.turns.degrees)});