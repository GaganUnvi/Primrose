{"version":3,"file":"PrimroseWithDoc.js","sources":["src/flags/isOpera.js","src/flags/isChrome.js","src/flags/isFirefox.js","src/flags/isGearVR.js","src/flags/isIE.js","src/flags/isInIFrame.js","src/flags/isiOS.js","src/flags/isLandscape.js","src/flags/isMacOS.js","src/flags/isMobile.js","src/flags/isSafari.js","src/flags/isWebKit.js","src/flags/isWindows.js","src/flags/index.js","src/live-api/hub.js","src/util/cache.js","src/live-api/material.js","src/Primrose/Graphics/loadTexture.js","src/live-api/textured.js","src/live-api/colored.js","src/live-api/box.js","src/live-api/brick.js","src/live-api/axis.js","node_modules/poor-mans-symbol/dist/poor-mans-symbol.es-modules.js","node_modules/intervalometer/dist/intervalometer.es-modules.js","node_modules/iphone-inline-video/dist/iphone-inline-video.es-modules.js","src/Primrose/Controls/Entity.js","src/Primrose/Graphics/fixGeometry.js","src/live-api/quad.js","src/Primrose/Graphics/InsideSphereGeometry.js","src/live-api/shell.js","src/Primrose/Controls/BaseTextured.js","src/Primrose/Controls/Video.js","src/live-api/camera.js","src/live-api/circle.js","src/live-api/cloud.js","src/live-api/cylinder.js","src/live-api/light.js","src/live-api/quat.js","src/util/identity.js","src/live-api/range.js","src/live-api/ring.js","src/live-api/raycaster.js","src/live-api/sphere.js","src/live-api/v2.js","src/live-api/v3.js","src/live-api/v4.js","src/live-api/index.js","src/util/findProperty.js","src/util/AsyncLockRequest.js","src/util/deleteSetting.js","src/util/FullScreen.js","src/util/getSetting.js","src/util/immutable.js","src/util/isTimestampDeltaValid.js","src/util/mutable.js","src/util/Orientation.js","src/util/PointerLock.js","src/util/setSetting.js","src/util/standardUnlockBehavior.js","src/util/standardExitFullScreenBehavior.js","src/util/standardLockBehavior.js","src/util/standardFullScreenBehavior.js","src/util/Workerize.js","src/util/index.js","src/THREE/center.js","src/THREE/colored.js","src/THREE/CubeTextureLoader.js","src/THREE/emit.js","src/THREE/Matrix4.js","src/THREE/MTLLoader.js","src/THREE/Object3D.js","src/THREE/OBJLoader.js","src/THREE/offset.js","src/THREE/textured.js","src/THREE/vectorToString.js","node_modules/promise-polyfill/promise.js","src/Primrose/Angle.js","src/Primrose/HTTP/XHR.js","src/Primrose/HTTP/get.js","src/Primrose/HTTP/getBuffer.js","src/Primrose/DOM/cascadeElement.js","src/Primrose/Audio/Audio3D.js","src/Primrose/Audio/PositionalSound.js","src/Primrose/Audio/Note.js","src/Primrose/Audio/Music.js","src/Primrose/Audio/Sound.js","src/Primrose/Audio/Speech.js","src/Primrose/Audio/index.js","src/Primrose/Pointer.js","src/Primrose/Keys.js","src/Primrose/Text/Point.js","src/Primrose/Text/Size.js","src/Primrose/Text/Rectangle.js","src/Primrose/Controls/Surface.js","src/Primrose/Text/Themes/Default.js","src/Primrose/Controls/Label.js","src/Primrose/Controls/Button2D.js","src/Primrose/Controls/Button3D.js","src/Primrose/Controls/ButtonFactory.js","src/Primrose/Controls/Image.js","src/Primrose/Graphics/ModelFactory.js","src/Primrose/Controls/Ground.js","src/Primrose/Controls/Sky.js","src/Primrose/Text/Cursor.js","src/Primrose/Text/CommandPacks/CommandPack.js","src/Primrose/Text/CommandPacks/BasicTextInput.js","src/Primrose/Text/CommandPacks/TextEditor.js","src/Primrose/Text/Rule.js","src/Primrose/Text/Token.js","src/Primrose/Text/Grammars/Grammar.js","src/Primrose/Text/Grammars/JavaScript.js","src/Primrose/Controls/TextBox.js","src/Primrose/Displays/frameDataFromPose.js","src/Primrose/Displays/VRFrameData.js","src/Primrose/Displays/VRDisplay.js","src/Primrose/Displays/StandardMonitorVRDisplay.js","src/Primrose/DOM/makeHidingContainer.js","src/Primrose/Input/InputProcessor.js","src/Primrose/Text/OperatingSystems/OperatingSystem.js","src/Primrose/Text/OperatingSystems/Windows.js","src/Primrose/Text/OperatingSystems/macOS.js","src/Primrose/Text/CodePages/CodePage.js","src/Primrose/Text/CodePages/DE_QWERTZ.js","src/Primrose/Text/CodePages/EN_UKX.js","src/Primrose/Text/CodePages/EN_US.js","src/Primrose/Text/CodePages/FR_AZERTY.js","src/Primrose/Text/CodePages/index.js","src/Primrose/Input/Keyboard.js","src/Primrose/Input/Mouse.js","src/Primrose/Input/PoseInputProcessor.js","src/Primrose/Input/Gamepad.js","src/Primrose/Input/GamepadManager.js","src/Primrose/Input/Touch.js","src/Primrose/Input/Speech.js","src/Primrose/Displays/SensorFusion/SensorSample.js","src/Primrose/Displays/SensorFusion/ComplementaryFilter.js","src/Primrose/Displays/SensorFusion/PosePredictor.js","src/Primrose/Displays/SensorFusion/FusionPoseSensor.js","src/Primrose/Displays/CardboardVRDisplay.js","src/Primrose/Replay/Automator.js","src/Primrose/Replay/Obj.js","src/Primrose/Replay/Record.js","src/Primrose/Replay/Frame.js","src/Primrose/Replay/Player.js","src/Primrose/Displays/MockVRDisplay.js","src/Primrose/HTTP/getObject.js","src/Primrose/Displays/install.js","src/Primrose/Input/VR.js","src/Primrose/Random/number.js","src/Primrose/Random/int.js","src/Primrose/Random/color.js","src/Primrose/Network/RemoteUser.js","src/Primrose/Network/Manager.js","src/Primrose/Text/Grammars/PlainText.js","src/Primrose/Tools/Teleporter.js","src/Primrose/Constants.js","src/Primrose/BrowserEnvironment.js","src/Primrose/Controls/Model.js","src/Primrose/Controls/PlainText.js","src/Primrose/Controls/Progress.js","src/Primrose/Text/CommandPacks/TextInput.js","src/Primrose/Controls/TextInput.js","src/Primrose/Controls/index.js","src/Primrose/Displays/index.js","src/Primrose/DOM/findEverything.js","src/Primrose/DOM/index.js","src/Primrose/Graphics/index.js","src/Primrose/HTTP/del.js","src/Primrose/HTTP/delObject.js","src/Primrose/HTTP/getText.js","src/Primrose/HTTP/post.js","src/Primrose/HTTP/postObject.js","src/Primrose/HTTP/index.js","src/Primrose/Input/Location.js","src/Primrose/Input/index.js","src/Primrose/Network/WebRTCSocket.js","src/Primrose/Network/AudioChannel.js","src/Primrose/Network/DataChannel.js","src/Primrose/Network/index.js","src/Primrose/Random/ID.js","src/Primrose/Random/item.js","src/Primrose/Random/steps.js","src/Primrose/Random/vector.js","src/Primrose/Random/index.js","src/Primrose/Replay/Watcher.js","src/Primrose/Replay/Recorder.js","src/Primrose/Replay/index.js","src/Primrose/Text/CommandPacks/index.js","src/Primrose/Text/Grammars/Basic.js","src/Primrose/Text/Grammars/HTML.js","src/Primrose/Text/Grammars/TestResults.js","src/Primrose/Text/Grammars/index.js","src/Primrose/Text/OperatingSystems/Linux.js","src/Primrose/Text/OperatingSystems/index.js","src/Primrose/Text/Terminal.js","src/Primrose/Text/Themes/Dark.js","src/Primrose/Text/Themes/index.js","src/Primrose/Text/index.js","src/Primrose/Tools/index.js","src/Primrose/index.js","src/index.js"],"sourcesContent":["pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isOpera\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is currently calling itself Opera.\"\r\n});\r\n\r\nexport default !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isChrome\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is currently calling itself Chrome or Chromium.\"\r\n});\r\n\r\nimport isOpera from \"./isOpera\";\r\nexport default !!window.chrome && !isOpera;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isFirefox\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is currently calling itself Firefox.\"\r\n});\r\n\r\nexport default typeof window.InstallTrigger !== \"undefined\";","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isGearVR\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the application is running on the Samsung Gear VR in the Samsung Internet app.\"\r\n});\r\n\r\nexport default navigator.userAgent.indexOf(\"Mobile VR\") > -1;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isIE\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is currently calling itself Internet Explorer. Once the bane of every web developer's existence, it has since passed the torch on to Safari in all of its many useless incarnations.\"\r\n});\r\n\r\nexport default /*@cc_on!@*/ false || !!document.documentMode;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isHomeScreen\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the script is currently running in an IFRAME or not.\"\r\n});\r\n\r\nexport default (window.self !== window.top);","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isiOS\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the current system is a device running the Apple iOS operating system: iPad, iPod Touch, iPhone. Useful for invoking optional code paths necessary to deal with deficiencies in Apple's implementation of web standards.\"\r\n});\r\n\r\nexport default /iP(hone|od|ad)/.test(navigator.userAgent || \"\");","pliny.function({\r\n  parent: \"Flags\",\r\n  name: \"isLandscape\",\r\n  returns: \"Boolean\",\r\n  description: \"Indicates whether or not the phone has been flipped to landscape mode.\"\r\n});\r\n\r\nexport default function isLandscape() {\r\n  return Math.abs(window.orientation) === 90;\r\n};","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isMacOS\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the current system is a computer running the Apple macOS operating system. Useful for changing keyboard shortcuts to support Apple's idiosyncratic, consensus-defying keyboard shortcuts.\"\r\n});\r\n\r\nexport default /Macintosh/.test(navigator.userAgent || \"\");","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isMobile\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the current system is a recognized \\\"mobile\\\" device, usually possessing a motion sensor.\"\r\n});\r\n\r\nfunction testUserAgent (a) {\r\n  return /(android|bb\\d+|meego).+|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(\r\n      a) ||\r\n    /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\r\n      a.substring(0, 4));\r\n}\r\n\r\nexport default testUserAgent(navigator.userAgent || navigator.vendor || window.opera);","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isSafari\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is currently calling itself Safari. Safari is an overly opinionated browser that thinks users should be protected from themselves in such a way as to prevent users from gaining access to the latest in cutting-edge web technologies. Essentially, it was replaced Microsoft Internet Explorer as the Internet Explorer of the web.\"\r\n});\r\n\r\nexport default Object.prototype.toString.call(window.HTMLElement)\r\n  .indexOf(\"Constructor\") > 0;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isWebKit\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the browser is one of Chrome, Safari, or Opera. WebKit browsers have certain issues in common that can be treated together, like a common basis for orientation events.\"\r\n});\r\n\r\nimport isOpera from \"./isOpera\";\r\nimport isChrome from \"./isChrome\";\r\nimport isSafari from \"./isSafari\";\r\nexport default isOpera || isChrome || isSafari;","pliny.value({\r\n  parent: \"Flags\",\r\n  name: \"isWindows\",\r\n  type: \"Boolean\",\r\n  description: \"Flag indicating the current system is a computer running one of the Microsoft Windows operating systems.\"\r\n});\r\n\r\nexport default /Windows/.test(navigator.userAgent || \"\");","pliny.namespace({\r\n  name: \"Flags\",\r\n  description: `Various flags used for feature detecting and configuring the system.\r\n\r\nWhen including Primrose as a \\`script\\` tag, the Flags namespace is imported directly onto the window object and is available without qualification.`\r\n});\r\n\r\nimport isChrome from \"./isChrome\";\r\nimport isFirefox from \"./isFirefox\";\r\nimport isGearVR from \"./isGearVR\";\r\nimport isIE from \"./isIE\";\r\nimport isInIFrame from \"./isInIFrame\";\r\nimport isiOS from \"./isiOS\";\r\nimport isLandscape from \"./isLandscape\";\r\nimport isMacOS from \"./isMacOS\";\r\nimport isMobile from \"./isMobile\";\r\nimport isOpera from \"./isOpera\";\r\nimport isSafari from \"./isSafari\";\r\nimport isWebKit from \"./isWebKit\";\r\nimport isWindows from \"./isWindows\";\r\n\r\nexport {\r\n  isChrome,\r\n  isFirefox,\r\n  isGearVR,\r\n  isIE,\r\n  isInIFrame,\r\n  isiOS,\r\n  isLandscape,\r\n  isMacOS,\r\n  isMobile,\r\n  isOpera,\r\n  isSafari,\r\n  isWebKit,\r\n  isWindows\r\n};\r\n\r\nexport default {\r\n  isChrome,\r\n  isFirefox,\r\n  isGearVR,\r\n  isIE,\r\n  isInIFrame,\r\n  isiOS,\r\n  isLandscape,\r\n  isMacOS,\r\n  isMobile,\r\n  isOpera,\r\n  isSafari,\r\n  isWebKit,\r\n  isWindows\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"hub\",\r\n  description: \"Calling `hub()` is a short-hand for creating a new `THREE.Object3D`. This is useful in live-coding examples to keep code terse and easy to write. It also polyfills in a method for being able to add the object to a `Primrose.BrowserEnvironment` using `appendChild()` and to add other elements to the hub using `appendChild()` such that they may be pickable in the scene.\",\r\n  returns: \"THREE.Object3D\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: `\r\n    grammar(\"JavaScript\");\r\n    //these two lines of code perform the same task.\r\n    var base1 = new THREE.Object3D();\r\n    var base2 = hub();`\r\n  }]\r\n});\r\n\r\nimport { Object3D } from \"three\";\r\nexport default function hub() {\r\n  return new Object3D();\r\n};\r\n","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"cache\",\r\n  description: \"Looks for the hashed name of the object in the object cache, and if it exists, returns it. If it doesn't exist, calls the makeObject function, using the return results to set the object in the cache, and returning it. In other words, a simple sort of memoization.\",\r\n  parameters: [{\r\n    name: \"hash\",\r\n    type: \"String\",\r\n    description: \"The hash key for the object to cache or retrieve.\"\r\n  }, {\r\n    name: \"makeObject\",\r\n    type: \"Function\",\r\n    description: \"A function that creates the object we want, if it doesn't already exist in the cache.\"\r\n  }],\r\n  returns: \"Object\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Using the `cache()` function lets you create an object once and retrieve it back again with the same function call.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    function makeCube(i){\\n\\\r\n      return cache(\\\"cubeGeom\\\" + i, function(){\\n\\\r\n        return new THREE.BoxGeometry(i, i, i);\\n\\\r\n      });\\n\\\r\n    }\\n\\\r\n    \\n\\\r\n    var a = makeCube(1),\\n\\\r\n        b = makeCube(2),\\n\\\r\n        c = makeCube(1);\\n\\\r\n    \\n\\\r\n    console.assert(a !== b);\\n\\\r\n    console.assert(a === c);\"\r\n  }]\r\n});\r\n\r\nconst _cache = {};\r\nexport default function cache(hash, makeObject, onCacheHit) {\r\n  if (!_cache[hash]) {\r\n    _cache[hash] = makeObject();\r\n  }\r\n  else if(onCacheHit) {\r\n    onCacheHit(_cache[hash]);\r\n  }\r\n  return _cache[hash];\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"material\",\r\n  description: \"A mechanism for creating and caching Three.js Materials so they don't get duplicated, as duplicate materials can severally slow down the system.\\n\\\r\n\\n\\\r\nYou typically won't use this function on your own. It's usually called by one of the functions [`textured()`](#LiveAPI_textured] or [`colored()`](#LiveAPI_colored) to handle common material handling between the two.\",\r\n  returns: \"THREE.MeshStandardMaterial or THREE.MeshBasicMaterial\",\r\n  parameters: [{\r\n    name: \"textureDescription\",\r\n    type: \"String\",\r\n    optional: true,\r\n    default: \"none\",\r\n    description: \"When called from `textured()`, it is the string that uniquely identifies the texture being used as part of the material. When called from `colored()`, it's just an empty string. The `textureDescription` is then used as part of a `materialDescription` that is used to cache the material.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Live API.material.optionsHash\",\r\n    optional: true,\r\n    description: \"Options to pass to the THREE.MeshStandardMaterial or THREE.MeshBasicMaterial constructor, or infrequently-used options to change the behavior of the setup. See [`Live API.material.optionsHash`](#LiveAPI_material_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Live API.material\",\r\n  name: \"optionsHash\",\r\n  type: \"Object\",\r\n  description: \"Optional options to alter how the material is created.\",\r\n  parameters: [{\r\n    name: \"color\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: \"0xffffff\",\r\n    description: \"A hex-value RGB color to apply to the material.\"\r\n  }, {\r\n    name: \"unshaded\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: false,\r\n    description: \"Set to true to use THREE.MeshBasicMaterial instead of THREE.MeshStandardMaterial.\"\r\n  }, {\r\n    name: \"side\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: \"THREE.FrontSide\",\r\n    description: \"Used to set the sides of the material that get rendered. Options are:\\n\\\r\n\\n\\\r\n* `THREE.FontSide`\\n\\\r\n* `THREE.BackSide`\\n\\\r\n* `THREE.DoubleSide`\\n\\\r\n\\n\\n\"\r\n  }, {\r\n    name: \"opacity\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"Set how opaque the material will be. When this value is set to a value less than 1, the `transparent` option is automatically set as well\"\r\n  }, {\r\n    name: \"transparent\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Set to true to make the material participate in z-buffered transparency rendering.\"\r\n  }, {\r\n    name: \"useFog\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: true,\r\n    description: \"Set whether or not the material is affected by fog in the scene.\"\r\n  }, {\r\n    name: \"wireframe\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: true,\r\n    description: \"Set whether or not the material is rendered as a wireframe, rather than full polygons.\"\r\n  }, {\r\n    name: \"roughness\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 0.5,\r\n    description: \"When `unshaded` is falsey, sets the THREE.MeshStandardMaterial's diffuse scattering parameter.\"\r\n  }, {\r\n    name: \"metalness\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 0,\r\n    description: \"When `unshaded` is falsey, sets the THREE.MeshStandardMaterial's specular reflection parameter.\"\r\n  }, {\r\n    name: \"emissive\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: true,\r\n    description: \"When `unshaded` is falsey, sets the light that the THREE.MeshStandardMaterial emits onto the scene.\"\r\n  } ]\r\n});\r\n\r\nimport { FrontSide, FlatShading, MeshStandardMaterial, MeshBasicMaterial } from \"three\";\r\nimport cache from \"../util/cache\";\r\nexport default function material(textureDescription, options){\r\n  if(options === undefined && typeof textureDescription !== \"string\") {\r\n    options = textureDescription;\r\n    textureDescription = \"none\";\r\n  }\r\n  options = Object.assign({}, {\r\n    opacity: 1,\r\n    roughness: 0.5,\r\n    metalness: 0,\r\n    color: 0xffffff,\r\n    useFog: true,\r\n    unshaded: false,\r\n    wireframe: false,\r\n    side: FrontSide\r\n  }, options);\r\n\r\n  var materialDescription = `Primrose.material(${textureDescription}, ${options.color}, ${options.unshaded}, ${options.side}, ${options.opacity}, ${options.roughness}, ${options.metalness}, ${options.color}, ${options.emissive}, ${options.wireframe}, ${options.useFog})`;\r\n\r\n  return cache(materialDescription, () => {\r\n    var materialOptions = {\r\n        fog: options.useFog,\r\n        transparent: options.transparent || (options.opacity !== undefined && options.opacity < 1),\r\n        opacity: options.opacity,\r\n        side: options.side || FrontSide\r\n      },\r\n      MaterialType = MeshStandardMaterial;\r\n\r\n    if (options.unshaded) {\r\n      materialOptions.shading = FlatShading;\r\n      MaterialType = MeshBasicMaterial;\r\n    }\r\n    else {\r\n      materialOptions.roughness = options.roughness;\r\n      materialOptions.metalness = options.metalness;\r\n\r\n      if (options.emissive !== undefined) {\r\n        materialOptions.emissive = options.emissive;\r\n      }\r\n    }\r\n\r\n    var mat = new MaterialType(materialOptions);\r\n    if (typeof options.color === \"number\" || options.color instanceof Number) {\r\n      mat.color.set(options.color);\r\n    }\r\n    mat.wireframe = options.wireframe;\r\n    return mat;\r\n  });\r\n};\r\n","pliny.function({\r\n  parent: \"Primrose.Graphics\",\r\n  name: \"loadTexture\",\r\n  description: \"Loads an image as a texture\",\r\n  returns: \"THREE.Texture or THREE.CubteTexture\",\r\n  parameters: [{\r\n    name: \"id\",\r\n    type: \"String\",\r\n    description: \"The key to use to cache the texture.\"\r\n  }, {\r\n    name: \"url\",\r\n    type: \"String or 6-item Array of String\",\r\n    description: \"The texture path(s) to load.\"\r\n  }, {\r\n    name: \"progress\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"A callback function to use for tracking progress. The callback function should accept a standard [`ProgressEvent`](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent).\"\r\n  }]\r\n})\r\n\r\nimport { CubeTextureLoader, TextureLoader, Texture } from \"three\";\r\nimport cache from \"../../util/cache\";\r\n\r\nexport default function loadTexture(id, url, progress) {\r\n  var textureLoader = null;\r\n  if(url instanceof Array && url.length === 6) {\r\n    textureLoader = new CubeTextureLoader();;\r\n  }\r\n  else {\r\n    if(url instanceof HTMLImageElement){\r\n      url = url.src;\r\n    }\r\n\r\n    if(typeof url === \"string\") {\r\n      textureLoader = new TextureLoader();\r\n    }\r\n  }\r\n\r\n  if(textureLoader){\r\n    textureLoader.setCrossOrigin(\"anonymous\");\r\n  }\r\n\r\n  return cache(\r\n    `Texture(${id})`,\r\n    () => new Promise((resolve, reject) => {\r\n      if(textureLoader){\r\n        textureLoader.load(url, resolve, progress, reject);\r\n      }\r\n      else{\r\n        resolve(new Texture(url))\r\n      };\r\n    }));\r\n}\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"textured\",\r\n  description: \"Combines a geometry and a texture description into a mesh. The texture description can be quite complex, as there are a lot of options. The following description makes using this function sound quite complex, but it's actually quite easy to use. It's just complex in its implementation to be able to accommodate ease of use.\",\r\n  returns: \"THREE.Mesh\",\r\n  parameters: [{\r\n    name: \"geometry\",\r\n    type: \"THREE.Geometry or THREE.Mesh\",\r\n    description: \"The object to which to apply the texture. If the object provided is a THREE.Mesh, this replaces the material currently being used on the Mesh without creating a new Mesh.\"\r\n  }, {\r\n    name: \"txt\",\r\n    type: \"one of: [String, 6-item Array of String, Primrose.Controls.Surface, HTMLCanvasElement, HTMLVideoElement, HTMLImageElement, THREE.Texture]\",\r\n    description: \"There are a lot of options for the types of things use can use for this parameter:\\n\\\r\n\\n\\\r\n* `String` - A texture will be loaded using the default texture loader with this value as the `src` attribute of the Image that is to be loaded.\\n\\\r\n* `6-item Array of String` - Each item of the array will be loaded as a texture as in the case of a single String, but the results will be used to create a THREE.CubeTexture, rather than a THREE.Texture, thereby creating a cube-map.\\n\\\r\n* `Primrose.Controls.Surface` - any subclass of the Surface class, including 2D button controls or text editors.\\n\\\r\n* `HTMLCanvasElement`, `HTMLVideoElement`, or `HTMLImageElement` - HTML elements that represent image data in some way.\\n\\\r\n* `THREE.Texture` - for convenience, any previously loaded texture may also be used as the texture parameter.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Live API.textured.optionsHash\",\r\n    optional: true,\r\n    description: \"Options to pass to the THREE.Texture constructor, or infrequently-used options to change the behavior of the setup. See [`Live API.textured.optionsHash`](#LiveAPI_textured_optionsHash) and [`Live API.material.optionsHash`](#LiveAPI_material_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"You'll typically want to create textures out of images.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var moon = textured(circle(1, 45), \\\"moon.jpg\\\", {\\n\\\r\n      unshaded: true,\\n\\\r\n      useFog: false\\n\\\r\n    });\\n\\\r\n    \\n\\\r\n    env.sky.add(moon); // assuming we have a `Primrose.BrowserEnvironment` named `env`\\n\\\r\n    moon.latLng(-30, 30, 7);\\n\\\r\n    moon.lookAt(env.scene.position);\\n\\\r\n\\n\\\r\nThe result should appear as:\\n\\\r\n\\n\\\r\n![screenshot](images/moon.jpg)\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Live API.textured\",\r\n  name: \"optionsHash\",\r\n  type: \"Object\",\r\n  description: \"Optional options to alter how the texture is applied to the geometry. This also includes options that are passed on to the [`material()`](#LiveAPI_material) function.\",\r\n  parameters: [{\r\n    name: \"progress\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"A callback function to use for tracking progress. The callback function should accept a standard [`ProgressEvent`](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent).\"\r\n  }, {\r\n    name: \"resolve\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"A callback function to use when a texture is successfully created. It's generally best to use this callback to add the mesh to the scene, rather than adding the mesh when `textured()` returns, as textures that need time to load will cause WebGL warnings and slow down the overall experience.\"\r\n  }, {\r\n    name: \"reject\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"An error callback function to use when the texture could not be loaded.\"\r\n  }, {\r\n    name: \"shadow\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"If true, this texture will receive shadows from other objects, and the mesh will cast shadows onto other objects.\"\r\n  }, {\r\n    name: \"txtRepeatX\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The number of times to repeat the texture across the mesh in the X axis.\"\r\n  }, {\r\n    name: \"txtRepeatY\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The number of times to repeat the texture across the mesh in the Y axis.\"\r\n  }, {\r\n    name: \"anisotropy\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The degree to which to sharpen textures at large distances and sharp angles.\"\r\n  }, {\r\n    name: \"scaleTexture\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The degree to which to resize a texture on both the X and Y  axis, if separate `scaleTextureWidth` and `scaleTextureHeight` options are not provided.\"\r\n  }, {\r\n    name: \"scaleTextureWidth\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The degree to which to resize a texture on the X axis to fit on the model.\"\r\n  }, {\r\n    name: \"scaleTextureHeight\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The degree to which to resize a texture on the Y axis to fit on the model.\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport material from \"./material\";\r\nimport { Mesh, RepeatWrapping, Texture } from \"three\";\r\nimport loadTexture from \"../Primrose/Graphics/loadTexture\";\r\n\r\nconst seenElements = new WeakMap();\r\nlet seenElementCount = 0;\r\n\r\nexport default function textured(geometry, txt, options) {\r\n  if(!options){\r\n    options = {};\r\n  }\r\n  if(!options.txtRepeatX){\r\n    options.txtRepeatX = 1;\r\n  }\r\n  if(!options.txtRepeatY){\r\n    options.txtRepeatY = 1;\r\n  }\r\n  if(!options.anisotropy){\r\n    options.anisotropy = 1;\r\n  }\r\n\r\n  let txtType = typeof txt,\r\n    txtID = null;\r\n  if(txtType === \"object\") {\r\n    if(txt.id){\r\n      txtID = txt.id;\r\n    }\r\n    else{\r\n      if(!seenElements.has(txt)) {\r\n        seenElements.set(txt, \"TextureAutoID\" + seenElementCount);\r\n        ++seenElementCount;\r\n      }\r\n      txtID = seenElements.get(txt);\r\n    }\r\n  }\r\n  else if(txtType === \"string\") {\r\n    txtID = txt;\r\n  }\r\n  else{\r\n    var err = new Error(`Couldn't figure out how to make a texture out of typeof '${txtType}', value ${txt}.`);\r\n    if(options.reject){\r\n      options.reject(err);\r\n    }\r\n    else{\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  const textureDescription = `Primrose.textured(${txtID}, ${options.txtRepeatX}, ${options.txtRepeatY}, ${options.anisotropy}, ${options.scaleTextureWidth}, ${options.scaleTextureHeight})`;\r\n  const texturePromise = cache(textureDescription, () => {\r\n      if (typeof txt === \"string\" || (txt instanceof Array || txt.length === 6)) {\r\n        return loadTexture(textureDescription, txt, options.progress);\r\n      }\r\n      else {\r\n        let retValue = null;\r\n        if (txt instanceof HTMLCanvasElement || txt instanceof HTMLVideoElement || txt instanceof HTMLImageElement) {\r\n          retValue = new Texture(txt);\r\n        }\r\n        else if(txt.isTexture) {\r\n          retValue = txt;\r\n        }\r\n        else {\r\n          Promise.reject(\"Texture description couldn't be converted to a THREE.Texture object\");\r\n        }\r\n\r\n        return Promise.resolve(retValue);\r\n      }\r\n    });\r\n\r\n  var mat = material(textureDescription, options),\r\n    obj = null;\r\n  if (geometry.type.indexOf(\"Geometry\") > -1) {\r\n    obj = new Mesh(geometry, mat);\r\n  }\r\n  else if (geometry.isMesh) {\r\n    obj = geometry;\r\n    obj.material = mat;\r\n    geometry = obj.geometry;\r\n  }\r\n\r\n  if(options.shadow){\r\n    obj.receiveShadow = true;\r\n    obj.castShadow = true;\r\n  }\r\n\r\n  if ((options.scaleTextureWidth || options.scaleTextureHeight)) {\r\n    if (geometry.attributes && geometry.attributes.uv && geometry.attributes.uv.array) {\r\n      var uv = geometry.attributes.uv,\r\n        arr = uv.array,\r\n        i;\r\n      if (options.scaleTextureWidth) {\r\n        for (i = 0; i < arr.length; i += uv.itemSize) {\r\n          arr[i] *= options.scaleTextureWidth;\r\n        }\r\n      }\r\n      if (options.scaleTextureHeight) {\r\n        for (i = 1; i < arr.length; i += uv.itemSize) {\r\n          arr[i] = 1 - (1 - arr[i]) * options.scaleTextureHeight;\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      console.trace(geometry, options);\r\n    }\r\n  }\r\n\r\n  options.promise = texturePromise.then((texture) => {\r\n    if (options.txtRepeatX * options.txtRepeatY > 1) {\r\n      texture.wrapS = texture.wrapT = RepeatWrapping;\r\n      texture.repeat.set(options.txtRepeatX, options.txtRepeatY);\r\n    }\r\n\r\n    texture.anisotropy = options.anisotropy;\r\n\r\n    if(texture.isCubeTexture){\r\n      mat.envMap = texture;\r\n    }\r\n    else if(texture.isTexture){\r\n      mat.map = texture;\r\n    }\r\n\r\n    mat.needsUpdate = true;\r\n    texture.needsUpdate = true;\r\n    return texture;\r\n  });\r\n\r\n  return obj;\r\n}\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"colored\",\r\n  description: \"Apply a color to a geometry, creating the intermediate material as necessary, and returning the resulting mesh\",\r\n  returns: \"THREE.Mesh\",\r\n  parameters: [{\r\n    name: \"geometry\",\r\n    type: \"THREE.Geometry\",\r\n    description: \"The geometry to which to apply the color.\"\r\n  }, {\r\n    name: \"color\",\r\n    type: \"Number\",\r\n    description: \"A hexadecimal color value in RGB format.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Live API.colored.optionsHash\",\r\n    optional: true,\r\n    description: \"Options to pass on to [`material()`](#LiveAPI_material), or infrequently-used options to change the behavior of the setup. See [`Live API.colored.optionsHash`](#LiveAPI_colored_optionsHash) and [`Live API.material.optionsHash`](#LiveAPI_material_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Usage\",\r\n    description: `Apply color to a geometry:\r\n\r\n    grammar(\"JavaScript\");\r\n    var geom = box(),\r\n      red = colored(geom, 0xff0000),\r\n      green = colored(geom, 0x00ff00),\r\n      blue = colored(geom, 0x0000ff);\r\n\r\n    red.position.set(-2, 1, -1);\r\n    green.position.set(0, 1, -1);\r\n    blue.position.set(2, 1, -1);\r\n\r\n    env.scene.add(red);\r\n    env.scene.add(green);\r\n    env.scene.add(blue);\r\n\r\nThe results should look like this:\r\n\r\n<img src=\"images/colored.jpg\">`\r\n  }]\r\n});\r\n\r\n\r\npliny.record({\r\n  parent: \"Live API.colored\",\r\n  name: \"optionsHash\",\r\n  type: \"Object\",\r\n  description: \"Optional options to alter how the texture is applied to the geometry. This also includes options that are passed on to the [`material()`](#LiveAPI_material) function.\",\r\n  parameters: [{\r\n    name: \"resolve\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"A callback function to use when the material is successfully created, so that `colored()` can be used in place of `textured()`.\"\r\n  }]\r\n});\r\n\r\nimport { Mesh } from \"three\";\r\nimport material from \"./material\";\r\nexport default function colored(geometry, color, options) {\r\n  options = options || {};\r\n  options.color = color;\r\n\r\n  var mat = material(\"\", options),\r\n    obj = null;\r\n\r\n  if (geometry.type.indexOf(\"Geometry\") > -1) {\r\n    obj = new Mesh(geometry, mat);\r\n  }\r\n  else if (geometry.isObject3D) {\r\n    obj = geometry;\r\n    obj.material = mat;\r\n  }\r\n\r\n  if(options.shadow){\r\n    obj.receiveShadow = true;\r\n    obj.castShadow = true;\r\n  }\r\n\r\n  if(options.resolve){\r\n    options.resolve();\r\n  }\r\n  return obj;\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"box\",\r\n  description: \"A shortcut function for the THREE.BoxGeometry class. Creates a \\\"rectilinear prism\\\", i.e. the general class of rectangular objects that includes cubes.\",\r\n  parameters: [{\r\n    name: \"width\",\r\n    type: \"Number\",\r\n    description: \"The size of the box in the X dimension.\"\r\n  }, {\r\n    name: \"height\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The size of the box in the Y dimension. If height is not provided, it will be set to the width parameter.\"\r\n  }, {\r\n    name: \"length\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The size of the box in the Z dimension. If length is not provided, it will be set to the width parameter.\"\r\n  }, {\r\n    name: \"t\",\r\n    type: \"Number\",\r\n    description: \"The number of horizontal sections in which to split the box.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"u\",\r\n    type: \"Number\",\r\n    description: \"The number of vertical sections in which to split the box.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"v\",\r\n    type: \"Number\",\r\n    description: \"The number of sections deep in which to split the box.\",\r\n    optional: true,\r\n    default: 1\r\n  }],\r\n  returns: \"THREE.BoxGeometry\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Three.js separates geometry from materials, so you can create shared materials and geometry that recombine in different ways. To create a simple box geometry object that you can then add a material to create a mesh:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var geom = box(1, 2, 3),\\n\\\r\n      mesh = colored(geom, 0xff0000);\\n\\\r\n    mesh\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nIt should look something like this:\\n\\\r\n<img src=\\\"images/box.jpg\\\">\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { BoxBufferGeometry } from \"three\";\r\nexport default function box(width, height, length, t, u, v) {\r\n  if (height === undefined) {\r\n    height = width;\r\n  }\r\n  if (length === undefined) {\r\n    length = width;\r\n  }\r\n  return cache(\r\n    `BoxBufferGeometry(${width}, ${height}, ${length}, ${t}, ${u}, ${v})`,\r\n    () => new BoxBufferGeometry(width, height, length, t, u, v));\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"brick\",\r\n  description: \"Creates a textured box. See [`box()`](#LiveAPI_box) and [`textured()`](#LiveAPI_textured) or [`colored()`](#LiveAPI_colored). The texture will be repeated across the box.\",\r\n  parameters: [{\r\n    name: \"txt\",\r\n    type: \"Number or Image\",\r\n    description: \"The texture to apply to the box.\"\r\n  }, {\r\n    name: \"width\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The size of the box in the X dimension.\",\r\n    default: 1\r\n  }, {\r\n    name: \"height\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The size of the box in the Y dimension.\",\r\n    default: 1\r\n  }, {\r\n    name: \"length\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The size of the box in the Z dimension.\",\r\n    default: 1\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    optional: true,\r\n    description: \"A hashmap specifying other options to pass on to the material creation function. The material creation function is either [`colored()`](#LiveAPI_colored) or [`textured()`](#LiveAPI_textured), depending on the value of the `txt` parameter passed to this function.\"\r\n  }],\r\n  returns: \"THREE.Mesh\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"To create a textured brick with the `brick()` function.:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var mesh = brick(DECK, 1, 2, 3)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nThe result should appear as:\\n\\\r\n\\n\\\r\n![screenshot](images/brick.jpg)\"\r\n  }]\r\n});\r\n\r\nimport textured from \"./textured\";\r\nimport colored from \"./colored\";\r\nimport box from \"./box\";\r\nexport default function brick(txt, width, height, length, options) {\r\n  width = width || 1;\r\n  height = height || 1;\r\n  length = length || 1;\r\n  options = Object.assign({}, {\r\n    txtRepeatX: width,\r\n    txtRepeatY: length,\r\n    anisotropy: 8,\r\n    transparent: true,\r\n    opacity: 1\r\n  }, options);\r\n  const m = (typeof txt === \"number\") ? colored : textured,\r\n    obj = m(box(width, height, length), txt, options);\r\n  return obj;\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"axis\",\r\n  description: \"Creates a set of reference axes, with X as red, Y as green, and Z as blue.\",\r\n  parameters: [{\r\n    name: \"length\",\r\n    type: \"Number\",\r\n    description: \"The length each axis should be in its own axis.\"\r\n  }, {\r\n    name: \"width\",\r\n    type: \"Number\",\r\n    description: \"The size each axis should be in the other axes.\"\r\n  }],\r\n  returns: \"THREE.Object3D\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"To create a fixed point of reference in the scene, use the `axis()` function.:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var scene = new THREE.Scene()\\n\\\r\n    // This set of axis bars will each be 1 meter long and 5cm wide.\\n\\\r\n    // They'll be centered on each other, so the individual halves\\n\\\r\n    // of the bars will only extend half a meter.\\n\\\r\n    scene.add(axis(1, 0.05));\\n\\\r\n\\n\\\r\nThe result should appear as:\\n\\\r\n\\n\\\r\n![screenshot](images/axis.png)\"\r\n  }]\r\n});\r\n\r\nimport hub from \"./hub\";\r\nimport brick from \"./brick\";\r\nexport default function axis(length, width) {\r\n  return hub()\r\n    .add(brick(0xff0000, length, width, width))\r\n    .add(brick(0x00ff00, width, length, width))\r\n    .add(brick(0x0000ff, width, width, length));\r\n};","var index = typeof Symbol === 'undefined' ? function (description) {\n\treturn '@' + (description || '@') + Math.random();\n} : Symbol;\n\nexport default index;","/*! npm.im/intervalometer */\nfunction intervalometer(cb, request, cancel, requestParameter) {\n\tvar requestId;\n\tvar previousLoopTime;\n\tfunction loop(now) {\n\t\t// must be requested before cb() because that might call .stop()\n\t\trequestId = request(loop, requestParameter);\n\n\t\t// called with \"ms since last call\". 0 on start()\n\t\tcb(now - (previousLoopTime || now));\n\n\t\tpreviousLoopTime = now;\n\t}\n\treturn {\n\t\tstart: function start() {\n\t\t\tif (!requestId) { // prevent double starts\n\t\t\t\tloop(0);\n\t\t\t}\n\t\t},\n\t\tstop: function stop() {\n\t\t\tcancel(requestId);\n\t\t\trequestId = null;\n\t\t\tpreviousLoopTime = 0;\n\t\t}\n\t};\n}\n\nfunction frameIntervalometer(cb) {\n\treturn intervalometer(cb, requestAnimationFrame, cancelAnimationFrame);\n}\n\nfunction timerIntervalometer(cb, delay) {\n\treturn intervalometer(cb, setTimeout, clearTimeout, delay);\n}\n\nexport { intervalometer, frameIntervalometer, timerIntervalometer };","/*! npm.im/iphone-inline-video */\nimport Symbol from 'poor-mans-symbol';\nimport { frameIntervalometer } from 'intervalometer';\n\nfunction preventEvent(element, eventName, toggleProperty, preventWithProperty) {\n\tfunction handler(e) {\n\t\tif (Boolean(element[toggleProperty]) === Boolean(preventWithProperty)) {\n\t\t\te.stopImmediatePropagation();\n\t\t\t// console.log(eventName, 'prevented on', element);\n\t\t}\n\t\tdelete element[toggleProperty];\n\t}\n\telement.addEventListener(eventName, handler, false);\n\n\t// Return handler to allow to disable the prevention. Usage:\n\t// const preventionHandler = preventEvent(el, 'click');\n\t// el.removeEventHandler('click', preventionHandler);\n\treturn handler;\n}\n\nfunction proxyProperty(object, propertyName, sourceObject, copyFirst) {\n\tfunction get() {\n\t\treturn sourceObject[propertyName];\n\t}\n\tfunction set(value) {\n\t\tsourceObject[propertyName] = value;\n\t}\n\n\tif (copyFirst) {\n\t\tset(object[propertyName]);\n\t}\n\n\tObject.defineProperty(object, propertyName, {get: get, set: set});\n}\n\nfunction proxyEvent(object, eventName, sourceObject) {\n\tsourceObject.addEventListener(eventName, function () { return object.dispatchEvent(new Event(eventName)); });\n}\n\nfunction dispatchEventAsync(element, type) {\n\tPromise.resolve().then(function () {\n\t\telement.dispatchEvent(new Event(type));\n\t});\n}\n\n// iOS 10 adds support for native inline playback + silent autoplay\nvar isWhitelisted = 'object-fit' in document.head.style && /iPhone|iPod/i.test(navigator.userAgent) && !matchMedia('(-webkit-video-playable-inline)').matches;\n\nvar ಠ = Symbol();\nvar ಠevent = Symbol();\nvar ಠplay = Symbol('nativeplay');\nvar ಠpause = Symbol('nativepause');\n\n/**\n * UTILS\n */\n\nfunction getAudioFromVideo(video) {\n\tvar audio = new Audio();\n\tproxyEvent(video, 'play', audio);\n\tproxyEvent(video, 'playing', audio);\n\tproxyEvent(video, 'pause', audio);\n\taudio.crossOrigin = video.crossOrigin;\n\n\t// 'data:' causes audio.networkState > 0\n\t// which then allows to keep <audio> in a resumable playing state\n\t// i.e. once you set a real src it will keep playing if it was if .play() was called\n\taudio.src = video.src || video.currentSrc || 'data:';\n\n\t// if (audio.src === 'data:') {\n\t//   TODO: wait for video to be selected\n\t// }\n\treturn audio;\n}\n\nvar lastRequests = [];\nvar requestIndex = 0;\nvar lastTimeupdateEvent;\n\nfunction setTime(video, time, rememberOnly) {\n\t// allow one timeupdate event every 200+ ms\n\tif ((lastTimeupdateEvent || 0) + 200 < Date.now()) {\n\t\tvideo[ಠevent] = true;\n\t\tlastTimeupdateEvent = Date.now();\n\t}\n\tif (!rememberOnly) {\n\t\tvideo.currentTime = time;\n\t}\n\tlastRequests[++requestIndex % 3] = time * 100 | 0 / 100;\n}\n\nfunction isPlayerEnded(player) {\n\treturn player.driver.currentTime >= player.video.duration;\n}\n\nfunction update(timeDiff) {\n\tvar player = this;\n\t// console.log('update', player.video.readyState, player.video.networkState, player.driver.readyState, player.driver.networkState, player.driver.paused);\n\tif (player.video.readyState >= player.video.HAVE_FUTURE_DATA) {\n\t\tif (!player.hasAudio) {\n\t\t\tplayer.driver.currentTime = player.video.currentTime + ((timeDiff * player.video.playbackRate) / 1000);\n\t\t\tif (player.video.loop && isPlayerEnded(player)) {\n\t\t\t\tplayer.driver.currentTime = 0;\n\t\t\t}\n\t\t}\n\t\tsetTime(player.video, player.driver.currentTime);\n\t} else if (player.video.networkState === player.video.NETWORK_IDLE && !player.video.buffered.length) {\n\t\t// this should happen when the source is available but:\n\t\t// - it's potentially playing (.paused === false)\n\t\t// - it's not ready to play\n\t\t// - it's not loading\n\t\t// If it hasAudio, that will be loaded in the 'emptied' handler below\n\t\tplayer.video.load();\n\t\t// console.log('Will load');\n\t}\n\n\t// console.assert(player.video.currentTime === player.driver.currentTime, 'Video not updating!');\n\n\tif (player.video.ended) {\n\t\tdelete player.video[ಠevent]; // allow timeupdate event\n\t\tplayer.video.pause(true);\n\t}\n}\n\n/**\n * METHODS\n */\n\nfunction play() {\n\t// console.log('play');\n\tvar video = this;\n\tvar player = video[ಠ];\n\n\t// if it's fullscreen, use the native player\n\tif (video.webkitDisplayingFullscreen) {\n\t\tvideo[ಠplay]();\n\t\treturn;\n\t}\n\n\tif (player.driver.src !== 'data:' && player.driver.src !== video.src) {\n\t\t// console.log('src changed on play', video.src);\n\t\tsetTime(video, 0, true);\n\t\tplayer.driver.src = video.src;\n\t}\n\n\tif (!video.paused) {\n\t\treturn;\n\t}\n\tplayer.paused = false;\n\n\tif (!video.buffered.length) {\n\t\t// .load() causes the emptied event\n\t\t// the alternative is .play()+.pause() but that triggers play/pause events, even worse\n\t\t// possibly the alternative is preventing this event only once\n\t\tvideo.load();\n\t}\n\n\tplayer.driver.play();\n\tplayer.updater.start();\n\n\tif (!player.hasAudio) {\n\t\tdispatchEventAsync(video, 'play');\n\t\tif (player.video.readyState >= player.video.HAVE_ENOUGH_DATA) {\n\t\t\t// console.log('onplay');\n\t\t\tdispatchEventAsync(video, 'playing');\n\t\t}\n\t}\n}\nfunction pause(forceEvents) {\n\t// console.log('pause');\n\tvar video = this;\n\tvar player = video[ಠ];\n\n\tplayer.driver.pause();\n\tplayer.updater.stop();\n\n\t// if it's fullscreen, the developer the native player.pause()\n\t// This is at the end of pause() because it also\n\t// needs to make sure that the simulation is paused\n\tif (video.webkitDisplayingFullscreen) {\n\t\tvideo[ಠpause]();\n\t}\n\n\tif (player.paused && !forceEvents) {\n\t\treturn;\n\t}\n\n\tplayer.paused = true;\n\tif (!player.hasAudio) {\n\t\tdispatchEventAsync(video, 'pause');\n\t}\n\tif (video.ended) {\n\t\tvideo[ಠevent] = true;\n\t\tdispatchEventAsync(video, 'ended');\n\t}\n}\n\n/**\n * SETUP\n */\n\nfunction addPlayer(video, hasAudio) {\n\tvar player = video[ಠ] = {};\n\tplayer.paused = true; // track whether 'pause' events have been fired\n\tplayer.hasAudio = hasAudio;\n\tplayer.video = video;\n\tplayer.updater = frameIntervalometer(update.bind(player));\n\n\tif (hasAudio) {\n\t\tplayer.driver = getAudioFromVideo(video);\n\t} else {\n\t\tvideo.addEventListener('canplay', function () {\n\t\t\tif (!video.paused) {\n\t\t\t\t// console.log('oncanplay');\n\t\t\t\tdispatchEventAsync(video, 'playing');\n\t\t\t}\n\t\t});\n\t\tplayer.driver = {\n\t\t\tsrc: video.src || video.currentSrc || 'data:',\n\t\t\tmuted: true,\n\t\t\tpaused: true,\n\t\t\tpause: function () {\n\t\t\t\tplayer.driver.paused = true;\n\t\t\t},\n\t\t\tplay: function () {\n\t\t\t\tplayer.driver.paused = false;\n\t\t\t\t// media automatically goes to 0 if .play() is called when it's done\n\t\t\t\tif (isPlayerEnded(player)) {\n\t\t\t\t\tsetTime(video, 0);\n\t\t\t\t}\n\t\t\t},\n\t\t\tget ended() {\n\t\t\t\treturn isPlayerEnded(player);\n\t\t\t}\n\t\t};\n\t}\n\n\t// .load() causes the emptied event\n\tvideo.addEventListener('emptied', function () {\n\t\t// console.log('driver src is', player.driver.src);\n\t\tvar wasEmpty = !player.driver.src || player.driver.src === 'data:';\n\t\tif (player.driver.src && player.driver.src !== video.src) {\n\t\t\t// console.log('src changed to', video.src);\n\t\t\tsetTime(video, 0, true);\n\t\t\tplayer.driver.src = video.src;\n\t\t\t// playing videos will only keep playing if no src was present when .play()’ed\n\t\t\tif (wasEmpty) {\n\t\t\t\tplayer.driver.play();\n\t\t\t} else {\n\t\t\t\tplayer.updater.stop();\n\t\t\t}\n\t\t}\n\t}, false);\n\n\t// stop programmatic player when OS takes over\n\tvideo.addEventListener('webkitbeginfullscreen', function () {\n\t\tif (!video.paused) {\n\t\t\t// make sure that the <audio> and the syncer/updater are stopped\n\t\t\tvideo.pause();\n\n\t\t\t// play video natively\n\t\t\tvideo[ಠplay]();\n\t\t} else if (hasAudio && !player.driver.buffered.length) {\n\t\t\t// if the first play is native,\n\t\t\t// the <audio> needs to be buffered manually\n\t\t\t// so when the fullscreen ends, it can be set to the same current time\n\t\t\tplayer.driver.load();\n\t\t}\n\t});\n\tif (hasAudio) {\n\t\tvideo.addEventListener('webkitendfullscreen', function () {\n\t\t\t// sync audio to new video position\n\t\t\tplayer.driver.currentTime = video.currentTime;\n\t\t\t// console.assert(player.driver.currentTime === video.currentTime, 'Audio not synced');\n\t\t});\n\n\t\t// allow seeking\n\t\tvideo.addEventListener('seeking', function () {\n\t\t\tif (lastRequests.indexOf(video.currentTime * 100 | 0 / 100) < 0) {\n\t\t\t\t// console.log('User-requested seeking');\n\t\t\t\tplayer.driver.currentTime = video.currentTime;\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction overloadAPI(video) {\n\tvar player = video[ಠ];\n\tvideo[ಠplay] = video.play;\n\tvideo[ಠpause] = video.pause;\n\tvideo.play = play;\n\tvideo.pause = pause;\n\tproxyProperty(video, 'paused', player.driver);\n\tproxyProperty(video, 'muted', player.driver, true);\n\tproxyProperty(video, 'playbackRate', player.driver, true);\n\tproxyProperty(video, 'ended', player.driver);\n\tproxyProperty(video, 'loop', player.driver, true);\n\tpreventEvent(video, 'seeking');\n\tpreventEvent(video, 'seeked');\n\tpreventEvent(video, 'timeupdate', ಠevent, false);\n\tpreventEvent(video, 'ended', ಠevent, false); // prevent occasional native ended events\n}\n\nfunction enableInlineVideo(video, hasAudio, onlyWhitelisted) {\n\tif ( hasAudio === void 0 ) hasAudio = true;\n\tif ( onlyWhitelisted === void 0 ) onlyWhitelisted = true;\n\n\tif ((onlyWhitelisted && !isWhitelisted) || video[ಠ]) {\n\t\treturn;\n\t}\n\taddPlayer(video, hasAudio);\n\toverloadAPI(video);\n\tvideo.classList.add('IIV');\n\tif (!hasAudio && video.autoplay) {\n\t\tvideo.play();\n\t}\n\tif (!/iPhone|iPod|iPad/.test(navigator.platform)) {\n\t\tconsole.warn('iphone-inline-video is not guaranteed to work in emulated environments');\n\t}\n}\n\nenableInlineVideo.isWhitelisted = isWhitelisted;\n\nexport default enableInlineVideo;","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Entity\",\r\n  baseClass: \"THREE.Object3D\",\r\n  description: \"The Entity class is the parent class for all 3D controls. It manages a unique ID for every new control, the focus state of the control, and performs basic conversions from DOM elements to the internal Control format.\"\r\n});\r\n\r\nimport { Object3D } from \"three\";\r\n\r\nexport default class Entity extends Object3D {\r\n\r\n  constructor(name, options) {\r\n    super();\r\n    this.isEntity = true;\r\n    this.name = name;\r\n    this.options = options || {};\r\n    this.ready = this._ready.then(() => this);\r\n    this.disabled = false;\r\n  }\r\n\r\n  get _ready() {\r\n    return Promise.resolve();\r\n  }\r\n};\r\n","pliny.function({\r\n  parent: \"Primrose.Graphics\",\r\n  name: \"fixGeometry\",\r\n  description: \"Performs some changes to the geometry's UV coordinates to make them work better.\",\r\n  returns: \"THREE.Geometry\",\r\n  parameters: [{\r\n    name: \"geometry\",\r\n    type: \"THREE.Geometry\",\r\n    description: \"The geometry to fix.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.Graphics.fixGeometry.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for changing the UV coordinates. See [`Primrose.Graphics.fixGeometry.optionsHash`](#Primrose_Graphics_fixGeometry_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Primrose.Graphics.fixGeometry\",\r\n  name: \"optionsHash\",\r\n  description: \"Options for changing the UV coordinates.\",\r\n  parameters: [{\r\n    name: \"maxU\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The value by which to scale the U component of the texture coordinate.\"\r\n  }, {\r\n    name: \"maxV\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The value by which to scale the V component of the texture coordinate.\"\r\n  }]\r\n});\r\nexport default function fixGeometry(geometry, options){\r\n  options = options || {};\r\n  const maxU = options.maxU || 1,\r\n    maxV = options.maxV || 1,\r\n    attrs = geometry.attributes || (geometry._bufferGeometry && geometry._bufferGeometry.attributes);\r\n  if (attrs && attrs.uv && attrs.uv.array) {\r\n    const uv = attrs.uv,\r\n      arr = uv.array;\r\n    for (let j = 0; j < arr.length; j += uv.itemSize) {\r\n      arr[j] *= maxU;\r\n    }\r\n    for (let j = 1; j < arr.length; j += uv.itemSize) {\r\n      arr[j] = 1 - (1 - arr[j]) * maxV;\r\n    }\r\n  }\r\n  else if(geometry.faceVertexUvs) {\r\n    const faces = geometry.faceVertexUvs;\r\n    for(let i = 0; i < faces.length; ++i){\r\n      const face = faces[i];\r\n      for(let j = 0; j < face.length; ++j){\r\n        const uvs = face[j];\r\n        for(let k = 0; k < uvs.length; ++k){\r\n          const uv = uvs[k];\r\n          uv.x *= maxU;\r\n          uv.y = 1 - (1 - uv.y) * maxV;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return geometry;\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"quad\",\r\n  description: \"A shortcut function for the THREE.PlaneBufferGeometry class. Creates a flat rectangle, oriented in the XY plane.\",\r\n  parameters: [{\r\n    name: \"width\",\r\n    type: \"Number\",\r\n    description: \"The width of the rectangle.\"\r\n  }, {\r\n    name: \"height\",\r\n    type: \"Number\",\r\n    description: \"The height of the rectangle.\",\r\n    optional: true,\r\n    default: \"The value of the `width` parameter.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Live API.quad.optionsHash\",\r\n    optional: true,\r\n    description: \"Optional settings for creating the quad geometry. See [`Live API.quad.optionsHash`](#LiveAPI_quad_optionsHash) for more information.\"\r\n  }],\r\n  returns: \"THREE.PlaneBufferGeometry\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Three.js separates geometry from materials, so you can create shared materials and geometry that recombine in different ways. To create a simple circle geometry object that you can then add a material to create a mesh:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var mesh = quad(1, 2)\\n\\\r\n      .colored(0xff0000)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nIt should look something like this:\\n\\\r\n<img src=\\\"images/quad.jpg\\\">\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Live API.quad\",\r\n  name: \"optionsHash\",\r\n  description: \"Optional options to alter how the quad is built.\",\r\n  parameters: [{\r\n    name: \"s\",\r\n    type: \"Number\",\r\n    description: \"The number of sub-quads in which to divide the quad horizontally.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"t\",\r\n    type: \"Number\",\r\n    description: \"The number of sub-quads in which to divide the quad vertically.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"maxU\",\r\n    type: \"Number\",\r\n    description: \"A scalar value for the texture coordinate U component.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"maxV\",\r\n    type: \"Number\",\r\n    description: \"A scalar value for the texture coordinate V component.\",\r\n    optional: true,\r\n    default: 1\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport fixGeometry from \"../Primrose/Graphics/fixGeometry\";\r\nimport { PlaneBufferGeometry } from \"three\";\r\nexport default function quad(width, height, options) {\r\n\r\n  if (width === undefined) {\r\n    width = 1;\r\n  }\r\n\r\n  if (height === undefined) {\r\n    height = width;\r\n  }\r\n\r\n  options = Object.assign({}, {\r\n    s: 1,\r\n    t: 1\r\n  }, options);\r\n\r\n  return cache(\r\n    `PlaneBufferGeometry(${width}, ${height}, ${options.s}, ${options.t}, ${options.maxU}, ${options.maxV})`,\r\n    () => fixGeometry(new PlaneBufferGeometry(width, height, options.s, options.t), options));\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Graphics\",\r\n  name: \"InsideSphereGeometry\",\r\n  parameters: [{\r\n    name: \"radius\",\r\n    type: \"Number\",\r\n    description: \"How far the sphere should extend away from a center point.\"\r\n  }, {\r\n    name: \"widthSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces wide in which to slice the geometry.\"\r\n  }, {\r\n    name: \"heightSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces tall in which to slice the geometry.\"\r\n  }, {\r\n    name: \"phiStart\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians around the Y-axis at which the sphere starts.\"\r\n  }, {\r\n    name: \"phiLength\",\r\n    type: \"Number\",\r\n    description: \"The change of angle in radians around the Y-axis to which the sphere ends.\"\r\n  }, {\r\n    name: \"thetaStart\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians around the Z-axis at which the sphere starts.\"\r\n  }, {\r\n    name: \"thetaLength\",\r\n    type: \"Number\",\r\n    description: \"The change of angle in radians around the Z-axis to which the sphere ends.\"\r\n  }],\r\n  description: \"The InsideSphereGeometry is basically an inside-out Sphere. Or\\n\\\r\nmore accurately, it's a Sphere where the face winding order is reversed, so that\\n\\\r\ntextures appear on the inside of the sphere, rather than the outside. I know, that's\\n\\\r\nnot exactly helpful.\\n\\\r\n\\n\\\r\nSay you want a to model the sky as a sphere, or the inside of a helmet. You don't\\n\\\r\ncare anything about the outside of this sphere, only the inside. You would use\\n\\\r\nInsideSphereGeometry in this case. Or its alias, [`shell()`](#LiveAPI_shell).\"\r\n});\r\n\r\nimport { Geometry, Vector3, Vector2, Face3, Sphere } from \"three\";\r\nexport default class InsideSphereGeometry extends Geometry {\r\n  constructor(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\r\n    super();\r\n\r\n    this.type = 'InsideSphereGeometry';\r\n\r\n    this.parameters = {\r\n      radius: radius,\r\n      widthSegments: widthSegments,\r\n      heightSegments: heightSegments,\r\n      phiStart: phiStart,\r\n      phiLength: phiLength,\r\n      thetaStart: thetaStart,\r\n      thetaLength: thetaLength\r\n    };\r\n\r\n    radius = radius || 50;\r\n\r\n    widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\r\n    heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\r\n\r\n    phiStart = phiStart !== undefined ? phiStart : 0;\r\n    phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n    thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n    thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n    var x,\r\n      y,\r\n      vertices = [],\r\n      uvs = [];\r\n\r\n    for (y = 0; y <= heightSegments; y++) {\r\n\r\n      var verticesRow = [];\r\n      var uvsRow = [];\r\n\r\n      for (x = widthSegments; x >= 0; x--) {\r\n\r\n        var u = x / widthSegments;\r\n\r\n        var v = y / heightSegments;\r\n\r\n        var vertex = new Vector3();\r\n        vertex.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(\r\n          thetaStart + v * thetaLength);\r\n        vertex.y = radius * Math.cos(thetaStart + v * thetaLength);\r\n        vertex.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(\r\n          thetaStart + v * thetaLength);\r\n\r\n        this.vertices.push(vertex);\r\n\r\n        verticesRow.push(this.vertices.length - 1);\r\n        uvsRow.push(new Vector2(1 - u, 1 - v));\r\n\r\n      }\r\n\r\n      vertices.push(verticesRow);\r\n      uvs.push(uvsRow);\r\n\r\n    }\r\n\r\n    for (y = 0; y < heightSegments; y++) {\r\n\r\n      for (x = 0; x < widthSegments; x++) {\r\n\r\n        var v1 = vertices[y][x + 1];\r\n        var v2 = vertices[y][x];\r\n        var v3 = vertices[y + 1][x];\r\n        var v4 = vertices[y + 1][x + 1];\r\n\r\n        var n1 = this.vertices[v1].clone()\r\n          .normalize();\r\n        var n2 = this.vertices[v2].clone()\r\n          .normalize();\r\n        var n3 = this.vertices[v3].clone()\r\n          .normalize();\r\n        var n4 = this.vertices[v4].clone()\r\n          .normalize();\r\n\r\n        var uv1 = uvs[y][x + 1].clone();\r\n        var uv2 = uvs[y][x].clone();\r\n        var uv3 = uvs[y + 1][x].clone();\r\n        var uv4 = uvs[y + 1][x + 1].clone();\r\n\r\n        if (Math.abs(this.vertices[v1].y) === radius) {\r\n\r\n          uv1.x = (uv1.x + uv2.x) / 2;\r\n          this.faces.push(new Face3(v1, v3, v4, [n1, n3, n4]));\r\n          this.faceVertexUvs[0].push([uv1, uv3, uv4]);\r\n\r\n        }\r\n        else if (Math.abs(this.vertices[v3].y) === radius) {\r\n\r\n          uv3.x = (uv3.x + uv4.x) / 2;\r\n          this.faces.push(new Face3(v1, v2, v3, [n1, n2, n3]));\r\n          this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n        }\r\n        else {\r\n\r\n          this.faces.push(new Face3(v1, v2, v4, [n1, n2, n4]));\r\n          this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n          this.faces.push(new Face3(v2, v3, v4, [n2.clone(), n3,\r\n            n4.clone()\r\n          ]));\r\n          this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeFaceNormals();\r\n\r\n    for (var i = 0; i < this.faces.length; ++i) {\r\n      var f = this.faces[i];\r\n      f.normal.multiplyScalar(-1);\r\n      for (var j = 0; j < f.vertexNormals.length; ++j) {\r\n        f.vertexNormals[j].multiplyScalar(-1);\r\n      }\r\n    }\r\n\r\n    this.boundingSphere = new Sphere(new Vector3(), radius);\r\n\r\n  }\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"shell\",\r\n  parameters: [{\r\n    name: \"radius\",\r\n    type: \"Number\",\r\n    description: \"How far the sphere should extend away from a center point.\"\r\n  }, {\r\n    name: \"widthSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces wide in which to slice the geometry.\"\r\n  }, {\r\n    name: \"heightSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces tall in which to slice the geometry.\"\r\n  }, {\r\n    name: \"phi\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle in radians around the Y-axis of the sphere.\",\r\n    default: \"80 degrees.\"\r\n  }, {\r\n    name: \"theta\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle in radians around the Z-axis of the sphere.\",\r\n    default: \"48 degrees.\"\r\n  }],\r\n  description: \"The shell is basically an inside-out sphere. Say you want a to model\\n\\\r\nthe sky as a sphere, or the inside of a helmet. You don't care anything about the\\n\\\r\noutside of this sphere, only the inside. You would use InsideSphereGeometry in this\\n\\\r\ncase. It is mostly an alias for [`InsideSphereGeometry`](#LiveAPI_InsideSphereGeometry).\",\r\n  examples: [{\r\n    name: \"Create a sky sphere\",\r\n    description: \"To create a sphere that hovers around the user at a\\n\\\r\nfar distance, showing a sky of some kind, you can use the `shell()` function in\\n\\\r\ncombination with the [`textured()`](#LiveAPI_textured) function. Assuming you have an image\\n\\\r\nfile to use as the texture, execute code as such:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var sky = textured(\\n\\\r\n      shell(\\n\\\r\n          // The radius value should be less than your draw distance.\\n\\\r\n          1000,\\n\\\r\n          // The number of slices defines how smooth the sphere will be in the\\n\\\r\n          // horizontal direction. Think of it like lines of longitude.\\n\\\r\n          18,\\n\\\r\n          // The number of rings defines how smooth the sphere will be in the\\n\\\r\n          // vertical direction. Think of it like lines of latitude.\\n\\\r\n          9,\\n\\\r\n          // The phi angle is the number or radians around the 'belt' of the sphere\\n\\\r\n          // to sweep out the geometry. To make a full circle, you'll need 2 * PI\\n\\\r\n          // radians.\\n\\\r\n          Math.PI * 2,\\n\\\r\n          // The theta angle is the number of radians above and below the 'belt'\\n\\\r\n          // of the sphere to sweep out the geometry. Since the belt sweeps a full\\n\\\r\n          // 360 degrees, theta only needs to sweep a half circle, or PI radians.\\n\\\r\n          Math.PI ),\\n\\\r\n      // Specify the texture image next.\\n\\\r\n      \\\"skyTexture.jpg\\\",\\n\\\r\n      // Specify that the material should be shadeless, i.e. no shadows. This\\n\\\r\n      // works best for skymaps.\\n\\\r\n      {unshaded: true} );\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport InsideSphereGeometry from \"../Primrose/Graphics/InsideSphereGeometry\";\r\nimport fixGeometry from \"../Primrose/Graphics/fixGeometry\";\r\nconst SLICE = 0.45;\r\nexport default function shell(r, slices, rings, phi, theta, options) {\r\n  if (phi === undefined) {\r\n    phi = Math.PI * SLICE;\r\n  }\r\n  if (theta === undefined) {\r\n    theta = Math.PI * SLICE * 0.6;\r\n  }\r\n  var phiStart = 1.5 * Math.PI - phi * 0.5,\r\n    thetaStart = (Math.PI - theta) * 0.5;\r\n  options = options || {};\r\n  return cache(\r\n    `InsideSphereGeometry(${r}, ${slices}, ${rings}, ${phi}, ${theta})`,\r\n    () => fixGeometry(new InsideSphereGeometry(r, slices, rings, phiStart, phi, thetaStart, theta, true), options));\r\n};","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"BaseTextured\",\r\n  baseClass: \"Primrose.Controls.Surface\",\r\n  description: \"A simple 2D texture that has to be loaded from a file.\",\r\n  parameters: [{\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"Named parameters for creating the textured object.\"\r\n  }]\r\n});\r\n\r\nlet COUNTER = 0;\r\n\r\nimport Entity from \"./Entity\";\r\nimport quad from \"../../live-api/quad\";\r\nimport shell from \"../../live-api/shell\";\r\nimport hub from \"../../live-api/hub\";\r\n\r\nvar entities = [];\r\n\r\npliny.function({\r\n  parent: \"Primrose.Controls.Entity\",\r\n  name: \"updateAll\",\r\n  description: \"Trigger the eyeBlank event for all registered entities.\",\r\n  parameters: [{\r\n    name: \"eye\",\r\n    type: \"Number\",\r\n    description: \"The eye to switch to: -1 for left, +1 for right.\"\r\n  }]\r\n});\r\nexport function updateAll(){\r\n  entities.forEach((entity) => {\r\n    entity.eyeBlank(0);\r\n    entity.update();\r\n  });\r\n};\r\n\r\nexport function eyeBlankAll(eye) {\r\n  entities.forEach((entity) =>\r\n    entity.eyeBlank(eye));\r\n};\r\n\r\nexport default class BaseTextured extends Entity {\r\n\r\n  constructor(files, options) {\r\n    name = options && options.id || files.join();\r\n    \r\n    super(name, options);\r\n\r\n    entities.push(this);\r\n\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // initialization\r\n    ///////////////////////////////////////////////////////////////////////\r\n    this._files = files;\r\n    this._meshes = [];\r\n    this._textures = [];\r\n    this._currentImageIndex = 0;\r\n\r\n    if(this.options.geometry){\r\n      this._geometry = this.options.geometry;\r\n    }\r\n    else if(this.options.radius){\r\n      this._geometry = shell(\r\n        this.options.radius,\r\n        72,\r\n        36,\r\n        Math.PI * 2,\r\n        Math.PI,\r\n        options);\r\n    }\r\n    else {\r\n      if(!this.options.width){\r\n        this.options.width = 0.5;\r\n      }\r\n      if(!this.options.height){\r\n        this.options.height = 0.5;\r\n      }\r\n      this._geometry = quad(this.options.width, this.options.height, options);\r\n    }\r\n  }\r\n\r\n  get _ready() {\r\n    return super._ready\r\n      .then(() => this._loadFiles(this._files, this.options.progress))\r\n      .then(() => this._meshes.forEach((mesh) =>\r\n        this.add(mesh)));\r\n  }\r\n\r\n  get blending() {\r\n    return this._meshes && this._meshes.length > 0 && this._meshes[0] && this._meshes[0].material.blending;\r\n  }\r\n\r\n  set blending(v){\r\n    this._meshes.forEach((mesh) => mesh.material.blending = v);\r\n  }\r\n\r\n  eyeBlank(eye) {\r\n    if(this._meshes && this._meshes.length > 0) {\r\n      this._currentImageIndex = eye % this._meshes.length;\r\n      for(let i = 0; i < this._meshes.length; ++i){\r\n        this._meshes[i].visible = (i === this._currentImageIndex);\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n\r\n  }\r\n}","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Videa\",\r\n  baseClass: \"Primrose.Controls.BaseTextured\",\r\n  description: \"A simple 2D video to put on a Surface.\",\r\n  parameters: [{\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"Named parameters for creating the Video.\"\r\n  }]\r\n});\r\n\r\nimport enableInlineVideo from \"iphone-inline-video\";\r\n\r\nimport { LinearFilter } from \"three\";\r\n\r\nimport BaseTextured from \"./BaseTextured\";\r\nimport textured from \"../../live-api/textured\";\r\nimport isiOS from \"../../flags/isiOS\";\r\n\r\nlet COUNTER = 0;\r\n\r\n// Videos don't auto-play on mobile devices, so let's make them all play whenever we tap the screen.\r\nconst processedVideos = [];\r\nfunction findAndFixVideo(evt){\r\n  const vids = document.querySelectorAll(\"video\");\r\n  for(let i = 0; i < vids.length; ++i){\r\n    fixVideo(vids[i]);\r\n  }\r\n  window.removeEventListener(\"touchend\", findAndFixVideo);\r\n  window.removeEventListener(\"mouseup\", findAndFixVideo);\r\n  window.removeEventListener(\"keyup\", findAndFixVideo);\r\n}\r\n\r\nfunction fixVideo(vid) {\r\n  if(isiOS && processedVideos.indexOf(vid) === -1){\r\n    processedVideos.push(vid);\r\n    enableInlineVideo(vid, false);\r\n  }\r\n}\r\n\r\nwindow.addEventListener(\"touchend\", findAndFixVideo, false);\r\nwindow.addEventListener(\"mouseup\", findAndFixVideo, false);\r\nwindow.addEventListener(\"keyup\", findAndFixVideo, false);\r\n\r\nexport default class Video extends BaseTextured {\r\n\r\n  constructor(videos, options) {\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // normalize input parameters\r\n    ////////////////////////////////////////////////////////////////////////\r\n    if(!(videos instanceof Array)) {\r\n      videos = [videos];\r\n    }\r\n\r\n    options = Object.assign({}, {\r\n      id: \"Primrose.Controls.Video[\" + (COUNTER++) + \"]\"\r\n    }, options);\r\n\r\n    super(videos, options);\r\n  }\r\n\r\n  _loadFiles(videos, progress) {\r\n    this._elements = Array.prototype.map.call(videos, (spec, i) => {\r\n      let video = null;\r\n      if(typeof spec === \"string\"){\r\n        video = document.querySelector(`video[src='${spec}']`);\r\n        if(!video) {\r\n          video = document.createElement(\"video\");\r\n          video.src = spec;\r\n        }\r\n      }\r\n      else if(spec instanceof HTMLVideoElement){\r\n        video = spec;\r\n      }\r\n      else if(spec.toString() === \"[object MediaStream]\" || spec.toString() === \"[object LocalMediaStream]\"){\r\n        video = document.createElement(\"video\");\r\n        video.srcObject = spec;\r\n      }\r\n      video.onprogress = progress;\r\n      video.onloadedmetadata = progress;\r\n      video.muted = true;\r\n      video.loop = true;\r\n      video.setAttribute(\"playsinline\", \"\");\r\n      video.setAttribute(\"webkit-playsinline\", \"\");\r\n      if(!isiOS) {\r\n        video.preload = \"auto\";\r\n      }\r\n\r\n      const loadOptions = Object.assign({}, this.options);\r\n      this._meshes[i] = textured(\r\n        this._geometry,\r\n        video,\r\n        loadOptions);\r\n\r\n      if(!video.parentElement){\r\n        document.body.insertBefore(video, document.body.children[0]);\r\n        fixVideo(video);\r\n      }\r\n\r\n      loadOptions.promise.then((txt) => {\r\n        this._textures[i] = txt;\r\n        console.log(txt);\r\n        txt.minFilter = LinearFilter;\r\n      });\r\n\r\n      return video;\r\n    });\r\n    return Promise.resolve();\r\n  }\r\n\r\n  play() {\r\n    if(this._elements.length > 0) {\r\n      this._elements[0].play();\r\n    }\r\n  }\r\n\r\n  update(){\r\n    super.update();\r\n    for (let i = 0; i < this._textures.length; ++i) {\r\n      if(this._textures[i]) {\r\n        const elem = this._elements[i];\r\n        if(elem.currentTime !== this._lastTime){\r\n          this._textures[i].needsUpdate = true;\r\n          this._lastTime = elem.currentTime;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"camera\",\r\n  returns: \"THREE.Texture\",\r\n  description: \"Creates a texture that reads data from one of the cameras connected to the system.\",\r\n  parameters: [{\r\n    name: \"index\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 0,\r\n    description: \"The index of the object from the results of getUserMedia() to use for the camera.\"\r\n  },{\r\n    name: \"options\",\r\n    type: \"Live API.camera.optionsHash\",\r\n    optional: true,\r\n    description: \"Extra parameters for the selected camera, including resolution.\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Live API.camera\",\r\n  name: \"optionsHash\",\r\n  description: \"Extra parameters for the selected camera, including resolution.\",\r\n  parameters: [{\r\n    name: \"width\",\r\n    type: \"Number\",\r\n    description: \"The width of the camera image to request. Note that if the camera does not support the resolution mode you are specifying, the request may not succeed, or may not give you the results you expect.\"\r\n  }]\r\n});\r\n\r\nimport hub from \"./hub\";\r\nimport Video from \"../Primrose/Controls/Video\";\r\n\r\nexport default function camera(index, options) {\r\n  options = Object.assign({\r\n      width: 1,\r\n      height: 768/1280,\r\n      unshaded: true,\r\n      transparent: true,\r\n      opacity: 0.5\r\n    }, options);\r\n  return navigator.mediaDevices.enumerateDevices()\r\n    .catch(console.error.bind(console, \"ERR [enumerating devices]:>\"))\r\n    .then((devices) => devices.filter((d) => d.kind === \"videoinput\")[index])\r\n    .catch(console.error.bind(console, \"ERR [filtering devices]:>\"))\r\n    .then((device) => navigator.mediaDevices.getUserMedia({\r\n      video: {\r\n        deviceId: device.deviceId,\r\n        width: { ideal: 1280 },\r\n        height: { ideal: 768 }\r\n      }\r\n    }))\r\n    .catch(console.error.bind(console, \"ERR [getting media access]:>\"))\r\n    .then((stream) => new Video(stream, options).ready)\r\n    .catch(console.error.bind(console, \"ERR [creating image]:>\"));\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"circle\",\r\n  description: \"A shortcut function for the THREE.CircleBufferGeometry class. Creates a flat circle, oriented in the XZ plane. `Circle` is a bit of a misnomer. It's actually an N-sided polygon, with the implication being that N must be large to convincingly approximate a true circle.\",\r\n  parameters: [{\r\n    name: \"r\",\r\n    type: \"Number\",\r\n    description: \"The radius of the circle.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"sections\",\r\n    type: \"Number\",\r\n    description: \"The number of sides for the polygon approximating a circle.\",\r\n    optional: true,\r\n    default: 18\r\n  }, {\r\n    name: \"start\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians at which to start drawing the circle polygon.\",\r\n    optional: true,\r\n    default: 0\r\n  }, {\r\n    name: \"end\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians at which to stop drawing the circle polygon.\",\r\n    optional: true,\r\n    default: 2 * Math.PI\r\n  }],\r\n  returns: \"THREE.CircleBufferGeometry\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Three.js separates geometry from materials, so you can create shared materials and geometry that recombine in different ways. To create a simple circle geometry object that you can then add a material to create a mesh:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var geom = circle(1, 18, 0, 2 * Math.PI)\\n\\\r\n      .colored(0xff0000)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nIt should look something like this:\\n\\\r\n<img src=\\\"images/circle.jpg\\\">\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { CircleBufferGeometry } from \"three\";\r\nexport default function circle(r, sections, start, end) {\r\n  r = r || 1;\r\n  sections = sections || 18;\r\n  return cache(\r\n    `CircleBufferGeometry(${r}, ${sections}, ${start}, ${end})`,\r\n    () => new CircleBufferGeometry(r, sections, start, end));\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"cloud\",\r\n  description: \"Creates a point cloud with points of a fixed color and size out of an array of vertices.\",\r\n  parameters: [{\r\n    name: \"verts\",\r\n    type: \"Array\",\r\n    description: \"An array of `THREE.Vector3`s to turn into a `THREE.Points` object.\"\r\n  }, {\r\n    name: \"c\",\r\n    type: \"Number\",\r\n    description: \"A hexadecimal color value to use when creating the `THREE.PointsMaterial` to go with the point cloud.\"\r\n  }, {\r\n    name: \"s\",\r\n    type: \"Number\",\r\n    description: \"A numeric size value to use when creating the `THREE.PointsMaterial` to go with the point cloud.\"\r\n  }],\r\n  returns: \"THREE.Points\",\r\n  examples: [{\r\n    name: \"Create randomized \\\"dust\\\".\",\r\n    description: \"Creating a cloud is pretty simple.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var verts = [],\\n\\\r\n        R = Primrose.Random.number,\\n\\\r\n        WIDTH = 10,\\n\\\r\n        HEIGHT = 10,\\n\\\r\n        DEPTH = 10;\\n\\\r\n    \\n\\\r\n    for (var i = 0; i< 5000; ++i) {\\n\\\r\n      verts.push(v3(R(-0.5 * WIDTH, 0.5 * WIDTH),\\n\\\r\n                    R(-0.5 * HEIGHT, 0.5 * HEIGHT),\\n\\\r\n                    R(-0.5 * DEPTH, 0.5 * DEPTH)));\\n\\\r\n    }\\n\\\r\n    cloud(verts, 0x7f7f7f 0.05)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(WIDTH / 2 , HEIGHT / 2, DEPTH / 2);\\n\\\r\n\\n\\\r\nThe results should look like this:\\n\\\r\n\\n\\\r\n<img src=\\\"images/cloud.jpg\\\">\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { Geometry, PointsMaterial, Points } from \"three\";\r\nexport default function cloud(verts, c, s) {\r\n  var geom = new Geometry();\r\n  for (var i = 0; i < verts.length; ++i) {\r\n    geom.vertices.push(verts[i]);\r\n  }\r\n  var mat = cache(\r\n    `PointsMaterial(${c}, ${s})`,\r\n    () => new PointsMaterial({\r\n      color: c,\r\n      size: s\r\n    }));\r\n  return new Points(geom, mat);\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"cylinder\",\r\n  description: \"Shorthand function for creating a new THREE.CylinderGeometry object.\",\r\n  parameters: [{\r\n    name: \"rT\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The radius at the top of the cylinder.\",\r\n    default: 0.5\r\n  }, {\r\n    name: \"rB\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The radius at the bottom of the cylinder.\",\r\n    default: 0.5\r\n  }, {\r\n    name: \"height\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The height of the cylinder.\",\r\n    default: 1\r\n  }, {\r\n    name: \"rS\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The number of sides on the cylinder.\",\r\n    default: 8\r\n  }, {\r\n    name: \"hS\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The number of slices along the height of the cylinder.\",\r\n    default: 1\r\n  }, {\r\n    name: \"openEnded\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Whether or not to leave the end of the cylinder open, thereby making a pipe.\",\r\n    default: false\r\n  }, {\r\n    name: \"thetaStart\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle at which to start sweeping the cylinder.\",\r\n    default: 0\r\n  }, {\r\n    name: \"thetaEnd\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle at which to end sweeping the cylinder.\",\r\n    default: 2 * Math.PI\r\n  }],\r\n  returns: \"THREE.CylinderBufferGeometry\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Three.js separates geometry from materials, so you can create shared materials and geometry that recombine in different ways. To create a simple cylinder geometry object that you can then add a material to create a mesh: \\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var mesh = cylinder()\\n\\\r\n      .colored(0xff0000)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nIt should look something like this:\\n\\\r\n<img src=\\\"images/cylinder.jpg\\\">\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { CylinderBufferGeometry } from \"three\";\r\nexport default function cylinder(rT, rB, height, rS, hS, openEnded, thetaStart, thetaEnd) {\r\n  if (rT === undefined) {\r\n    rT = 0.5;\r\n  }\r\n  if (rB === undefined) {\r\n    rB = 0.5;\r\n  }\r\n  if (height === undefined) {\r\n    height = 1;\r\n  }\r\n  return cache(\r\n    `CylinderBufferGeometry(${rT}, ${rB}, ${height}, ${rS}, ${hS}, ${openEnded}, ${thetaStart}, ${thetaEnd})`,\r\n    () => new CylinderBufferGeometry(rT, rB, height, rS, hS, openEnded, thetaStart, thetaEnd));\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"light\",\r\n  description: \"Shortcut function for creating a new THREE.PointLight object.\",\r\n  parameters: [{\r\n    name: \"color\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The RGB color value for the light.\",\r\n    default: \"0xffffff\"\r\n  }, {\r\n    name: \"intensity\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The strength of the light.\",\r\n    default: 1\r\n  }, {\r\n    name: \"distance\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The distance the light will shine.\",\r\n    default: 0\r\n  }, {\r\n    name: \"decay\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"How much the light dims over distance.\",\r\n    default: 1\r\n  }],\r\n  returns: \"THREE.PointLight\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"    grammar(\\\"JavaScript\\\");\\n\\\r\n    light(0xffff00)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(0, 100, 0);\"\r\n  }]\r\n});\r\n\r\nimport { PointLight } from \"three\";\r\nexport default function light(color, intensity, distance, decay) {\r\n  return new PointLight(color, intensity, distance, decay);\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"quat\",\r\n  description: \"A shorthand for THREE.Quaternion.\",\r\n  returns: \"THREE.Quaternion\",\r\n  parameters: [{\r\n    name: \"x\",\r\n    type: \"Number\",\r\n    description: \"The `x` component of the Quaternion.\"\r\n  }, {\r\n    name: \"y\",\r\n    type: \"Number\",\r\n    description: \"The `y` component of the Quaternion.\"\r\n  }, {\r\n    name: \"z\",\r\n    type: \"Number\",\r\n    description: \"The `z` component of the Quaternion.\"\r\n  }, {\r\n    name: \"w\",\r\n    type: \"Number\",\r\n    description: \"The `w` component of the Quaternion.\"\r\n  }]\r\n});\r\n\r\nimport { Quaternion } from \"three\";\r\nexport default function quat(x, y, z, w) {\r\n  return new Quaternion(x, y, z, w);\r\n}\r\n","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"identity\",\r\n  description: \"The identity function takes a single parameter and returns out again that parameter.\",\r\n  returns: \"Any\",\r\n  parameters: [{\r\n    name: \"obj\",\r\n    type: \"Any\",\r\n    description: \"The value to pass through.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"The `identity()` function is useful in certain functional programming scenarios, such as filtering values of an array for falseyness.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = [false, 1, 2, null, undefined, 0, 3, 4, \\\"Hello, world.\\\"];\\n\\\r\n    console.log(arr.filter(identity)); // [1, 2, 3, 4]\"\r\n  }]\r\n});\r\n\r\nexport default function identity(obj) {\r\n  return obj;\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"range\",\r\n  description: \"Executes a function a set number of times, to shorten up common programming patterns a little. If the provided function returns value, they will be collected into an array that is returned at the end of the loop. This function has a weird cascading syntax that does not work like normal functions with default values for positional parameters.\",\r\n  parameters: [{\r\n    name: \"n\",\r\n    type: \"Number\",\r\n    description: \"The starting value for the loop counter.\",\r\n    optional: true,\r\n    default: 0\r\n  }, {\r\n    name: \"m\",\r\n    type: \"Number\",\r\n    description: \"The ending value for the loop counter.\"\r\n  }, {\r\n    name: \"s\",\r\n    type: \"Number\",\r\n    description: \"The value by which to increment the loop counter.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"t\",\r\n    type: \"Function\",\r\n    description: \"A function that receives the current loop counter value, does work, and optionally returns a result.\",\r\n    optional: true,\r\n    default: \"the identity function\"\r\n  }],\r\n  returns: \"Array\",\r\n  examples: [{\r\n    name: \"Generate an array of ten numbers, from 0 to 9.\",\r\n    description: \"The most basic usage is with one parameter.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(10);\\n\\\r\n    console.log(arr); // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\\n\\\r\n\"\r\n  }, {\r\n    name: \"Generate an array of five objects.\",\r\n    description: \"The last parameter position is always a function.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(5, hub);\\n\\\r\n    console.log(arr); // [[Object], [Object], [Object], [Object], [Object]];\\n\\\r\n\"\r\n  }, {\r\n    name: \"Generate a subsection of an array of numbers.\",\r\n    description: \"If you provide two number parameters, the first is treated as the starting value and the second is the end.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(3, 5);\\n\\\r\n    console.log(arr); // [3, 4];\\n\\\r\n\"\r\n  }, {\r\n    name: \"Generate a series of strings.\",\r\n    description: \"If you provide two number parameters, the first is treated as the starting value and the second is the end.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(3, 5, (i) => \\\"num\\\" + i);\\n\\\r\n    console.log(arr); // [\\\"num3\\\", \\\"num4\\\"];\\n\\\r\n\"\r\n  }, {\r\n    name: \"Specify a step value.\",\r\n    description: \"If you provide three number parameters, the first is treated as the starting value, the second is the end, and the third is the step value.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(3, 15, 3);\\n\\\r\n    console.log(arr); // [3, 6, 9, 12];\\n\\\r\n\"\r\n  }, {\r\n    name: \"Generate objects using a step value.\",\r\n    description: \"If you provide three number parameters, the first is treated as the starting value, the second is the end, and the third is the step value.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var arr = range(3, 15, 3, (x) => {\\n\\\r\n      var obj = hub();\\n\\\r\n      obj.position.x = x;\\n\\\r\n      return obj;\\n\\\r\n    });\\n\\\r\n\"\r\n  }]\r\n});\r\n\r\nimport identity from \"../util/identity\";\r\nexport default function range(n, m, s, t) {\r\n  const n2 = s && n || 0,\r\n    m2 = s && m || n,\r\n    s2 = t && s || 1;\r\n  let t2 = t || s || m,\r\n    output = null;\r\n\r\n  if(!(t2 instanceof Function)) {\r\n    t2 = identity;\r\n  }\r\n\r\n  for (let i = n2; i < m2; i += s2) {\r\n    const value = t2(i);\r\n    if(output === null && value !== undefined) {\r\n      output = [];\r\n    }\r\n    if(output !== null) {\r\n      output.push(value);\r\n    }\r\n  }\r\n  if(output !== null) {\r\n    return output;\r\n  }\r\n};","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"ring\",\r\n  description: \"A shortcut function for the THREE.RingBufferGeometry class. Creates a flat ring, which is a larger circle with a smaller circle cut out of its center, oriented in the XZ plane. `Circle` is a bit of a misnomer. It's actually an N-sided polygon, with the implication being that N must be large to convincingly approximate a true circle.\",\r\n  parameters: [{\r\n    name: \"rInner\",\r\n    type: \"Number\",\r\n    description: \"The radius of the inner circle of the ring.\",\r\n    optional: true,\r\n    default: 0.5\r\n  }, {\r\n    name: \"rOuter\",\r\n    type: \"Number\",\r\n    description: \"The radius of the outer circle of the ring.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"sectors\",\r\n    type: \"Number\",\r\n    description: \"The number of radial sides for the polygon approximating a ring.\",\r\n    optional: true,\r\n    default: 18\r\n  }, {\r\n    name: \"rings\",\r\n    type: \"Number\",\r\n    description: \"The number of concentric rings in which to split the ring.\",\r\n    optional: true,\r\n    default: 1\r\n  }, {\r\n    name: \"start\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians at which to start drawing the ring polygon.\",\r\n    optional: true,\r\n    default: 0\r\n  }, {\r\n    name: \"end\",\r\n    type: \"Number\",\r\n    description: \"The angle in radians at which to stop drawing the ring polygon.\",\r\n    optional: true,\r\n    default: 2 * Math.PI\r\n  }],\r\n  returns: \"THREE.CircleBufferGeometry\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Three.js separates geometry from materials, so you can create shared materials and geometry that recombine in different ways. To create a simple circle geometry object that you can then add a material to create a mesh:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var mesh = ring(0.5, 1, 18, 1, 0, 2 * Math.PI)\\n\\\r\n      .colored(0xff0000)\\n\\\r\n      .addTo(scene)\\n\\\r\n      .at(-2, 1, -5);\\n\\\r\n\\n\\\r\nIt should look something like this:\\n\\\r\n<img src=\\\"images/ring.jpg\\\">\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { RingBufferGeometry } from \"three\";\r\nexport default function ring(rInner, rOuter, sectors, rings, start, end) {\r\n  if(rInner === undefined){\r\n    rInner = 0.5;\r\n  }\r\n  sectors = sectors || 18;\r\n  rings = rings || 1;\r\n  rOuter = rOuter || 1;\r\n  start = start || 0;\r\n  end = end || 2 * Math.PI;\r\n  return cache(\r\n    `RingBufferGeometry(${rInner}, ${rOuter}, ${sectors}, ${rings}, ${start}, ${end})`,\r\n    () => new RingBufferGeometry(rInner, rOuter, sectors, rings, start, end));\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"raycaster\",\r\n  description: \"Creates a THREE.Raycaster. This is useful so you don't have to try to figure out how to import any parts of Three.js separately from Primrose. It also makes it possible to use in functional settings.\"\r\n});\r\n\r\nimport { Raycaster } from \"three\";\r\nexport default function raycaster() {\r\n  return new Raycaster();\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"sphere\",\r\n  parameters: [{\r\n    name: \"radius\",\r\n    type: \"Number\",\r\n    description: \"How far the sphere should extend away from a center point.\"\r\n  }, {\r\n    name: \"widthSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces wide in which to slice the geometry.\"\r\n  }, {\r\n    name: \"heightSegments\",\r\n    type: \"Number\",\r\n    description: \"The number of faces tall in which to slice the geometry.\"\r\n  }, {\r\n    name: \"phi\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle in radians around the Y-axis of the sphere.\",\r\n    default: \"80 degrees.\"\r\n  }, {\r\n    name: \"theta\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The angle in radians around the Z-axis of the sphere.\",\r\n    default: \"48 degrees.\"\r\n  }],\r\n  description: \"Creates a THREE.SphereBuffereGeometry.\",\r\n  examples: [{\r\n    name: \"Create a pointer.\",\r\n    description: \"Small spheres are useful for indicating things:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var ball = colored(\\n\\\r\n      sphere(0.1),\\n\\\r\n      0xffff00,\\n\\\r\n      {unshaded: true} );\"\r\n  }]\r\n});\r\n\r\nimport cache from \"../util/cache\";\r\nimport { SphereGeometry } from \"three\";\r\nexport default function sphere(r, slices, rings) {\r\n  return cache(\r\n    `SphereGeometry(${r}, ${slices}, ${rings})`,\r\n    () => new SphereGeometry(r, slices, rings));\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"v2\",\r\n  description: \"A shortcut function for creating a new THREE.Vector3 object.\",\r\n  parameters: [{\r\n    name: \"x\",\r\n    type: \"Number\",\r\n    description: \"The X component of the vector\"\r\n  }, {\r\n    name: \"y\",\r\n    type: \"Number\",\r\n    description: \"The Y component of the vector\"\r\n  }],\r\n  returns: \"THREE.Vector2\",\r\n  examples: [{\r\n    name: \"Create a vector\",\r\n    description: \"    grammar(\\\"JavaScript\\\");\\n\\\r\n    var a = v2(1, 2);\\n\\\r\n    console.assert(a.x === 1);\\n\\\r\n    console.assert(a.y === 2);\\n\\\r\n    console.assert(a.toArray().join(\\\", \\\") === \\\"1, 2\\\");\"\r\n  }]\r\n});\r\n\r\nimport { Vector2 } from \"three\";\r\nexport default function v2(x, y) {\r\n  return new Vector2(x, y);\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"v3\",\r\n  description: \"A shortcut function for creating a new THREE.Vector3 object.\",\r\n  parameters: [{\r\n    name: \"x\",\r\n    type: \"Number\",\r\n    description: \"The X component of the vector\"\r\n  }, {\r\n    name: \"y\",\r\n    type: \"Number\",\r\n    description: \"The Y component of the vector\"\r\n  }, {\r\n    name: \"z\",\r\n    type: \"Number\",\r\n    description: \"The Z component of the vector\"\r\n  }],\r\n  returns: \"THREE.Vector3\",\r\n  examples: [{\r\n    name: \"Create a vector\",\r\n    description: \"    grammar(\\\"JavaScript\\\");\\n\\\r\n    var a = v3(1, 2, 3);\\n\\\r\n    console.assert(a.x === 1);\\n\\\r\n    console.assert(a.y === 2);\\n\\\r\n    console.assert(a.z === 3);\\n\\\r\n    console.assert(a.toArray().join(\\\", \\\") === \\\"1, 2, 3\\\");\"\r\n  }]\r\n});\r\n\r\nimport { Vector3 } from \"three\";\r\nexport default function v3(x, y, z) {\r\n  return new Vector3(x, y, z);\r\n};\r\n","pliny.function({\r\n  parent: \"Live API\",\r\n  name: \"v4\",\r\n  description: \"A shortcut function for creating a new THREE.Vector4 object.\",\r\n  parameters: [{\r\n    name: \"x\",\r\n    type: \"Number\",\r\n    description: \"The X component of the vector\"\r\n  }, {\r\n    name: \"y\",\r\n    type: \"Number\",\r\n    description: \"The Y component of the vector\"\r\n  }, {\r\n    name: \"z\",\r\n    type: \"Number\",\r\n    description: \"The Z component of the vector\"\r\n  }, {\r\n    name: \"w\",\r\n    type: \"Number\",\r\n    description: \"The W component of the vector\"\r\n  }],\r\n  returns: \"THREE.Vector4\",\r\n  examples: [{\r\n    name: \"Create a vector\",\r\n    description: \"    grammar(\\\"JavaScript\\\");\\n\\\r\n    var a = v4(1, 2, 3);\\n\\\r\n    console.assert(a.x === 1);\\n\\\r\n    console.assert(a.y === 2);\\n\\\r\n    console.assert(a.z === 3);\\n\\\r\n    console.assert(a.w === 4);\\n\\\r\n    console.assert(a.toArray().join(\\\", \\\") === \\\"1, 2, 3, 4\\\");\"\r\n  }]\r\n});\r\n\r\nimport { Vector4 } from \"three\";\r\nexport default function v4(x, y, z, w) {\r\n  return new Vector4(x, y, z, w);\r\n};\r\n","pliny.namespace({\r\n  name: \"Live API\",\r\n  description: \"The Live API is a set of functions that serve as shorthand for common Three.js objects, with a caching system built in to deduplicate repeated creations of geometries and materials.\\n\\\r\n\\n\\\r\nWhen including Primrose as a `script` tag, the Live API is imported directly onto the window object and is available without qualification.\"\r\n});\r\n\r\nimport axis from \"./axis\";\r\nimport box from \"./box\";\r\nimport brick from \"./brick\";\r\nimport camera from \"./camera\";\r\nimport circle from \"./circle\";\r\nimport cloud from \"./cloud\";\r\nimport colored from \"./colored\";\r\nimport cylinder from \"./cylinder\";\r\nimport hub from \"./hub\";\r\nimport light from \"./light\";\r\nimport material from \"./material\";\r\nimport quad from \"./quad\";\r\nimport quat from \"./quat\";\r\nimport range from \"./range\";\r\nimport ring from \"./ring\";\r\nimport shell from \"./shell\";\r\nimport raycaster from \"./raycaster\";\r\nimport sphere from \"./sphere\";\r\nimport textured from \"./textured\";\r\nimport v2 from \"./v2\";\r\nimport v3 from \"./v3\";\r\nimport v4 from \"./v4\";\r\n\r\nexport {\r\n  axis,\r\n  box,\r\n  brick,\r\n  camera,\r\n  circle,\r\n  cloud,\r\n  colored,\r\n  cylinder,\r\n  hub,\r\n  light,\r\n  material,\r\n  quad,\r\n  quat,\r\n  range,\r\n  ring,\r\n  shell,\r\n  raycaster,\r\n  sphere,\r\n  textured,\r\n  v2,\r\n  v3,\r\n  v4\r\n};\r\n\r\nexport default {\r\n  axis,\r\n  box,\r\n  brick,\r\n  camera,\r\n  circle,\r\n  cloud,\r\n  colored,\r\n  cylinder,\r\n  hub,\r\n  light,\r\n  material,\r\n  quad,\r\n  quat,\r\n  range,\r\n  ring,\r\n  shell,\r\n  raycaster,\r\n  sphere,\r\n  textured,\r\n  v2,\r\n  v3,\r\n  v4\r\n};","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"findProperty\",\r\n  description: \"Searches an object for a property that might go by different names in different browsers.\",\r\n  parameters: [{\r\n    name: \"elem\",\r\n    type: \"Object\",\r\n    description: \"The object to search.\"\r\n  }, {\r\n    name: \"arr\",\r\n    type: \"Array\",\r\n    description: \"An array of strings that lists the possible values for the property name.\"\r\n  }],\r\n  returns: \"String\",\r\n  examples: [{\r\n    name: \"Find the right name of the full screen element.\",\r\n    description: \"    grammar(\\\"JavaScript\\\");\\n\\\r\n    var elementName = findProperty(document, [\\\"fullscreenElement\\\", \\\"mozFullScreenElement\\\", \\\"webkitFullscreenElement\\\", \\\"msFullscreenElement\\\"]);\\n\\\r\n    console.assert(!isFirefox || elementName === \\\"mozFullScreenElement\\\");\\n\\\r\n    console.assert(!isChrome || elementName === \\\"webkitFullscreenElement\\\");\\n\\\r\n    console.assert(!isIE || elementName === \\\"msFullscreenElement\\\");\"\r\n  }]\r\n});\r\n\r\nexport default function findProperty(elem, arr) {\r\n  for (var i = 0; i < arr.length; ++i) {\r\n    if (arr[i] in elem) {\r\n      return arr[i];\r\n    }\r\n  }\r\n};","pliny.class({\r\n  parent: \"Util\",\r\n  name: \"AsyncLockRequest\",\r\n  description: \"Searches a set of properties from a list of potential browser-vendor-prefixed options for a set of related functions that can be used to make certain types of Full Screen and Orientation Locking requests.\",\r\n  parameters: [{\r\n    name: \"name \",\r\n    type: \"String\",\r\n    description: \"A friendly name to use in error messages emitted by this locking object.\"\r\n  }, {\r\n    name: \"elementOpts\",\r\n    type: \"Array\",\r\n    description: \"An array of potential element names to search the document object that indicate to which DOM element the lock has been acquired.\"\r\n  }, {\r\n    name: \"changeEventOpts\",\r\n    type: \"Array\",\r\n    description: \"An array of potential event names for the callback when the lock is acquired.\"\r\n  }, {\r\n    name: \"errorEventOpts\",\r\n    type: \"Array\",\r\n    description: \"An array of potential event names for the callback when the lock has failed to be acquired.\"\r\n  }, {\r\n    name: \"requestMethodOpts\",\r\n    type: \"Array\",\r\n    description: \"An array of potential method names for initiating the lock request.\"\r\n  }, {\r\n    name: \"exitMethodOpts\",\r\n    type: \"Array\",\r\n    description: \"An array of potential method names for canceling the lock.\"\r\n  }]\r\n});\r\n\r\nimport findProperty from \"./findProperty\";\r\n\r\nexport default class AsyncLockRequest {\r\n  constructor(name, elementOpts, changeEventOpts, errorEventOpts, requestMethodOpts, exitMethodOpts) {\r\n\r\n    this.name = name;\r\n\r\n    this._elementName = findProperty(document, elementOpts);\r\n    this._requestMethodName = findProperty(document.documentElement, requestMethodOpts);\r\n    this._exitMethodName = findProperty(document, exitMethodOpts);\r\n    this._changeTimeout = null;\r\n\r\n    this._changeEventName = findProperty(document, changeEventOpts);\r\n    this._errorEventName = findProperty(document, errorEventOpts);\r\n    this._changeEventName = this._changeEventName && this._changeEventName.substring(2);\r\n    this._errorEventName = this._errorEventName && this._errorEventName.substring(2);\r\n\r\n    this._events = {\r\n      change: this._changeEventName,\r\n      error: this._errorEventName\r\n    };\r\n\r\n    this.exit = this.exit.bind(this);\r\n    this.request = this.request.bind(this);\r\n  }\r\n\r\n  get element(){\r\n    return document[this._elementName];\r\n  }\r\n\r\n  get isActive(){\r\n    return !!this.element;\r\n  }\r\n\r\n  addEventListener(name, thunk, bubbles){\r\n    if(this._events[name]) {\r\n      document.addEventListener(this._events[name], thunk, bubbles);\r\n    }\r\n  }\r\n\r\n  removeEventListener(name, thunk){\r\n    if(this._events[name]) {\r\n      document.removeEventListener(this._events[name], thunk);\r\n    }\r\n  };\r\n\r\n  addChangeListener (thunk, bubbles) {\r\n    this.addEventListener(\"change\", thunk, bubbles);\r\n  }\r\n\r\n  removeChangeListener(thunk){\r\n    this.removeEventListener(\"change\", thunk);\r\n  }\r\n\r\n  addErrorListener(thunk, bubbles) {\r\n    this.addEventListener(\"error\", thunk, bubbles);\r\n  }\r\n\r\n  removeErrorListener(thunk){\r\n    this.removeEventListener(\"error\", thunk);\r\n  }\r\n\r\n  _withChange(act){\r\n    return new Promise((resolve, reject) => {\r\n      var onSuccess = () => {\r\n          setTimeout(tearDown);\r\n          resolve(this.element);\r\n        },\r\n        onError = (evt) => {\r\n          setTimeout(tearDown);\r\n          reject(evt);\r\n        },\r\n        stop = () => {\r\n          if (this._changeTimeout) {\r\n            clearTimeout(this._changeTimeout);\r\n            this._changeTimeout = null;\r\n          }\r\n        },\r\n        tearDown = () => {\r\n          stop();\r\n          this.removeChangeListener(onSuccess);\r\n          this.removeErrorListener(onError);\r\n        };\r\n\r\n      this.addChangeListener(onSuccess, false);\r\n      this.addErrorListener(onError, false);\r\n\r\n      if (act()) {\r\n        // we've already gotten lock, so don't wait for it.\r\n        onSuccess();\r\n      }\r\n      else {\r\n        // Timeout waiting on the lock to happen, for systems like iOS that\r\n        // don't properly support it, even though they say they do.\r\n        stop();\r\n        this._changeTimeout = setTimeout(\r\n          () => onError(name + \" state did not change in allotted time\"),\r\n          1000);\r\n      }\r\n    });\r\n  }\r\n\r\n  request(elem, extraParam){\r\n    return this._withChange(() => {\r\n      if (!this._requestMethodName) {\r\n        throw new Error(\"No \" + this.name + \" API support.\");\r\n      }\r\n      else if (this.isActive) {\r\n        return true;\r\n      }\r\n      else if (extraParam) {\r\n        elem[this._requestMethodName](extraParam);\r\n      }\r\n      else {\r\n        elem[this._requestMethodName]();\r\n      }\r\n    });\r\n  }\r\n\r\n  exit(){\r\n    return this._withChange(() => {\r\n      if (!this._exitMethodName) {\r\n        throw new Error(\"No \" + name + \" API support.\");\r\n      }\r\n      else if (!this.isActive) {\r\n        return true;\r\n      }\r\n      else {\r\n        document[this._exitMethodName]();\r\n      }\r\n    });\r\n  }\r\n}","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"deleteSetting\",\r\n  parameters: [{\r\n    name: \"settingName\",\r\n    type: \"string\",\r\n    description: \"The name of the setting to delete.\"\r\n  }],\r\n  description: \"Removes an object from localStorage\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    console.assert(getSetting(\\\"A\\\", \\\"default-A\\\") === \\\"default-A\\\");\\n\\\r\n    setSetting(\\\"A\\\", \\\"modified-A\\\");\\n\\\r\n    console.assert(getSetting(\\\"A\\\", \\\"default-A\\\") === \\\"modified-A\\\");\\n\\\r\n    deleteSetting(\\\"A\\\");\\n\\\r\n    console.assert(getSetting(\\\"A\\\", \\\"default-A\\\") === \\\"default-A\\\");\"\r\n  }]\r\n});\r\n\r\nexport default function deleteSetting(settingName) {\r\n  if (window.localStorage) {\r\n    window.localStorage.removeItem(settingName);\r\n  }\r\n};","import AsyncLockRequest from \"./AsyncLockRequest\";\r\nimport findProperty from \"./findProperty\";\r\n\r\nclass FullScreenLockRequest extends AsyncLockRequest {\r\n  constructor() {\r\n    // Notice the spelling difference for the Mozilla cases. They require a capital S for Screen.\r\n    super(\"Fullscreen\", [\r\n              \"fullscreenElement\",\r\n            \"msFullscreenElement\",\r\n           \"mozFullScreenElement\",\r\n        \"webkitFullscreenElement\"\r\n      ], [\r\n              \"onfullscreenchange\",\r\n            \"onmsfullscreenchange\",\r\n           \"onmozfullscreenchange\",\r\n        \"onwebkitfullscreenchange\"\r\n      ], [\r\n              \"onfullscreenerror\",\r\n            \"onmsfullscreenerror\",\r\n           \"onmozfullscreenerror\",\r\n        \"onwebkitfullscreenerror\"\r\n      ], [\r\n              \"requestFullscreen\",\r\n            \"msRequestFullscreen\",\r\n           \"mozRequestFullScreen\",\r\n        \"webkitRequestFullscreen\"\r\n      ], [\r\n              \"exitFullscreen\",\r\n            \"msExitFullscreen\",\r\n           \"mozExitFullScreen\",\r\n        \"webkitExitFullscreen\"\r\n      ]);\r\n\r\n    this._fullScreenEnabledProperty = findProperty(document, [\r\n            \"fullscreenEnabled\",\r\n          \"msFullscreenEnabled\",\r\n         \"mozFullScreenEnabled\",\r\n      \"webkitFullscreenEnabled\"\r\n    ]);\r\n  }\r\n\r\n  get available() {\r\n    return !!(this._fullScreenEnabledProperty && document[this._fullScreenEnabledProperty]);\r\n  }\r\n}\r\n\r\nexport default new FullScreenLockRequest();","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"getSetting\",\r\n  parameters: [{\r\n    name: \"settingName\",\r\n    type: \"string\",\r\n    description: \"The name of the setting to read.\"\r\n  }, {\r\n    name: \"defValue\",\r\n    type: \"Object\",\r\n    description: \"The default value to return, if the setting is not present in `localStorage`.\"\r\n  }],\r\n  returns: \"The Object stored in `localStorage` for the given name, or the default value provided if the setting doesn't exist in `localStorage`.\",\r\n  description: \"Retrieves named values out of `localStorage`. The values should\\n\\\r\nbe valid for passing to `JSON.parse()`. A default value can be specified in the\\n\\\r\nfunction call that should be returned if the value does not exist, or causes an\\n\\\r\nerror in parsing. Typically, you'd call this function at page-load time after having\\n\\\r\ncalled the [`setSetting()`](#setSetting) function during a previous page session.\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Assuming a text input element with the id `text1`, the following\\n\\\r\ncode should persist between reloads whatever the user writes in the text area:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var text1 = document.getElementById(\\\"text1\\\");\\n\\\r\n    document.addEventListener(\\\"unload\\\", function(){\\n\\\r\n      setSetting(\\\"text1-value\\\", text1.value);\\n\\\r\n    }, false);\\n\\\r\n    document.addEventListener(\\\"load\\\", function(){\\n\\\r\n      text1.value = getSetting(\\\"text1-value\\\", \\\"My default value!\\\");\\n\\\r\n    }, false);\"\r\n  }]\r\n});\r\n\r\nexport default function getSetting(settingName, defValue) {\r\n  if (window.localStorage) {\r\n    var val = window.localStorage.getItem(settingName);\r\n    if (val) {\r\n      try {\r\n        return JSON.parse(val);\r\n      }\r\n      catch (exp) {\r\n        console.error(\"getSetting\", settingName, val, typeof (val), exp);\r\n        console.error(exp);\r\n        console.error(\"getSetting\", settingName, val, typeof (val));\r\n      }\r\n    }\r\n  }\r\n  return defValue;\r\n};","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"immutable\",\r\n  description: \"Define an enumerable property that cannot be modified.\",\r\n  returns: \"Property\",\r\n  parameters: [{\r\n    name: \"value\",\r\n    type: \"Object\",\r\n    optional: true,\r\n    description: \"The initial value for the property.\"\r\n  }]\r\n});\r\n\r\nexport default function immutable(value) {\r\n  const getter = (typeof value === \"function\") ? value : function () {\r\n    return value;\r\n  };\r\n  return {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: getter,\r\n    set: function() {\r\n      throw new Error(\"This value is immutable and may only be read, not written.\");\r\n    }\r\n  };\r\n};\r\n","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"isTimestampDeltaValid\",\r\n  returns: \"Boolean\",\r\n  description: \"Helper method to validate the time steps of sensor timestamps.\",\r\n  parameters: [{\r\n    name: \"timestampDeltaS\",\r\n    type: \"Number\",\r\n    description: \"The timestamp to check.\"\r\n  }]\r\n});\r\nconst MIN_TIMESTEP = 0.001,\r\n  MAX_TIMESTEP = 1;\r\n\r\nexport default function isTimestampDeltaValid(timestampDeltaS) {\r\n  return !isNaN(timestampDeltaS) &&\r\n    MIN_TIMESTEP < timestampDeltaS &&\r\n    timestampDeltaS <= MAX_TIMESTEP;\r\n};","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"mutable\",\r\n  description: \"Define an enumerable property that can be modified, with type optional checking.\",\r\n  returns: \"Property\",\r\n  parameters: [{\r\n    name: \"value\",\r\n    type: \"Object\",\r\n    optional: true,\r\n    description: \"The initial value for the property.\"\r\n  }, {\r\n    name: \"type\",\r\n    type: \"string or Function\",\r\n    optional: true,\r\n\r\n  }]\r\n});\r\n\r\nexport default function mutable(value, type) {\r\n  if(!type) {\r\n    return {\r\n      enumerable: true,\r\n      configurable: true,\r\n      get: function() {\r\n        return value;\r\n      },\r\n      set: function(v) {\r\n        value = v;\r\n      }\r\n    };\r\n  }\r\n  else if(typeof type === \"function\") {\r\n    return {\r\n      enumerable: true,\r\n      configurable: true,\r\n      get: function() {\r\n        return value;\r\n      },\r\n      set: function(v) {\r\n        if(v instanceof type) {\r\n          throw new Error(\"Value must be a \" + type + \": \" + v);\r\n        }\r\n        value = v;\r\n      }\r\n    };\r\n  }\r\n  else {\r\n    return {\r\n      enumerable: true,\r\n      configurable: true,\r\n      get: function() {\r\n        return value;\r\n      },\r\n      set: function(v) {\r\n        var t = typeof v;\r\n        if(t !== type) {\r\n          throw new Error(\"Value must be a \" + type + \". An \" + t + \" was provided instead: \" + v);\r\n        }\r\n        value = v;\r\n      }\r\n    };\r\n  }\r\n};\r\n","export function lock(element) {\r\n  var type = screen.orientation && screen.orientation.type || screen.mozOrientation || \"\";\r\n  if (type.indexOf(\"landscape\") === -1) {\r\n    type = \"landscape-primary\";\r\n  }\r\n  if (screen.orientation && screen.orientation.lock) {\r\n    return screen.orientation.lock(type);\r\n  }\r\n  else if (screen.mozLockOrientation) {\r\n    var locked = screen.mozLockOrientation(type);\r\n    if (locked) {\r\n      return Promise.resolve(element);\r\n    }\r\n  }\r\n  else {\r\n    return Promise.reject(new Error(\"Pointer lock not supported.\"));\r\n  }\r\n}\r\n\r\nexport function unlock() {\r\n  if (screen.orientation && screen.orientation.unlock) {\r\n    screen.orientation.unlock();\r\n  }\r\n  else if (screen.mozUnlockOrientation) {\r\n    screen.mozUnlockOrientation();\r\n  }\r\n}\r\n\r\nexport default {\r\n  lock,\r\n  unlock\r\n};","import AsyncLockRequest from \"./AsyncLockRequest\";\r\nexport default new AsyncLockRequest(\r\n  \"Pointer Lock\",\r\n  [\"pointerLockElement\", \"mozPointerLockElement\", \"webkitPointerLockElement\"],\r\n  [\"onpointerlockchange\", \"onmozpointerlockchange\", \"onwebkitpointerlockchange\"],\r\n  [\"onpointerlockerror\", \"onmozpointerlockerror\", \"onwebkitpointerlockerror\"],\r\n  [\"requestPointerLock\", \"mozRequestPointerLock\", \"webkitRequestPointerLock\", \"webkitRequestPointerLock\"],\r\n  [\"exitPointerLock\", \"mozExitPointerLock\", \"webkitExitPointerLock\", \"webkitExitPointerLock\"]);","pliny.function({\r\n  parent: \"Util\",\r\n  name: \"setSetting\",\r\n  parameters: [{\r\n    name: \"settingName\",\r\n    type: \"string\",\r\n    description: \"The name of the setting to set.\"\r\n  }, {\r\n    name: \"val\",\r\n    type: \"Object\",\r\n    description: \"The value to write. It should be useable as a parameter to `JSON.stringify()`.\"\r\n  }],\r\n  description: \"Writes named values to `localStorage`. The values should be valid\\n\\\r\nfor passing to `JSON.stringify()`. Typically, you'd call this function at page-unload\\n\\\r\ntime, then call the [`getSetting()`](#getSetting) function during a subsequent page load.\",\r\n  examples: [{\r\n    name: \"Basic usage\",\r\n    description: \"Assuming a text input element with the id `text1`, the following\\n\\\r\ncode should persist between reloads whatever the user writes in the text area:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var text1 = document.getElementById(\\\"text1\\\");\\n\\\r\n    document.addEventListener(\\\"unload\\\", function(){\\n\\\r\n      setSetting(\\\"text1-value\\\", text1.value);\\n\\\r\n    }, false);\\n\\\r\n    document.addEventListener(\\\"load\\\", function(){\\n\\\r\n      text1.value = getSetting(\\\"text1-value\\\", \\\"My default value!\\\");\\n\\\r\n    }, false);\"\r\n  }]\r\n});\r\n\r\nexport default function setSetting(settingName, val) {\r\n  if (window.localStorage && val) {\r\n    try {\r\n      window.localStorage.setItem(settingName, JSON.stringify(val));\r\n    }\r\n    catch (exp) {\r\n      console.error(\"setSetting\", settingName, val, typeof (val), exp);\r\n    }\r\n  }\r\n};","import isMobile from \"../flags/isMobile\";\r\nimport Orientation from \"./Orientation\";\r\nimport PointerLock from \"./PointerLock\";\r\n\r\nexport default function standardUnlockBehavior() {\r\n  if (isMobile) {\r\n    Orientation.unlock();\r\n    return Promise.resolve();\r\n  }\r\n  else{\r\n    return PointerLock.exit()\r\n      .catch((exp) => console.warn(\"PointerLock exit failed\", exp));\r\n  }\r\n};","import standardUnlockBehavior from \"./standardUnlockBehavior\";\r\nimport FullScreen from \"./FullScreen\";\r\n\r\nexport default function standardExitFullScreenBehavior() {\r\n  return standardUnlockBehavior()\r\n    .then(() => FullScreen.exit())\r\n    .catch((exp) => console.warn(\"FullScreen failed\", exp));\r\n};\r\n","import isMobile from \"../flags/isMobile\";\r\nimport isiOS from \"../flags/isiOS\";\r\nimport Orientation from \"./Orientation\";\r\nimport PointerLock from \"./PointerLock\";\r\n\r\nexport default function standardLockBehavior(elem) {\r\n  if(isiOS) {\r\n    return Promise.resolve(elem);\r\n  }\r\n  else if (isMobile) {\r\n    return Orientation.lock(elem)\r\n      .catch((exp) => console.warn(\"OrientationLock failed\", exp));\r\n  }\r\n  else {\r\n    return PointerLock.request(elem)\r\n      .catch((exp) => console.warn(\"PointerLock failed\", exp));\r\n  }\r\n};","import FullScreen from \"./FullScreen\";\r\nimport standardLockBehavior from \"./standardLockBehavior\";\r\n\r\nexport default function standardFullScreenBehavior(elem) {\r\n  return FullScreen.request(elem)\r\n    .catch((exp) => console.warn(\"FullScreen failed\", exp))\r\n    .then(standardLockBehavior);\r\n};","pliny.class({\r\n  parent: \"Util\",\r\n  name: \"Workerize\",\r\n  description: \"Builds a WebWorker thread out of a JavaScript class's source code, and attempts to create a message interface that matches the message-passing interface that the class already uses.\\n\\\r\n\\n\\\r\nAutomatically workerized classes should have methods that take a single array for any parameters and return no values. All return results should come through an Event that the class emits.\",\r\n  parameters: [{\r\n    name: \"func\",\r\n    type: \"Function\",\r\n    description: \"The class function to workerize\"\r\n  }],\r\n  examples: [{\r\n    name: \"Create a basic workerized class.\",\r\n    description: \"Classes in JavaScript are created by adding new functions to the `prototype` of another function, then instantiating objects from that class with `new`. When creating such a class for automatic workerization, a few restrictions are required:\\n\\\r\n* All methods in the class must be on the prototype. Any methods created and assigned in the constructor will not be available to the message passing interface.\\n\\\r\n* All interaction with objects of the class must be through these publicly accessible methods. This includes initialization.\\n\\\r\n* All methods should take at most a single argument. If you need multiple arguments, pack them into an array.\\n\\\r\n* The methods cannot return any values. If a value must be returned to the calling context, it must be done through an event callback.\\n\\\r\n* The class must assign handlers to events through an addEventListener method that mirrors the standard interface used in DOM. Workerize will not respect the 3rd `bubbles` parameter that is so often omitted when programming against DOM.\\n\\\r\n\\n\\\r\nAssuming the following class:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    function MyClass(){\\n\\\r\n      this.listeners = {\\n\\\r\n        complete: []\\n\\\r\n      };\\n\\\r\n      this.objects = [];\\n\\\r\n    }\\n\\\r\n\\n\\\r\n    MyClass.prototype.addEventListener = function(evt, handler){\\n\\\r\n      if(this.listeners[evt]){\\n\\\r\n        this.listeners[evt].push(handler);\\n\\\r\n      }\\n\\\r\n    };\\n\\\r\n\\n\\\r\n    MyClass.prototype.addObject = function(obj){\\n\\\r\n      this.objects.push(obj);\\n\\\r\n    };\\n\\\r\n\\n\\\r\n    MyClass.prototype.update = function(dt){\\n\\\r\n      // we can make essentially arbitrarily small timeslice updates\\n\\\r\n      var SLICE = 0.1;\\n\\\r\n      for(var ddt = 0; ddt < dt; ddt += SLICE){\\n\\\r\n        for(var i = 0; i < this.objects.length; ++i){\\n\\\r\n          var o = this.objects[i];\\n\\\r\n          o.x += o.vx * SLICE;\\n\\\r\n          o.y += o.vy * SLICE;\\n\\\r\n          o.z += o.vz * SLICE;\\n\\\r\n        }\\n\\\r\n      }\\n\\\r\n      // prepare our return state for the UI thread.\\n\\\r\n      var returnValue = [];\\n\\\r\n      for(var i = 0; i < this.objects.length; ++i){\\n\\\r\n        returnValue.push([o.x, o.y, o.z]);\\n\\\r\n      }\\n\\\r\n      // and emit the event to all of the listeners.\\n\\\r\n      for(var i = 0; i < this.listeners.complete.length; ++i){\\n\\\r\n        this.listeners.complete[i](returnValue);\\n\\\r\n      }\\n\\\r\n    };\\n\\\r\n\\n\\\r\nThen we can create and use an automatically workerized version of it as follows.\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var phys = new Primrose.Workerize(MyClass);\\n\\\r\n    // we keep a local copy of the state so we can perform other operations on it.\\n\\\r\n    var objects = [];\\n\\\r\n    for(var i = 0; i < 10; ++i){\\n\\\r\n      var obj = {\\n\\\r\n        // random values between -1 and 1\\n\\\r\n        x: 2 * Math.random() - 1,\\n\\\r\n        y: 2 * Math.random() - 1,\\n\\\r\n        z: 2 * Math.random() - 1,\\n\\\r\n        vx: 2 * Math.random() - 1,\\n\\\r\n        vy: 2 * Math.random() - 1,\\n\\\r\n        vz: 2 * Math.random() - 1\\n\\\r\n      };\\n\\\r\n      objects.push(obj);\\n\\\r\n      phys.addObject(obj);\\n\\\r\n    }\\n\\\r\n    \\n\\\r\n    // this flag lets us keep track of whether or not we know that the worker is in the middle of an expensive operation.\\n\\\r\n    phys.ready = true;\\n\\\r\n    phys.addEventListener(\\\"complete\\\", function(newPositions){\\n\\\r\n      // We update the state in the UI thread with the expensively-computed values.\\n\\\r\n      for(var i = 0; i < newPositions.length; ++i){\\n\\\r\n        objects[i].x = newPositions[i][0];\\n\\\r\n        objects[i].y = newPositions[i][1];\\n\\\r\n        objects[i].z = newPositions[i][2];\\n\\\r\n      }\\n\\\r\n      phys.ready = true;\\n\\\r\n    });\\n\\\r\n    \\n\\\r\n    var lt = null;\\n\\\r\n    function paint(t){\\n\\\r\n      requestAnimationFrame(paint);\\n\\\r\n      if(lt === undefined || lt === null){\\n\\\r\n        lt = t;\\n\\\r\n      } else {\\n\\\r\n        var dt = t - lt;\\n\\\r\n        if(phys.ready){\\n\\\r\n          phys.ready = false;\\n\\\r\n          phys.update(dt);\\n\\\r\n          lt = t;\\n\\\r\n        }\\n\\\r\n        for(var i = 0; i < objects.length; ++i){\\n\\\r\n          var o = objects[i];\\n\\\r\n          // We can even perform a much cheaper position update to smooth over the blips in the expensive update on the worker thread.\\n\\\r\n          drawObjectAt(o.x + o.vx * dt, o.y + o.vy * dt, o.z + o.vz * dt);\\n\\\r\n        }\\n\\\r\n      }\\n\\\r\n    }\\n\\\r\n    requestAnimationFrame(paint);\"\r\n    }]\r\n});\r\n\r\nimport { EventDispatcher } from \"three\";\r\n\r\nexport default class Workerize extends EventDispatcher {\r\n\r\n  static createWorker(script, stripFunc) {\r\n\r\n    pliny.function({\r\n      parent: \"Util.Workerize\",\r\n      name: \"createWorker\",\r\n      description: \"A static function that loads Plain Ol' JavaScript Functions into a WebWorker.\",\r\n      parameters: [{\r\n        name: \"script\",\r\n        type: \"(String|Function)\",\r\n        description: \"A String defining a script, or a Function that can be toString()'d to get it's script.\"\r\n      }, {\r\n        name: \"stripFunc\",\r\n        type: \"Boolean\",\r\n        description: \"Set to true if you want the function to strip the surround function block scope from the script.\"\r\n      }],\r\n      returns: \"The WebWorker object.\"\r\n    });\r\n\r\n    if (typeof script === \"function\") {\r\n      script = script.toString();\r\n    }\r\n\r\n    if (stripFunc) {\r\n      script = script.trim();\r\n      var start = script.indexOf('{');\r\n      script = script.substring(start + 1, script.length - 1);\r\n    }\r\n\r\n    var blob = new Blob([script], {\r\n        type: \"text/javascript\"\r\n      }),\r\n      dataURI = URL.createObjectURL(blob);\r\n\r\n    return new Worker(dataURI);\r\n  }\r\n\r\n  constructor(func) {\r\n    super();\r\n    // First, rebuild the script that defines the class. Since we're dealing\r\n    // with pre-ES6 browsers, we have to use ES5 syntax in the script, or invoke\r\n    // a conversion at a point post-script reconstruction, pre-workerization.\r\n\r\n    // start with the constructor function\r\n    var script = func.toString(),\r\n      // strip out the name in a way that Internet Explorer also understands\r\n      // (IE doesn't have the Function.name property supported by Chrome and\r\n      // Firefox)\r\n      matches = script.match(/function\\s+(\\w+)\\s*\\(/),\r\n      name = matches[1],\r\n      k;\r\n\r\n    // then rebuild the member methods\r\n    for (k in func.prototype) {\r\n      // We preserve some formatting so it's easy to read the code in the debug\r\n      // view. Yes, you'll be able to see the generated code in your browser's\r\n      // debugger.\r\n      script += \"\\n\\n\" + name + \".prototype.\" + k + \" = \" + func.prototype[k].toString() + \";\";\r\n    }\r\n\r\n    // Automatically instantiate an object out of the class inside the worker,\r\n    // in such a way that the user-defined function won't be able to get to it.\r\n    script += \"\\n\\n(function(){\\n  var instance = new \" + name + \"(true);\";\r\n\r\n    // Create a mapper from the events that the class defines to the worker-side\r\n    // postMessage method, to send message to the UI thread that one of the\r\n    // events occured.\r\n    script += \"\\n  if(instance.addEventListener){\\n\" +\r\n      \"    self.args = [null, null];\\n\" +\r\n      \"    for(var k in instance.listeners) {\\n\" +\r\n      \"      instance.addEventListener(k, function(eventName, args){\\n\" +\r\n      \"        self.args[0] = eventName;\\n\" +\r\n      \"        self.args[1] = args;\\n\" +\r\n      \"        postMessage(self.args);\\n\" +\r\n      \"      }.bind(this, k));\\n\" +\r\n      \"    }\\n\" +\r\n      \"  }\";\r\n\r\n    // Create a mapper from the worker-side onmessage event, to receive messages\r\n    // from the UI thread that methods were called on the object.\r\n    script += \"\\n\\n  onmessage = function(evt){\\n\" +\r\n      \"    var f = evt.data[0],\\n\" +\r\n      \"        t = instance[f];\\n\" +\r\n      \"    if(t){\\n\" +\r\n      \"      t.call(instance, evt.data[1]);\\n\" +\r\n      \"    }\\n\" +\r\n      \"  };\\n\\n\" +\r\n      \"})();\";\r\n\r\n    // The binary-large-object can be used to convert the script from text to a\r\n    // data URI, because workers can only be created from same-origin URIs.\r\n    pliny.property({\r\n      parent: \"Util.Workerize\",\r\n      name: \"worker\",\r\n      type: \"WebWorker\",\r\n      description: \"The worker thread containing our class.\"\r\n    });\r\n    this.worker = Workerize.createWorker(script, false);\r\n\r\n    pliny.property({\r\n      parent: \"Util.Workerize\",\r\n      name: \"args\",\r\n      type: \"Array\",\r\n      description: \"Static allocation of an array to save on memory usage when piping commands to a worker.\"\r\n    });\r\n    this.args = [null, null];\r\n\r\n    this.worker.onmessage = (e) => this.emit(e.data[0], e.data[1]);\r\n\r\n    // create mappers from the UI-thread side method calls to the UI-thread side\r\n    // postMessage method, to inform the worker thread that methods were called,\r\n    // with parameters.\r\n    pliny.property({\r\n      parent: \"Util.Workerize\",\r\n      name: \"&lt;mappings for each method in the original class&gt;\",\r\n      type: \"Function\",\r\n      description: \"Each mapped function causes a message to be posted to the worker thread with its arguments packed into an array.\"\r\n    });\r\n    for (k in func.prototype) {\r\n      // we skip the addEventListener method because we override it in a\r\n      // different way, to be able to pass messages across the thread boundary.\r\n      if (k !== \"addEventListener\" && k[0] !== '_') {\r\n        // make the name of the function the first argument, no matter what.\r\n        this[k] = this.methodShim.bind(this, k);\r\n      }\r\n    }\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  methodShim(eventName, args) {\r\n\r\n    pliny.method({\r\n      parent: \"Util.Workerize\",\r\n      name: \"methodShim\",\r\n      description: \"Posts messages to the worker thread by packing arguments into an array. The worker will receive the array and interpret the first value as the name of the method to invoke and the second value as another array of parameters.\",\r\n      parameters: [{\r\n        name: \"methodName\",\r\n        type: \"String\",\r\n        description: \"The method inside the worker context that we want to invoke.\"\r\n      }, {\r\n        name: \"args\",\r\n        type: \"Array\",\r\n        description: \"The arguments that we want to pass to the method that we are calling in the worker context.\"\r\n      }]\r\n    });\r\n\r\n    this.args[0] = eventName;\r\n    this.args[1] = args;\r\n    this.worker.postMessage(this.args);\r\n  }\r\n};\r\n","pliny.namespace({\r\n  name: \"Util\",\r\n  description: \"A few different utility functions.\\n\\\r\n\\n\\\r\nWhen including Primrose as a `script` tag, the Util functions are imported directly onto the window object and is available without qualification.\"\r\n});\r\n\r\nimport AsyncLockRequest from \"./AsyncLockRequest\";\r\nimport cache from \"./cache\";\r\nimport deleteSetting from \"./deleteSetting\";\r\nimport findProperty from \"./findProperty\";\r\nimport FullScreen from \"./FullScreen\";\r\nimport getSetting from \"./getSetting\";\r\nimport identity from \"./identity\";\r\nimport immutable from \"./immutable\";\r\nimport isTimestampDeltaValid from \"./isTimestampDeltaValid\";\r\nimport mutable from \"./mutable\";\r\nimport Orientation from \"./Orientation\";\r\nimport PointerLock from \"./PointerLock\";\r\nimport setSetting from \"./setSetting\";\r\nimport standardExitFullScreenBehavior from \"./standardExitFullScreenBehavior\";\r\nimport standardFullScreenBehavior from \"./standardFullScreenBehavior\";\r\nimport standardLockBehavior from \"./standardLockBehavior\";\r\nimport standardUnlockBehavior from \"./standardUnlockBehavior\";\r\nimport Workerize from \"./Workerize\";\r\n\r\nexport {\r\n  AsyncLockRequest,\r\n  cache,\r\n  deleteSetting,\r\n  findProperty,\r\n  FullScreen,\r\n  getSetting,\r\n  identity,\r\n  immutable,\r\n  isTimestampDeltaValid,\r\n  mutable,\r\n  Orientation,\r\n  PointerLock,\r\n  setSetting,\r\n  standardExitFullScreenBehavior,\r\n  standardFullScreenBehavior,\r\n  standardLockBehavior,\r\n  standardUnlockBehavior,\r\n  Workerize\r\n};\r\n\r\nexport default {\r\n  AsyncLockRequest,\r\n  cache,\r\n  deleteSetting,\r\n  findProperty,\r\n  FullScreen,\r\n  getSetting,\r\n  identity,\r\n  immutable,\r\n  isTimestampDeltaValid,\r\n  mutable,\r\n  Orientation,\r\n  PointerLock,\r\n  setSetting,\r\n  standardExitFullScreenBehavior,\r\n  standardFullScreenBehavior,\r\n  standardLockBehavior,\r\n  standardUnlockBehavior,\r\n  Workerize\r\n};","import { Geometry, BufferGeometry } from \"three\";\r\n\r\nBufferGeometry.prototype.center =\r\nGeometry.prototype.center =\r\n  function() {\r\n    this.computeBoundingBox();\r\n    const b = this.boundingBox,\r\n          dx = (b.max.x + b.min.x) / 2,\r\n          dy = (b.max.y + b.min.y) / 2,\r\n          dz = (b.max.z + b.min.z) / 2;\r\n    return this.offset(-dx, -dy, -dz);\r\n  };\r\n","import { BufferGeometry, Geometry, Mesh } from \"three\";\r\nimport colored from \"../live-api/colored\";\r\n\r\nBufferGeometry.prototype.colored =\r\nGeometry.prototype.colored =\r\nMesh.prototype.colored =\r\n  function(color, options){\r\n    return colored(this, color, options);\r\n  };\r\n","import { CubeTextureLoader, CubeTexture, ImageLoader } from \"three\";\r\n\r\nCubeTextureLoader.prototype.load = function( urls, onLoad, onProgress, onError ) {\r\n  var texture = new CubeTexture();\r\n  var loader = new ImageLoader( this.manager );\r\n  loader.setCrossOrigin( this.crossOrigin );\r\n  loader.setPath( this.path );\r\n  var loaded = 0;\r\n\r\n  for ( var i = 0; i < urls.length; ++ i ) {\r\n    loader.load( urls[ i ], (function ( image ) {\r\n      texture.images[ i ] = image;\r\n      ++loaded;\r\n      if ( loaded === 6 ) {\r\n        texture.needsUpdate = true;\r\n        if ( onLoad ) onLoad( texture );\r\n      }\r\n    }).bind(null, i), onProgress, onError );\r\n  }\r\n\r\n  return texture;\r\n};\r\n","import { EventDispatcher, Object3D } from \"three\";\r\n\r\nObject3D.prototype.emit = EventDispatcher.prototype.emit = function(evt, obj) {\r\n  if(!obj) {\r\n    obj = {};\r\n  }\r\n\r\n  if(typeof obj === \"object\" && !(obj instanceof Event)){\r\n    obj.type = evt;\r\n\r\n    if(obj.defaultPrevented === undefined){\r\n      obj.defaultPrevented = false;\r\n      obj.preventDefault = () => obj.defaultPrevented = true;\r\n    }\r\n  }\r\n\r\n  this.dispatchEvent(obj);\r\n};\r\n\r\nObject3D.prototype.dispatchEvent = EventDispatcher.prototype.dispatchEvent = function(evt) {\r\n  if (this._listeners === undefined ){\r\n    return;\r\n  }\r\n\r\n  var listeners = this._listeners;\r\n  var listenerArray = listeners[ evt.type ];\r\n\r\n  if ( listenerArray !== undefined ) {\r\n\r\n    if(!(evt instanceof Event)) {\r\n      evt.target = this;\r\n    }\r\n\r\n    var array = [], i = 0;\r\n    var length = listenerArray.length;\r\n\r\n    for ( i = 0; i < length; i ++ ) {\r\n\r\n      array[ i ] = listenerArray[ i ];\r\n\r\n    }\r\n\r\n    for ( i = 0; i < length; i ++ ) {\r\n\r\n      array[ i ].call( this, evt );\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\nObject3D.prototype.watch = EventDispatcher.prototype.watch = function(child, events) {\r\n  if(!(events instanceof Array)) {\r\n    events = [events];\r\n  }\r\n  events.forEach((event) =>\r\n    child.addEventListener(event, this.dispatchEvent.bind(this)));\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.route = EventDispatcher.prototype.route = function(events, listener) {\r\n  events.forEach((event) =>\r\n    this.addEventListener(event, listener));\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.on = EventDispatcher.prototype.on = function(event, listener) {\r\n  this.addEventListener(event, listener);\r\n  return this;\r\n};\r\n","import { Matrix4 } from \"three\";\r\n\r\nMatrix4.prototype.toString = function(digits) {\r\n  if(digits === undefined){\r\n    digits = 10;\r\n  }\r\n  this.transpose();\r\n  var parts = this.toArray();\r\n  this.transpose();\r\n  if (digits !== undefined) {\r\n    for (let i = 0; i < parts.length; ++i) {\r\n    }\r\n  }\r\n  var output = \"\";\r\n  for (let i = 0; i < parts.length; ++i) {\r\n    if ((i % 4) === 0) {\r\n      output += \"| \";\r\n    }\r\n    if(Math.sign(parts[i]) === -1){\r\n      output += \"-\";\r\n    }\r\n    else{\r\n      output += \" \";\r\n    }\r\n\r\n    if (parts[i] !== null && parts[i] !== undefined) {\r\n      output += Math.abs(parts[i]).toFixed(digits);\r\n    }\r\n    else {\r\n      output += \"undefined\".substring(0, digits);\r\n    }\r\n\r\n    if ((i % 4) === 3) {\r\n      output += \" |\\n\";\r\n    }\r\n    else {\r\n      output += \", \";\r\n    }\r\n  }\r\n  return output;\r\n};\r\n","/**\r\n * Loads a Wavefront .mtl file specifying materials\r\n *\r\n * @author angelxuanchang\r\n *\r\n * Converted to ES2015 by @capnmidnight\r\n *\r\n */\r\nimport { EventDispatcher, DefaultLoadingManager, Loader, RepeatWrapping, FileLoader, TextureLoader, FrontSide, MeshPhongMaterial, MeshBasicMaterial, Color, Vector2 } from \"three\";\r\n\r\nexport class MTLLoader extends EventDispatcher {\r\n\r\n  constructor ( manager ) {\r\n\r\n    super();\r\n\r\n    this.manager = ( manager !== undefined ) ? manager : DefaultLoadingManager;\r\n\r\n  }\r\n\r\n  /**\r\n   * Loads and parses a MTL asset from a URL.\r\n   *\r\n   * @param {String} url - URL to the MTL file.\r\n   * @param {Function} [onLoad] - Callback invoked with the loaded object.\r\n   * @param {Function} [onProgress] - Callback for download progress.\r\n   * @param {Function} [onError] - Callback for download errors.\r\n   *\r\n   * @see setPath setTexturePath\r\n   *\r\n   * @note In order for relative texture references to resolve correctly\r\n   * you must call setPath and/or setTexturePath explicitly prior to load.\r\n   */\r\n  load ( url, onLoad, onProgress, onError ) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new FileLoader( this.manager );\r\n    loader.setPath( this.path );\r\n    loader.load( url, function ( text ) {\r\n\r\n      onLoad( scope.parse( text ) );\r\n\r\n    }, onProgress, onError );\r\n\r\n  }\r\n\r\n  /**\r\n   * Set base path for resolving references.\r\n   * If set this path will be prepended to each loaded and found reference.\r\n   *\r\n   * @see setTexturePath\r\n   * @param {String} path\r\n   *\r\n   * @example\r\n   *     mtlLoader.setPath( 'assets/obj/' );\r\n   *     mtlLoader.load( 'my.mtl', ... );\r\n   */\r\n  setPath ( path ) {\r\n\r\n    this.path = path;\r\n\r\n  }\r\n\r\n  /**\r\n   * Set base path for resolving texture references.\r\n   * If set this path will be prepended found texture reference.\r\n   * If not set and setPath is, it will be used as texture base path.\r\n   *\r\n   * @see setPath\r\n   * @param {String} path\r\n   *\r\n   * @example\r\n   *     mtlLoader.setPath( 'assets/obj/' );\r\n   *     mtlLoader.setTexturePath( 'assets/textures/' );\r\n   *     mtlLoader.load( 'my.mtl', ... );\r\n   */\r\n  setTexturePath ( path ) {\r\n\r\n    this.texturePath = path;\r\n\r\n  }\r\n\r\n  setBaseUrl ( path ) {\r\n\r\n    console.warn( 'MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.' );\r\n\r\n    this.setTexturePath( path );\r\n\r\n  }\r\n\r\n  setCrossOrigin ( value ) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n  setMaterialOptions ( value ) {\r\n\r\n    this.materialOptions = value;\r\n\r\n  }\r\n\r\n  /**\r\n   * Parses a MTL file.\r\n   *\r\n   * @param {String} text - Content of MTL file\r\n   * @return {MTLLoader.MaterialCreator}\r\n   *\r\n   * @see setPath setTexturePath\r\n   *\r\n   * @note In order for relative texture references to resolve correctly\r\n   * you must call setPath and/or setTexturePath explicitly prior to parse.\r\n   */\r\n  parse ( text ) {\r\n\r\n    var lines = text.split( '\\n' );\r\n    var info = {};\r\n    var delimiter_pattern = /\\s+/;\r\n    var materialsInfo = {};\r\n\r\n    for ( var i = 0; i < lines.length; i ++ ) {\r\n\r\n      var line = lines[ i ];\r\n      line = line.trim();\r\n\r\n      if ( line.length === 0 || line.charAt( 0 ) === '#' ) {\r\n\r\n        // Blank line or comment ignore\r\n        continue;\r\n\r\n      }\r\n\r\n      var pos = line.indexOf( ' ' );\r\n\r\n      var key = ( pos >= 0 ) ? line.substring( 0, pos ) : line;\r\n      key = key.toLowerCase();\r\n\r\n      var value = ( pos >= 0 ) ? line.substring( pos + 1 ) : '';\r\n      value = value.trim();\r\n\r\n      if ( key === 'newmtl' ) {\r\n\r\n        // New material\r\n\r\n        info = { name: value };\r\n        materialsInfo[ value ] = info;\r\n\r\n      } else if ( info ) {\r\n\r\n        if ( key === 'ka' || key === 'kd' || key === 'ks' ) {\r\n\r\n          var ss = value.split( delimiter_pattern, 3 );\r\n          info[ key ] = [ parseFloat( ss[ 0 ] ), parseFloat( ss[ 1 ] ), parseFloat( ss[ 2 ] ) ];\r\n\r\n        } else {\r\n\r\n          info[ key ] = value;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var materialCreator = new MaterialCreator( this.texturePath || this.path, this.materialOptions );\r\n    materialCreator.setCrossOrigin( this.crossOrigin );\r\n    materialCreator.setManager( this.manager );\r\n    materialCreator.setMaterials( materialsInfo );\r\n    return materialCreator;\r\n\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * Create a new MTLLoader.MaterialCreator\r\n * @param baseUrl - Url relative to which textures are loaded\r\n * @param options - Set of options on how to construct the materials\r\n *                  side: Which side to apply the material\r\n *                        THREE.FrontSide (default), THREE.BackSide, THREE.DoubleSide\r\n *                  wrap: What type of wrapping to apply for textures\r\n *                        THREE.RepeatWrapping (default), THREE.ClampToEdgeWrapping, THREE.MirroredRepeatWrapping\r\n *                  normalizeRGB: RGBs need to be normalized to 0-1 from 0-255\r\n *                                Default: false, assumed to be already normalized\r\n *                  ignoreZeroRGBs: Ignore values of RGBs (Ka,Kd,Ks) that are all 0's\r\n *                                  Default: false\r\n * @constructor\r\n */\r\n\r\nclass MaterialCreator {\r\n\r\n  constructor ( baseUrl, options ) {\r\n\r\n    this.baseUrl = baseUrl || '';\r\n    this.options = options;\r\n    this.materialsInfo = {};\r\n    this.materials = {};\r\n    this.materialsArray = [];\r\n    this.nameLookup = {};\r\n\r\n    this.side = ( this.options && this.options.side ) ? this.options.side : FrontSide;\r\n    this.wrap = ( this.options && this.options.wrap ) ? this.options.wrap : RepeatWrapping;\r\n\r\n  }\r\n\r\n  setCrossOrigin ( value ) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n  setManager ( value ) {\r\n\r\n    this.manager = value;\r\n\r\n  }\r\n\r\n  setMaterials ( materialsInfo ) {\r\n\r\n    this.materialsInfo = this.convert( materialsInfo );\r\n    this.materials = {};\r\n    this.materialsArray = [];\r\n    this.nameLookup = {};\r\n\r\n  }\r\n\r\n  convert ( materialsInfo ) {\r\n\r\n    if ( ! this.options ) return materialsInfo;\r\n\r\n    var converted = {};\r\n\r\n    for ( var mn in materialsInfo ) {\r\n\r\n      // Convert materials info into normalized form based on options\r\n\r\n      var mat = materialsInfo[ mn ];\r\n\r\n      var covmat = {};\r\n\r\n      converted[ mn ] = covmat;\r\n\r\n      for ( var prop in mat ) {\r\n\r\n        var save = true;\r\n        var value = mat[ prop ];\r\n        var lprop = prop.toLowerCase();\r\n\r\n        switch ( lprop ) {\r\n\r\n          case 'kd':\r\n          case 'ka':\r\n          case 'ks':\r\n\r\n            // Diffuse color (color under white light) using RGB values\r\n\r\n            if ( this.options && this.options.normalizeRGB ) {\r\n\r\n              value = [ value[ 0 ] / 255, value[ 1 ] / 255, value[ 2 ] / 255 ];\r\n\r\n            }\r\n\r\n            if ( this.options && this.options.ignoreZeroRGBs ) {\r\n\r\n              if ( value[ 0 ] === 0 && value[ 1 ] === 0 && value[ 2 ] === 0 ) {\r\n\r\n                // ignore\r\n\r\n                save = false;\r\n\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n          default:\r\n\r\n            break;\r\n        }\r\n\r\n        if ( save ) {\r\n\r\n          covmat[ lprop ] = value;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return converted;\r\n\r\n  }\r\n\r\n  preload () {\r\n\r\n    for ( var mn in this.materialsInfo ) {\r\n\r\n      this.create( mn );\r\n\r\n    }\r\n\r\n  }\r\n\r\n  getIndex ( materialName ) {\r\n\r\n    return this.nameLookup[ materialName ];\r\n\r\n  }\r\n\r\n  getAsArray () {\r\n\r\n    var index = 0;\r\n\r\n    for ( var mn in this.materialsInfo ) {\r\n\r\n      this.materialsArray[ index ] = this.create( mn );\r\n      this.nameLookup[ mn ] = index;\r\n      index ++;\r\n\r\n    }\r\n\r\n    return this.materialsArray;\r\n\r\n  }\r\n\r\n  create ( materialName ) {\r\n\r\n    if ( this.materials[ materialName ] === undefined ) {\r\n\r\n      this.createMaterial_( materialName );\r\n\r\n    }\r\n\r\n    return this.materials[ materialName ];\r\n\r\n  }\r\n\r\n  createMaterial_ ( materialName ) {\r\n\r\n    // Create material\r\n\r\n    var TMaterial = MeshPhongMaterial;\r\n    var scope = this;\r\n    var mat = this.materialsInfo[ materialName ];\r\n    var params = {\r\n\r\n      name: materialName,\r\n      side: this.side\r\n\r\n    };\r\n\r\n    var resolveURL = function ( baseUrl, url ) {\r\n\r\n      if ( typeof url !== 'string' || url === '' )\r\n        return '';\r\n\r\n      // Absolute URL\r\n      if ( /^https?:\\/\\//i.test( url ) ) {\r\n        return url;\r\n      }\r\n\r\n      return baseUrl + url;\r\n    };\r\n\r\n    function setMapForType ( mapType, value ) {\r\n\r\n      if ( params[ mapType ] ) return; // Keep the first encountered texture\r\n\r\n      var texParams = scope.getTextureParams( value, params );\r\n      var map = scope.loadTexture( resolveURL( scope.baseUrl, texParams.url ) );\r\n\r\n      map.repeat.copy( texParams.scale );\r\n      map.offset.copy( texParams.offset );\r\n\r\n      map.wrapS = scope.wrap;\r\n      map.wrapT = scope.wrap;\r\n\r\n      params[ mapType ] = map;\r\n    }\r\n\r\n    for ( var prop in mat ) {\r\n\r\n      var value = mat[ prop ];\r\n\r\n      if ( value === '' ) continue;\r\n\r\n      switch ( prop.toLowerCase() ) {\r\n\r\n        // Ns is material specular exponent\r\n\r\n        case 'kd':\r\n\r\n          // Diffuse color (color under white light) using RGB values\r\n\r\n          params.color = new Color().fromArray( value );\r\n\r\n          break;\r\n\r\n        case 'ks':\r\n\r\n          // Specular color (color when light is reflected from shiny surface) using RGB values\r\n          params.specular = new Color().fromArray( value );\r\n\r\n          break;\r\n\r\n        case 'map_kd':\r\n\r\n          // Diffuse texture map\r\n\r\n          setMapForType( \"map\", value );\r\n\r\n          break;\r\n\r\n        case 'map_ks':\r\n\r\n          // Specular map\r\n\r\n          setMapForType( \"specularMap\", value );\r\n\r\n          break;\r\n\r\n        case 'map_bump':\r\n        case 'bump':\r\n\r\n          // Bump texture map\r\n\r\n          setMapForType( \"bumpMap\", value );\r\n\r\n          break;\r\n\r\n        case 'ns':\r\n\r\n          // The specular exponent (defines the focus of the specular highlight)\r\n          // A high exponent results in a tight, concentrated highlight. Ns values normally range from 0 to 1000.\r\n\r\n          params.shininess = parseFloat( value );\r\n\r\n          break;\r\n\r\n        case 'd':\r\n\r\n          if ( value < 1 ) {\r\n\r\n            params.opacity = value;\r\n            params.transparent = true;\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'illum':\r\n\r\n          value = parseFloat(value);\r\n\r\n          if ( value === MTLLoader.COLOR_ON_AND_AMBIENT_OFF ) {\r\n\r\n            TMaterial = MeshBasicMaterial;\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'Tr':\r\n\r\n          if ( value > 0 ) {\r\n\r\n            params.opacity = 1 - value;\r\n            params.transparent = true;\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        default:\r\n          break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if ( TMaterial === MeshBasicMaterial ) {\r\n\r\n      [ \"shininess\", \"specular\" ].forEach( function ( attribute ) {\r\n\r\n        if ( attribute in params ) {\r\n\r\n          delete params[attribute];\r\n\r\n        }\r\n\r\n      } );\r\n\r\n    }\r\n\r\n    this.materials[ materialName ] = new TMaterial( params );\r\n    return this.materials[ materialName ];\r\n  }\r\n\r\n  getTextureParams ( value, matParams ) {\r\n\r\n    var texParams = {\r\n\r\n      scale: new Vector2( 1, 1 ),\r\n      offset: new Vector2( 0, 0 ),\r\n\r\n     };\r\n\r\n    var items = value.split(/\\s+/);\r\n    var pos;\r\n\r\n    pos = items.indexOf('-bm');\r\n    if (pos >= 0) {\r\n\r\n      matParams.bumpScale = parseFloat( items[pos+1] );\r\n      items.splice( pos, 2 );\r\n\r\n    }\r\n\r\n    pos = items.indexOf('-s');\r\n    if (pos >= 0) {\r\n\r\n      texParams.scale.set( parseFloat( items[pos+1] ), parseFloat( items[pos+2] ) );\r\n      items.splice( pos, 4 ); // we expect 3 parameters here!\r\n\r\n    }\r\n\r\n    pos = items.indexOf('-o');\r\n    if (pos >= 0) {\r\n\r\n      texParams.offset.set( parseFloat( items[pos+1] ), parseFloat( items[pos+2] ) );\r\n      items.splice( pos, 4 ); // we expect 3 parameters here!\r\n\r\n    }\r\n\r\n    texParams.url = items.join(' ').trim();\r\n    return texParams;\r\n\r\n  }\r\n\r\n  loadTexture ( url, mapping, onLoad, onProgress, onError ) {\r\n\r\n    var texture;\r\n    var loader = Loader.Handlers.get( url );\r\n    var manager = ( this.manager !== undefined ) ? this.manager : DefaultLoadingManager;\r\n\r\n    if ( loader === null ) {\r\n\r\n      loader = new TextureLoader( manager );\r\n\r\n    }\r\n\r\n    if ( loader.setCrossOrigin ) loader.setCrossOrigin( this.crossOrigin );\r\n    texture = loader.load( url, onLoad, onProgress, onError );\r\n\r\n    if ( mapping !== undefined ) texture.mapping = mapping;\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// http://paulbourke.net/dataformats/mtl/\r\nObject.assign( MTLLoader, {\r\n  COLOR_ON_AND_AMBIENT_OFF: 0,\r\n  COLOR_ON_AND_AMBIENT_ON: 1,\r\n  HIGHLIGHT_ON: 2,\r\n  REFLECTION_ON_AND_RAY_TRACE_ON: 3,\r\n  TRANSPARENCY_GLASS_ON_REFLECTION_RAY_TRACE_ON: 4,\r\n  REFLECTION_FRESNEL_ON_AND_RAY_TRACE_ON: 5,\r\n  TRANSPARENCY_REFRACTION_ON_REFLECTION_FRESNEL_OFF_AND_RAY_TRACE_ON: 6,\r\n  TRANSPARENCY_REFRACTION_ON_REFLECTION_FRESNEL_ON_AND_RAY_TRACE_ON: 7,\r\n  REFLECTION_ON_AND_RAY_TRACE_OFF: 8,\r\n  TRANSPARENCY_GLASS_ON_REFLECTION_RAY_TRACE_OFF: 9,\r\n  CASTS_SHADOWS_ONTO_INVISIBLE_SURFACES: 10\r\n});\r\n","import { Object3D } from \"three\";\r\n\r\npliny.method({\r\n  parent: \"THREE.Object3D\",\r\n  name: \"appendChild\",\r\n  description: \"An alias for `Object3D::add`, to mirror DOM.\",\r\n  parameters: [ {\r\n    name: \"child\",\r\n    type: \"THREE.Object3D\",\r\n    description: \"The object to add.\"\r\n  }]\r\n});\r\nObject3D.prototype.appendChild = function(child) {\r\n  return this.add(child);\r\n};\r\n\r\nObject.defineProperty(Object3D.prototype, \"pickable\", {\r\n  get: function() {\r\n    return this._listeners && (\r\n         (this._listeners.enter && this._listeners.enter.length > 0)\r\n      || (this._listeners.exit && this._listeners.exit.length > 0)\r\n      || (this._listeners.select && this._listeners.select.length > 0)\r\n      || (this._listeners.useraction && this._listeners.useraction.length > 0)\r\n      || (this._listeners.pointerstart && this._listeners.pointerstart.length > 0)\r\n      || (this._listeners.pointerend && this._listeners.pointerend.length > 0)\r\n      || (this._listeners.pointermove && this._listeners.pointermove.length > 0)\r\n      || (this._listeners.gazestart && this._listeners.gazestart.length > 0)\r\n      || (this._listeners.gazecancel && this._listeners.gazecancel.length > 0)\r\n      || (this._listeners.gazemove && this._listeners.gazemove.length > 0)\r\n      || (this._listeners.gazecomplete && this._listeners.gazecomplete.length > 0));\r\n  }\r\n});\r\n\r\nObject3D.prototype.latLng = function(lat, lon, r) {\r\n  lat = -Math.PI * (lat || 0) / 180;\r\n  lon = Math.PI * (lon || 0) / 180;\r\n  r = r || 1.5;\r\n  this.rotation.set(lat, lon, 0, \"XYZ\");\r\n  this.position.set(0, 0, -r);\r\n  this.position.applyQuaternion(this.quaternion);\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.named = function(name){\r\n  this.name = name;\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.addTo = function(obj) {\r\n  obj.add(this);\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.at = function(x, y, z) {\r\n  this.position.set(x, y, z);\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.rot = function(x, y, z) {\r\n  this.rotation.set(x, y, z);\r\n  return this;\r\n};\r\n\r\nObject3D.prototype.scl = function(x, y, z) {\r\n  this.scale.set(x, y, z);\r\n  return this;\r\n};\r\n\r\nObject.defineProperty(Object3D.prototype, \"visible\", {\r\n  get: function() {\r\n    return this._visible;\r\n  },\r\n  set: function(v) {\r\n    var oldV = this._visible;\r\n    this._visible = v;\r\n    if(oldV !== v){\r\n      this.emit(\"visiblechanged\");\r\n    }\r\n  }\r\n});\r\n","/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nimport { DefaultLoadingManager, BufferGeometry, BufferAttribute, LineSegments, FileLoader, Group, LineBasicMaterial, MeshPhongMaterial, SmoothShading, FlatShading, MultiMaterial, Mesh } from \"three\";\r\n\r\nexport class OBJLoader {\r\n\tconstructor ( manager ) {\r\n\r\n\t\tthis.manager = ( manager !== undefined ) ? manager : DefaultLoadingManager;\r\n\r\n\t\tthis.materials = null;\r\n\r\n\t\tthis.regexp = {\r\n\t\t\t// v float float float\r\n\t\t\tvertex_pattern           : /^v\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\r\n\t\t\t// vn float float float\r\n\t\t\tnormal_pattern           : /^vn\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\r\n\t\t\t// vt float float\r\n\t\t\tuv_pattern               : /^vt\\s+([\\d|\\.|\\+|\\-|e|E]+)\\s+([\\d|\\.|\\+|\\-|e|E]+)/,\r\n\t\t\t// f vertex vertex vertex\r\n\t\t\tface_vertex              : /^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,\r\n\t\t\t// f vertex/uv vertex/uv vertex/uv\r\n\t\t\tface_vertex_uv           : /^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,\r\n\t\t\t// f vertex/uv/normal vertex/uv/normal vertex/uv/normal\r\n\t\t\tface_vertex_uv_normal    : /^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,\r\n\t\t\t// f vertex//normal vertex//normal vertex//normal\r\n\t\t\tface_vertex_normal       : /^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,\r\n\t\t\t// o object_name | g group_name\r\n\t\t\tobject_pattern           : /^[og]\\s*(.+)?/,\r\n\t\t\t// s boolean\r\n\t\t\tsmoothing_pattern        : /^s\\s+(\\d+|on|off)/,\r\n\t\t\t// mtllib file_reference\r\n\t\t\tmaterial_library_pattern : /^mtllib /,\r\n\t\t\t// usemtl material_name\r\n\t\t\tmaterial_use_pattern     : /^usemtl /\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tload ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( this.path );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tonLoad( scope.parse( text ) );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t}\r\n\r\n\tsetPath ( value ) {\r\n\r\n\t\tthis.path = value;\r\n\r\n\t}\r\n\r\n\tsetMaterials ( materials ) {\r\n\r\n\t\tthis.materials = materials;\r\n\r\n\t}\r\n\r\n\t_createParserState () {\r\n\r\n\t\tvar state = new OBJParserState();\r\n\r\n\t\tstate.startObject( '', false );\r\n\r\n\t\treturn state;\r\n\r\n\t}\r\n\r\n\tparse ( text ) {\r\n\r\n\t\tconsole.time( 'OBJLoader' );\r\n\r\n\t\tvar state = this._createParserState();\r\n\r\n\t\tif ( text.indexOf( '\\r\\n' ) !== - 1 ) {\r\n\r\n\t\t\t// This is faster than String.split with regex that splits on both\r\n\t\t\ttext = text.replace( '\\r\\n', '\\n' );\r\n\r\n\t\t}\r\n\r\n\t\tvar lines = text.split( '\\n' );\r\n\t\tvar line = '', lineFirstChar = '', lineSecondChar = '';\r\n\t\tvar lineLength = 0;\r\n\t\tvar result = [];\r\n\r\n\t\t// Faster to just trim left side of the line. Use if available.\r\n\t\tvar trimLeft = ( typeof ''.trimLeft === 'function' );\r\n\r\n\t\tfor ( var i = 0, l = lines.length; i < l; i ++ ) {\r\n\r\n\t\t\tline = lines[ i ];\r\n\r\n\t\t\tline = trimLeft ? line.trimLeft() : line.trim();\r\n\r\n\t\t\tlineLength = line.length;\r\n\r\n\t\t\tif ( lineLength === 0 ) continue;\r\n\r\n\t\t\tlineFirstChar = line.charAt( 0 );\r\n\r\n\t\t\t// @todo invoke passed in handler if any\r\n\t\t\tif ( lineFirstChar === '#' ) continue;\r\n\r\n\t\t\tif ( lineFirstChar === 'v' ) {\r\n\r\n\t\t\t\tlineSecondChar = line.charAt( 1 );\r\n\r\n\t\t\t\tif ( lineSecondChar === ' ' && ( result = this.regexp.vertex_pattern.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// 0                  1      2      3\r\n\t\t\t\t\t// [\"v 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\r\n\r\n\t\t\t\t\tstate.vertices.push(\r\n\t\t\t\t\t\tparseFloat( result[ 1 ] ),\r\n\t\t\t\t\t\tparseFloat( result[ 2 ] ),\r\n\t\t\t\t\t\tparseFloat( result[ 3 ] )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else if ( lineSecondChar === 'n' && ( result = this.regexp.normal_pattern.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// 0                   1      2      3\r\n\t\t\t\t\t// [\"vn 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\r\n\r\n\t\t\t\t\tstate.normals.push(\r\n\t\t\t\t\t\tparseFloat( result[ 1 ] ),\r\n\t\t\t\t\t\tparseFloat( result[ 2 ] ),\r\n\t\t\t\t\t\tparseFloat( result[ 3 ] )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else if ( lineSecondChar === 't' && ( result = this.regexp.uv_pattern.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// 0               1      2\r\n\t\t\t\t\t// [\"vt 0.1 0.2\", \"0.1\", \"0.2\"]\r\n\r\n\t\t\t\t\tstate.uvs.push(\r\n\t\t\t\t\t\tparseFloat( result[ 1 ] ),\r\n\t\t\t\t\t\tparseFloat( result[ 2 ] )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( \"Unexpected vertex/normal/uv line: '\" + line  + \"'\" );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( lineFirstChar === \"f\" ) {\r\n\r\n\t\t\t\tif ( ( result = this.regexp.face_vertex_uv_normal.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// f vertex/uv/normal vertex/uv/normal vertex/uv/normal\r\n\t\t\t\t\t// 0                        1    2    3    4    5    6    7    8    9   10         11         12\r\n\t\t\t\t\t// [\"f 1/1/1 2/2/2 3/3/3\", \"1\", \"1\", \"1\", \"2\", \"2\", \"2\", \"3\", \"3\", \"3\", undefined, undefined, undefined]\r\n\r\n\t\t\t\t\tstate.addFace(\r\n\t\t\t\t\t\tresult[ 1 ], result[ 4 ], result[ 7 ], result[ 10 ],\r\n\t\t\t\t\t\tresult[ 2 ], result[ 5 ], result[ 8 ], result[ 11 ],\r\n\t\t\t\t\t\tresult[ 3 ], result[ 6 ], result[ 9 ], result[ 12 ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else if ( ( result = this.regexp.face_vertex_uv.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// f vertex/uv vertex/uv vertex/uv\r\n\t\t\t\t\t// 0                  1    2    3    4    5    6   7          8\r\n\t\t\t\t\t// [\"f 1/1 2/2 3/3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\r\n\r\n\t\t\t\t\tstate.addFace(\r\n\t\t\t\t\t\tresult[ 1 ], result[ 3 ], result[ 5 ], result[ 7 ],\r\n\t\t\t\t\t\tresult[ 2 ], result[ 4 ], result[ 6 ], result[ 8 ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else if ( ( result = this.regexp.face_vertex_normal.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// f vertex//normal vertex//normal vertex//normal\r\n\t\t\t\t\t// 0                     1    2    3    4    5    6   7          8\r\n\t\t\t\t\t// [\"f 1//1 2//2 3//3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\r\n\r\n\t\t\t\t\tstate.addFace(\r\n\t\t\t\t\t\tresult[ 1 ], result[ 3 ], result[ 5 ], result[ 7 ],\r\n\t\t\t\t\t\tundefined, undefined, undefined, undefined,\r\n\t\t\t\t\t\tresult[ 2 ], result[ 4 ], result[ 6 ], result[ 8 ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else if ( ( result = this.regexp.face_vertex.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t// f vertex vertex vertex\r\n\t\t\t\t\t// 0            1    2    3   4\r\n\t\t\t\t\t// [\"f 1 2 3\", \"1\", \"2\", \"3\", undefined]\r\n\r\n\t\t\t\t\tstate.addFace(\r\n\t\t\t\t\t\tresult[ 1 ], result[ 2 ], result[ 3 ], result[ 4 ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( \"Unexpected face line: '\" + line  + \"'\" );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( lineFirstChar === \"l\" ) {\r\n\r\n\t\t\t\tvar lineParts = line.substring( 1 ).trim().split( \" \" );\r\n\t\t\t\tvar lineVertices = [], lineUVs = [];\r\n\r\n\t\t\t\tif ( line.indexOf( \"/\" ) === - 1 ) {\r\n\r\n\t\t\t\t\tlineVertices = lineParts;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tfor ( var li = 0, llen = lineParts.length; li < llen; li ++ ) {\r\n\r\n\t\t\t\t\t\tvar parts = lineParts[ li ].split( \"/\" );\r\n\r\n\t\t\t\t\t\tif ( parts[ 0 ] !== \"\" ) lineVertices.push( parts[ 0 ] );\r\n\t\t\t\t\t\tif ( parts[ 1 ] !== \"\" ) lineUVs.push( parts[ 1 ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tstate.addLineGeometry( lineVertices, lineUVs );\r\n\r\n\t\t\t} else if ( ( result = this.regexp.object_pattern.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t// o object_name\r\n\t\t\t\t// or\r\n\t\t\t\t// g group_name\r\n\r\n\t\t\t\tvar name = result[ 0 ].substr( 1 ).trim();\r\n\t\t\t\tstate.startObject( name );\r\n\r\n\t\t\t} else if ( this.regexp.material_use_pattern.test( line ) ) {\r\n\r\n\t\t\t\t// material\r\n\r\n\t\t\t\tstate.object.startMaterial( line.substring( 7 ).trim(), state.materialLibraries );\r\n\r\n\t\t\t} else if ( this.regexp.material_library_pattern.test( line ) ) {\r\n\r\n\t\t\t\t// mtl file\r\n\r\n\t\t\t\tstate.materialLibraries.push( line.substring( 7 ).trim() );\r\n\r\n\t\t\t} else if ( ( result = this.regexp.smoothing_pattern.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t// smooth shading\r\n\r\n\t\t\t\t// @todo Handle files that have varying smooth values for a set of faces inside one geometry,\r\n\t\t\t\t// but does not define a usemtl for each face set.\r\n\t\t\t\t// This should be detected and a dummy material created (later MultiMaterial and geometry groups).\r\n\t\t\t\t// This requires some care to not create extra material on each smooth value for \"normal\" obj files.\r\n\t\t\t\t// where explicit usemtl defines geometry groups.\r\n\t\t\t\t// Example asset: examples/models/obj/cerberus/Cerberus.obj\r\n\r\n\t\t\t\tvar value = result[ 1 ].trim().toLowerCase();\r\n\t\t\t\tstate.object.smooth = ( value === '1' || value === 'on' );\r\n\r\n\t\t\t\tvar material = state.object.currentMaterial();\r\n\t\t\t\tif ( material ) {\r\n\r\n\t\t\t\t\tmaterial.smooth = state.object.smooth;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Handle null terminated files without exception\r\n\t\t\t\tif ( line === '\\0' ) continue;\r\n\r\n\t\t\t\tthrow new Error( \"Unexpected line: '\" + line  + \"'\" );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.finalize();\r\n\r\n\t\tvar container = new Group();\r\n\t\tcontainer.materialLibraries = [].concat( state.materialLibraries );\r\n\r\n\t\tfor ( var i = 0, l = state.objects.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar object = state.objects[ i ];\r\n\t\t\tvar geometry = object.geometry;\r\n\t\t\tvar materials = object.materials;\r\n\t\t\tvar isLine = ( geometry.type === 'Line' );\r\n\r\n\t\t\t// Skip o/g line declarations that did not follow with any faces\r\n\t\t\tif ( geometry.vertices.length === 0 ) continue;\r\n\r\n\t\t\tvar buffergeometry = new BufferGeometry();\r\n\r\n\t\t\tbuffergeometry.addAttribute( 'position', new BufferAttribute( new Float32Array( geometry.vertices ), 3 ) );\r\n\r\n\t\t\tif ( geometry.normals.length > 0 ) {\r\n\r\n\t\t\t\tbuffergeometry.addAttribute( 'normal', new BufferAttribute( new Float32Array( geometry.normals ), 3 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbuffergeometry.computeVertexNormals();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometry.uvs.length > 0 ) {\r\n\r\n\t\t\t\tbuffergeometry.addAttribute( 'uv', new BufferAttribute( new Float32Array( geometry.uvs ), 2 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Create materials\r\n\r\n\t\t\tvar createdMaterials = [];\r\n\r\n\t\t\tfor ( var mi = 0, miLen = materials.length; mi < miLen ; mi++ ) {\r\n\r\n\t\t\t\tvar sourceMaterial = materials[mi];\r\n\t\t\t\tvar material = undefined;\r\n\r\n\t\t\t\tif ( this.materials !== null ) {\r\n\r\n\t\t\t\t\tmaterial = this.materials.create( sourceMaterial.name );\r\n\r\n\t\t\t\t\t// mtl etc. loaders probably can't create line materials correctly, copy properties to a line material.\r\n\t\t\t\t\tif ( isLine && material && ! ( material.isLineBasicMaterial ) ) {\r\n\r\n\t\t\t\t\t\tvar materialLine = new LineBasicMaterial();\r\n\t\t\t\t\t\tmaterialLine.copy( material );\r\n\t\t\t\t\t\tmaterial = materialLine;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! material ) {\r\n\r\n\t\t\t\t\tmaterial = ( ! isLine ? new MeshPhongMaterial() : new LineBasicMaterial() );\r\n\t\t\t\t\tmaterial.name = sourceMaterial.name;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterial.shading = sourceMaterial.smooth ? SmoothShading : FlatShading;\r\n\r\n\t\t\t\tcreatedMaterials.push(material);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Create mesh\r\n\r\n\t\t\tvar mesh;\r\n\r\n\t\t\tif ( createdMaterials.length > 1 ) {\r\n\r\n\t\t\t\tfor ( var mi = 0, miLen = materials.length; mi < miLen ; mi++ ) {\r\n\r\n\t\t\t\t\tvar sourceMaterial = materials[mi];\r\n\t\t\t\t\tbuffergeometry.addGroup( sourceMaterial.groupStart, sourceMaterial.groupCount, mi );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar multiMaterial = new MultiMaterial( createdMaterials );\r\n\t\t\t\tmesh = ( ! isLine ? new Mesh( buffergeometry, multiMaterial ) : new LineSegments( buffergeometry, multiMaterial ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmesh = ( ! isLine ? new Mesh( buffergeometry, createdMaterials[ 0 ] ) : new LineSegments( buffergeometry, createdMaterials[ 0 ] ) );\r\n\t\t\t}\r\n\r\n\t\t\tmesh.name = object.name;\r\n\r\n\t\t\tcontainer.add( mesh );\r\n\r\n\t\t}\r\n\r\n\t\tconsole.timeEnd( 'OBJLoader' );\r\n\r\n\t\treturn container;\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\nclass OBJParserState {\r\n\r\n\tconstructor () {\r\n\t\tthis.objects  = [];\r\n\t\tthis.object   = {};\r\n\r\n\t\tthis.vertices = [];\r\n\t\tthis.normals  = [];\r\n\t\tthis.uvs      = [];\r\n\r\n\t\tthis.materialLibraries = [];\r\n\t}\r\n\r\n\tstartObject  ( name, fromDeclaration ) {\r\n\r\n\t\t// If the current object (initial from reset) is not from a g/o declaration in the parsed\r\n\t\t// file. We need to use it for the first parsed g/o to keep things in sync.\r\n\t\tif ( this.object && this.object.fromDeclaration === false ) {\r\n\r\n\t\t\tthis.object.name = name;\r\n\t\t\tthis.object.fromDeclaration = ( fromDeclaration !== false );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.object && typeof this.object._finalize === 'function' ) {\r\n\r\n\t\t\tthis.object._finalize();\r\n\r\n\t\t}\r\n\r\n\t\tvar previousMaterial = ( this.object && typeof this.object.currentMaterial === 'function' ? this.object.currentMaterial() : undefined );\r\n\r\n\t\tthis.object = new OBJ(name, fromDeclaration);\r\n\r\n\t\t// Inherit previous objects material.\r\n\t\t// Spec tells us that a declared material must be set to all objects until a new material is declared.\r\n\t\t// If a usemtl declaration is encountered while this new object is being parsed, it will\r\n\t\t// overwrite the inherited material. Exception being that there was already face declarations\r\n\t\t// to the inherited material, then it will be preserved for proper MultiMaterial continuation.\r\n\r\n\t\tif ( previousMaterial && previousMaterial.name && typeof previousMaterial.clone === \"function\" ) {\r\n\r\n\t\t\tvar declared = previousMaterial.clone( 0 );\r\n\t\t\tdeclared.inherited = true;\r\n\t\t\tthis.object.materials.push( declared );\r\n\r\n\t\t}\r\n\r\n\t\tthis.objects.push( this.object );\r\n\r\n\t}\r\n\r\n\tfinalize () {\r\n\r\n\t\tif ( this.object && typeof this.object._finalize === 'function' ) {\r\n\r\n\t\t\tthis.object._finalize();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tparseVertexIndex ( value, len ) {\r\n\r\n\t\tvar index = parseInt( value, 10 );\r\n\t\treturn ( index >= 0 ? index - 1 : index + len / 3 ) * 3;\r\n\r\n\t}\r\n\r\n\tparseNormalIndex ( value, len ) {\r\n\r\n\t\tvar index = parseInt( value, 10 );\r\n\t\treturn ( index >= 0 ? index - 1 : index + len / 3 ) * 3;\r\n\r\n\t}\r\n\r\n\tparseUVIndex ( value, len ) {\r\n\r\n\t\tvar index = parseInt( value, 10 );\r\n\t\treturn ( index >= 0 ? index - 1 : index + len / 2 ) * 2;\r\n\r\n\t}\r\n\r\n\taddVertex ( a, b, c ) {\r\n\r\n\t\tvar src = this.vertices;\r\n\t\tvar dst = this.object.geometry.vertices;\r\n\r\n\t\tdst.push( src[ a + 0 ] );\r\n\t\tdst.push( src[ a + 1 ] );\r\n\t\tdst.push( src[ a + 2 ] );\r\n\t\tdst.push( src[ b + 0 ] );\r\n\t\tdst.push( src[ b + 1 ] );\r\n\t\tdst.push( src[ b + 2 ] );\r\n\t\tdst.push( src[ c + 0 ] );\r\n\t\tdst.push( src[ c + 1 ] );\r\n\t\tdst.push( src[ c + 2 ] );\r\n\r\n\t}\r\n\r\n\taddVertexLine ( a ) {\r\n\r\n\t\tvar src = this.vertices;\r\n\t\tvar dst = this.object.geometry.vertices;\r\n\r\n\t\tdst.push( src[ a + 0 ] );\r\n\t\tdst.push( src[ a + 1 ] );\r\n\t\tdst.push( src[ a + 2 ] );\r\n\r\n\t}\r\n\r\n\taddNormal ( a, b, c ) {\r\n\r\n\t\tvar src = this.normals;\r\n\t\tvar dst = this.object.geometry.normals;\r\n\r\n\t\tdst.push( src[ a + 0 ] );\r\n\t\tdst.push( src[ a + 1 ] );\r\n\t\tdst.push( src[ a + 2 ] );\r\n\t\tdst.push( src[ b + 0 ] );\r\n\t\tdst.push( src[ b + 1 ] );\r\n\t\tdst.push( src[ b + 2 ] );\r\n\t\tdst.push( src[ c + 0 ] );\r\n\t\tdst.push( src[ c + 1 ] );\r\n\t\tdst.push( src[ c + 2 ] );\r\n\r\n\t}\r\n\r\n\taddUV ( a, b, c ) {\r\n\r\n\t\tvar src = this.uvs;\r\n\t\tvar dst = this.object.geometry.uvs;\r\n\r\n\t\tdst.push( src[ a + 0 ] );\r\n\t\tdst.push( src[ a + 1 ] );\r\n\t\tdst.push( src[ b + 0 ] );\r\n\t\tdst.push( src[ b + 1 ] );\r\n\t\tdst.push( src[ c + 0 ] );\r\n\t\tdst.push( src[ c + 1 ] );\r\n\r\n\t}\r\n\r\n\taddUVLine ( a ) {\r\n\r\n\t\tvar src = this.uvs;\r\n\t\tvar dst = this.object.geometry.uvs;\r\n\r\n\t\tdst.push( src[ a + 0 ] );\r\n\t\tdst.push( src[ a + 1 ] );\r\n\r\n\t}\r\n\r\n\taddFace ( a, b, c, d, ua, ub, uc, ud, na, nb, nc, nd ) {\r\n\r\n\t\tvar vLen = this.vertices.length;\r\n\r\n\t\tvar ia = this.parseVertexIndex( a, vLen );\r\n\t\tvar ib = this.parseVertexIndex( b, vLen );\r\n\t\tvar ic = this.parseVertexIndex( c, vLen );\r\n\t\tvar id;\r\n\r\n\t\tif ( d === undefined ) {\r\n\r\n\t\t\tthis.addVertex( ia, ib, ic );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tid = this.parseVertexIndex( d, vLen );\r\n\r\n\t\t\tthis.addVertex( ia, ib, id );\r\n\t\t\tthis.addVertex( ib, ic, id );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ua !== undefined ) {\r\n\r\n\t\t\tvar uvLen = this.uvs.length;\r\n\r\n\t\t\tia = this.parseUVIndex( ua, uvLen );\r\n\t\t\tib = this.parseUVIndex( ub, uvLen );\r\n\t\t\tic = this.parseUVIndex( uc, uvLen );\r\n\r\n\t\t\tif ( d === undefined ) {\r\n\r\n\t\t\t\tthis.addUV( ia, ib, ic );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tid = this.parseUVIndex( ud, uvLen );\r\n\r\n\t\t\t\tthis.addUV( ia, ib, id );\r\n\t\t\t\tthis.addUV( ib, ic, id );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( na !== undefined ) {\r\n\r\n\t\t\t// Normals are many times the same. If so, skip function call and parseInt.\r\n\t\t\tvar nLen = this.normals.length;\r\n\t\t\tia = this.parseNormalIndex( na, nLen );\r\n\r\n\t\t\tib = na === nb ? ia : this.parseNormalIndex( nb, nLen );\r\n\t\t\tic = na === nc ? ia : this.parseNormalIndex( nc, nLen );\r\n\r\n\t\t\tif ( d === undefined ) {\r\n\r\n\t\t\t\tthis.addNormal( ia, ib, ic );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tid = this.parseNormalIndex( nd, nLen );\r\n\r\n\t\t\t\tthis.addNormal( ia, ib, id );\r\n\t\t\t\tthis.addNormal( ib, ic, id );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\taddLineGeometry ( vertices, uvs ) {\r\n\r\n\t\tthis.object.geometry.type = 'Line';\r\n\r\n\t\tvar vLen = this.vertices.length;\r\n\t\tvar uvLen = this.uvs.length;\r\n\r\n\t\tfor ( var vi = 0, l = vertices.length; vi < l; vi ++ ) {\r\n\r\n\t\t\tthis.addVertexLine( this.parseVertexIndex( vertices[ vi ], vLen ) );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var uvi = 0, l = uvs.length; uvi < l; uvi ++ ) {\r\n\r\n\t\t\tthis.addUVLine( this.parseUVIndex( uvs[ uvi ], uvLen ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nclass OBJ {\r\n\r\n\tconstructor (name, fromDeclaration) {\r\n\r\n\t\tthis.name = name || '';\r\n\t\tthis.fromDeclaration = ( fromDeclaration !== false );\r\n\r\n\t\tthis.geometry = {\r\n\t\t\tvertices : [],\r\n\t\t\tnormals  : [],\r\n\t\t\tuvs      : []\r\n\t\t};\r\n\t\tthis.materials = [];\r\n\t\tthis.smooth = true;\r\n\r\n\t}\r\n\r\n\tstartMaterial ( name, libraries ) {\r\n\r\n\t\tvar previous = this._finalize( false );\r\n\r\n\t\t// New usemtl declaration overwrites an inherited material, except if faces were declared\r\n\t\t// after the material, then it must be preserved for proper MultiMaterial continuation.\r\n\t\tif ( previous && ( previous.inherited || previous.groupCount <= 0 ) ) {\r\n\r\n\t\t\tthis.materials.splice( previous.index, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvar material = {\r\n\t\t\tindex      : this.materials.length,\r\n\t\t\tname       : name || '',\r\n\t\t\tmtllib     : ( Array.isArray( libraries ) && libraries.length > 0 ? libraries[ libraries.length - 1 ] : '' ),\r\n\t\t\tsmooth     : ( previous !== undefined ? previous.smooth : this.smooth ),\r\n\t\t\tgroupStart : ( previous !== undefined ? previous.groupEnd : 0 ),\r\n\t\t\tgroupEnd   : -1,\r\n\t\t\tgroupCount : -1,\r\n\t\t\tinherited  : false,\r\n\r\n\t\t\tclone : function( index ) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tindex      : ( typeof index === 'number' ? index : this.index ),\r\n\t\t\t\t\tname       : this.name,\r\n\t\t\t\t\tmtllib     : this.mtllib,\r\n\t\t\t\t\tsmooth     : this.smooth,\r\n\t\t\t\t\tgroupStart : this.groupEnd,\r\n\t\t\t\t\tgroupEnd   : -1,\r\n\t\t\t\t\tgroupCount : -1,\r\n\t\t\t\t\tinherited  : false\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.materials.push( material );\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n\tcurrentMaterial () {\r\n\r\n\t\tif ( this.materials.length > 0 ) {\r\n\t\t\treturn this.materials[ this.materials.length - 1 ];\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\r\n\t}\r\n\r\n\t_finalize ( end ) {\r\n\r\n\t\tvar lastMultiMaterial = this.currentMaterial();\r\n\t\tif ( lastMultiMaterial && lastMultiMaterial.groupEnd === -1 ) {\r\n\r\n\t\t\tlastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\r\n\t\t\tlastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\r\n\t\t\tlastMultiMaterial.inherited = false;\r\n\r\n\t\t}\r\n\r\n\t\t// Guarantee at least one empty material, this makes the creation later more straight forward.\r\n\t\tif ( end !== false && this.materials.length === 0 ) {\r\n\t\t\tthis.materials.push({\r\n\t\t\t\tname   : '',\r\n\t\t\t\tsmooth : this.smooth\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn lastMultiMaterial;\r\n\r\n\t}\r\n}\r\n","import { Geometry, BufferGeometry } from \"three\";\r\n\r\nGeometry.prototype.offset = function(x, y, z){\r\n  const arr = this.vertices;\r\n  for(let i = 0; i < arr.length; ++i) {\r\n    const vert = arr[i];\r\n    vert.x += x;\r\n    vert.y += y;\r\n    vert.z += z;\r\n  }\r\n  return this;\r\n};\r\n\r\nBufferGeometry.prototype.offset = function(x, y, z){\r\n  const arr = this.attributes.position.array,\r\n    l = this.attributes.position.itemSize;\r\n  for(let i = 0; i < arr.length; i += l) {\r\n    arr[i] += x;\r\n    arr[i + 1] += y;\r\n    arr[i + 2] += z;\r\n  }\r\n  return this;\r\n};\r\n","import { BufferGeometry, Geometry, Mesh } from \"three\";\r\nimport textured from \"../live-api/textured\";\r\n\r\nBufferGeometry.prototype.textured =\r\nGeometry.prototype.textured =\r\nMesh.prototype.textured =\r\n  function(texture, options) {\r\n    return textured(this, texture, options);\r\n  };\r\n","import { Euler, Quaternion, Vector2, Vector3, Vector4, Matrix3, Matrix4 } from \"three\";\r\n\r\nEuler.prototype.toString =\r\nQuaternion.prototype.toString =\r\nVector2.prototype.toString =\r\nVector3.prototype.toString =\r\nVector4.prototype.toString =\r\n  function(digits) {\r\n    var parts = this.toArray();\r\n    if (digits !== undefined) {\r\n      for (var i = 0; i < parts.length; ++i) {\r\n        if (parts[i] !== null && parts[i] !== undefined) {\r\n          parts[i] = parts[i].toFixed(digits);\r\n        }\r\n        else {\r\n          parts[i] = \"undefined\";\r\n        }\r\n      }\r\n    }\r\n    return \"<\" + parts.join(\", \") + \">\";\r\n  };\r\n\r\nconst debugOutputCache = {};\r\nEuler.prototype.debug =\r\nQuaternion.prototype.debug =\r\nVector2.prototype.debug =\r\nVector3.prototype.debug =\r\nVector4.prototype.debug =\r\nMatrix3.prototype.debug =\r\nMatrix4.prototype.debug =\r\n  function(label, digits) {\r\n    var val = this.toString(digits);\r\n    if (val !== debugOutputCache[label]) {\r\n      debugOutputCache[label] = val;\r\n      console.trace(label + \"\\n\" + val);\r\n    }\r\n    return this;\r\n  };\r\n","(function (root) {\n\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {\n  }\n\n  // Use polyfill for setImmediate for performance gains\n  var asap = (typeof setImmediate === 'function' && setImmediate) ||\n    function (fn) {\n      setTimeoutFunc(fn, 0);\n    };\n\n  var onUnhandledRejection = function onUnhandledRejection(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n\n  // Polyfill for Function.prototype.bind\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n      return;\n    }\n    self._handled = true;\n    asap(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n      var ret;\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      asap(function() {\n        if (!self._handled) {\n          onUnhandledRejection(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n  function doResolve(fn, self) {\n    var done = false;\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new (this.constructor)(noop);\n\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    var args = Array.prototype.slice.call(arr);\n\n    return new Promise(function (resolve, reject) {\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n          args[i] = val;\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  };\n\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @private\n   */\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    asap = fn;\n  };\n\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    onUnhandledRejection = fn;\n  };\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n\n})(this);\n","pliny.class({\r\n  parent: \"Primrose\",\r\n    name: \"Angle\",\r\n    description: \"The Angle class smooths out the jump from 360 to 0 degrees. It\\n\\\r\nkeeps track of the previous state of angle values and keeps the change between\\n\\\r\nangle values to a maximum magnitude of 180 degrees, plus or minus. This allows for\\n\\\r\nsmoother operation as rotating past 360 degrees will not reset to 0, but continue\\n\\\r\nto 361 degrees and beyond, while rotating behind 0 degrees will not reset to 360\\n\\\r\nbut continue to -1 and below.\\n\\\r\n\\n\\\r\nWhen instantiating, choose a value that is as close as you can guess will be your\\n\\\r\ninitial sensor readings.\\n\\\r\n\\n\\\r\nThis is particularly important for the 180 degrees, +- 10 degrees or so. If you\\n\\\r\nexpect values to run back and forth over 180 degrees, then initialAngleInDegrees\\n\\\r\nshould be set to 180. Otherwise, if your initial value is anything slightly larger\\n\\\r\nthan 180, the correction will rotate the angle into negative degrees, e.g.:\\n\\\r\n* initialAngleInDegrees = 0\\n\\\r\n* first reading = 185\\n\\\r\n* updated degrees value = -175\\n\\\r\n\\n\\\r\nIt also automatically performs degree-to-radian and radian-to-degree conversions.\\n\\\r\nFor more information, see [Radian - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/Radian).\\n\\\r\n\\n\\\r\n![Radians](https://upload.wikimedia.org/wikipedia/commons/4/4e/Circle_radians.gif)\",\r\n    parameters: [{\r\n      name: \"initialAngleInDegrees\",\r\n      type: \"Number\",\r\n      description: \"(Required) Specifies the initial context of the angle. Zero is not always the correct value.\"\r\n    }],\r\n    examples: [{\r\n      name: \"Basic usage\",\r\n      description: \"To use the Angle class, create an instance of it with `new`, and modify the `degrees` property.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var a = new Primrose.Angle(356);\\n\\\r\n  a.degrees += 5;\\n\\\r\n  console.log(a.degrees);\\n\\\r\n\\n\\\r\n## Results:\\n\\\r\n> 361\"\r\n    }, {\r\n      name: \"Convert degrees to radians\",\r\n      description: \"Create an instance of Primrose.Angle, modify the `degrees` property, and read the `radians` property.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var a = new Primrose.Angle(10);\\n\\\r\n  a.degrees += 355;\\n\\\r\n  console.log(a.radians);\\n\\\r\n\\n\\\r\n## Results:\\n\\\r\n> 0.08726646259971647\"\r\n    }, {\r\n      name: \"Convert radians to degress\",\r\n      description: \"Create an instance of Primrose.Angle, modify the `radians` property, and read the `degrees` property.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var a = new Primrose.Angle(0);\\n\\\r\n  a.radians += Math.PI / 2;\\n\\\r\n  console.log(a.degrees);\\n\\\r\n\\n\\\r\n## Results:\\n\\\r\n> 90\"\r\n    }]\r\n});\r\n\r\nimport { Math as _Math } from \"three\";\r\n\r\nconst { DEG2RAD, RAD2DEG } = _Math;\r\n\r\nexport default class Angle {\r\n  constructor (v) {\r\n    if (typeof (v) !== \"number\") {\r\n      throw new Error(\"Angle must be initialized with a number. Initial value was: \" + v);\r\n    }\r\n\r\n    this._value = v;\r\n    this._delta = 0;\r\n    this._d1 = null;\r\n    this._d2 = null;\r\n    this._d3 = null;\r\n  }\r\n\r\n  get degrees() {\r\n    return this._value;\r\n  }\r\n\r\n  set degrees(newValue) {\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Angle\",\r\n      name: \"degrees\",\r\n      type: \"Number\",\r\n      description: \"Get/set the current value of the angle in degrees.\"\r\n    });\r\n\r\n    do {\r\n      // figure out if it is adding the raw value, or whole\r\n      // rotations of the value, that results in a smaller\r\n      // magnitude of change.\r\n      this._d1 = newValue + this._delta - this._value;\r\n      this._d2 = Math.abs(this._d1 + 360);\r\n      this._d3 = Math.abs(this._d1 - 360);\r\n      this._d1 = Math.abs(this._d1);\r\n      if (this._d2 < this._d1 && this._d2 < this._d3) {\r\n        this._delta += 360;\r\n      }\r\n      else if (this._d3 < this._d1) {\r\n        this._delta -= 360;\r\n      }\r\n    } while (this._d1 > this._d2 || this._d1 > this._d3);\r\n    this._value = newValue + this._delta;\r\n  }\r\n\r\n  get radians() {\r\n    return this.degrees * DEG2RAD;\r\n  }\r\n\r\n  set radians(val) {\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Angle\",\r\n      name: \"radians\",\r\n      type: \"Number\",\r\n      description: \"Get/set the current value of the angle in radians.\"\r\n    });\r\n\r\n    this.degrees = val * RAD2DEG;\r\n  }\r\n};\r\n\r\n","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"XHR\",\r\n  description: \"Wraps up the XMLHttpRequest object into a workflow that is easier for me to handle: a single function call. Can handle both GETs and POSTs, with or  without a payload.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"method\",\r\n    type: \"String\",\r\n    description: \"The HTTP Verb being used for the request.\"\r\n  }, {\r\n    name: \"type\",\r\n    type: \"String\",\r\n    description: `How the response should be interpreted. One of [\"text\", \"json\", \"arraybuffer\"]. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).`,\r\n    default: `\"text\"`\r\n  }, {\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Make a GET request.\",\r\n    description: `Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\r\n\r\n## Code:\r\n\r\n    grammar(\"JavaScript\");\r\n    Primrose.HTTP.XHR(\"GET\", \"json\", \"localFile.json\", {\r\n      progress: console.log.bind(console, \"progress\"))\r\n      .then(console.log.bind(console, \"done\")))\r\n      .catch(console.error.bind(console));\r\n\r\n## Results:\r\n> Object {field1: 1, field2: \"Field2\"}`\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Primrose.HTTP.XHR\",\r\n  name: \"optionsHash\",\r\n  description: \"Options for passing data or tracking progress.\",\r\n  parameters: [{\r\n    name: \"data\",\r\n    type: \"Object\",\r\n    optional: true,\r\n    description: \"The data object to use as the request body payload, if this is a POST request.\"\r\n  }, {\r\n    name: \"progress\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"A callback function to use for tracking progress. The callback function should accept a standard [`ProgressEvent`](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent).\"\r\n  }]\r\n});\r\n\r\nexport default function XHR(method, type, url, options) {\r\n  return new Promise(function (resolve, reject) {\r\n    options = options || {};\r\n    options.headers = options.headers || {};\r\n    if (method === \"POST\") {\r\n      options.headers[\"Content-Type\"] = options.headers[\"Content-Type\"] || type;\r\n    }\r\n\r\n    var req = new XMLHttpRequest();\r\n    req.onerror = (evt) => reject(new Error(\"Request error: \" + evt.message));\r\n    req.onabort = (evt) => reject(new Error(\"Request abort: \" + evt.message));\r\n    req.onload = function () {\r\n      // The other error events are client-errors. If there was a server error,\r\n      // we'd find out about it during this event. We need to only respond to\r\n      // successful requests, i.e. those with HTTP status code in the 200 or 300\r\n      // range.\r\n      if (req.status < 400) {\r\n        resolve(req.response);\r\n      }\r\n      else {\r\n        reject(req);\r\n      }\r\n    };\r\n\r\n    // The order of these operations is very explicit. You have to call open\r\n    // first. It seems counter intuitive, but think of it more like you're opening\r\n    // an HTTP document to be able to write to it, and then you finish by sending\r\n    // the document. The `open` method does not refer to a network connection.\r\n    req.open(method, url);\r\n    if (type) {\r\n      req.responseType = type;\r\n    }\r\n\r\n    req.onprogress = options.progress;\r\n\r\n    for (var key in options.headers) {\r\n      req.setRequestHeader(key, options.headers[key]);\r\n    }\r\n\r\n    req.withCredentials = !!options.withCredentials;\r\n\r\n    if (options.data) {\r\n      req.send(JSON.stringify(options.data));\r\n    }\r\n    else {\r\n      req.send();\r\n    }\r\n  });\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"get\",\r\n  description: \"Process an HTTP GET request.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"type\",\r\n    type: \"String\",\r\n    description: `How the response should be interpreted. One of [\"text\", \"json\", \"arraybuffer\"]. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).`,\r\n    default: `\"text\"`\r\n  }, {\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Make a GET request.\",\r\n    description: `Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\r\n\r\n## Code:\r\n\r\n    grammar(\"JavaScript\");\r\n    Primrose.HTTP.get(\"json\", \"localFile.json\",\r\n      console.log.bind(console, \"progress\"),\r\n      console.log.bind(console, \"done\"),\r\n      console.error.bind(console));\r\n\r\n## Results:\r\n> Object {field1: 1, field2: \"Field2\"}`\r\n  }]\r\n});\r\n\r\nimport XHR from \"./XHR\";\r\nexport default function get(type, url, options) {\r\n  return XHR(\"GET\", type || \"text\", url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"getBuffer\",\r\n  description: \"Get an ArrayBuffer from a server.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Make a GET request for an ArrayBuffer.\",\r\n    description: `Use this to load audio files and do whatever you want with them.\r\n\r\n## Code:\r\n\r\n  grammar(\"JavaScript\");\r\n  var context = new AudioContext();\r\n  Primrose.HTTP.getBuffer(\"audio.mp3\",\r\n    console.log.bind(console, \"progress\"));,\r\n    function(buffer){\r\n      context.decodeAudioData(\r\n        buffer,\r\n        console.log.bind(console, \"success\"),\r\n        console.error.bind(console, \"error decoding\"));\r\n    },\r\n    console.error.bind(console, \"error loading\")\\n`\r\n  }]\r\n});\r\n\r\nimport get from \"./get\";\r\nexport default function getBuffer(url, options) {\r\n  return get(\"arraybuffer\", url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.DOM\",\r\n  name: \"cascadeElement\",\r\n  returns: \"Element\",\r\n  parameters: [{\r\n    name: \"id\",\r\n    type: \"(String|Element)\",\r\n    description: \"A vague reference to the element. Either a String id where the element can be had, a String id to give a newly created element if it does not exist, or an Element to manipulate and validate\"\r\n  }, {\r\n    name: \"tag\",\r\n    type: \"String\",\r\n    description: \"The HTML tag name of the element we are finding/creating/validating.\"\r\n  }, {\r\n    name: \"DOMClass\",\r\n    type: \"Class\",\r\n    description: \"The class Function that is the type of element that we are frobnicating.\"\r\n  }],\r\n  description: \"* If `id` is a string, tries to find the DOM element that has said ID\\n\\\r\n  * If it exists, and it matches the expected tag type, returns the element, or throws an error if validation fails.\\n\\\r\n  * If it doesn't exist, creates it and sets its ID to the provided id, then returns the new DOM element, not yet placed in the document anywhere.\\n\\\r\n* If `id` is a DOM element, validates that it is of the expected type,\\n\\\r\n  * returning the DOM element back if it's good,\\n\\\r\n  * or throwing an error if it is not\\n\\\r\n* If `id` is null, creates the DOM element to match the expected type.\",\r\n  examples: [{\r\n    name: \"Get an element by ID that already exists.\",\r\n    description: \"Assuming the following HTML snippet:\\n\\\r\n\\n\\\r\n    grammar(\\\"HTML\\\");\\n\\\r\n    <div>\\n\\\r\n      <div id=\\\"First\\\">first element</div>\\n\\\r\n      <section id=\\\"second-elem\\\">\\n\\\r\n        Second element\\n\\\r\n        <img id=\\\"img1\\\" src=\\\"img.png\\\">\\n\\\r\n      </section>\\n\\\r\n    </div>\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var elem = Primrose.DOM.cascadeElement(\\\"second-elem\\\", \\\"section\\\", HTMLElement);\\n\\\r\n    console.assert(elem.textContent === \\\"Second element\\\");\"\r\n  }, {\r\n    name: \"Validate the tag type.\",\r\n    description: \"Assuming the following HTML snippet:\\n\\\r\n\\n\\\r\n    grammar(\\\"HTML\\\");\\n\\\r\n    <div>\\n\\\r\n      <div id=\\\"First\\\">first element</div>\\n\\\r\n      <section id=\\\"second-elem\\\">\\n\\\r\n        Second element\\n\\\r\n        <img id=\\\"img1\\\" src=\\\"img.png\\\">\\n\\\r\n      </section>\\n\\\r\n    </div>\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    //The following line of code should cause a runtime error.\\n\\\r\n    Primrose.DOM.cascadeElement(\\\"img1\\\", \\\"section\\\", HTMLElement);\"\r\n  }, {\r\n    name: \"Create an element.\",\r\n    description: \"Assuming the following HTML snippet:\\n\\\r\n\\n\\\r\n    grammar(\\\"HTML\\\");\\n\\\r\n    <div>\\n\\\r\n      <div id=\\\"First\\\">first element</div>\\n\\\r\n      <section id=\\\"second-elem\\\">\\n\\\r\n        Second element\\n\\\r\n        <img id=\\\"img1\\\" src=\\\"img.png\\\">\\n\\\r\n      </section>\\n\\\r\n    </div>\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var elem = Primrose.DOM.cascadeElement(\\\"img2\\\", \\\"img\\\", HTMLImageElement);\\n\\\r\n    console.assert(elem.id === \\\"img2\\\");\\n\\\r\n    console.assert(elem.parentElement === null);\\n\\\r\n    document.body.appendChild(elem);\\n\\\r\n    console.assert(elem.parentElement === document.body);\"\r\n  }]\r\n});\r\n\r\nexport default function cascadeElement(id, tag, DOMClass, add) {\r\n  var elem = null;\r\n  if (id === null) {\r\n    elem = document.createElement(tag);\r\n    elem.id = id = \"auto_\" + tag + Date.now();\r\n  }\r\n  else if (DOMClass === undefined || id instanceof DOMClass) {\r\n    elem = id;\r\n  }\r\n  else if (typeof (id) === \"string\") {\r\n    elem = document.getElementById(id);\r\n    if (elem === null) {\r\n      elem = document.createElement(tag);\r\n      elem.id = id;\r\n      if (add) {\r\n        document.body.appendChild(elem);\r\n      }\r\n    }\r\n    else if (elem.tagName !== tag.toUpperCase()) {\r\n      elem = null;\r\n    }\r\n  }\r\n\r\n  if (elem === null) {\r\n    pliny.error({\r\n      parent: \"Primrose.DOM.cascadeElement\",\r\n      name: \"Invalid element\",\r\n      type: \"Error\",\r\n      description: \"If the element could not be found, could not be created, or one of the appropriate ID was found but did not match the expected type, an error is thrown to halt operation.\"\r\n    });\r\n    throw new Error(id + \" does not refer to a valid \" + tag + \" element.\");\r\n  }\r\n  return elem;\r\n}","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"Audio3D\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\n// polyfill\r\nwindow.AudioContext =\r\n  window.AudioContext ||\r\n  window.webkitAudioContext;\r\n\r\n\r\n\r\nlet VECTOR = new Vector3(),\r\n  UP = new Vector3(),\r\n  TEMP = new Matrix4();\r\n\r\nimport { Vector3, Matrix4 } from \"three\";\r\nimport isiOS from \"../../flags/isiOS\";\r\nimport getBuffer from \"../HTTP/getBuffer\";\r\nimport cascadeElement from \"../DOM/cascadeElement\"\r\nexport default class Audio3D {\r\n\r\n  static setAudioStream(stream, id) {\r\n    const audioElementCount = document.querySelectorAll(\"audio\")\r\n      .length,\r\n      element = cascadeElement(id || (\"audioStream\" + audioElementCount), \"audio\", HTMLAudioElement, true);\r\n    setAudioProperties(element);\r\n    element.srcObject = stream;\r\n    return element;\r\n  }\r\n\r\n  static setAudioProperties(element){\r\n    element.autoplay = true;\r\n    element.controls = false;\r\n    element.crossOrigin = \"anonymous\";\r\n    element.muted = true;\r\n    element.setAttribute(\"muted\", \"\");\r\n  }\r\n\r\n  constructor() {\r\n    this.ready = new Promise((resolve, reject) => {\r\n      try{\r\n        if(Audio3D.isAvailable) {\r\n          const finishSetup = () => {\r\n            try{\r\n              this.sampleRate = this.context.sampleRate;\r\n              this.mainVolume = this.context.createGain();\r\n              this.start();\r\n              resolve();\r\n            }\r\n            catch(exp){\r\n              reject(exp);\r\n            }\r\n          };\r\n\r\n          if(!isiOS) {\r\n            this.context = new AudioContext();\r\n            finishSetup();\r\n          }\r\n          else {\r\n            const unlock = () => {\r\n              try{\r\n                this.context = this.context || new AudioContext();\r\n                const source = this.context.createBufferSource();\r\n                source.buffer = this.createRawSound([[0]]);\r\n                source.connect(this.context.destination);\r\n                source.start();\r\n                setTimeout(() => {\r\n                  if((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {\r\n                    window.removeEventListener(\"mouseup\", unlock);\r\n                    window.removeEventListener(\"touchend\", unlock);\r\n                    window.removeEventListener(\"keyup\", unlock);\r\n                    finishSetup();\r\n                  }\r\n                }, 0);\r\n              }\r\n              catch(exp){\r\n                reject(exp);\r\n              }\r\n            };\r\n\r\n            window.addEventListener(\"mouseup\", unlock, false);\r\n            window.addEventListener(\"touchend\", unlock, false);\r\n            window.addEventListener(\"keyup\", unlock, false);\r\n          }\r\n        }\r\n      }\r\n      catch(exp){\r\n        reject(exp);\r\n      }\r\n    });\r\n  }\r\n\r\n  setVelocity(x, y, z) {\r\n    if(this.context){\r\n      this.context.listener.setVelocity(x, y, z);\r\n    }\r\n  }\r\n\r\n  setPlayer(obj) {\r\n    if(this.context && this.context.listener){\r\n      obj.updateMatrixWorld();\r\n      TEMP.copy(obj.matrixWorld);\r\n      var mx = TEMP.elements[12],\r\n        my = TEMP.elements[13],\r\n        mz = TEMP.elements[14];\r\n\r\n      this.context.listener.setPosition(mx, my, mz);\r\n\r\n      VECTOR.set(0, 0, -1)\r\n        .applyMatrix4(TEMP)\r\n        .normalize();\r\n      UP.set(0, 1, 0)\r\n        .applyMatrix4(TEMP)\r\n        .normalize();\r\n\r\n      this.context.listener.setOrientation(VECTOR.x, VECTOR.y, VECTOR.z, UP.x, UP.y, UP.z);\r\n    }\r\n  }\r\n\r\n  start() {\r\n    if(this.mainVolume){\r\n      this.mainVolume.connect(this.context.destination);\r\n    }\r\n    if(this.context.resume) {\r\n      this.context.resume();\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    if(this.context.suspend) {\r\n      this.context.suspend();\r\n    }\r\n    if(this.mainVolume){\r\n      this.mainVolume.disconnect();\r\n    }\r\n  }\r\n\r\n  loadURL(src) {\r\n    return this.ready.then(() => {\r\n      console.log(\"Loading \" + src + \" from URL\");\r\n      getBuffer(src);\r\n    })\r\n      .then((data) => new Promise((resolve, reject) =>\r\n        this.context.decodeAudioData(data, resolve, reject)))\r\n      .then((dat) => {\r\n        console.log(src + \" loaded\");\r\n        return dat;\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Couldn't load \" + src + \". Reason: \" + err);\r\n      });\r\n  }\r\n\r\n  createRawSound(pcmData) {\r\n    if (pcmData.length !== 1 && pcmData.length !== 2) {\r\n      throw new Error(\"Incorrect number of channels. Expected 1 or 2, got \" + pcmData.length);\r\n    }\r\n\r\n    var frameCount = pcmData[0].length;\r\n    if (pcmData.length > 1 && pcmData[1].length !== frameCount) {\r\n      throw new Error(\r\n        \"Second channel is not the same length as the first channel. Expected \" + frameCount + \", but was \" + pcmData[1].length);\r\n    }\r\n\r\n    var buffer = this.context.createBuffer(pcmData.length, frameCount, this.sampleRate || 22050);\r\n    for (var c = 0; c < pcmData.length; ++c) {\r\n      var channel = buffer.getChannelData(c);\r\n      for (var i = 0; i < frameCount; ++i) {\r\n        channel[i] = pcmData[c][i];\r\n      }\r\n    }\r\n    return buffer;\r\n  }\r\n\r\n  create3DSound(x, y, z, snd) {\r\n    snd.panner = this.context.createPanner();\r\n    snd.panner.setPosition(x, y, z);\r\n    snd.panner.connect(this.mainVolume);\r\n    snd.volume.connect(snd.panner);\r\n    return snd;\r\n  }\r\n\r\n  createFixedSound(snd) {\r\n    snd.volume.connect(this.mainVolume);\r\n    return snd;\r\n  }\r\n\r\n  loadSource(sources, loop) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Output.Audio3D\",\r\n      name: \"loadSound\",\r\n      returns: \"Promise<MediaElementAudioSourceNode>\",\r\n      parameters: [{\r\n        name: \"sources\",\r\n        type: \"String|Array<String>\",\r\n        description: \"A string URI to an audio source, or an array of string URIs to audio sources. Will be used as a collection of HTML5 &lt;source> tags as children of an HTML5 &lt;audio> tag.\"\r\n      }, {\r\n        name: \"loop\",\r\n        type: \"Boolean\",\r\n        optional: true,\r\n        description: \"indicate that the sound should be played on loop.\"\r\n      }],\r\n      description: \"Loads the first element of the `sources` array for which the browser supports the file format as an HTML5 &lt;audio> tag to use as an `AudioSourceNode` attached to the current `AudioContext`. This does not load all of the audio files. It only loads the first one of a list of options that could work, because all browsers do not support the same audio formats.\",\r\n      examples: [{\r\n        name: \"Load a single audio file.\",\r\n        description: \"There is no one, good, compressed audio format supported in all browsers, but they do all support uncompressed WAV. You shouldn't use this on the Internet, but it might be okay for a local solution.\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var audio = new Primrose.Output.Audio3D();\\n\\\r\n  audio.loadSource(\\\"mySong.wav\\\").then(function(node){\\n\\\r\n    node.connect(audio.context.destination);\\n\\\r\n  });\"\r\n      }, {\r\n        name: \"Load a single audio file from a list of options.\",\r\n        description: \"There is no one, good, compressed audio format supported in all browsers. As a hack around the problem, HTML5 media tags may include one or more &lt;source> tags as children to specify a cascading list of media sources. The browser will select the first one that it can successfully decode.\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var audio = new Primrose.Output.Audio3D();\\n\\\r\n  audio.loadSource([\\n\\\r\n    \\\"mySong.mp3\\\",\\n\\\r\n    \\\"mySong.aac\\\",\\n\\\r\n    \\\"mySong.ogg\\\"\\n\\\r\n  ]).then(function(node){\\n\\\r\n    node.connect(audio.context.destination);\\n\\\r\n  });\"\r\n      }, {\r\n        name: \"Load an ambient audio file that should be looped.\",\r\n        description: \"The only audio option that is available is whether or not the audio file should be looped. You specify this with the second parameter to the `loadSource()` method, a `Boolean` value to indicate that looping is desired.\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var audio = new Primrose.Output.Audio3D();\\n\\\r\n  audio.loadSource([\\n\\\r\n    \\\"mySong.mp3\\\",\\n\\\r\n    \\\"mySong.aac\\\",\\n\\\r\n    \\\"mySong.ogg\\\"\\n\\\r\n  ], true).then(function(node){\\n\\\r\n    node.connect(audio.context.destination);\\n\\\r\n  });\"\r\n      }]\r\n    });\r\n\r\n    return this.ready.then(() => new Promise((resolve, reject) => {\r\n      console.log(\"Loading \" + sources);\r\n      if (!(sources instanceof Array)) {\r\n        sources = [sources];\r\n      }\r\n      var audio = document.createElement(\"audio\");\r\n      audio.autoplay = true;\r\n      audio.preload = \"auto\";\r\n      audio[\"webkit-playsinline\"] = true;\r\n      audio.playsinline = true;\r\n      audio.loop = loop;\r\n      audio.crossOrigin = \"anonymous\";\r\n      sources.map((src) => {\r\n          var source = document.createElement(\"source\");\r\n          source.src = src;\r\n          return source;\r\n        })\r\n        .forEach(audio.appendChild.bind(audio));\r\n      audio.onerror = reject;\r\n      audio.oncanplay = () => {\r\n        audio.oncanplay = null;\r\n        const snd = {\r\n          volume: this.context.createGain(),\r\n          source: this.context.createMediaElementSource(audio)\r\n        };\r\n        snd.source.connect(snd.volume);\r\n        resolve(snd);\r\n      };\r\n      audio.play();\r\n      document.body.appendChild(audio);\r\n    }))\r\n      .then((dat) => {\r\n        console.log(sources + \" loaded\");\r\n        return dat;\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Couldn't load \" + sources + \". Reason: \" + err);\r\n      });\r\n  }\r\n\r\n  load3DSound(src, loop, x, y, z) {\r\n    return this.loadSource(src, loop)\r\n      .then(this.create3DSound.bind(this, x, y, z));\r\n  }\r\n\r\n  loadFixedSound(src, loop) {\r\n    return this.loadSource(src, loop)\r\n      .then(this.createFixedSound.bind(this));\r\n  }\r\n}\r\n\r\nAudio3D.isAvailable = !!window.AudioContext && !!AudioContext.prototype.createGain;\r\n","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"PositionalSound\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nexport default class PositionalSound {\r\n  constructor(ctx, mainVolume){\r\n    this.gn = ctx.createGain(),\r\n    this.pnr = ctx.createPanner();\r\n    this.gn.connect(this.pnr);\r\n    this.pnr.connect(mainVolume);\r\n    this.gn.gain.value = 0;\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  at(x, y, z, dx, dy, dz) {\r\n    x = x || 0;\r\n    y = y || 0;\r\n    z = z || 0;\r\n    if(dx === undefined || dx === null) {\r\n      dx = 0;\r\n    }\r\n    dy = dy || 0;\r\n    dz = dz || 0;\r\n\r\n    this.pnr.setPosition(x, y, z);\r\n    this.pnr.setOrientation(dx, dy, dz);\r\n    return this;\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"Note\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nconst PIANO_BASE = Math.pow(2, 1 / 12);\r\n\r\nimport PositionalSound from \"./PositionalSound\";\r\nexport default class Note extends PositionalSound {\r\n\r\n  static piano(n) {\r\n    return 440 * Math.pow(PIANO_BASE, n - 49);\r\n  }\r\n\r\n  constructor(ctx, mainVolume, type){\r\n    super(ctx, mainVolume);\r\n    this.osc = ctx.createOscillator(),\r\n    this.osc.type = type;\r\n    this.osc.frequency.value = 0;\r\n    this.osc.connect(this.gn);\r\n    this.osc.start();\r\n  }\r\n\r\n  get ready(){\r\n    return this.gn.gain.value === 0;\r\n  }\r\n\r\n  on(i, volume, dt, ramp) {\r\n    if(dt === undefined){\r\n      dt = 0;\r\n    }\r\n    const f = Note.piano(parseFloat(i) + 1),\r\n      t = this.ctx.currentTime + dt;\r\n    this.gn.gain.setValueAtTime(volume, t);\r\n    if(ramp){\r\n      this.osc.frequency.exponentialRampToValueAtTime(f, t);\r\n    }\r\n    else {\r\n      this.osc.frequency.setValueAtTime(f, t);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  off(dt) {\r\n    if(dt === undefined){\r\n      dt = 0;\r\n    }\r\n    const t = this.ctx.currentTime + dt;\r\n    this.gn.gain.setValueAtTime(0, t);\r\n    this.osc.frequency.setValueAtTime(0, t);\r\n    return this;\r\n  }\r\n}","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"Music\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nvar MAX_NOTE_COUNT = (navigator.maxTouchPoints || 10) + 1,\r\n  TYPES = [\"sine\",\r\n    \"square\",\r\n    \"sawtooth\",\r\n    \"triangle\"\r\n  ];\r\n\r\nimport Note from \"./Note\";\r\nexport default class Music {\r\n\r\n  constructor(audio, numNotes) {\r\n    if (numNotes === undefined) {\r\n      numNotes = MAX_NOTE_COUNT;\r\n    }\r\n\r\n    this.oscillators = {};\r\n    this.isAvailable = false;\r\n    this.audio = audio;\r\n    this.audio.ready.then(() => {\r\n      const ctx = this.audio.context;\r\n      this.mainVolume = ctx.createGain();\r\n      this.mainVolume.connect(this.audio.mainVolume);\r\n      this.mainVolume.gain.value = 1;\r\n      this.numNotes = numNotes;\r\n      TYPES.forEach((type) => {\r\n        const oscs = this.oscillators[type] = [];\r\n        this[type] = this.play.bind(this, type);\r\n        for (var i = 0; i < this.numNotes; ++i) {\r\n          oscs.push(new Note(ctx, this.mainVolume, type));\r\n        }\r\n      });\r\n      this.isAvailable = true;\r\n    });\r\n  }\r\n\r\n  get type() {\r\n    return this._type;\r\n  }\r\n\r\n  set type(v){\r\n    if(this.isAvailable){\r\n      this._type = v;\r\n      this.oscillators.forEach((o) => o.osc.type = this._type);\r\n    }\r\n  }\r\n\r\n  getOsc(type){\r\n    const osc = this.oscillators[type];\r\n    let n;\r\n    for(n = 0; n < osc.length; ++n){\r\n      if(osc[n].ready){\r\n        break;\r\n      }\r\n    }\r\n\r\n    return osc[n % this.numNotes];\r\n  }\r\n\r\n  play (type, i, volume, duration, dt) {\r\n    if(dt === undefined){\r\n      dt = 0;\r\n    }\r\n    const o = this.getOsc(type)\r\n      .on(i, volume, dt);\r\n    dt += duration;\r\n    o.off(dt);\r\n    dt = this.audio.context.currentTime + dt - performance.now() / 1000;\r\n    return o;\r\n  }\r\n}\r\n\r\nMusic.TYPES = TYPES;","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"Sound\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nimport PositionalSound from \"./PositionalSound\";\r\nexport default class Sound extends PositionalSound {\r\n  constructor(audio3D, sources, loop){\r\n    super(audio3D.context, audio3D.mainVolume);\r\n    this.audio = document.createElement(\"audio\");\r\n    this.audio.autoplay = true;\r\n    this.audio.preload = \"auto\";\r\n    this.audio[\"webkit-playsinline\"] = true;\r\n    this.audio.playsinline = true;\r\n    this.audio.loop = loop;\r\n    this.audio.crossOrigin = \"anonymous\";\r\n    console.log(\"Loading \" + sources);\r\n    if (!(sources instanceof Array)) {\r\n      sources = [sources];\r\n    }\r\n    sources.map((src) => {\r\n        var source = document.createElement(\"source\");\r\n        source.src = src;\r\n        return source;\r\n      })\r\n      .forEach(this.audio.appendChild.bind(this.audio));\r\n    this.ready = new Promise((resolve, reject) => {\r\n      this.audio.onerror = reject;\r\n      this.audio.oncanplay = () => {\r\n        this.audio.oncanplay = null;\r\n        this.node = this.ctx.createMediaElementSource(this.audio);\r\n        this.node.connect(this.gn);\r\n        this.gn.gain.setValueAtTime(0, this.ctx.currentTime);\r\n        resolve(this);\r\n      };\r\n      this.audio.play();\r\n    });\r\n\r\n    document.body.appendChild(this.audio);\r\n  }\r\n\r\n  play(){\r\n    this.gn.gain.setValueAtTime(1, this.ctx.currentTime);\r\n    this.audio.play();\r\n    return this;\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Output\",\r\n    name: \"Speech\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nconst DEFAULT_SPEECH_SETTINGS = {\r\n  remoteVoices: true,\r\n  volume: 1,\r\n  rate: 1,\r\n  pitch: 1,\r\n  voice: 0\r\n};\r\n\r\nexport default class Speech {\r\n  constructor (options) {\r\n    this.options = Object.assign({}, DEFAULT_SPEECH_SETTINGS, options);\r\n    if(Speech.isAvailable) {\r\n      const getVoices = () => {\r\n        this.voices = speechSynthesis\r\n          .getVoices()\r\n          .filter((v) => this.options.remoteVoices || v.default || v.localService);\r\n        this.voiceNames = this.voices.map((voice) => voice.name);\r\n      };\r\n\r\n      getVoices();\r\n      speechSynthesis.onvoiceschanged = getVoices;\r\n    }\r\n  }\r\n\r\n  static get isAvailable () {\r\n    return !!window.speechSynthesis;\r\n  }\r\n\r\n  get speaking(){\r\n    return Speech.isAvailable && speechSynthesis.speaking;\r\n  }\r\n\r\n  speak(txt, opts) {\r\n    if(Speech.isAvailable) {\r\n      return new Promise((resolve, reject) => {\r\n        var msg = new SpeechSynthesisUtterance();\r\n        msg.voice = this.voices[opts && opts.voice || this.options.voice];\r\n        msg.volume = opts && opts.volume || this.options.volume;\r\n        msg.rate = opts && opts.rate || this.options.rate;\r\n        msg.pitch = opts && opts.pitch || this.options.pitch;\r\n        msg.text = txt;\r\n        msg.onend = resolve;\r\n        msg.onerror = reject;\r\n        speechSynthesis.speak(msg);\r\n      });\r\n    }\r\n    else{\r\n      return Promise.reject();\r\n    }\r\n  }\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Audio\",\r\n  description: \"The audio namespace contains classes that handle output to devices other than the screen (e.g. Audio, Music, etc.).\"\r\n});\r\n\r\nimport Audio3D from \"./Audio3D\";\r\nimport Music from \"./Music\";\r\nimport Note from \"./Note\";\r\nimport PositionalSound from \"./PositionalSound\";\r\nimport Sound from \"./Sound\";\r\nimport Speech from \"./Speech\";\r\n\r\nexport {\r\n  Audio3D,\r\n  Music,\r\n  Note,\r\n  PositionalSound,\r\n  Sound,\r\n  Speech\r\n};\r\n\r\nexport default {\r\n  Audio3D,\r\n  Music,\r\n  Note,\r\n  PositionalSound,\r\n  Sound,\r\n  Speech\r\n};","pliny.class({\r\n  parent: \"Primrose\",\r\n  name: \"Pointer\",\r\n  description: \"An object that points into the scene somewhere, casting a ray at objects for picking operations.\",\r\n  parameters: [{\r\n    name: \"pointerName\",\r\n    type: \"String\",\r\n    description: \"A friendly name for this pointer object, to make debugging easier.\"\r\n  }, {\r\n    name: \"color\",\r\n    type: \"Number\",\r\n    description: \"The color to use to render the teleport pad and 3D pointer cursor.\"\r\n  }, {\r\n    name: \"highlight\",\r\n    type: \"Number\",\r\n    description: \"The color to use to highlight the teleport pad and 3D pointer cursor when it's pointing at a real thing.\"\r\n  }, {\r\n    name: \"devices\",\r\n    type: \"Array\",\r\n    description: \"An Array of `Primrose.InputProcessor` objects that define the orientation for this pointer.\"\r\n  }, {\r\n    name: \"triggerDevices\",\r\n    type: \"Array\",\r\n    description: \"An Array of `Primrose.InputProcessor` objects that define the button trigger for this pointer.\",\r\n    optional: true,\r\n    default: null\r\n    }]\r\n});\r\n\r\nimport { Vector3, Euler, Quaternion, Raycaster, Object3D } from \"three\";\r\n\r\nimport identity from \"../util/identity\";\r\nimport colored from \"../live-api/colored\";\r\nimport hub from \"../live-api/hub\";\r\nimport box from \"../live-api/box\";\r\nimport sphere from \"../live-api/sphere\";\r\nimport circle from \"../live-api/circle\";\r\nimport ring from \"../live-api/ring\";\r\nimport material from \"../live-api/material\";\r\nimport Entity from \"./Controls/Entity\";\r\n\r\nconst FORWARD = new Vector3(0, 0, -1),\r\n  LASER_WIDTH = 0.01,\r\n  LASER_LENGTH = 3 * LASER_WIDTH,\r\n  GAZE_RING_DISTANCE  = -1.25,\r\n  GAZE_RING_INNER = 0.015,\r\n  GAZE_RING_OUTER = 0.03,\r\n  VECTOR_TEMP = new Vector3(),\r\n  EULER_TEMP = new Euler(),\r\n  QUAT_TEMP = new Quaternion();\r\n\r\n\r\nfunction hasGazeEvent(obj){\r\n  return obj && obj._listeners && (\r\n      (obj._listeners.gazecomplete && obj._listeners.gazecomplete.length > 0) ||\r\n      (obj._listeners.select && obj._listeners.select.length > 0) ||\r\n      (obj._listeners.click && obj._listeners.click.length > 0));\r\n}\r\n\r\nexport default class Pointer extends Entity {\r\n  constructor(pointerName, color, highlight, s, devices, triggerDevices, options) {\r\n    super(pointerName, options);\r\n\r\n    this.isPointer = true;\r\n    this.devices = devices.filter(identity);\r\n    this.triggerDevices = triggerDevices && triggerDevices.filter(identity) || this.devices.slice();\r\n    this.gazeTimeout = (this.options.gazeLength || 1.5) * 1000;\r\n\r\n    this.unproject = null;\r\n\r\n    this.picker = new Raycaster();\r\n    this.showPointer = true;\r\n    this.color = color;\r\n    this.highlight = highlight;\r\n    this.velocity = new Vector3();\r\n\r\n    this.mesh = box(LASER_WIDTH / s, LASER_WIDTH / s, LASER_LENGTH * s)\r\n      .colored(this.color, {\r\n        unshaded: true\r\n      })\r\n      .named(pointerName + \"-pointer\")\r\n      .addTo(this)\r\n      .at(0, 0, -1.5);\r\n\r\n    this.gazeInner = circle(GAZE_RING_INNER / 2, 10)\r\n      .colored(0xc0c0c0, {\r\n        unshaded: true\r\n      })\r\n      .addTo(this)\r\n      .at(0, 0, GAZE_RING_DISTANCE);\r\n\r\n    this.gazeReference = ring(GAZE_RING_INNER * 0.5, GAZE_RING_INNER * 0.75, 10, 36, 0, 2 * Math.PI)\r\n      .colored(0xffffff, {\r\n        unshaded: true\r\n      })\r\n      .addTo(this.gazeInner);\r\n\r\n    this.gazeOuter = ring(GAZE_RING_INNER, GAZE_RING_OUTER, 10, 36, 0, 2 * Math.PI)\r\n      .colored(0xffffff, {\r\n        unshaded: true\r\n      })\r\n      .addTo(this.gazeInner);\r\n\r\n    this.gazeOuter.visible = false;\r\n\r\n    this.useGaze = this.options.useGaze;\r\n    this.lastHit = null;\r\n  }\r\n\r\n  get pickable() {\r\n    return false;\r\n  }\r\n\r\n  get material(){\r\n    return this.mesh.material;\r\n  }\r\n\r\n  set material(v){\r\n    this.mesh.material = v;\r\n    this.gazeInner.material = v;\r\n    this.gazeOuter.material = v;\r\n  }\r\n\r\n  addDevice(orientation, trigger){\r\n    if(orientation){\r\n      this.devices.push(orientation);\r\n    }\r\n\r\n    if(trigger){\r\n      this.triggerDevices.push(trigger);\r\n    }\r\n  }\r\n\r\n  setSize(width, height) {\r\n    const w = devicePixelRatio * 2 / width,\r\n      h = devicePixelRatio * 2 / height;\r\n    for(let i = 0; i < this.devices.length; ++i) {\r\n      const device = this.devices[i];\r\n      device.commands.U.scale = w;\r\n      device.commands.V.scale = h;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.position.set(0, 0, 0);\r\n\r\n    if(this.unproject) {\r\n      QUAT_TEMP.set(0, 1, 0, 0);\r\n      VECTOR_TEMP.set(0, 0, 0);\r\n      for(let i = 0; i < this.devices.length; ++i) {\r\n        const obj = this.devices[i];\r\n        if(obj.enabled && obj.inPhysicalUse && !obj.commands.U.disabled && !obj.commands.V.disabled) {\r\n          VECTOR_TEMP.x += obj.getValue(\"U\") - 1;\r\n          VECTOR_TEMP.y += obj.getValue(\"V\") - 1;\r\n        }\r\n      }\r\n      VECTOR_TEMP.applyMatrix4(this.unproject)\r\n        .applyQuaternion(QUAT_TEMP);\r\n      this.lookAt(VECTOR_TEMP);\r\n    }\r\n    else {\r\n      this.quaternion.set(0, 0, 0, 1);\r\n      EULER_TEMP.set(0, 0, 0, \"YXZ\");\r\n      for(let i = 0; i < this.devices.length; ++i) {\r\n        const obj = this.devices[i];\r\n        if(obj.enabled) {\r\n          if(obj.quaternion) {\r\n            this.quaternion.multiply(obj.quaternion);\r\n          }\r\n          if(obj.position) {\r\n            this.position.add(obj.position);\r\n          }\r\n        }\r\n      }\r\n\r\n      QUAT_TEMP.setFromEuler(EULER_TEMP);\r\n      this.quaternion.multiply(QUAT_TEMP);\r\n    }\r\n    this.updateMatrixWorld();\r\n  }\r\n\r\n  _check(curHit) {\r\n    const curObj = curHit && curHit.object,\r\n      lastHit = this.lastHit,\r\n      lastObj = lastHit && lastHit.object;\r\n\r\n    if(curObj || lastObj) {\r\n      const moved = lastHit && curHit &&\r\n          (curHit.point.x !== lastHit.point.x ||\r\n          curHit.point.y !== lastHit.point.y ||\r\n          curHit.point.z !== lastHit.point.z),\r\n        dt = lastHit && lastHit.time && (performance.now() - lastHit.time),\r\n        curID = curObj && curObj.id,\r\n        lastID = lastObj && lastObj.id,\r\n        changed = curID !== lastID,\r\n        enterEvt = {\r\n          pointer: this,\r\n          buttons: 0,\r\n          hit: curHit\r\n        },\r\n        leaveEvt = {\r\n          pointer: this,\r\n          buttons: 0,\r\n          hit: lastHit\r\n        };\r\n\r\n      if(curHit){\r\n        this.gazeInner.position.z = 0.02 - curHit.distance;\r\n        curHit.time = performance.now();\r\n\r\n        this.mesh.material = material(\"\", {\r\n          color: this.highlight,\r\n          unshaded: true\r\n        });\r\n      }\r\n      else{\r\n        this.gazeInner.position.z = GAZE_RING_DISTANCE;\r\n      }\r\n\r\n      this.mesh.position.z = this.gazeInner.position.z - 0.02;\r\n\r\n      if(moved){\r\n        lastHit.point.copy(curHit.point);\r\n      }\r\n\r\n      var dButtons = 0;\r\n      for(let i = 0; i < this.triggerDevices.length; ++i) {\r\n        const obj = this.triggerDevices[i];\r\n        if(obj.enabled){\r\n          enterEvt.buttons |= obj.getValue(\"buttons\");\r\n          dButtons |= obj.getValue(\"dButtons\");\r\n        }\r\n      }\r\n\r\n      leaveEvt.buttons = enterEvt.buttons;\r\n\r\n      if(changed){\r\n        if(lastObj) {\r\n          this.emit(\"exit\", leaveEvt);\r\n        }\r\n        if(curObj) {\r\n          this.emit(\"enter\", enterEvt);\r\n        }\r\n      }\r\n\r\n      let selected = false;\r\n      if(dButtons){\r\n        if(enterEvt.buttons){\r\n          if(curObj) {\r\n            this.emit(\"pointerstart\", enterEvt);\r\n          }\r\n          if(lastHit){\r\n            lastHit.time = performance.now();\r\n          }\r\n        }\r\n        else if(curObj) {\r\n          selected = !!curHit;\r\n          this.emit(\"pointerend\", enterEvt);\r\n        }\r\n      }\r\n      else if(moved && curObj) {\r\n        this.emit(\"pointermove\", enterEvt);\r\n      }\r\n\r\n      if(this.useGaze){\r\n        if(changed) {\r\n          if(dt !== null && dt < this.gazeTimeout){\r\n            this.gazeOuter.visible = false;\r\n            if(lastObj) {\r\n              this.emit(\"gazecancel\", leaveEvt);\r\n            }\r\n          }\r\n          if(curHit){\r\n            this.gazeOuter.visible = true;\r\n            if(curObj) {\r\n              this.emit(\"gazestart\", enterEvt);\r\n            }\r\n          }\r\n        }\r\n        else if(dt !== null) {\r\n          if(dt >= this.gazeTimeout){\r\n            this.gazeOuter.visible = false;\r\n            if(curObj) {\r\n              selected = !!curHit;\r\n              this.emit(\"gazecomplete\", enterEvt);\r\n            }\r\n            lastHit.time = null;\r\n          }\r\n          else if(hasGazeEvent(curObj)){\r\n            var p = Math.round(36 * dt / this.gazeTimeout),\r\n              a = 2 * Math.PI * p / 36;\r\n            this.gazeOuter.geometry = ring(GAZE_RING_INNER, GAZE_RING_OUTER, 36, p, 0, a);\r\n            if(moved && curObj) {\r\n              this.emit(\"gazemove\", enterEvt);\r\n            }\r\n          }\r\n          else{\r\n            this.gazeOuter.visible = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      if(selected){\r\n        this.emit(\"select\", enterEvt);\r\n      }\r\n\r\n      if(!changed && curHit && lastHit) {\r\n        curHit.time = lastHit.time;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  resolvePicking(objects) {\r\n    this.mesh.visible = false;\r\n    this.gazeInner.visible = false;\r\n    this.mesh.material = material(\"\", {\r\n      color: this.color,\r\n      unshaded: true\r\n    });\r\n\r\n    if(this.showPointer){\r\n      VECTOR_TEMP.set(0, 0, 0)\r\n        .applyMatrix4(this.matrixWorld);\r\n      FORWARD.set(0, 0, -1)\r\n        .applyMatrix4(this.matrixWorld)\r\n        .sub(VECTOR_TEMP);\r\n      this.picker.set(VECTOR_TEMP, FORWARD);\r\n      this.gazeInner.visible = this.useGaze;\r\n      this.mesh.visible = !this.useGaze;\r\n\r\n      // Fire phasers\r\n      const hits = this.picker.intersectObject(objects, true);\r\n      for(let i = 0; i < hits.length; ++i) {\r\n\r\n        const hit = hits[i],\r\n          origObj = hit.object;\r\n        let obj = origObj;\r\n\r\n        // Try to find a Primrose Entity\r\n        while(obj && (!obj.isEntity || obj.isPointer)) {\r\n          obj = obj.parent;\r\n        }\r\n\r\n        // If we didn't find a Primrose Entity, go back to using the Three.js mesh.\r\n        if(!obj) {\r\n          obj = origObj;\r\n        }\r\n\r\n        // Check to see if the object has any event handlers that we care about.\r\n        if(obj && !obj.pickable) {\r\n          obj = null;\r\n        }\r\n\r\n        // Save the setting, necessary for checking against the last value, to check for changes in which object was pointed at.\r\n        hit.object = obj;\r\n\r\n        if(obj && this._check(hit)) {\r\n          this.lastHit = hit;\r\n          return hit.object._listeners.useraction;\r\n        }\r\n      }\r\n\r\n      // If we got this far, it means we didn't find any good objects, and the _check method never ran. So run the check again with no object and it will fire the necessary \"end\" event handlers.\r\n      this._check();\r\n      this.lastHit = null;\r\n    }\r\n  }\r\n}\r\n\r\nPointer.EVENTS = [\"pointerstart\", \"pointerend\", \"pointermove\", \"gazestart\", \"gazemove\", \"gazecomplete\", \"gazecancel\", \"exit\", \"enter\", \"select\", \"useraction\"];\r\n","pliny.enumeration({\r\n  parent: \"Primrose\",\r\n  name: \"Keys\",\r\n  description: \"Keycode values for system keys that are the same across all international standards\"\r\n});\r\n\r\nvar Keys = {\r\n  ANY: Number.MAX_VALUE,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // modifiers\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  MODIFIER_KEYS: [\"ctrl\", \"shift\", \"alt\", \"meta\", \"meta_l\", \"meta_r\"],\r\n  SHIFT: 16,\r\n  CTRL: 17,\r\n  ALT: 18,\r\n  META: 91,\r\n  META_L: 91,\r\n  META_R: 92,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // whitespace\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  BACKSPACE: 8,\r\n  TAB: 9,\r\n  ENTER: 13,\r\n  SPACE: 32,\r\n  DELETE: 46,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // lock keys\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  PAUSEBREAK: 19,\r\n  CAPSLOCK: 20,\r\n  NUMLOCK: 144,\r\n  SCROLLLOCK: 145,\r\n  INSERT: 45,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // navigation keys\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  ESCAPE: 27,\r\n  PAGEUP: 33,\r\n  PAGEDOWN: 34,\r\n  END: 35,\r\n  HOME: 36,\r\n  LEFTARROW: 37,\r\n  UPARROW: 38,\r\n  RIGHTARROW: 39,\r\n  DOWNARROW: 40,\r\n  SELECTKEY: 93,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // numbers\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  NUMBER0: 48,\r\n  NUMBER1: 49,\r\n  NUMBER2: 50,\r\n  NUMBER3: 51,\r\n  NUMBER4: 52,\r\n  NUMBER5: 53,\r\n  NUMBER6: 54,\r\n  NUMBER7: 55,\r\n  NUMBER8: 56,\r\n  NUMBER9: 57,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // letters\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  A: 65,\r\n  B: 66,\r\n  C: 67,\r\n  D: 68,\r\n  E: 69,\r\n  F: 70,\r\n  G: 71,\r\n  H: 72,\r\n  I: 73,\r\n  J: 74,\r\n  K: 75,\r\n  L: 76,\r\n  M: 77,\r\n  N: 78,\r\n  O: 79,\r\n  P: 80,\r\n  Q: 81,\r\n  R: 82,\r\n  S: 83,\r\n  T: 84,\r\n  U: 85,\r\n  V: 86,\r\n  W: 87,\r\n  X: 88,\r\n  Y: 89,\r\n  Z: 90,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // numpad\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  NUMPAD0: 96,\r\n  NUMPAD1: 97,\r\n  NUMPAD2: 98,\r\n  NUMPAD3: 99,\r\n  NUMPAD4: 100,\r\n  NUMPAD5: 101,\r\n  NUMPAD6: 102,\r\n  NUMPAD7: 103,\r\n  NUMPAD8: 104,\r\n  NUMPAD9: 105,\r\n  MULTIPLY: 106,\r\n  ADD: 107,\r\n  SUBTRACT: 109,\r\n  DECIMALPOINT: 110,\r\n  DIVIDE: 111,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // function keys\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  F1: 112,\r\n  F2: 113,\r\n  F3: 114,\r\n  F4: 115,\r\n  F5: 116,\r\n  F6: 117,\r\n  F7: 118,\r\n  F8: 119,\r\n  F9: 120,\r\n  F10: 121,\r\n  F11: 122,\r\n  F12: 123,\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // media keys\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  VOLUME_DOWN: 174,\r\n  VOLUME_UP: 175,\r\n  TRACK_NEXT: 176,\r\n  TRACK_PREVIOUS: 177\r\n};\r\n\r\n// create a reverse mapping from keyCode to name.\r\nfor (var key in Keys) {\r\n  var val = Keys[key];\r\n  if (Keys.hasOwnProperty(key) && typeof (val) === \"number\") {\r\n    Keys[val] = key;\r\n  }\r\n}\r\n\r\nexport default Keys;","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Point\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nexport default class Point {\r\n  constructor (x, y) {\r\n    this.set(x || 0, y || 0);\r\n  }\r\n\r\n  set(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  copy(p) {\r\n    if (p) {\r\n      this.x = p.x;\r\n      this.y = p.y;\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return new Point(this.x, this.y);\r\n  }\r\n\r\n  toString() {\r\n    return \"(x:\" + this.x + \", y:\" + this.y + \")\";\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Size\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nexport default class Size {\r\n  constructor(width, height) {\r\n    this.set(width || 0, height || 0);\r\n  }\r\n\r\n  set(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  copy(s) {\r\n    if (s) {\r\n      this.width = s.width;\r\n      this.height = s.height;\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return new Size(this.width, this.height);\r\n  }\r\n\r\n  toString() {\r\n    return \"<w:\" + this.width + \", h:\" + this.height + \">\";\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Rectangle\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nimport Point from \"./Point\";\r\nimport Size from \"./Size\";\r\nexport default class Rectangle {\r\n  constructor(x, y, width, height) {\r\n    this.isRectangle = true;\r\n    this.point = new Point(x, y);\r\n    this.size = new Size(width, height);\r\n  }\r\n\r\n  get x() {\r\n    return this.point.x;\r\n  }\r\n\r\n  set x(x) {\r\n    this.point.x = x;\r\n  }\r\n\r\n  get left() {\r\n    return this.point.x;\r\n  }\r\n  set left(x) {\r\n    this.point.x = x;\r\n  }\r\n\r\n  get width() {\r\n    return this.size.width;\r\n  }\r\n  set width(width) {\r\n    this.size.width = width;\r\n  }\r\n\r\n  get right() {\r\n    return this.point.x + this.size.width;\r\n  }\r\n  set right(right) {\r\n    this.point.x = right - this.size.width;\r\n  }\r\n\r\n  get y() {\r\n    return this.point.y;\r\n  }\r\n  set y(y) {\r\n    this.point.y = y;\r\n  }\r\n\r\n  get top() {\r\n    return this.point.y;\r\n  }\r\n  set top(y) {\r\n    this.point.y = y;\r\n  }\r\n\r\n  get height() {\r\n    return this.size.height;\r\n  }\r\n  set height(height) {\r\n    this.size.height = height;\r\n  }\r\n\r\n  get bottom() {\r\n    return this.point.y + this.size.height;\r\n  }\r\n  set bottom(bottom) {\r\n    this.point.y = bottom - this.size.height;\r\n  }\r\n\r\n  get area() {\r\n    return this.width * this.height;\r\n  }\r\n\r\n  set(x, y, width, height) {\r\n    this.point.set(x, y);\r\n    this.size.set(width, height);\r\n  }\r\n\r\n  copy(r) {\r\n    if (r) {\r\n      this.point.copy(r.point);\r\n      this.size.copy(r.size);\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return new Rectangle(this.point.x, this.point.y, this.size.width, this.size.height);\r\n  }\r\n\r\n  toString() {\r\n    return `[${this.point.toString()} x ${this.size.toString()}]`;\r\n  }\r\n\r\n  overlap(r) {\r\n    var left = Math.max(this.left, r.left),\r\n      top = Math.max(this.top, r.top),\r\n      right = Math.min(this.right, r.right),\r\n      bottom = Math.min(this.bottom, r.bottom);\r\n    if (right > left && bottom > top) {\r\n      return new Rectangle(left, top, right - left, bottom - top);\r\n    }\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Surface\",\r\n  baseClass: \"Primrose.Controls.BaseTextured\",\r\n  description: \"Cascades through a number of options to eventually return a CanvasRenderingContext2D object on which one will perform drawing operations.\",\r\n  parameters: [{\r\n    name: \"options\",\r\n    type: \"Primrose.Controls.Surface.optionsHash\",\r\n    optional: true,\r\n    description: \"Optional settings for creating the surface, including ID and Bounds. See [`Primrose.Controls.Surface.optionsHash`](#Primrose_Controls_Surface_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Primrose.Controls.Surface\",\r\n  name: \"optionsHash\",\r\n  parameters: [{\r\n    name: \"id\",\r\n    type: \"String or HTMLCanvasElement or CanvasRenderingContext2D\",\r\n    description: \"Either an ID of an element that exists, an element, or the ID to set on an element that is to be created.\"\r\n  }, {\r\n    name: \"bounds\",\r\n    type: \"Primrose.Text.Rectangle\",\r\n    description: \"The size and location of the surface to create.\"\r\n  }]\r\n});\r\n\r\nvar COUNTER = 0;\r\n\r\nimport { Texture } from \"three\";\r\nimport isChrome from \"../../flags/isChrome\";\r\nimport BaseTextured from \"./BaseTextured\";\r\nimport Rectangle from \"../Text/Rectangle\";\r\nimport textured from \"../../live-api/textured\";\r\nimport quad from \"../../live-api/quad\";\r\nimport shell from \"../../live-api/shell\";\r\nexport default class Surface extends BaseTextured {\r\n\r\n  constructor(options) {\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"focus\", description: \"If the element is focusable, occurs when the user clicks on an element for the first time, or when a program calls the `focus()` method.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"blur\", description: \"If the element is focused (which implies it is also focusable), occurs when the user clicks off of an element, or when a program calls the `blur()` method.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"click\", description: \"Occurs whenever the user clicks on an element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"keydown\", description: \"Occurs when the user pushes a key down while focused on the element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"keyup\", description: \"Occurs when the user releases a key while focused on the element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"paste\", description: \"Occurs when the user activates the clipboard's `paste` command while focused on the element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"cut\", description: \"Occurs when the user activates the clipboard's `cut` command while focused on the element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"copy\", description: \"Occurs when the user activates the clipboard's `copy` command while focused on the element.\" });\r\n    pliny.event({ parent: \"Primrose.Controls.Surface\", name: \"wheel\", description: \"Occurs when the user scrolls the mouse wheel while focused on the element.\" });\r\n\r\n\r\n\r\n    options = Object.assign({}, {\r\n      id: \"Primrose.Controls.Surface[\" + (COUNTER++) + \"]\",\r\n      bounds: new Rectangle()\r\n    }, options);\r\n\r\n    if(options.width) {\r\n      options.bounds.width = options.width;\r\n    }\r\n\r\n    if(options.height) {\r\n      options.bounds.height = options.height;\r\n    }\r\n\r\n    let canvas = null,\r\n      context = null;\r\n\r\n    if (options.id instanceof Surface) {\r\n      throw new Error(\"Object is already a Surface. Please don't try to wrap them.\");\r\n    }\r\n    else if (options.id instanceof CanvasRenderingContext2D) {\r\n      context = options.id;\r\n      canvas = context.canvas;\r\n    }\r\n    else if (options.id instanceof HTMLCanvasElement) {\r\n      canvas = options.id;\r\n    }\r\n    else if (typeof (options.id) === \"string\" || options.id instanceof String) {\r\n      canvas = document.getElementById(options.id);\r\n      if (canvas === null) {\r\n        canvas = document.createElement(\"canvas\");\r\n        canvas.id = options.id;\r\n      }\r\n      else if (canvas.tagName !== \"CANVAS\") {\r\n        canvas = null;\r\n      }\r\n    }\r\n\r\n    if (canvas === null) {\r\n      pliny.error({\r\n        parent: \"Primrose.Controls.Surface\",\r\n        name: \"Invalid element\",\r\n        type: \"Error\",\r\n        description: \"If the element could not be found, could not be created, or one of the appropriate ID was found but did not match the expected type, an error is thrown to halt operation.\"\r\n      });\r\n      console.error(typeof (options.id));\r\n      console.error(options.id);\r\n      throw new Error(options.id + \" does not refer to a valid canvas element.\");\r\n    }\r\n\r\n    super([canvas], options);\r\n    this.isSurface = true;\r\n    this.bounds = this.options.bounds;\r\n    this.canvas = canvas;\r\n    this.context = context || this.canvas.getContext(\"2d\");\r\n    this._opacity = 1;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"focused\",\r\n      type: \"Boolean\",\r\n      description: \"A flag indicating if the element, or a child element within it, has received focus from the user.\"\r\n    });\r\n    this.focused = false;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"focusable\",\r\n      type: \"Boolean\",\r\n      description: \"A flag indicating if the element, or any child elements within it, is capable of receiving focus.\"\r\n    });\r\n    this.focusable = true;\r\n\r\n    this.style = {};\r\n\r\n    Object.defineProperties(this.style, {\r\n      width: {\r\n        get: () => {\r\n          return this.bounds.width;\r\n        },\r\n        set: (v) => {\r\n          this.bounds.width = v;\r\n          this.resize();\r\n        }\r\n      },\r\n      height: {\r\n        get: () => {\r\n          return this.bounds.height;\r\n        },\r\n        set: (v) => {\r\n          this.bounds.height = v;\r\n          this.resize();\r\n        }\r\n      },\r\n      left: {\r\n        get: () => {\r\n          return this.bounds.left;\r\n        },\r\n        set: (v) => {\r\n          this.bounds.left = v;\r\n        }\r\n      },\r\n      top: {\r\n        get: () => {\r\n          return this.bounds.top;\r\n        },\r\n        set: (v) => {\r\n          this.bounds.top = v;\r\n        }\r\n      },\r\n      opacity: {\r\n        get: () => {\r\n          return this._opacity;\r\n        },\r\n        set: (v) => {\r\n          this._opacity = v;\r\n        }\r\n      },\r\n      fontSize: {\r\n        get: () => {\r\n          return this.fontSize;\r\n        },\r\n        set: (v) => {\r\n          this.fontSize = v;\r\n        }\r\n      },\r\n      backgroundColor: {\r\n        get: () => {\r\n          return this.backgroundColor;\r\n        },\r\n        set: (v) => {\r\n          this.backgroundColor = v;\r\n        }\r\n      },\r\n      color: {\r\n        get: () => {\r\n          return this.color;\r\n        },\r\n        set: (v) => {\r\n          this.color = v;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (this.bounds.width === 0) {\r\n      this.bounds.width = this.imageWidth;\r\n      this.bounds.height = this.imageHeight;\r\n    }\r\n\r\n    this.imageWidth = this.bounds.width;\r\n    this.imageHeight = this.bounds.height;\r\n\r\n    this.canvas.style.imageRendering = isChrome ? \"pixelated\" : \"optimizespeed\";\r\n    this.context.imageSmoothingEnabled = false;\r\n    this.context.textBaseline = \"top\";\r\n\r\n    this.subSurfaces = [];\r\n\r\n    this.render = this.render.bind(this);\r\n\r\n    this.on(\"focus\", this.render)\r\n      .on(\"blur\", this.render)\r\n      .on(\"pointerstart\", this.startUV.bind(this))\r\n      .on(\"pointermove\", this.moveUV.bind(this))\r\n      .on(\"gazemove\", this.moveUV.bind(this))\r\n      .on(\"pointerend\", this.endPointer.bind(this))\r\n      .on(\"gazecomplete\", (evt) => {\r\n        this.startUV(evt);\r\n        setTimeout(() => this.endPointer(evt), 100);\r\n      })\r\n      .on(\"keydown\", this.keyDown.bind(this))\r\n      .on(\"keyup\", this.keyUp.bind(this));\r\n\r\n    this.render();\r\n  }\r\n\r\n  get pickable() {\r\n    return true;\r\n  }\r\n\r\n\r\n  _loadFiles(canvases, progress) {\r\n    return Promise.all(canvases.map((canvas, i) => {\r\n      const loadOptions = Object.assign({}, this.options);\r\n      this._meshes[i] = this._geometry.textured(canvas, loadOptions);\r\n      return loadOptions.promise.then((txt) => this._textures[i] = txt);\r\n    }));\r\n  }\r\n\r\n  invalidate(bounds) {\r\n    var useDefault = !bounds;\r\n    if (!bounds) {\r\n      bounds = this.bounds.clone();\r\n      bounds.left = 0;\r\n      bounds.top = 0;\r\n    }\r\n    else if (bounds.isRectangle) {\r\n      bounds = bounds.clone();\r\n    }\r\n    for (var i = 0; i < this.subSurfaces.length; ++i) {\r\n      var subSurface = this.subSurfaces[i],\r\n        overlap = bounds.overlap(subSurface.bounds);\r\n      if (overlap) {\r\n        var x = overlap.left - subSurface.bounds.left,\r\n          y = overlap.top - subSurface.bounds.top;\r\n        this.context.drawImage(\r\n          subSurface.canvas,\r\n          x, y, overlap.width, overlap.height,\r\n          overlap.x, overlap.y, overlap.width, overlap.height);\r\n      }\r\n    }\r\n    if (this._textures[0]) {\r\n      this._textures[0].needsUpdate = true;\r\n    }\r\n    if (this._meshes[0]) {\r\n      this._meshes[0].material.needsUpdate = true;\r\n    }\r\n    if (this.parent instanceof Surface) {\r\n      bounds.left += this.bounds.left;\r\n      bounds.top += this.bounds.top;\r\n      this.parent.invalidate(bounds);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.invalidate();\r\n  }\r\n\r\n  get imageWidth() {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  set imageWidth(v) {\r\n    this.canvas.width = v;\r\n    this.bounds.width = v;\r\n  }\r\n\r\n  get imageHeight() {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  set imageHeight(v) {\r\n    this.canvas.height = v;\r\n    this.bounds.height = v;\r\n  }\r\n\r\n  get elementWidth() {\r\n    return this.canvas.clientWidth * devicePixelRatio;\r\n  }\r\n\r\n  set elementWidth(v) {\r\n    this.canvas.style.width = (v / devicePixelRatio) + \"px\";\r\n  }\r\n\r\n  get elementHeight() {\r\n    return this.canvas.clientHeight * devicePixelRatio;\r\n  }\r\n\r\n  set elementHeight(v) {\r\n    this.canvas.style.height = (v / devicePixelRatio) + \"px\";\r\n  }\r\n\r\n  get surfaceWidth() {\r\n    return this.canvas.parentElement ? this.elementWidth : this.bounds.width;\r\n  }\r\n\r\n  get surfaceHeight() {\r\n    return this.canvas.parentElement ? this.elementHeight : this.bounds.height;\r\n  }\r\n\r\n  get resized() {\r\n    return this.imageWidth !== this.surfaceWidth ||\r\n      this.imageHeight !== this.surfaceHeight;\r\n  }\r\n\r\n  resize() {\r\n    this.setSize(this.surfaceWidth, this.surfaceHeight);\r\n  }\r\n\r\n  setSize(width, height) {\r\n    const oldTextBaseline = this.context.textBaseline,\r\n      oldTextAlign = this.context.textAlign;\r\n    this.imageWidth = width;\r\n    this.imageHeight = height;\r\n\r\n    this.context.textBaseline = oldTextBaseline;\r\n    this.context.textAlign = oldTextAlign;\r\n  }\r\n\r\n  get environment() {\r\n    var head = this;\r\n    while(head){\r\n      if(head._environment){\r\n        if(head !== this){\r\n          this._environment = head._environment;\r\n        }\r\n        return this._environment;\r\n      }\r\n      head = head.parent;\r\n    }\r\n  }\r\n\r\n  add(child) {\r\n    if(child.isSurface) {\r\n      this.subSurfaces.push(child);\r\n      this.invalidate();\r\n    }\r\n    else if (child.isObject3D) {\r\n      super.add(child);\r\n    }\r\n    else {\r\n      throw new Error(\"Can only append other Surfaces to a Surface. You gave: \" + child);\r\n    }\r\n  }\r\n\r\n  mapUV(point) {\r\n    if(point instanceof Array){\r\n      return {\r\n        x: point[0] * this.imageWidth,\r\n        y: (1 - point[1]) * this.imageHeight\r\n      };\r\n    }\r\n    else if(point.isVector2) {\r\n      return {\r\n        x: point.x * this.imageWidth,\r\n        y: (1 - point.y) * this.imageHeight\r\n      };\r\n    }\r\n  }\r\n\r\n  unmapUV(point) {\r\n    return [point.x / this.imageWidth, (1 - point.y / this.imageHeight)];\r\n  }\r\n\r\n  _findSubSurface(x, y, thunk) {\r\n    var here = this.inBounds(x, y),\r\n      found = null;\r\n    for (var i = this.subSurfaces.length - 1; i >= 0; --i) {\r\n      var subSurface = this.subSurfaces[i];\r\n      if (!found && subSurface.inBounds(x - this.bounds.left, y - this.bounds.top)) {\r\n        found = subSurface;\r\n      }\r\n      else if (subSurface.focused) {\r\n        subSurface.blur();\r\n      }\r\n    }\r\n    return found || here && this;\r\n  }\r\n\r\n  inBounds(x, y) {\r\n    return this.bounds.left <= x && x < this.bounds.right && this.bounds.top <= y && y < this.bounds.bottom;\r\n  }\r\n\r\n  startPointer(x, y) {\r\n    if (this.inBounds(x, y)) {\r\n      var target = this._findSubSurface(x, y, (subSurface, x2, y2) => subSurface.startPointer(x2, y2));\r\n      if (target) {\r\n        if (!this.focused) {\r\n          this.focus();\r\n        }\r\n        this.emit(\"click\", {\r\n          target,\r\n          x,\r\n          y\r\n        });\r\n        if (target !== this) {\r\n          target.startPointer(x - this.bounds.left, y - this.bounds.top);\r\n        }\r\n      }\r\n      else if (this.focused) {\r\n        this.blur();\r\n      }\r\n    }\r\n  }\r\n\r\n  movePointer(x, y) {\r\n    var target = this._findSubSurface(x, y, (subSurface, x2, y2) => subSurface.startPointer(x2, y2));\r\n    if (target) {\r\n      this.emit(\"move\", {\r\n        target,\r\n        x,\r\n        y\r\n      });\r\n      if (target !== this) {\r\n        target.movePointer(x - this.bounds.left, y - this.bounds.top);\r\n      }\r\n    }\r\n  }\r\n\r\n  _forFocusedSubSurface(name, evt) {\r\n    var elem = this.focusedElement;\r\n    if (elem && elem !== this) {\r\n      elem[name](evt);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  startUV(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"startUV\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The pointer event to read\"\r\n      }],\r\n      description: \"Hooks up to the window's `mouseDown` and `touchStart` events, with coordinates translated to tangent-space UV coordinates, and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    if(!this._forFocusedSubSurface(\"startUV\", evt)){\r\n      var p = this.mapUV(evt.hit.uv);\r\n      this.startPointer(p.x, p.y);\r\n    }\r\n  }\r\n\r\n  moveUV(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"moveUV\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The pointer event to read\"\r\n      }],\r\n      description: \"Hooks up to the window's `mouseMove` and `touchMove` events, with coordinates translated to tangent-space UV coordinates, and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    if(!this._forFocusedSubSurface(\"moveUV\", evt)) {\r\n      var p = this.mapUV(evt.hit.uv);\r\n      this.movePointer(p.x, p.y);\r\n    }\r\n  }\r\n\r\n  endPointer(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"endPointer\",\r\n      description: \"Hooks up to the window's `mouseUp` and `toucheEnd` events and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"endPointer\", evt);\r\n  }\r\n\r\n  focus() {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"focus\",\r\n      description: \"If the control is focusable, sets the focus property of the control, does not change the focus property of any other control.\",\r\n      examples: [{\r\n        name: \"Focus on one control, blur all the rest\",\r\n        description: \"When we have a list of controls and we are trying to track focus between them all, we must coordinate calls between `focus()` and `blur()`.\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var ctrls = [\\n\\\r\n  new Primrose.Controls.TextBox(),\\n\\\r\n  new Primrose.Controls.TextBox(),\\n\\\r\n  new Primrose.Controls.Button()\\n\\\r\n  ];\\n\\\r\n  \\n\\\r\n  function focusOn(id){\\n\\\r\n    for(var i = 0; i < ctrls.length; ++i){\\n\\\r\n      var c = ctrls[i];\\n\\\r\n      if(c.controlID === id){\\n\\\r\n        c.focus();\\n\\\r\n      }\\n\\\r\n      else{\\n\\\r\n        c.blur();\\n\\\r\n      }\\n\\\r\n    }\\n\\\r\n  }\"\r\n      }]\r\n    });\r\n\r\n    if (this.focusable && !this.focused) {\r\n      this.focused = true;\r\n      this.emit(\"focus\");\r\n    }\r\n  }\r\n\r\n  blur() {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"blur\",\r\n      description: \"If the element is focused, unsets the focus property of the control and all child controls. Does not change the focus property of any parent or sibling controls.\",\r\n      examples: [{\r\n        name: \"Focus on one control, blur all the rest\",\r\n        description: \"When we have a list of controls and we are trying to track focus between them all, we must coordinate calls between `focus()` and `blur()`.\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var ctrls = [\\n\\\r\n  new Primrose.Controls.TextBox(),\\n\\\r\n  new Primrose.Controls.TextBox(),\\n\\\r\n  new Primrose.Controls.Button()\\n\\\r\n  ];\\n\\\r\n  \\n\\\r\n  function focusOn(id){\\n\\\r\n    for(var i = 0; i < ctrls.length; ++i){\\n\\\r\n      var c = ctrls[i];\\n\\\r\n      if(c.controlID === id){\\n\\\r\n        c.focus();\\n\\\r\n      }\\n\\\r\n      else{\\n\\\r\n        c.blur();\\n\\\r\n      }\\n\\\r\n    }\\n\\\r\n  }\"\r\n      }]\r\n    });\r\n    if (this.focused) {\r\n      this.focused = false;\r\n      for (var i = 0; i < this.subSurfaces.length; ++i) {\r\n        if (this.subSurfaces[i].focused) {\r\n          this.subSurfaces[i].blur();\r\n        }\r\n      }\r\n      this.emit(\"blur\");\r\n    }\r\n  }\r\n\r\n  get theme() {\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"theme\",\r\n      type: \"Primrose.Text.Themes.*\",\r\n      description: \"Get or set the theme used for rendering text on any controls in the control tree.\"\r\n    });\r\n    return null;\r\n  }\r\n\r\n  set theme(v) {\r\n    for (var i = 0; i < this.subSurfaces.length; ++i) {\r\n      this.subSurfaces[i].theme = v;\r\n    }\r\n  }\r\n\r\n  get lockMovement() {\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"lockMovement\",\r\n      type: \"Boolean\",\r\n      description: \"Recursively searches the deepest leaf-node of the control graph for a control that has its `lockMovement` property set to `true`, indicating that key events should not be used to navigate the user, because they are being interpreted as typing commands.\"\r\n    });\r\n    var lock = false;\r\n    for (var i = 0; i < this.subSurfaces.length && !lock; ++i) {\r\n      lock = lock || this.subSurfaces[i].lockMovement;\r\n    }\r\n    return lock;\r\n  }\r\n\r\n  get focusedElement() {\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"focusedElement\",\r\n      type: \"Primrose.Controls.Surface\",\r\n      description: \"Searches the deepest leaf-node of the control graph for a control that has its `focused` property set to `true`.\"\r\n    });\r\n    var result = null,\r\n      head = this;\r\n    while (head && head.focused) {\r\n      result = head;\r\n      var subSurfaces = head.subSurfaces;\r\n      head = null;\r\n      for (var i = 0; i < subSurfaces.length; ++i) {\r\n        var subSurface = subSurfaces[i];\r\n        if (subSurface.focused) {\r\n          head = subSurface;\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  keyDown(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"keyDown\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The key event to read\"\r\n      }],\r\n      description: \"Hooks up to the window's `keyDown` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"keyDown\", evt);\r\n  }\r\n\r\n  keyUp(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"keyUp\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The key event to read\"\r\n      }],\r\n      description: \"Hooks up to the window's `keyUp` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"keyUp\", evt);\r\n  }\r\n\r\n  readClipboard(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"readClipboard\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The clipboard event to read\"\r\n      }],\r\n      description: \"Hooks up to the clipboard's `paste` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"readClipboard\", evt);\r\n  }\r\n\r\n  copySelectedText(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"copySelectedText\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The clipboard event to read\"\r\n      }],\r\n      description: \"Hooks up to the clipboard's `copy` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"copySelectedText\", evt);\r\n  }\r\n\r\n  cutSelectedText(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"cutSelectedText\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The clipboard event to read\"\r\n      }],\r\n      description: \"Hooks up to the clipboard's `cut` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"cutSelectedText\", evt);\r\n  }\r\n\r\n  readWheel(evt) {\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Surface\",\r\n      name: \"readWheel\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The wheel event to read\"\r\n      }],\r\n      description: \"Hooks up to the window's `wheel` event and propagates it to any of its focused subSurfaces.\"\r\n    });\r\n    this._forFocusedSubSurface(\"readWheel\", evt);\r\n  }\r\n}\r\n","pliny.record({\r\n  parent: \"Primrose.Text.Themes\",\r\n  name: \"Default\",\r\n  description: \"A light background with dark foreground text.\"\r\n});\r\n\r\nexport default {\r\n  name: \"Light\",\r\n  fontFamily: \"'Droid Sans Mono', 'Consolas', 'Lucida Console', 'Courier New', 'Courier', monospace\",\r\n  cursorColor: \"black\",\r\n  fontSize: 16,\r\n  lineNumbers: {\r\n    foreColor: \"black\"\r\n  },\r\n  regular: {\r\n    backColor: \"white\",\r\n    foreColor: \"black\",\r\n    currentRowBackColor: \"#f0f0f0\",\r\n    selectedBackColor: \"#c0c0c0\",\r\n    unfocused: \"rgba(0, 0, 255, 0.25)\"\r\n  },\r\n  strings: {\r\n    foreColor: \"#aa9900\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  regexes: {\r\n    foreColor: \"#aa0099\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  numbers: {\r\n    foreColor: \"green\"\r\n  },\r\n  comments: {\r\n    foreColor: \"grey\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  keywords: {\r\n    foreColor: \"blue\"\r\n  },\r\n  functions: {\r\n    foreColor: \"brown\",\r\n    fontWeight: \"bold\"\r\n  },\r\n  members: {\r\n    foreColor: \"green\"\r\n  },\r\n  error: {\r\n    foreColor: \"red\",\r\n    fontStyle: \"underline italic\"\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Label\",\r\n  description: \"A simple label of text to put on a Surface.\",\r\n  baseClass: \"Primrose.Controls.Surface\",\r\n  parameters: [{\r\n    name: \"idOrCanvasOrContext\",\r\n    type: \"String or HTMLCanvasElement or CanvasRenderingContext2D\",\r\n    description: \"Either an ID of an element that exists, an element, or the ID to set on an element that is to be created.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"Named parameters for creating the Button.\"\r\n  }]\r\n});\r\n\r\nvar COUNTER = 0;\r\n\r\nimport Surface from \"./Surface\";\r\nimport Size from \"../Text/Size\";\r\nimport DefaultTheme from \"../Text/Themes/Default\";\r\nexport default class Label extends Surface {\r\n  constructor(options) {\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // normalize input parameters\r\n    ////////////////////////////////////////////////////////////////////////\r\n    super(Object.assign({}, {\r\n      id: \"Primrose.Controls.Label[\" + (COUNTER++) + \"]\"\r\n    }, options));\r\n\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // initialization\r\n    ///////////////////////////////////////////////////////////////////////\r\n\r\n    this._lastFont = null;\r\n    this._lastText = null;\r\n    this._lastCharacterWidth = null;\r\n    this._lastCharacterHeight = null;\r\n    this._lastPadding = null;\r\n    this._lastWidth = -1;\r\n    this._lastHeight = -1;\r\n    this._lastTextAlign = null;\r\n\r\n    this.textAlign = this.options.textAlign;\r\n    this.character = new Size();\r\n    this.theme = this.options.theme;\r\n    this.fontSize = this.options.fontSize || 16;\r\n    this.refreshCharacter();\r\n    this.backgroundColor = this.options.backgroundColor || this.theme.regular.backColor;\r\n    this.color = this.options.color || this.theme.regular.foreColor;\r\n    this.value = this.options.value;\r\n  }\r\n\r\n  get textAlign() {\r\n    return this.context.textAlign;\r\n  }\r\n\r\n  set textAlign(v) {\r\n    this.context.textAlign = v;\r\n    this.render();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(txt) {\r\n    txt = txt || \"\";\r\n    this._value = txt.replace(/\\r\\n/g, \"\\n\");\r\n    this.render();\r\n  }\r\n\r\n  get theme() {\r\n    return this._theme;\r\n  }\r\n\r\n  set theme(t) {\r\n    this._theme = Object.assign({}, DefaultTheme, t);\r\n    this._theme.fontSize = this.fontSize;\r\n    this.refreshCharacter();\r\n    this.render();\r\n  }\r\n\r\n  refreshCharacter() {\r\n    this.character.height = this.fontSize;\r\n    this.context.font = this.character.height + \"px \" + this.theme.fontFamily;\r\n    // measure 100 letter M's, then divide by 100, to get the width of an M\r\n    // to two decimal places on systems that return integer values from\r\n    // measureText.\r\n    this.character.width = this.context.measureText(\r\n        \"MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\")\r\n      .width /\r\n      100;\r\n  }\r\n\r\n  _isChanged() {\r\n    var textChanged = this._lastText !== this.value,\r\n      characterWidthChanged = this.character.width !== this._lastCharacterWidth,\r\n      characterHeightChanged = this.character.height !== this._lastCharacterHeight,\r\n      fontChanged = this.context.font !== this._lastFont,\r\n      alignChanged = this.textAlign !== this._lastTextAlign,\r\n      changed = this.resized || textChanged || characterWidthChanged || characterHeightChanged || this.resized || fontChanged || alignChanged;\r\n    return changed;\r\n  }\r\n\r\n  render() {\r\n    if (this.resized) {\r\n      this.resize();\r\n    }\r\n\r\n    if (this.theme && this._isChanged) {\r\n      this._lastText = this.value;\r\n      this._lastCharacterWidth = this.character.width;\r\n      this._lastCharacterHeight = this.character.height;\r\n      this._lastWidth = this.imageWidth;\r\n      this._lastHeight = this.imageHeight;\r\n      this._lastFont = this.context.font;\r\n      this._lastTextAlign = this.textAlign;\r\n\r\n      this.context.textAlign = this.textAlign || \"left\";\r\n\r\n      var clearFunc = this.backgroundColor ? \"fillRect\" : \"clearRect\";\r\n      if (this.theme.regular.backColor) {\r\n        this.context.fillStyle = this.backgroundColor;\r\n      }\r\n\r\n      this.context[clearFunc](0, 0, this.imageWidth, this.imageHeight);\r\n\r\n      if (this.value) {\r\n        var lines = this.value.split(\"\\n\");\r\n        for (var y = 0; y < lines.length; ++y) {\r\n          var line = lines[y],\r\n            textY = (this.imageHeight - lines.length * this.character.height) / 2 + y * this.character.height;\r\n\r\n          var textX = null;\r\n          switch (this.textAlign) {\r\n            case \"right\":\r\n              textX = this.imageWidth;\r\n              break;\r\n            case \"center\":\r\n              textX = this.imageWidth / 2;\r\n              break;\r\n            default:\r\n              textX = 0;\r\n          }\r\n\r\n          var font = (this.theme.regular.fontWeight || \"\") +\r\n            \" \" + (this.theme.regular.fontStyle || \"\") +\r\n            \" \" + this.character.height + \"px \" + this.theme.fontFamily;\r\n          this.context.font = font.trim();\r\n          this.context.fillStyle = this.color;\r\n          this.context.fillText(line, textX, textY);\r\n        }\r\n      }\r\n\r\n      this.renderCanvasTrim();\r\n\r\n      this.invalidate();\r\n    }\r\n  }\r\n\r\n  renderCanvasTrim() {}\r\n}","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Button2D\",\r\n  baseClass: \"Primrose.Controls.Label\",\r\n  description: \"A simple button to put on a Surface.\",\r\n  parameters: [{\r\n    name: \"idOrCanvasOrContext\",\r\n    type: \"String or HTMLCanvasElement or CanvasRenderingContext2D\",\r\n    description: \"Either an ID of an element that exists, an element, or the ID to set on an element that is to be created.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"Named parameters for creating the Button.\"\r\n  }]\r\n});\r\n\r\nvar COUNTER = 0;\r\n\r\nimport Label from \"./Label\";\r\nexport default class Button2D extends Label {\r\n\r\n  constructor(options) {\r\n    super(Object.assign({}, {\r\n      id: \"Primrose.Controls.Button2D[\" + (COUNTER++) + \"]\",\r\n      textAlign: \"center\"\r\n    }, options));\r\n    this._lastActivated = null;\r\n  }\r\n\r\n  startPointer(x, y) {\r\n    this.focus();\r\n    this._activated = true;\r\n    this.render();\r\n  }\r\n\r\n  endPointer() {\r\n    if (this._activated) {\r\n      this._activated = false;\r\n      this.emit(\"click\", {\r\n        target: this\r\n      });\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  _isChanged() {\r\n    var activatedChanged = this._activated !== this._lastActivated,\r\n      changed = super._isChanged || activatedChanged;\r\n    return changed;\r\n  }\r\n\r\n  renderCanvasTrim() {\r\n    this.context.lineWidth = this._activated ? 4 : 2;\r\n    this.context.strokeStyle = this.theme.regular.foreColor || Primrose.Text.Themes.Default.regular.foreColor;\r\n    this.context.strokeRect(0, 0, this.imageWidth, this.imageHeight);\r\n  }\r\n}","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Button3D\",\r\n  baseClass: \"Primrose.Controls.Entity\",\r\n  parameters: [{\r\n    name: \"model\",\r\n    type: \"THREE.Object3D\",\r\n    description: \"A 3D model to use as the graphics for this button.\"\r\n  }, {\r\n    name: \"buttonName\",\r\n    type: \"String\",\r\n    description: \"A name for the button, to make it distinct from other buttons.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"A hash of options:\\n\\t\\t\\tmaxThrow - The limit for how far the button can be depressed.\\n\\t\\t\\tminDeflection - The minimum distance the button must be depressed before it is activated.\\n\\t\\t\\tcolorPressed - The color to change the button cap to when the button is activated.\\n\\t\\t\\tcolorUnpressed - The color to change the button cap to when the button is deactivated.\\n\\t\\t\\ttoggle - True if deactivating the button should require a second click. False if the button should deactivate when it is released.\"\r\n  }],\r\n  description: \"A 3D button control, with a separate cap from a stand that it sits on. You click and depress the cap on top of the stand to actuate.\"\r\n});\r\n\r\nimport Entity from \"./Entity\";\r\nimport { Color } from \"three\";\r\nexport default class Button3D extends Entity {\r\n  constructor(model, buttonName, options) {\r\n    super(buttonName, Object.assign({}, Button3D.DEFAULTS, options));\r\n\r\n    this.options.minDeflection = Math.cos(this.options.minDeflection);\r\n    this.options.colorUnpressed = new Color(this.options.colorUnpressed);\r\n    this.options.colorPressed = new Color(this.options.colorPressed);\r\n\r\n    pliny.event({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"click\",\r\n      description: \"Occurs when the button is activated.\"\r\n    });\r\n\r\n    pliny.event({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"release\",\r\n      description: \"Occurs when the button is deactivated.\"\r\n    });\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"base\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"The stand the button cap sits on.\"\r\n    });\r\n    this.base = model.children[1];\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"base\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"The moveable part of the button, that triggers the click event.\"\r\n    });\r\n    this.cap = model.children[0];\r\n    this.cap.name = buttonName;\r\n    this.cap.material = this.cap.material.clone();\r\n    this.cap.button = this;\r\n    this.cap.base = this.base;\r\n\r\n    this.add(this.base);\r\n    this.add(this.cap);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"color\",\r\n      type: \"Number\",\r\n      description: \"The current color of the button cap.\"\r\n    });\r\n    this.color = this.cap.material.color;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \" name\",\r\n      type: \"String\",\r\n      description: \"A name for the button, to tell it from others when debugging.\"\r\n    });\r\n    this.name = buttonName;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"element\",\r\n      type: \"Element\",\r\n      optional: true,\r\n      description: \"If this 3D button was created from a copy of an HTMLButtonElement, this is that element.\"\r\n    });\r\n    this.element = null;\r\n  }\r\n\r\n  startUV(point) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"startUV\",\r\n      description: \"Handle a mouse-down event on a textured object.\",\r\n      parameters: [{\r\n        name: \"point\",\r\n        type: \"Primrose.Text.Point\",\r\n        description: \"The UV coordinate of the texture that was clicked.\"\r\n      }]\r\n    });\r\n\r\n    this.color.copy(this.options.colorPressed);\r\n    if (this.element) {\r\n      this.element.click();\r\n    }\r\n    else {\r\n      this.emit(\"click\", { source: this });\r\n    }\r\n  }\r\n\r\n  endPointer(evt) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"endPointer\",\r\n      description: \"Handle a mouse-up event on a textured object.\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"Not actually used.\"\r\n      }]\r\n    });\r\n\r\n    this.color.copy(this.options.colorUnpressed);\r\n    this.emit(\"release\", { source: this });\r\n  }\r\n\r\n  consumeEvent(evt) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"consumeEvent\",\r\n      description: \"Route events.\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"The event to route.\"\r\n      }]\r\n    });\r\n\r\n    switch(evt.type){\r\n      case \"pointerstart\":\r\n        this.startUV();\r\n      break;\r\n      case \"pointerend\":\r\n        this.endPointer(evt);\r\n      break;\r\n      case \"gazecomplete\":\r\n        this.startUV();\r\n        setTimeout(() => this.endPointer(evt), 100);\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\npliny.record({\r\n  parent: \"Primrose.Controls.Button3D\",\r\n  name: \"DEFAULTS\",\r\n  description: \"Default option values that override undefined options passed to the Button3D class.\"\r\n});\r\npliny.value({\r\n  parent: \"Primrose.Controls.Button3D.DEFAULTS\",\r\n  name: \"maxThrow\",\r\n  type: \"Number\",\r\n  description: \"The limit for how far the button can be depressed.\"\r\n});\r\npliny.value({\r\n  parent: \"Primrose.Controls.Button3D.DEFAULTS\",\r\n  name: \"minDeflection\",\r\n  type: \"Number\",\r\n  description: \"The minimum distance the button must be depressed before it is activated.\"\r\n});\r\npliny.value({\r\n  parent: \"Primrose.Controls.Button3D.DEFAULTS\",\r\n  name: \"colorUnpressed\",\r\n  type: \"Number\",\r\n  description: \"The color to change the button cap to when the button is deactivated.\"\r\n});\r\npliny.value({\r\n  parent: \"Primrose.Controls.Button3D.DEFAULTS\",\r\n  name: \"colorPressed\",\r\n  type: \"Number\",\r\n  description: \"The color to change the button cap to when the button is activated.\"\r\n});\r\npliny.value({\r\n  parent: \"Primrose.Controls.Button3D.DEFAULTS\",\r\n  name: \"toggle\",\r\n  type: \"Boolean\",\r\n  description: \"True if deactivating the button should require a second click. False if the button should deactivate when it is released.\"\r\n});\r\nButton3D.DEFAULTS = {\r\n  maxThrow: 0.1,\r\n  minDeflection: 10,\r\n  colorUnpressed: 0x7f0000,\r\n  colorPressed: 0x007f00,\r\n  toggle: true\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"ButtonFactory\",\r\n  description: \"Loads a model file and holds the data, creating clones of the data whenever a new button is desired.\",\r\n  parameters: [{\r\n    name: \"template\",\r\n    type: \"THREE.Object3D\",\r\n    description: \"A THREE.Object3D that specifies a 3D model for a button, to be used as a template.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"The options to apply to all buttons that get created by the factory.\"\r\n  }, {\r\n    name: \"complete\",\r\n    type: \"Function\",\r\n    description: \"A callback function to indicate when the loading process has completed, if `templateFile` was a String path.\"\r\n  }]\r\n});\r\n\r\nvar buttonCount = 0;\r\n\r\nimport Button3D from \"./Button3D\";\r\nimport colored from \"../../live-api/colored\";\r\nimport box from \"../../live-api/box\";\r\nexport default class ButtonFactory {\r\n\r\n  constructor(templateFile, options) {\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"options\",\r\n      type: \"Object\",\r\n      description: \"The options that the user provided, so that we might change them after the factory has been created, if we so choose.\"\r\n    });\r\n    this.options = options;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Controls.Button3D\",\r\n      name: \"template\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"The 3D model for the button, that will be cloned every time a new button is created.\"\r\n    });\r\n    this.template = templateFile;\r\n  }\r\n\r\n  create(toggle) {\r\n    pliny.method({\r\n      parent: \"Primrose.ButtonFactory\",\r\n      name: \"create\",\r\n      description: \"Clones all of the geometry, materials, etc. in a 3D model to create a new copy of it. This really should be done with instanced objects, but I just don't have the time to deal with it right now.\",\r\n      parameters: [{\r\n        name: \"toggle\",\r\n        type: \"Boolean\",\r\n        description: \"True if the new button should be a toggle button (requiring additional clicks to deactivate) or a regular button (deactivating when the button is released, aka \\\"momentary\\\".\"\r\n      }],\r\n      return: \"The cloned button that which we so desired.\"\r\n    });\r\n\r\n    var name = \"button\" + (++buttonCount);\r\n    var obj = this.template.clone();\r\n    var btn = new Button3D(obj, name, this.options, toggle);\r\n    return btn;\r\n  }\r\n\r\n}\r\n\r\nButtonFactory.DEFAULT = new ButtonFactory(\r\n  colored(box(1, 1, 1), 0xff0000), {\r\n    maxThrow: 0.1,\r\n    minDeflection: 10,\r\n    colorUnpressed: 0x7f0000,\r\n    colorPressed: 0x007f00,\r\n    toggle: true\r\n  });","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Image\",\r\n  baseClass: \"Primrose.Controls.BaseTextured\",\r\n  description: \"A simple 2D image to put on a Surface.\",\r\n  parameters: [{\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"Named parameters for creating the Image.\"\r\n  }]\r\n});\r\n\r\nlet COUNTER = 0;\r\n\r\nimport BaseTextured from \"./BaseTextured\";\r\nimport textured from \"../../live-api/textured\";\r\nexport default class Image extends BaseTextured {\r\n\r\n  constructor(images, options) {\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // normalize input parameters\r\n    ////////////////////////////////////////////////////////////////////////\r\n    if(!(images instanceof Array)) {\r\n      images = [images];\r\n    }\r\n\r\n    options = Object.assign({}, {\r\n      id: \"Primrose.Controls.Image[\" + (COUNTER++) + \"]\"\r\n    }, options);\r\n\r\n    super(images, options);\r\n  }\r\n\r\n  _loadFiles(images, progress) {\r\n    return Promise.all(Array.prototype.map.call(images, (src, i) => {\r\n      const loadOptions = Object.assign({}, this.options, {\r\n        progress: progress\r\n      });\r\n\r\n      this._meshes[i] = this._geometry.textured(src, loadOptions)\r\n        .named(this.name + \"-mesh-\" + i);\r\n\r\n      return loadOptions.promise.then((txt) => this._textures[i] = txt);\r\n    }));\r\n  }\r\n}","pliny.class({\r\n  parent: \"Primrose\",\r\n    name: \"ModelFactory\",\r\n    description: \"Creates an interface for cloning 3D models loaded from files, to instance those objects.\\n\\\r\n\\n\\\r\n> NOTE: You don't instantiate this class directly. Call `ModelFactory.loadModel`.\",\r\n    parameters: [{\r\n      name: \"template\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"The 3D model to make clonable.\"\r\n    }],\r\n    examples: [{\r\n      name: \"Load a basic model.\",\r\n      description: \"When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.Controls.ModelFactory object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  // Create the scene where objects will go\\n\\\r\n  var scene = new THREE.Scene(),\\n\\\r\n   \\n\\\r\n  // Load up the file, optionally \\\"check it out\\\"\\n\\\r\n    modelFactory = new Primrose.loadModel(\\\"path/to/model.json\\\", console.log.bind(console, \\\"Progress:\\\"))\\n\\\r\n    .then(function(model){\\n\\\r\n      model.template.traverse(function(child){\\n\\\r\n        // Do whatever you want to the individual child objects of the scene.\\n\\\r\n      });\\n\\\r\n   \\n\\\r\n    // Add copies of the model to the scene every time the user hits the ENTER key.\\n\\\r\n    window.addEventListener(\\\"keyup\\\", function(evt){\\n\\\r\n      // If the template object exists, then the model loaded successfully.\\n\\\r\n      if(evt.keyCode === 10){\\n\\\r\n        scene.add(model.clone());\\n\\\r\n      }\\n\\\r\n    });\\n\\\r\n  })\\n\\\r\n  .catch(console.error.bind(console));\"\r\n    }]\r\n});\r\n\r\nimport { ObjectLoader, FontLoader, AnimationClip } from \"three\";\r\n\r\nimport { MTLLoader, OBJLoader } from \"../../THREE\"\r\n\r\n// The JSON format object loader is not always included in the Three.js distribution,\r\n// so we have to first check for it.\r\nvar loaders = null,\r\n  mime = {\r\n    \"text/prs.wavefront-obj\": \"obj\",\r\n    \"text/prs.wavefront-mtl\": \"mtl\"\r\n  },\r\n  PATH_PATTERN = /((?:https?:\\/\\/)?(?:[^/]+\\/)+)(\\w+)(\\.(?:\\w+))$/,\r\n  EXTENSION_PATTERN = /(\\.(?:\\w+))+$/,\r\n  NAME_PATTERN = /([^/]+)\\.\\w+$/;\r\n\r\nfunction loader(map, key) {\r\n  return (obj) => ModelFactory.loadObject(map[key])\r\n    .then((model) => {\r\n      obj[key] = model;\r\n      return obj;\r\n    });\r\n}\r\n\r\n// Sometimes, the properties that export out of Blender and into Three.js don't\r\n// come out correctly, so we need to do a correction.\r\nfunction fixJSONScene(json) {\r\n  json.traverse(function (obj) {\r\n    if (obj.geometry) {\r\n      obj.geometry.computeBoundingSphere();\r\n      obj.geometry.computeBoundingBox();\r\n    }\r\n  });\r\n  return json;\r\n}\r\n\r\nfunction fixOBJScene(group) {\r\n  if(group.type === \"Group\" && group.children.length === 1 && group.children[0].isMesh) {\r\n    return group.children[0];\r\n  }\r\n  return group;\r\n}\r\n\r\nvar propertyTests = {\r\n  isButton: function (obj) {\r\n    return obj.material && obj.material.name.match(/^button\\d+$/);\r\n  },\r\n  isSolid: function (obj) {\r\n    return !obj.name.match(/^(water|sky)/);\r\n  },\r\n  isGround: function (obj) {\r\n    return obj.material && obj.material.name && obj.material.name.match(/\\bground\\b/);\r\n  }\r\n}\r\n\r\nfunction setProperties(object) {\r\n  object.traverse(function (obj) {\r\n    if (obj.isMesh) {\r\n      for (var prop in propertyTests) {\r\n        obj[prop] = obj[prop] || propertyTests[prop](obj);\r\n      }\r\n    }\r\n  });\r\n  return object;\r\n}\r\n\r\nexport default class ModelFactory {\r\n\r\n  static loadModel(src, type, progress) {\r\n    return ModelFactory.loadObject(src, type, progress)\r\n      .then((scene) => {\r\n        while(scene && scene.type === \"Group\"){\r\n          scene = scene.children[0];\r\n        }\r\n        return new ModelFactory(scene);\r\n      });\r\n  }\r\n\r\n  static loadObject(src, type, progress) {\r\n\r\n    pliny.function({\r\n      parent: \"Primrose.Controls.ModelFactory\",\r\n      name: \"loadObject\",\r\n      description: \"Asynchronously loads a JSON, OBJ, or MTL file as a Three.js object. It processes the scene for attributes, creates new properties on the scene to give us\\n\\\r\n    faster access to some of the elements within it. It uses callbacks to tell you when loading progresses. It uses a Promise to tell you when it's complete, or when an error occurred.\\n\\\r\n    Useful for one-time use models.\",\r\n      returns: \"Promise\",\r\n      parameters: [{\r\n        name: \"src\",\r\n        type: \"String\",\r\n        description: \"The file from which to load.\"\r\n      }, {\r\n        name: \"type\",\r\n        type: \"String\",\r\n        optional: true,\r\n        description: \"The type of the file--JSON, FBX, OJB, or STL--if it can't be determined from the file extension.\"\r\n      }, {\r\n        name: \"progress\",\r\n        type: \"Function\",\r\n        optional: true,\r\n        description: \"A callback function to use for tracking progress. The callback function should accept a standard [`ProgressEvent`](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent).\"\r\n      }],\r\n      examples: [{\r\n        name: \"Load a basic model.\",\r\n        description: \"When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.Controls.ModelFactory object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\\n\\\r\n    \\n\\\r\n    ## Code:\\n\\\r\n    \\n\\\r\n      grammar(\\\"JavaScript\\\");\\n\\\r\n      // Create the scene where objects will go\\n\\\r\n      var renderer = new THREE.WebGLRenderer(),\\n\\\r\n          currentScene = new THREE.Scene(),\\n\\\r\n          camera = new THREE.PerspectiveCamera();\\n\\\r\n       \\n\\\r\n      // Load up the file\\n\\\r\n      Primrose.Controls.ModelFactory.loadObject(\\n\\\r\n        \\\"path/to/model.json\\\",\\n\\\r\n        null,\\n\\\r\n        console.log.bind(console, \\\"Progress:\\\"))\\n\\\r\n        .then(scene.add.bind(scene))\\n\\\r\n        .catch(console.error.bind(console));\\n\\\r\n       \\n\\\r\n      function paint(t){\\n\\\r\n        requestAnimationFrame(paint);\\n\\\r\n        renderer.render(scene, camera);\\n\\\r\n      }\\n\\\r\n       \\n\\\r\n      requestAnimationFrame(paint);\"\r\n      }]\r\n    });\r\n\r\n    var extMatch = src.match(EXTENSION_PATTERN),\r\n      extension = type && (\".\" + type) || extMatch[0];\r\n    if (!extension) {\r\n      return Promise.reject(\"File path `\" + src + \"` does not have a file extension, and a type was not provided as a parameter, so we can't determine the type.\");\r\n    }\r\n    else {\r\n      extension = extension.toLowerCase();\r\n      if(loaders === null){\r\n        loaders = {\r\n          \".json\": ObjectLoader,\r\n          \".mtl\": MTLLoader,\r\n          \".obj\": OBJLoader,\r\n          \".typeface.json\": FontLoader\r\n        }\r\n      }\r\n      var LoaderType = loaders[extension];\r\n      if (!LoaderType) {\r\n        return Promise.reject(\"There is no loader type for the file extension: \" + extension);\r\n      }\r\n      else {\r\n        var loader = new LoaderType(),\r\n          name = src.substring(0, extMatch.index),\r\n          elemID = name + \"_\" + extension.toLowerCase(),\r\n          elem = document.getElementById(elemID),\r\n          promise = Promise.resolve();\r\n        if (extension === \".obj\") {\r\n          var newPath = src.replace(EXTENSION_PATTERN, \".mtl\");\r\n          promise = promise\r\n            .then(() => ModelFactory.loadObject(newPath, \"mtl\", progress))\r\n            .then((materials) => {\r\n              materials.preload();\r\n              loader.setMaterials(materials);\r\n            })\r\n            .catch(console.error.bind(console, \"Error loading MTL file: \" + newPath));\r\n        }\r\n        else if (extension === \".mtl\") {\r\n          var match = src.match(PATH_PATTERN);\r\n          if(match) {\r\n            var dir = match[1];\r\n            src = match[2] + match[3];\r\n            loader.setTexturePath(dir);\r\n            loader.setPath(dir);\r\n          }\r\n        }\r\n\r\n        if (elem) {\r\n          var elemSource = elem.innerHTML\r\n            .split(/\\r?\\n/g)\r\n            .map((s) => s.trim())\r\n            .join(\"\\n\");\r\n          promise = promise.then(() => loader.parse(elemSource));\r\n        }\r\n        else {\r\n          if (loader.setCrossOrigin) {\r\n            loader.setCrossOrigin(\"anonymous\");\r\n          }\r\n          promise = promise.then(() => new Promise((resolve, reject) => loader.load(src, resolve, progress, reject)));\r\n        }\r\n\r\n        if (extension === \".obj\") {\r\n          promise = promise.then(fixOBJScene);\r\n        }\r\n\r\n        if (extension === \".json\") {\r\n          promise = promise.then(fixJSONScene);\r\n        }\r\n\r\n        if (extension !== \".mtl\" && extension !== \".typeface.json\") {\r\n          promise = promise.then(setProperties);\r\n        }\r\n        promise = promise.catch(console.error.bind(console, \"MODEL_ERR\", src));\r\n        return promise;\r\n      }\r\n    }\r\n  }\r\n\r\n  static loadObjects(map) {\r\n\r\n    pliny.function({\r\n      parent: \"Primrose.Controls.ModelFactory\",\r\n      name: \"loadObjects\",\r\n      description: \"Asynchronously loads an array of JSON, OBJ, or MTL file as a Three.js object. It processes the objects for attributes, creating new properties on each object to give us\\n\\\r\n    faster access to some of the elements within it. It uses callbacks to tell you when loading progresses. It uses a Promise to tell you when it's complete, or when an error occurred.\\n\\\r\n    Useful for static models.\\n\\\r\n    \\n\\\r\n    See [`Primrose.Controls.ModelFactory.loadObject()`](#Primrose_Controls_ModelFactory_loadObject) for more details on how individual models are loaded.\",\r\n      returns: \"Promise\",\r\n      parameters: [{\r\n        name: \"arr\",\r\n        type: \"Array\",\r\n        description: \"The files from which to load.\"\r\n      }, {\r\n        name: \"type\",\r\n        type: \"String\",\r\n        optional: true,\r\n        description: \"The type of the file--JSON, FBX, OJB, or STL--if it can't be determined from the file extension.\"\r\n      }, {\r\n        name: \"progress\",\r\n        type: \"Function\",\r\n        optional: true,\r\n        description: \"A callback function to use for tracking progress. The callback function should accept a standard [`ProgressEvent`](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent).\"\r\n      }],\r\n      examples: [{\r\n        name: \"Load some models.\",\r\n        description: \"When Blender exports models, they are frequently treated as full scenes, essentially making them scene-graph sub-trees.\\n\\\r\n    We can load a bunch of models in one go using the following code.\\n\\\r\n    \\n\\\r\n    ## Code:\\n\\\r\n    \\n\\\r\n      grammar(\\\"JavaScript\\\");\\n\\\r\n      // Create the scene where objects will go\\n\\\r\n      var renderer = new THREE.WebGLRenderer(),\\n\\\r\n          currentScene = new THREE.Scene(),\\n\\\r\n          camera = new THREE.PerspectiveCamera(),\\n\\\r\n          allModels = null;\\n\\\r\n       \\n\\\r\n      // Load up the file\\n\\\r\n      Primrose.Controls.ModelFactory.loadObjects(\\n\\\r\n        [\\\"path/to/model1.json\\\",\\n\\\r\n          \\\"path/to/model2.obj\\\",\\n\\\r\n          \\\"path/to/model3.obj\\\",\\n\\\r\n          \\\"path/to/model4.fbx\\\"],\\n\\\r\n        console.log.bind(console, \\\"Progress:\\\"))\\n\\\r\n        .then(function(models){\\n\\\r\n          allModels = models;\\n\\\r\n          models.forEach(function(model){\\n\\\r\n            scene.add(model);\\n\\\r\n          });\\n\\\r\n        })\\n\\\r\n        .catch(console.error.bind(console));\\n\\\r\n       \\n\\\r\n      function paint(t){\\n\\\r\n        requestAnimationFrame(paint);\\n\\\r\n        \\n\\\r\n        if(allModels){\\n\\\r\n          // do whatever updating you want on the models\\n\\\r\n        }\\n\\\r\n        \\n\\\r\n        renderer.render(scene, camera);\\n\\\r\n      }\\n\\\r\n      \\n\\\r\n      requestAnimationFrame(paint);\"\r\n      }]\r\n    });\r\n\r\n    var output = {},\r\n      promise = Promise.resolve(output);\r\n    for (var key in map) {\r\n      if (map[key]) {\r\n        promise = promise.then(loader(map, key));\r\n      }\r\n    }\r\n    return promise;\r\n  }\r\n\r\n  constructor(template) {\r\n    pliny.property({\r\n      parent: \"Primrose.Graphics.ModelFactory\",\r\n      name: \"template\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"When a model is loaded, stores a reference to the model so it can be cloned in the future.\"\r\n    });\r\n    this.template = template;\r\n  }\r\n\r\n  clone() {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Controls.ModelFactory\",\r\n      name: \"clone\",\r\n      description: \"Creates a copy of the stored template model.\",\r\n      returns: \"A THREE.Object3D that is a copy of the stored template.\",\r\n      examples: [{\r\n        name: \"Load a basic model.\",\r\n        description: \"When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.Controls.ModelFactory object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\\n\\\r\n    \\n\\\r\n    ## Code:\\n\\\r\n    \\n\\\r\n      grammar(\\\"JavaScript\\\");\\n\\\r\n      // Create the scene where objects will go\\n\\\r\n      var scene = new THREE.Scene(),\\n\\\r\n      \\n\\\r\n      // Load up the file, optionally \\\"check it out\\\"\\n\\\r\n        modelFactory = new Primrose.Controls.ModelFactory(\\\"path/to/model.json\\\", function(model){\\n\\\r\n          model.traverse(function(child){\\n\\\r\n            // Do whatever you want to the individual child objects of the scene.\\n\\\r\n          });\\n\\\r\n      }, console.error.bind(console), console.log.bind(console, \\\"Progress:\\\"));\\n\\\r\n      \\n\\\r\n      // Add copies of the model to the scene every time the user hits the ENTER key.\\n\\\r\n      window.addEventListener(\\\"keyup\\\", function(evt){\\n\\\r\n        // If the template object exists, then the model loaded successfully.\\n\\\r\n        if(modelFactory.template && evt.keyCode === 10){\\n\\\r\n          scene.add(modelFactory.clone());\\n\\\r\n        }\\n\\\r\n      });\"\r\n      }]\r\n    });\r\n    var obj = this.template.clone();\r\n\r\n    obj.traverse((child) => {\r\n      if (child.isSkinnedMesh) {\r\n        obj.animation = new AnimationClip(child, child.geometry.animation);\r\n        if (!this.template.originalAnimationClipData && obj.animation.data) {\r\n          this.template.originalAnimationClipData = obj.animation.data;\r\n        }\r\n        if (!obj.animation.data) {\r\n          obj.animation.data = this.template.originalAnimationClipData;\r\n        }\r\n      }\r\n    });\r\n\r\n    setProperties(obj);\r\n    return obj;\r\n  }\r\n\r\n}\r\n","import quad from \"../../live-api/quad\";\r\nimport Entity from \"./Entity\";\r\nimport Image from \"./Image\";\r\nimport Pointer from \"../Pointer\";\r\nimport ModelFactory from \"../Graphics/ModelFactory\";\r\n\r\nimport { Raycaster, Vector3 } from \"three\";\r\n\r\nconst heightTester = new Raycaster();\r\n\r\nheightTester.ray.direction.set(0, -1, 0);\r\n\r\nexport default class Ground extends Entity {\r\n\r\n  constructor(options) {\r\n    super(\"Ground\", {\r\n      transparent: false,\r\n      dim: options.drawDistance,\r\n      texture: options.groundTexture,\r\n      model: options.groundModel,\r\n      shadow: options.enableShadows,\r\n      progress: options.progress\r\n    });\r\n  }\r\n\r\n  get _ready() {\r\n    const dim = this.options.dim,\r\n      type = typeof  this.options.texture;\r\n\r\n    let promise = null;\r\n\r\n    this.model = null;\r\n    this.isInfinite = null;\r\n\r\n    if(this.options.model) {\r\n      promise = ModelFactory.loadObject(this.options.model)\r\n        .then((model) => {\r\n          this.model = model;\r\n          this.isInfinite = false;\r\n        });\r\n    }\r\n    else {\r\n      if(type === \"number\") {\r\n        this.model = quad(dim, dim)\r\n          .colored(this.options.texture, this.options)\r\n          .rot(-Math.PI / 2, 0, 0);\r\n        promise = Promise.resolve();\r\n      }\r\n      else if(type === \"string\") {\r\n        this.model = new Image(this.options.texture, Object.assign({}, this.options, {\r\n          width: dim,\r\n          height: dim,\r\n          txtRepeatX: dim,\r\n          txtRepeatY: dim,\r\n          anisotropy: 8\r\n        })).rot(-Math.PI / 2, 0, 0);\r\n\r\n        promise = this.model.ready;\r\n      }\r\n\r\n      if(promise) {\r\n        this.isInfinite = true;\r\n      }\r\n      else{\r\n        promise = Promise.reject(\"Couldn't figure out how to make the ground out of \" + this.options.texture);\r\n      }\r\n    }\r\n\r\n    promise = promise.then(() => {\r\n      this.model.receiveShadow = this.options.shadow;\r\n      this.model\r\n        .named(this.name + \"-\" + (this.options.model || this.options.texture))\r\n        .addTo(this);\r\n\r\n      this.watch(this.model, Pointer.EVENTS);\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  moveTo(pos) {\r\n    if(this.isInfinite) {\r\n      this.position.set(\r\n        Math.floor(pos.x),\r\n        0,\r\n        Math.floor(pos.z))\r\n    }\r\n  }\r\n\r\n  getHeightAt(pos) {\r\n    if(this.model) {\r\n      heightTester.ray.origin.copy(pos);\r\n      heightTester.ray.origin.y = 100;\r\n      const hits = heightTester.intersectObject(this.model);\r\n      if(hits.length > 0) {\r\n        const hit = hits[0];\r\n        return 100 - hit.distance;\r\n      }\r\n    }\r\n  }\r\n};\r\n","import quad from \"../../live-api/quad\";\r\nimport box from \"../../live-api/box\";\r\nimport isMobile from \"../../flags/isMobile\";\r\nimport Entity from \"./Entity\";\r\nimport Image from \"./Image\";\r\n\r\nimport { DirectionalLight } from \"three\";\r\n\r\nimport { AmbientLight, BackSide } from \"three\";\r\n\r\nexport default class Sky extends Entity {\r\n\r\n  constructor(options) {\r\n    super(\"Sky\", {\r\n      transparent: false,\r\n      useFog: false,\r\n      unshaded: true,\r\n      skyRadius: options.drawDistance,\r\n      texture: options.skyTexture,\r\n      progress: options.progress,\r\n      enableShadows: options.enableShadows,\r\n      shadowMapSize: options.shadowMapSize,\r\n      shadowCameraSize: options.shadowCameraSize,\r\n      shadowRadius: options.shadowRadius\r\n    });\r\n\r\n    this._image = null;\r\n\r\n    if(options.disableDefaultLighting) {\r\n      this.ambient = null;\r\n      this.sun = null;\r\n    }\r\n    else{\r\n\r\n      pliny.property({\r\n        parent: \"Primrose.Controls.Sky\",\r\n        name: \"ambient\",\r\n        type: \"THREE.AmbientLight\",\r\n        description: \"If the `disableDefaultLighting` option is not present, the ambient light provides a fill light so that dark shadows do not completely obscure object details.\"\r\n      });\r\n      this.ambient = new AmbientLight(0xffffff, 0.5)\r\n        .addTo(this);\r\n\r\n      pliny.property({\r\n        parent: \"Primrose.Controls.Sky\",\r\n        name: \"sun\",\r\n        type: \"THREE.PointLight\",\r\n        description: \"If the `disableDefaultLighting` option is not present, the sun light provides a key light so that objects have shading and relief.\"\r\n      });\r\n      this.sun = new DirectionalLight(0xffffff, 1)\r\n        .addTo(this)\r\n        .at(0, 100, 100);\r\n\r\n      this.add(this.sun.target);\r\n\r\n      if(this.options.enableShadows) {\r\n        this.sun.castShadow = true;\r\n        this.sun.shadow.mapSize.width =\r\n        this.sun.shadow.mapSize.height = this.options.shadowMapSize;\r\n        this.sun.shadow.radius = this.options.shadowRadius;\r\n        this.sun.shadow.camera.top = this.sun.shadow.camera.right = this.options.shadowCameraSize;\r\n        this.sun.shadow.camera.bottom = this.sun.shadow.camera.left = -this.options.shadowCameraSize;\r\n        this.sun.shadow.camera.updateProjectionMatrix();\r\n      }\r\n    }\r\n  }\r\n\r\n  replace(files){\r\n    this.options.texture = files;\r\n    this.children.splice(0);\r\n    return this._ready;\r\n  }\r\n\r\n  get _ready() {\r\n    const type = typeof  this.options.texture;\r\n    if(type === \"number\") {\r\n      const skyDim = this.options.skyRadius / Math.sqrt(2);\r\n      this.options.side = BackSide;\r\n      this.add(box(skyDim, skyDim, skyDim)\r\n        .colored(this.options.texture, this.options));\r\n    }\r\n    else if(type === \"string\" || (this.options.texture instanceof Array && this.options.texture.length === 6 && typeof this.options.texture[0] === \"string\")) {\r\n      this._image = new Image(this.options.texture, this.options);\r\n      this.add(this._image);\r\n    }\r\n\r\n    return this._image && this._image.ready || super._ready;\r\n  }\r\n\r\n\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Cursor\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\n// unicode-aware string reverse\r\nvar reverse = (function () {\r\n  var combiningMarks =\r\n    /(<%= allExceptCombiningMarks %>)(<%= combiningMarks %>+)/g,\r\n    surrogatePair = /(<%= highSurrogates %>)(<%= lowSurrogates %>)/g;\r\n\r\n  function reverse(str) {\r\n    str = str.replace(combiningMarks, function (match, capture1,\r\n        capture2) {\r\n        return reverse(capture2) + capture1;\r\n      })\r\n      .replace(surrogatePair, \"$2$1\");\r\n    var res = \"\";\r\n    for (var i = str.length - 1; i >= 0; --i) {\r\n      res += str[i];\r\n    }\r\n    return res;\r\n  }\r\n  return reverse;\r\n})();\r\n\r\nexport default class Cursor {\r\n\r\n  static min(a, b) {\r\n    if (a.i <= b.i) {\r\n      return a;\r\n    }\r\n    return b;\r\n  }\r\n\r\n  static max(a, b) {\r\n    if (a.i > b.i) {\r\n      return a;\r\n    }\r\n    return b;\r\n  }\r\n\r\n  constructor(i, x, y) {\r\n    this.i = i || 0;\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.moved = true;\r\n  }\r\n\r\n  clone() {\r\n    return new Cursor(this.i, this.x, this.y);\r\n  }\r\n\r\n  toString() {\r\n    return \"[i:\" + this.i + \" x:\" + this.x + \" y:\" + this.y + \"]\";\r\n  }\r\n\r\n  copy(cursor) {\r\n    this.i = cursor.i;\r\n    this.x = cursor.x;\r\n    this.y = cursor.y;\r\n    this.moved = false;\r\n  }\r\n\r\n  fullhome() {\r\n    this.i = 0;\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.moved = true;\r\n  }\r\n\r\n  fullend(lines) {\r\n    this.i = 0;\r\n    var lastLength = 0;\r\n    for (var y = 0; y < lines.length; ++y) {\r\n      var line = lines[y];\r\n      lastLength = line.length;\r\n      this.i += lastLength;\r\n    }\r\n    this.y = lines.length - 1;\r\n    this.x = lastLength;\r\n    this.moved = true;\r\n  }\r\n\r\n  skipleft(lines) {\r\n    if (this.x === 0) {\r\n      this.left(lines);\r\n    }\r\n    else {\r\n      var x = this.x - 1;\r\n      var line = lines[this.y];\r\n      var word = reverse(line.substring(0, x));\r\n      var m = word.match(/(\\s|\\W)+/);\r\n      var dx = m ? (m.index + m[0].length + 1) : word.length;\r\n      this.i -= dx;\r\n      this.x -= dx;\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  left(lines) {\r\n    if (this.i > 0) {\r\n      --this.i;\r\n      --this.x;\r\n      if (this.x < 0) {\r\n        --this.y;\r\n        var line = lines[this.y];\r\n        this.x = line.length;\r\n      }\r\n      if (this.reverseFromNewline(lines)) {\r\n        ++this.i;\r\n      }\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  skipright(lines) {\r\n    var line = lines[this.y];\r\n    if (this.x === line.length || line[this.x] === '\\n') {\r\n      this.right(lines);\r\n    }\r\n    else {\r\n      var x = this.x + 1;\r\n      line = line.substring(x);\r\n      var m = line.match(/(\\s|\\W)+/);\r\n      var dx = m ? (m.index + m[0].length + 1) : (line.length - this.x);\r\n      this.i += dx;\r\n      this.x += dx;\r\n      this.reverseFromNewline(lines);\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  fixCursor(lines) {\r\n    this.x = this.i;\r\n    this.y = 0;\r\n    var total = 0;\r\n    var line = lines[this.y];\r\n    while (this.x > line.length) {\r\n      this.x -= line.length;\r\n      total += line.length;\r\n      if (this.y >= lines.length - 1) {\r\n        this.i = total;\r\n        this.x = line.length;\r\n        this.moved = true;\r\n        break;\r\n      }\r\n      ++this.y;\r\n      line = lines[this.y];\r\n    }\r\n    return this.moved;\r\n  }\r\n\r\n  right(lines) {\r\n    this.advanceN(lines, 1);\r\n  }\r\n\r\n  advanceN(lines, n) {\r\n    var line = lines[this.y];\r\n    if (this.y < lines.length - 1 || this.x < line.length) {\r\n      this.i += n;\r\n      this.fixCursor(lines);\r\n      line = lines[this.y];\r\n      if (this.x > 0 && line[this.x - 1] === '\\n') {\r\n        ++this.y;\r\n        this.x = 0;\r\n      }\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  home() {\r\n    this.i -= this.x;\r\n    this.x = 0;\r\n    this.moved = true;\r\n  }\r\n\r\n  end(lines) {\r\n    var line = lines[this.y];\r\n    var dx = line.length - this.x;\r\n    this.i += dx;\r\n    this.x += dx;\r\n    this.reverseFromNewline(lines);\r\n    this.moved = true;\r\n  }\r\n\r\n  up(lines) {\r\n    if (this.y > 0) {\r\n      --this.y;\r\n      var line = lines[this.y];\r\n      var dx = Math.min(0, line.length - this.x);\r\n      this.x += dx;\r\n      this.i -= line.length - dx;\r\n      this.reverseFromNewline(lines);\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  down(lines) {\r\n    if (this.y < lines.length - 1) {\r\n      ++this.y;\r\n      var line = lines[this.y];\r\n      var pLine = lines[this.y - 1];\r\n      var dx = Math.min(0, line.length - this.x);\r\n      this.x += dx;\r\n      this.i += pLine.length + dx;\r\n      this.reverseFromNewline(lines);\r\n    }\r\n    this.moved = true;\r\n  }\r\n\r\n  incY(dy, lines) {\r\n    this.y = Math.max(0, Math.min(lines.length - 1, this.y + dy));\r\n    var line = lines[this.y];\r\n    this.x = Math.max(0, Math.min(line.length, this.x));\r\n    this.i = this.x;\r\n    for (var i = 0; i < this.y; ++i) {\r\n      this.i += lines[i].length;\r\n    }\r\n    this.reverseFromNewline(lines);\r\n    this.moved = true;\r\n  }\r\n\r\n  setXY(x, y, lines) {\r\n    this.y = Math.max(0, Math.min(lines.length - 1, y));\r\n    var line = lines[this.y];\r\n    this.x = Math.max(0, Math.min(line.length, x));\r\n    this.i = this.x;\r\n    for (var i = 0; i < this.y; ++i) {\r\n      this.i += lines[i].length;\r\n    }\r\n    this.reverseFromNewline(lines);\r\n    this.moved = true;\r\n  }\r\n\r\n  setI(i, lines) {\r\n    this.i = i;\r\n    this.fixCursor(lines);\r\n    this.moved = true;\r\n  }\r\n\r\n  reverseFromNewline(lines) {\r\n    var line = lines[this.y];\r\n    if (this.x > 0 && line[this.x - 1] === '\\n') {\r\n      --this.x;\r\n      --this.i;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"CommandPack\",\r\n    description: \"A CommandPack is a collection of key sequences and text editor commands. It provides a means of using a single text rendering control to create a variety of text-controls that utilize the text space differently.\",\r\n    parameters: [{\r\n      name: \"commandPackName\",\r\n      type: \"String\",\r\n      description: \"A friendly name for the command pack.\"\r\n    }, {\r\n      name: \"commands\",\r\n      type: \"Object\",\r\n      description: \"An object literal of key-value pairs describing the commands.\\n\\\r\n\\n\\\r\n* The object key elements are strings describing the key sequence that activates the command.\\n\\\r\n* The value elements are the action that occurs when the command is activated.\"\r\n    }]\r\n});\r\nexport default class CommandPack {\r\n  constructor (commandPackName, commands) {\r\n    this.name = commandPackName;\r\n    Object.assign(this, commands);\r\n  }\r\n};","pliny.record({\r\n  parent: \"Primrose.Text.CommandPacks\",\r\n  name: \"BasicTextInput\",\r\n  baseClass: \"Primrose.Text.CommandPacks.CommandPack\",\r\n  description: \"A set of commands for editing a single line of text in a text editor. This is the same set of commands for both single-line text elements and multi-line text elements.\"\r\n});\r\n\r\nimport CommandPack from \"./CommandPack\";\r\nexport default class BasicTextInput extends CommandPack {\r\n  constructor(additionalName, additionalCommands) {\r\n    var commands = {\r\n      NORMAL_LEFTARROW: function (prim, tokenRows) {\r\n        prim.cursorLeft(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_SKIPLEFT: function (prim, tokenRows) {\r\n        prim.cursorSkipLeft(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_RIGHTARROW: function (prim, tokenRows) {\r\n        prim.cursorRight(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_SKIPRIGHT: function (prim, tokenRows) {\r\n        prim.cursorSkipRight(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_HOME: function (prim, tokenRows) {\r\n        prim.cursorHome(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_END: function (prim, tokenRows) {\r\n        prim.cursorEnd(tokenRows, prim.frontCursor);\r\n      },\r\n      NORMAL_BACKSPACE: function (prim, tokenRows) {\r\n        if (prim.frontCursor.i === prim.backCursor.i) {\r\n          prim.frontCursor.left(tokenRows);\r\n        }\r\n        prim.selectedText = \"\";\r\n        prim.scrollIntoView(prim.frontCursor);\r\n      },\r\n      NORMAL_ENTER: function (prim, tokenRows, currentToken) {\r\n        prim.emit(\"change\", {\r\n          target: prim\r\n        });\r\n      },\r\n      NORMAL_DELETE: function (prim, tokenRows) {\r\n        if (prim.frontCursor.i === prim.backCursor.i) {\r\n          prim.backCursor.right(tokenRows);\r\n        }\r\n        prim.selectedText = \"\";\r\n        prim.scrollIntoView(prim.frontCursor);\r\n      },\r\n      NORMAL_TAB: function (prim, tokenRows) {\r\n        prim.selectedText = prim.tabString;\r\n      },\r\n\r\n      SHIFT_LEFTARROW: function (prim, tokenRows) {\r\n        prim.cursorLeft(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_SKIPLEFT: function (prim, tokenRows) {\r\n        prim.cursorSkipLeft(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_RIGHTARROW: function (prim, tokenRows) {\r\n        prim.cursorRight(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_SKIPRIGHT: function (prim, tokenRows) {\r\n        prim.cursorSkipRight(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_HOME: function (prim, tokenRows) {\r\n        prim.cursorHome(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_END: function (prim, tokenRows) {\r\n        prim.cursorEnd(tokenRows, prim.backCursor);\r\n      },\r\n      SHIFT_DELETE: function (prim, tokenRows) {\r\n        if (prim.frontCursor.i === prim.backCursor.i) {\r\n          prim.frontCursor.home(tokenRows);\r\n          prim.backCursor.end(tokenRows);\r\n        }\r\n        prim.selectedText = \"\";\r\n        prim.scrollIntoView(prim.frontCursor);\r\n      },\r\n      CTRL_HOME: function (prim, tokenRows) {\r\n        prim.cursorFullHome(tokenRows, prim.frontCursor);\r\n      },\r\n      CTRL_END: function (prim, tokenRows) {\r\n        prim.cursorFullEnd(tokenRows, prim.frontCursor);\r\n      },\r\n\r\n      CTRLSHIFT_HOME: function (prim, tokenRows) {\r\n        prim.cursorFullHome(tokenRows, prim.backCursor);\r\n      },\r\n      CTRLSHIFT_END: function (prim, tokenRows) {\r\n        prim.cursorFullEnd(tokenRows, prim.backCursor);\r\n      },\r\n\r\n      SELECT_ALL: function (prim, tokenRows) {\r\n        prim.frontCursor.fullhome(tokenRows);\r\n        prim.backCursor.fullend(tokenRows);\r\n      },\r\n\r\n      REDO: function (prim, tokenRows) {\r\n        prim.redo();\r\n        prim.scrollIntoView(prim.frontCursor);\r\n      },\r\n      UNDO: function (prim, tokenRows) {\r\n        prim.undo();\r\n        prim.scrollIntoView(prim.frontCursor);\r\n      }\r\n    };\r\n\r\n    if (additionalCommands) {\r\n      for (var key in additionalCommands) {\r\n        commands[key] = additionalCommands[key];\r\n      }\r\n    }\r\n\r\n    super(additionalName || \"Text editor commands\", commands);\r\n  }\r\n};","pliny.record({\r\n  parent: \"Primrose.Text.CommandPacks\",\r\n  name: \"TextEditor\",\r\n  description: \"A set of commands for a multi-line text editing, extending single-line text editing.\"\r\n});\r\n\r\nimport BasicTextInput from \"./BasicTextInput\";\r\nexport default new BasicTextInput(\r\n  \"Text Area input commands\", {\r\n    NORMAL_UPARROW: function (prim, tokenRows) {\r\n      prim.cursorUp(tokenRows, prim.frontCursor);\r\n    },\r\n    NORMAL_DOWNARROW: function (prim, tokenRows) {\r\n      prim.cursorDown(tokenRows, prim.frontCursor);\r\n    },\r\n    NORMAL_PAGEUP: function (prim, tokenRows) {\r\n      prim.cursorPageUp(tokenRows, prim.frontCursor);\r\n    },\r\n    NORMAL_PAGEDOWN: function (prim, tokenRows) {\r\n      prim.cursorPageDown(tokenRows, prim.frontCursor);\r\n    },\r\n    NORMAL_ENTER: function (prim, tokenRows, currentToken) {\r\n      var indent = \"\";\r\n      var tokenRow = tokenRows[prim.frontCursor.y];\r\n      if (tokenRow.length > 0 && tokenRow[0].type === \"whitespace\") {\r\n        indent = tokenRow[0].value;\r\n      }\r\n      prim.selectedText = \"\\n\" + indent;\r\n      prim.scrollIntoView(prim.frontCursor);\r\n    },\r\n\r\n    SHIFT_UPARROW: function (prim, tokenRows) {\r\n      prim.cursorUp(tokenRows, prim.backCursor);\r\n    },\r\n    SHIFT_DOWNARROW: function (prim, tokenRows) {\r\n      prim.cursorDown(tokenRows, prim.backCursor);\r\n    },\r\n    SHIFT_PAGEUP: function (prim, tokenRows) {\r\n      prim.cursorPageUp(tokenRows, prim.backCursor);\r\n    },\r\n    SHIFT_PAGEDOWN: function (prim, tokenRows) {\r\n      prim.cursorPageDown(tokenRows, prim.backCursor);\r\n    },\r\n\r\n    WINDOW_SCROLL_DOWN: function (prim, tokenRows) {\r\n      if (prim.scroll.y < tokenRows.length) {\r\n        ++prim.scroll.y;\r\n      }\r\n    },\r\n    WINDOW_SCROLL_UP: function (prim, tokenRows) {\r\n      if (prim.scroll.y > 0) {\r\n        --prim.scroll.y;\r\n      }\r\n    }\r\n  });","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Rule\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nexport default class Rule {\r\n  constructor (name, test) {\r\n    this.name = name;\r\n    this.test = test;\r\n  }\r\n\r\n  carveOutMatchedToken(tokens, j) {\r\n    var token = tokens[j];\r\n    if (token.type === \"regular\") {\r\n      var res = this.test.exec(token.value);\r\n      if (res) {\r\n        // Only use the last group that matches the regex, to allow for more\r\n        // complex regexes that can match in special contexts, but not make\r\n        // the context part of the token.\r\n        var midx = res[res.length - 1],\r\n          start = res.input.indexOf(midx),\r\n          end = start + midx.length;\r\n        if (start === 0) {\r\n          // the rule matches the start of the token\r\n          token.type = this.name;\r\n          if (end < token.value.length) {\r\n            // but not the end\r\n            var next = token.splitAt(end);\r\n            next.type = \"regular\";\r\n            tokens.splice(j + 1, 0, next);\r\n          }\r\n        }\r\n        else {\r\n          // the rule matches from the middle of the token\r\n          var mid = token.splitAt(start);\r\n          if (midx.length < mid.value.length) {\r\n            // but not the end\r\n            var right = mid.splitAt(midx.length);\r\n            tokens.splice(j + 1, 0, right);\r\n          }\r\n          mid.type = this.name;\r\n          tokens.splice(j + 1, 0, mid);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Token\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nexport default class Token {\r\n  constructor(value, type, index, line) {\r\n    this.value = value;\r\n    this.type = type;\r\n    this.index = index;\r\n    this.line = line;\r\n  }\r\n\r\n  clone() {\r\n    return new Token(this.value, this.type, this.index, this.line);\r\n  }\r\n\r\n  splitAt(i) {\r\n    var next = this.value.substring(i);\r\n    this.value = this.value.substring(0, i);\r\n    return new Token(next, this.type, this.index + i, this.line);\r\n  }\r\n\r\n  toString() {\r\n    return \"[\" + this.type + \": \" + this.value + \"]\";\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Grammar\",\r\n    parameters: [{\r\n      name: \"grammarName\",\r\n      type: \"String\",\r\n      description: \"A user-friendly name for the grammar, to be able to include it in an options listing.\"\r\n    }, {\r\n      name: \"rules\",\r\n      type: \"Array\",\r\n      description: \"A collection of rules to apply to tokenize text. The rules should be an array of two-element arrays. The first element should be a token name (see [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names), followed by a regular expression that selects the token out of the source code.\"\r\n    }],\r\n    description: \"A Grammar is a collection of rules for processing text into tokens. Tokens are special characters that tell us about the structure of the text, things like keywords, curly braces, numbers, etc. After the text is tokenized, the tokens get a rough processing pass that groups them into larger elements that can be rendered in color on the screen.\\n\\\r\n\\n\\\r\nAs tokens are discovered, they are removed from the text being processed, so order is important. Grammar rules are applied in the order they are specified, and more than one rule can produce the same token type.\\n\\\r\n\\n\\\r\nSee [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names.\",\r\n    examples: [{\r\n      name: \"A plain-text \\\"grammar\\\".\",\r\n      description: \"Plain text does not actually have a grammar that needs to be processed. However, to get the text to work with the rendering system, a basic grammar is necessary to be able to break the text up into lines and prepare it for rendering.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var plainTextGrammar = new Primrose.Text.Grammar(\\n\\\r\n    // The name is for displaying in options views.\\n\\\r\n    \\\"Plain-text\\\", [\\n\\\r\n    // Text needs at least the newlines token, or else every line will attempt to render as a single line and the line count won't work.\\n\\\r\n    [\\\"newlines\\\", /(?:\\\\r\\\\n|\\\\r|\\\\n)/] \\n\\\r\n  ] );\"\r\n    }, {\r\n      name: \"A grammar for BASIC\",\r\n      description: \"The BASIC programming language is now defunct, but a grammar for it to display in Primrose is quite easy to build.\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var basicGrammar = new Primrose.Text.Grammar( \\\"BASIC\\\",\\n\\\r\n    // Grammar rules are applied in the order they are specified.\\n\\\r\n    [\\n\\\r\n      // Text needs at least the newlines token, or else every line will attempt to render as a single line and the line count won't work.\\n\\\r\n      [ \\\"newlines\\\", /(?:\\\\r\\\\n|\\\\r|\\\\n)/ ],\\n\\\r\n      // BASIC programs used to require the programmer type in her own line numbers. The start at the beginning of the line.\\n\\\r\n      [ \\\"lineNumbers\\\", /^\\\\d+\\\\s+/ ],\\n\\\r\n      // Comments were lines that started with the keyword \\\"REM\\\" (for REMARK) and ran to the end of the line. They did not have to be numbered, because they were not executable and were stripped out by the interpreter.\\n\\\r\n      [ \\\"startLineComments\\\", /^REM\\\\s/ ],\\n\\\r\n      // Both double-quoted and single-quoted strings were not always supported, but in this case, I'm just demonstrating how it would be done for both.\\n\\\r\n      [ \\\"strings\\\", /\\\"(?:\\\\\\\\\\\"|[^\\\"])*\\\"/ ],\\n\\\r\n      [ \\\"strings\\\", /'(?:\\\\\\\\'|[^'])*'/ ],\\n\\\r\n      // Numbers are an optional dash, followed by a optional digits, followed by optional period, followed by 1 or more required digits. This allows us to match both integers and decimal numbers, both positive and negative, with or without leading zeroes for decimal numbers between (-1, 1).\\n\\\r\n      [ \\\"numbers\\\", /-?(?:(?:\\\\b\\\\d*)?\\\\.)?\\\\b\\\\d+\\\\b/ ],\\n\\\r\n      // Keywords are really just a list of different words we want to match, surrounded by the \\\"word boundary\\\" selector \\\"\\\\b\\\".\\n\\\r\n      [ \\\"keywords\\\",\\n\\\r\n        /\\\\b(?:RESTORE|REPEAT|RETURN|LOAD|LABEL|DATA|READ|THEN|ELSE|FOR|DIM|LET|IF|TO|STEP|NEXT|WHILE|WEND|UNTIL|GOTO|GOSUB|ON|TAB|AT|END|STOP|PRINT|INPUT|RND|INT|CLS|CLK|LEN)\\\\b/\\n\\\r\n      ],\\n\\\r\n      // Sometimes things we want to treat as keywords have different meanings in different locations. We can specify rules for tokens more than once.\\n\\\r\n      [ \\\"keywords\\\", /^DEF FN/ ],\\n\\\r\n      // These are all treated as mathematical operations.\\n\\\r\n      [ \\\"operators\\\",\\n\\\r\n        /(?:\\\\+|;|,|-|\\\\*\\\\*|\\\\*|\\\\/|>=|<=|=|<>|<|>|OR|AND|NOT|MOD|\\\\(|\\\\)|\\\\[|\\\\])/\\n\\\r\n      ],\\n\\\r\n      // Once everything else has been matched, the left over blocks of words are treated as variable and function names.\\n\\\r\n      [ \\\"identifiers\\\", /\\\\w+\\\\$?/ ]\\n\\\r\n    ] );\"\r\n    }]\r\n});\r\n\r\nimport Rule from \"../Rule\";\r\nimport Token from \"../Token\";\r\nimport DefaultTheme from \"../Themes/Default\";\r\nexport default class Grammar {\r\n  constructor(grammarName, rules) {\r\n    pliny.property({\r\n      parent: \"Primrose.Text.Grammar\",\r\n      name: \" name\",\r\n      type: \"String\",\r\n      description: \"A user-friendly name for the grammar, to be able to include it in an options listing.\"\r\n    });\r\n    this.name = grammarName;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Text.Grammar\",\r\n      name: \"grammar\",\r\n      type: \"Array\",\r\n      description: \"A collection of rules to apply to tokenize text. The rules should be an array of two-element arrays. The first element should be a token name (see [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names), followed by a regular expression that selects the token out of the source code.\"\r\n    });\r\n    // clone the preprocessing grammar to start a new grammar\r\n    this.grammar = rules.map(function (rule) {\r\n      return new Rule(rule[0], rule[1]);\r\n    });\r\n\r\n    function crudeParsing(tokens) {\r\n      var commentDelim = null,\r\n        stringDelim = null,\r\n        line = 0,\r\n        i, t;\r\n      for (i = 0; i < tokens.length; ++i) {\r\n        t = tokens[i];\r\n        t.line = line;\r\n        if (t.type === \"newlines\") {\r\n          ++line;\r\n        }\r\n\r\n        if (stringDelim) {\r\n          if (t.type === \"stringDelim\" && t.value === stringDelim && (i === 0 || tokens[i - 1].value[tokens[i - 1].value.length - 1] !== \"\\\\\")) {\r\n            stringDelim = null;\r\n          }\r\n          if (t.type !== \"newlines\") {\r\n            t.type = \"strings\";\r\n          }\r\n        }\r\n        else if (commentDelim) {\r\n          if (commentDelim === \"startBlockComments\" && t.type === \"endBlockComments\" ||\r\n            commentDelim === \"startLineComments\" && t.type === \"newlines\") {\r\n            commentDelim = null;\r\n          }\r\n          if (t.type !== \"newlines\") {\r\n            t.type = \"comments\";\r\n          }\r\n        }\r\n        else if (t.type === \"stringDelim\") {\r\n          stringDelim = t.value;\r\n          t.type = \"strings\";\r\n        }\r\n        else if (t.type === \"startBlockComments\" || t.type === \"startLineComments\") {\r\n          commentDelim = t.type;\r\n          t.type = \"comments\";\r\n        }\r\n      }\r\n\r\n      // recombine like-tokens\r\n      for (i = tokens.length - 1; i > 0; --i) {\r\n        var p = tokens[i - 1];\r\n        t = tokens[i];\r\n        if (p.type === t.type && p.type !== \"newlines\") {\r\n          p.value += t.value;\r\n          tokens.splice(i, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Text.Grammar\",\r\n      name: \"tokenize\",\r\n      parameters: [{\r\n        name: \"text\",\r\n        type: \"String\",\r\n        description: \"The text to tokenize.\"\r\n      }],\r\n      returns: \"An array of tokens, ammounting to drawing instructions to the renderer. However, they still need to be layed out to fit the bounds of the text area.\",\r\n      description: \"Breaks plain text up into a list of tokens that can later be rendered with color.\",\r\n      examples: [{\r\n        name: 'Tokenize some JavaScript',\r\n        description: 'Primrose comes with a grammar for JavaScript built in.\\n\\\r\n  \\n\\\r\n  ## Code:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    var tokens = new Primrose.Text.Grammars.JavaScript\\n\\\r\n      .tokenize(\"var x = 3;\\\\n\\\\\\n\\\r\n    var y = 2;\\\\n\\\\\\n\\\r\n    console.log(x + y);\");\\n\\\r\n    console.log(JSON.stringify(tokens));\\n\\\r\n  \\n\\\r\n  ## Result:\\n\\\r\n  \\n\\\r\n    grammar(\\\"JavaScript\\\");\\n\\\r\n    [ \\n\\\r\n      { \"value\": \"var\", \"type\": \"keywords\", \"index\": 0, \"line\": 0 },\\n\\\r\n      { \"value\": \" x = \", \"type\": \"regular\", \"index\": 3, \"line\": 0 },\\n\\\r\n      { \"value\": \"3\", \"type\": \"numbers\", \"index\": 8, \"line\": 0 },\\n\\\r\n      { \"value\": \";\", \"type\": \"regular\", \"index\": 9, \"line\": 0 },\\n\\\r\n      { \"value\": \"\\\\n\", \"type\": \"newlines\", \"index\": 10, \"line\": 0 },\\n\\\r\n      { \"value\": \" y = \", \"type\": \"regular\", \"index\": 11, \"line\": 1 },\\n\\\r\n      { \"value\": \"2\", \"type\": \"numbers\", \"index\": 16, \"line\": 1 },\\n\\\r\n      { \"value\": \";\", \"type\": \"regular\", \"index\": 17, \"line\": 1 },\\n\\\r\n      { \"value\": \"\\\\n\", \"type\": \"newlines\", \"index\": 18, \"line\": 1 },\\n\\\r\n      { \"value\": \"console\", \"type\": \"members\", \"index\": 19, \"line\": 2 },\\n\\\r\n      { \"value\": \".\", \"type\": \"regular\", \"index\": 26, \"line\": 2 },\\n\\\r\n      { \"value\": \"log\", \"type\": \"functions\", \"index\": 27, \"line\": 2 },\\n\\\r\n      { \"value\": \"(x + y);\", \"type\": \"regular\", \"index\": 30, \"line\": 2 }\\n\\\r\n    ]'\r\n      }]\r\n    });\r\n    this.tokenize = function (text) {\r\n      // all text starts off as regular text, then gets cut up into tokens of\r\n      // more specific type\r\n      var tokens = [new Token(text, \"regular\", 0)];\r\n      for (var i = 0; i < this.grammar.length; ++i) {\r\n        var rule = this.grammar[i];\r\n        for (var j = 0; j < tokens.length; ++j) {\r\n          rule.carveOutMatchedToken(tokens, j);\r\n        }\r\n      }\r\n\r\n      crudeParsing(tokens);\r\n      return tokens;\r\n    };\r\n  }\r\n\r\n  toHTML(txt, theme = DefaultTheme) {\r\n    var tokenRows = this.tokenize(txt),\r\n      temp = document.createElement(\"div\");\r\n    for (var y = 0; y < tokenRows.length; ++y) {\r\n      // draw the tokens on this row\r\n      var t = tokenRows[y];\r\n      if (t.type === \"newlines\") {\r\n        temp.appendChild(document.createElement(\"br\"));\r\n      }\r\n      else {\r\n        var style = theme[t.type] || {},\r\n          elem = document.createElement(\"span\");\r\n        elem.style.fontWeight = style.fontWeight || theme.regular.fontWeight;\r\n        elem.style.fontStyle = style.fontStyle || theme.regular.fontStyle || \"\";\r\n        elem.style.color = style.foreColor || theme.regular.foreColor;\r\n        elem.style.backgroundColor = style.backColor || theme.regular.backColor;\r\n        elem.style.fontFamily = style.fontFamily || theme.fontFamily;\r\n        elem.appendChild(document.createTextNode(t.value));\r\n        temp.appendChild(elem);\r\n      }\r\n    }\r\n    return temp.innerHTML;\r\n  }\r\n};","pliny.value({\r\n  parent: \"Primrose.Text.Grammars\",\r\n  name: \"JavaScript\",\r\n  description: \"A grammar for the JavaScript programming language.\"\r\n});\r\n\r\nimport Grammar from \"./Grammar\";\r\nexport default new Grammar(\"JavaScript\", [\r\n  [\"newlines\", /(?:\\r\\n|\\r|\\n)/],\r\n  [\"startBlockComments\", /\\/\\*/],\r\n  [\"endBlockComments\", /\\*\\//],\r\n  [\"regexes\", /(?:^|,|;|\\(|\\[|\\{)(?:\\s*)(\\/(?:\\\\\\/|[^\\n\\/])+\\/)/],\r\n  [\"stringDelim\", /(\"|')/],\r\n  [\"startLineComments\", /\\/\\/.*$/m],\r\n  [\"numbers\", /-?(?:(?:\\b\\d*)?\\.)?\\b\\d+\\b/],\r\n  [\"keywords\",\r\n    /\\b(?:break|case|catch|class|const|continue|debugger|default|delete|do|else|export|finally|for|function|if|import|in|instanceof|let|new|return|super|switch|this|throw|try|typeof|var|void|while|with)\\b/\r\n  ],\r\n  [\"functions\", /(\\w+)(?:\\s*\\()/],\r\n  [\"members\", /(\\w+)\\./],\r\n  [\"members\", /((\\w+\\.)+)(\\w+)/]\r\n]);","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n    name: \"TextBox\",\r\n    description: \"Syntax highlighting textbox control.\",\r\n    baseClass: \"Primrose.Controls.Surface\",\r\n    parameters: [{\r\n      name: \"idOrCanvasOrContext\",\r\n      type: \"String or HTMLCanvasElement or CanvasRenderingContext2D\",\r\n      description: \"Either an ID of an element that exists, an element, or the ID to set on an element that is to be created.\"\r\n    }, {\r\n      name: \"options\",\r\n      type: \"Object\",\r\n      description: \"Named parameters for creating the TextBox.\"\r\n    }]\r\n});\r\n\r\nimport Surface from \"./Surface\";\r\nimport Cursor from \"../Text/Cursor\";\r\nimport Point from \"../Text/Point\";\r\nimport Size from \"../Text/Size\";\r\nimport Rectangle from \"../Text/Rectangle\";\r\nimport TextEditor from \"../Text/CommandPacks/TextEditor\";\r\nimport DefaultTheme from \"../Text/Themes/Default\";\r\nimport JavaScript from \"../Text/Grammars/JavaScript\";\r\n\r\nimport isFirefox from \"../../flags/isFirefox\";\r\nimport isChrome from \"../../flags/isChrome\";\r\nimport isIE from \"../../flags/isIE\";\r\nimport isOpera from \"../../flags/isOpera\";\r\nimport isSafari from \"../../flags/isSafari\";\r\nimport isMobile from \"../../flags/isMobile\";\r\n\r\nvar SCROLL_SCALE = isFirefox ? 3 : 100,\r\n  COUNTER = 0,\r\n  OFFSET = 0;\r\n\r\nexport default class TextBox extends Surface {\r\n\r\n  constructor(options) {\r\n\r\n    if (typeof options === \"string\") {\r\n      options = {\r\n        value: options\r\n      };\r\n    }\r\n\r\n    super(Object.assign({}, {\r\n      id: \"Primrose.Controls.TextBox[\" + (COUNTER++) + \"]\"\r\n    }, options));\r\n\r\n    this.isTextBox = true;\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // normalize input parameters\r\n    ////////////////////////////////////////////////////////////////////////\r\n\r\n    this.useCaching = !isFirefox || !isMobile;\r\n\r\n    var makeCursorCommand = function (name) {\r\n      var method = name.toLowerCase();\r\n      this[\"cursor\" + name] = function (lines, cursor) {\r\n        cursor[method](lines);\r\n        this.scrollIntoView(cursor);\r\n      };\r\n    };\r\n\r\n    [\"Left\", \"Right\",\r\n      \"SkipLeft\", \"SkipRight\",\r\n      \"Up\", \"Down\",\r\n      \"Home\", \"End\",\r\n      \"FullHome\", \"FullEnd\"\r\n    ].map(makeCursorCommand.bind(this));\r\n\r\n    ////////////////////////////////////////////////////////////////////////\r\n    // initialization\r\n    ///////////////////////////////////////////////////////////////////////\r\n    this.tokens = null;\r\n    this.lines = null;\r\n    this._commandPack = null;\r\n    this._tokenRows = null;\r\n    this._tokenHashes = null;\r\n    this._tabString = null;\r\n    this._currentTouchID = null;\r\n    this._lineCountWidth = null;\r\n\r\n    this._lastFont = null;\r\n    this._lastText = null;\r\n    this._lastCharacterWidth = null;\r\n    this._lastCharacterHeight = null;\r\n    this._lastGridBounds = null;\r\n    this._lastPadding = null;\r\n    this._lastFrontCursor = null;\r\n    this._lastBackCursor = null;\r\n    this._lastWidth = -1;\r\n    this._lastHeight = -1;\r\n    this._lastScrollX = -1;\r\n    this._lastScrollY = -1;\r\n    this._lastFocused = false;\r\n    this._lastThemeName = null;\r\n    this._lastPointer = new Point();\r\n\r\n    // different browsers have different sets of keycodes for less-frequently\r\n    // used keys like curly brackets.\r\n    this._browser = isChrome ? \"CHROMIUM\" : (isFirefox ? \"FIREFOX\" : (isIE ? \"IE\" : (isOpera ? \"OPERA\" : (isSafari ? \"SAFARI\" : \"UNKNOWN\"))));\r\n    this._pointer = new Point();\r\n    this._history = [];\r\n    this._historyFrame = -1;\r\n    this._topLeftGutter = new Size();\r\n    this._bottomRightGutter = new Size();\r\n    this._dragging = false;\r\n    this._scrolling = false;\r\n    this._wheelScrollSpeed = 4;\r\n    var subBounds = new Rectangle(0, 0, this.bounds.width, this.bounds.height);\r\n    this._fg = new Surface({\r\n      id: this.id + \"-fore\",\r\n      bounds: subBounds\r\n    });\r\n    this._fgCanvas = this._fg.canvas;\r\n    this._fgfx = this._fg.context;\r\n    this._bg = new Surface({\r\n      id: this.id + \"-back\",\r\n      bounds: subBounds\r\n    });\r\n    this._bgCanvas = this._bg.canvas;\r\n    this._bgfx = this._bg.context;\r\n    this._trim = new Surface({\r\n      id: this.id + \"-trim\",\r\n      bounds: subBounds\r\n    });\r\n    this._trimCanvas = this._trim.canvas;\r\n    this._tgfx = this._trim.context;\r\n    this._rowCache = {};\r\n    this._VSCROLL_WIDTH = 2;\r\n\r\n    this.tabWidth = this.options.tabWidth;\r\n    this.showLineNumbers = !this.options.hideLineNumbers;\r\n    this.showScrollBars = !this.options.hideScrollBars;\r\n    this.wordWrap = !this.options.disableWordWrap;\r\n    this.readOnly = !!this.options.readOnly;\r\n    this.multiline = !this.options.singleLine;\r\n    this.gridBounds = new Rectangle();\r\n    this.frontCursor = new Cursor();\r\n    this.backCursor = new Cursor();\r\n    this.scroll = new Point();\r\n    this.character = new Size();\r\n    this.theme = this.options.theme;\r\n    this.fontSize = this.options.fontSize;\r\n    this.tokenizer = this.options.tokenizer;\r\n    this.commandPack = this.options.commands || TextEditor;\r\n    this.value = this.options.value;\r\n    this.padding = this.options.padding || 1;\r\n\r\n    this.addEventListener(\"visiblechanged\", this.blur.bind(this));\r\n  }\r\n\r\n  cursorPageUp(lines, cursor) {\r\n    cursor.incY(-this.gridBounds.height, lines);\r\n    this.scrollIntoView(cursor);\r\n  }\r\n\r\n  cursorPageDown(lines, cursor) {\r\n    cursor.incY(this.gridBounds.height, lines);\r\n    this.scrollIntoView(cursor);\r\n  }\r\n\r\n  get value() {\r\n    return this._history[this._historyFrame].join(\"\\n\");\r\n  }\r\n\r\n  set value(txt) {\r\n    txt = txt || \"\";\r\n    txt = txt.replace(/\\r\\n/g, \"\\n\");\r\n    if (!this.multiline) {\r\n      txt = txt.replace(/\\n/g, \"\");\r\n    }\r\n    var lines = txt.split(\"\\n\");\r\n    this.pushUndo(lines);\r\n    this.render();\r\n    this.emit(\"change\", {\r\n      target: this\r\n    });\r\n  }\r\n\r\n  get selectedText() {\r\n    var minCursor = Cursor.min(this.frontCursor, this.backCursor),\r\n      maxCursor = Cursor.max(this.frontCursor, this.backCursor);\r\n    return this.value.substring(minCursor.i, maxCursor.i);\r\n  }\r\n\r\n  set selectedText(str) {\r\n    str = str || \"\";\r\n    str = str.replace(/\\r\\n/g, \"\\n\");\r\n\r\n    if (this.frontCursor.i !== this.backCursor.i || str.length > 0) {\r\n      var minCursor = Cursor.min(this.frontCursor, this.backCursor),\r\n        maxCursor = Cursor.max(this.frontCursor, this.backCursor),\r\n        // TODO: don't recalc the string first.\r\n        text = this.value,\r\n        left = text.substring(0, minCursor.i),\r\n        right = text.substring(maxCursor.i);\r\n\r\n      var v = left + str + right;\r\n      this.value = v;\r\n      this.refreshGridBounds();\r\n      this.performLayout();\r\n      minCursor.advanceN(this.lines, Math.max(0, str.length));\r\n      this.scrollIntoView(maxCursor);\r\n      this.clampScroll();\r\n      maxCursor.copy(minCursor);\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  get padding() {\r\n    return this._padding;\r\n  }\r\n\r\n  set padding(v) {\r\n    this._padding = v;\r\n    this.render();\r\n  }\r\n\r\n  get wordWrap() {\r\n    return this._wordWrap;\r\n  }\r\n\r\n  set wordWrap(v) {\r\n    this._wordWrap = v || false;\r\n    this.setGutter();\r\n  }\r\n\r\n  get showLineNumbers() {\r\n    return this._showLineNumbers;\r\n  }\r\n\r\n  set showLineNumbers(v) {\r\n    this._showLineNumbers = v;\r\n    this.setGutter();\r\n  }\r\n\r\n  get showScrollBars() {\r\n    return this._showScrollBars;\r\n  }\r\n\r\n  set showScrollBars(v) {\r\n    this._showScrollBars = v;\r\n    this.setGutter();\r\n  }\r\n\r\n  get theme() {\r\n    return this._theme;\r\n  }\r\n\r\n  set theme(t) {\r\n    this._theme = Object.assign({}, DefaultTheme, t);\r\n    this._theme.fontSize = this.fontSize;\r\n    this._rowCache = {};\r\n    this.render();\r\n  }\r\n\r\n  get commandPack() {\r\n    return this._commandPack;\r\n  }\r\n\r\n  set commandPack(v) {\r\n    this._commandPack = v;\r\n  }\r\n\r\n  get selectionStart() {\r\n    return this.frontCursor.i;\r\n  }\r\n\r\n  set selectionStart(i) {\r\n    this.frontCursor.setI(i, this.lines);\r\n  }\r\n\r\n  get selectionEnd() {\r\n    return this.backCursor.i;\r\n  }\r\n\r\n  set selectionEnd(i) {\r\n    this.backCursor.setI(i, this.lines);\r\n  }\r\n\r\n  get selectionDirection() {\r\n    return this.frontCursor.i <= this.backCursor.i ? \"forward\" : \"backward\";\r\n  }\r\n\r\n  get tokenizer() {\r\n    return this._tokenizer;\r\n  }\r\n\r\n  set tokenizer(tk) {\r\n    this._tokenizer = tk || JavaScript;\r\n    if (this._history && this._history.length > 0) {\r\n      this.refreshTokens();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  get tabWidth() {\r\n    return this._tabWidth;\r\n  }\r\n\r\n  set tabWidth(tw) {\r\n    this._tabWidth = tw || 2;\r\n    this._tabString = \"\";\r\n    for (var i = 0; i < this._tabWidth; ++i) {\r\n      this._tabString += \" \";\r\n    }\r\n  }\r\n\r\n  get tabString() {\r\n    return this._tabString;\r\n  }\r\n\r\n  get fontSize() {\r\n    return this._fontSize || 16;\r\n  }\r\n\r\n  set fontSize(v) {\r\n    v = v || 16;\r\n    this._fontSize = v;\r\n    if (this.theme) {\r\n      this.theme.fontSize = this._fontSize;\r\n      this.resize();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  get lockMovement() {\r\n    return this.focused && !this.readOnly;\r\n  }\r\n\r\n  pushUndo(lines) {\r\n    if (this._historyFrame < this._history.length - 1) {\r\n      this._history.splice(this._historyFrame + 1);\r\n    }\r\n    this._history.push(lines);\r\n    this._historyFrame = this._history.length - 1;\r\n    this.refreshTokens();\r\n    this.render();\r\n  }\r\n\r\n  redo() {\r\n    if (this._historyFrame < this._history.length - 1) {\r\n      ++this._historyFrame;\r\n    }\r\n    this.refreshTokens();\r\n    this.fixCursor();\r\n    this.render();\r\n  }\r\n\r\n  undo() {\r\n    if (this._historyFrame > 0) {\r\n      --this._historyFrame;\r\n    }\r\n    this.refreshTokens();\r\n    this.fixCursor();\r\n    this.render();\r\n  }\r\n\r\n  scrollIntoView(currentCursor) {\r\n    this.scroll.y += this.minDelta(currentCursor.y, this.scroll.y, this.scroll.y + this.gridBounds.height);\r\n    if (!this.wordWrap) {\r\n      this.scroll.x += this.minDelta(currentCursor.x, this.scroll.x, this.scroll.x + this.gridBounds.width);\r\n    }\r\n    this.clampScroll();\r\n  }\r\n\r\n  readWheel(evt) {\r\n    if (this.focused) {\r\n      if (evt.shiftKey || isChrome) {\r\n        this.fontSize += -evt.deltaX / SCROLL_SCALE;\r\n      }\r\n      if (!evt.shiftKey || isChrome) {\r\n        this.scroll.y += Math.floor(evt.deltaY * this._wheelScrollSpeed / SCROLL_SCALE);\r\n      }\r\n      this.clampScroll();\r\n      this.render();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  startPointer(x, y) {\r\n    if (!super.startPointer(x, y)) {\r\n      this._dragging = true;\r\n      this.setCursorXY(this.frontCursor, x, y);\r\n    }\r\n  }\r\n\r\n  movePointer(x, y) {\r\n    if (this._dragging) {\r\n      this.setCursorXY(this.backCursor, x, y);\r\n    }\r\n  }\r\n\r\n  endPointer() {\r\n    super.endPointer();\r\n    this._dragging = false;\r\n    this._scrolling = false;\r\n  }\r\n\r\n  copySelectedText(evt) {\r\n    if (this.focused && this.frontCursor.i !== this.backCursor.i) {\r\n      var clipboard = evt.clipboardData || window.clipboardData;\r\n      clipboard.setData(\r\n        window.clipboardData ? \"Text\" : \"text/plain\", this.selectedText);\r\n      evt.returnValue = false;\r\n    }\r\n  }\r\n\r\n  cutSelectedText(evt) {\r\n    if (this.focused) {\r\n      this.copySelectedText(evt);\r\n      if (!this.readOnly) {\r\n        this.selectedText = \"\";\r\n      }\r\n    }\r\n  }\r\n\r\n  keyDown(evt){\r\n    if (this.focused && !this.readOnly) {\r\n      var func = this.commandPack[evt.altCmdName] ||\r\n        this.commandPack[evt.cmdName] ||\r\n        evt.altCmdText ||\r\n        evt.cmdText;\r\n\r\n\r\n      if (func instanceof String || typeof func === \"string\") {\r\n        console.warn(\"This shouldn't have happened.\");\r\n        func = this.commandPack[func] ||\r\n          this.commandPack[func] ||\r\n          func;\r\n      }\r\n\r\n      if (func) {\r\n        this.frontCursor.moved = false;\r\n        this.backCursor.moved = false;\r\n        if (func instanceof Function) {\r\n          func(this, this.lines);\r\n        }\r\n        else if (func instanceof String || typeof func === \"string\") {\r\n          console.log(func);\r\n          this.selectedText = func;\r\n        }\r\n        evt.resetDeadKeyState();\r\n        evt.preventDefault();\r\n\r\n        if (this.frontCursor.moved && !this.backCursor.moved) {\r\n          this.backCursor.copy(this.frontCursor);\r\n        }\r\n        this.clampScroll();\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  readClipboard(evt) {\r\n    if (this.focused && !this.readOnly) {\r\n      evt.returnValue = false;\r\n      var clipboard = evt.clipboardData || window.clipboardData,\r\n        str = clipboard.getData(window.clipboardData ? \"Text\" : \"text/plain\");\r\n      if (str) {\r\n        this.selectedText = str;\r\n      }\r\n    }\r\n  }\r\n\r\n  resize() {\r\n    super.resize();\r\n    this._bg.setSize(this.surfaceWidth, this.surfaceHeight);\r\n    this._fg.setSize(this.surfaceWidth, this.surfaceHeight);\r\n    this._trim.setSize(this.surfaceWidth, this.surfaceHeight);\r\n    if (this.theme) {\r\n      this.character.height = this.fontSize;\r\n      this.context.font = this.character.height + \"px \" + this.theme.fontFamily;\r\n      // measure 100 letter M's, then divide by 100, to get the width of an M\r\n      // to two decimal places on systems that return integer values from\r\n      // measureText.\r\n      this.character.width = this.context.measureText(\r\n          \"MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\")\r\n        .width /\r\n        100;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  pixel2cell(point) {\r\n    const x = point.x * this.imageWidth / this.surfaceWidth,\r\n      y = point.y * this.imageHeight / this.surfaceHeight;\r\n    point.set(\r\n      Math.round(point.x / this.character.width) + this.scroll.x - this.gridBounds.x,\r\n      Math.floor((point.y / this.character.height) - 0.25) + this.scroll.y);\r\n  }\r\n\r\n  clampScroll() {\r\n    if (this.scroll.y < 0) {\r\n      this.scroll.y = 0;\r\n    }\r\n    else {\r\n      while (0 < this.scroll.y &&\r\n        this.scroll.y > this.lines.length - this.gridBounds.height) {\r\n        --this.scroll.y;\r\n      }\r\n    }\r\n  }\r\n\r\n  refreshTokens() {\r\n    this.tokens = this.tokenizer.tokenize(this.value);\r\n  }\r\n\r\n  fixCursor() {\r\n    var moved = this.frontCursor.fixCursor(this.lines) ||\r\n      this.backCursor.fixCursor(this.lines);\r\n    if (moved) {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  setCursorXY(cursor, x, y) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n    this._pointer.set(x, y);\r\n    this.pixel2cell(this._pointer, this.scroll, this.gridBounds);\r\n    var gx = this._pointer.x - this.scroll.x,\r\n      gy = this._pointer.y - this.scroll.y,\r\n      onBottom = gy >= this.gridBounds.height,\r\n      onLeft = gx < 0,\r\n      onRight = this._pointer.x >= this.gridBounds.width;\r\n    if (!this._scrolling && !onBottom && !onLeft && !onRight) {\r\n      cursor.setXY(this._pointer.x, this._pointer.y, this.lines);\r\n      this.backCursor.copy(cursor);\r\n    }\r\n    else if (this._scrolling || onRight && !onBottom) {\r\n      this._scrolling = true;\r\n      var scrollHeight = this.lines.length - this.gridBounds.height;\r\n      if (gy >= 0 && scrollHeight >= 0) {\r\n        var sy = gy * scrollHeight / this.gridBounds.height;\r\n        this.scroll.y = Math.floor(sy);\r\n      }\r\n    }\r\n    else if (onBottom && !onLeft) {\r\n      var maxWidth = 0;\r\n      for (var dy = 0; dy < this.lines.length; ++dy) {\r\n        maxWidth = Math.max(maxWidth, this.lines[dy].length);\r\n      }\r\n      var scrollWidth = maxWidth - this.gridBounds.width;\r\n      if (gx >= 0 && scrollWidth >= 0) {\r\n        var sx = gx * scrollWidth / this.gridBounds.width;\r\n        this.scroll.x = Math.floor(sx);\r\n      }\r\n    }\r\n    else if (onLeft && !onBottom) {\r\n      // clicked in number-line gutter\r\n    }\r\n    else {\r\n      // clicked in the lower-left corner\r\n    }\r\n    this._lastPointer.copy(this._pointer);\r\n    this.render();\r\n  }\r\n\r\n  setGutter() {\r\n    if (this.showLineNumbers) {\r\n      this._topLeftGutter.width = 1;\r\n    }\r\n    else {\r\n      this._topLeftGutter.width = 0;\r\n    }\r\n\r\n    if (!this.showScrollBars) {\r\n      this._bottomRightGutter.set(0, 0);\r\n    }\r\n    else if (this.wordWrap) {\r\n      this._bottomRightGutter.set(this._VSCROLL_WIDTH, 0);\r\n    }\r\n    else {\r\n      this._bottomRightGutter.set(this._VSCROLL_WIDTH, 1);\r\n    }\r\n  }\r\n\r\n  refreshGridBounds() {\r\n    this._lineCountWidth = 0;\r\n    if (this.showLineNumbers) {\r\n      this._lineCountWidth = Math.max(1, Math.ceil(Math.log(this._history[this._historyFrame].length) / Math.LN10));\r\n    }\r\n\r\n    var x = Math.floor(this._topLeftGutter.width + this._lineCountWidth + this.padding / this.character.width),\r\n      y = Math.floor(this.padding / this.character.height),\r\n      w = Math.floor((this.imageWidth - 2 * this.padding) / this.character.width) - x - this._bottomRightGutter.width,\r\n      h = Math.floor((this.imageHeight - 2 * this.padding) / this.character.height) - y - this._bottomRightGutter.height;\r\n    this.gridBounds.set(x, y, w, h);\r\n  }\r\n\r\n  performLayout() {\r\n\r\n    // group the tokens into rows\r\n    this._tokenRows = [\r\n      []\r\n    ];\r\n    this._tokenHashes = [\"\"];\r\n    this.lines = [\"\"];\r\n    var currentRowWidth = 0;\r\n    var tokenQueue = this.tokens.slice();\r\n    for (var i = 0; i < tokenQueue.length; ++i) {\r\n      var t = tokenQueue[i].clone();\r\n      var widthLeft = this.gridBounds.width - currentRowWidth;\r\n      var wrap = this.wordWrap && t.type !== \"newlines\" && t.value.length > widthLeft;\r\n      var breakLine = t.type === \"newlines\" || wrap;\r\n      if (wrap) {\r\n        var split = t.value.length > this.gridBounds.width ? widthLeft : 0;\r\n        tokenQueue.splice(i + 1, 0, t.splitAt(split));\r\n      }\r\n\r\n      if (t.value.length > 0) {\r\n        this._tokenRows[this._tokenRows.length - 1].push(t);\r\n        this._tokenHashes[this._tokenHashes.length - 1] += JSON.stringify(t);\r\n        this.lines[this.lines.length - 1] += t.value;\r\n        currentRowWidth += t.value.length;\r\n      }\r\n\r\n      if (breakLine) {\r\n        this._tokenRows.push([]);\r\n        this._tokenHashes.push(\"\");\r\n        this.lines.push(\"\");\r\n        currentRowWidth = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minDelta(v, minV, maxV) {\r\n    var dvMinV = v - minV,\r\n      dvMaxV = v - maxV + 5,\r\n      dv = 0;\r\n    if (dvMinV < 0 || dvMaxV >= 0) {\r\n      // compare the absolute values, so we get the smallest change\r\n      // regardless of direction.\r\n      dv = Math.abs(dvMinV) < Math.abs(dvMaxV) ? dvMinV : dvMaxV;\r\n    }\r\n\r\n    return dv;\r\n  }\r\n\r\n  fillRect(gfx, fill, x, y, w, h) {\r\n    gfx.fillStyle = fill;\r\n    gfx.fillRect(\r\n      x * this.character.width,\r\n      y * this.character.height,\r\n      w * this.character.width + 1,\r\n      h * this.character.height + 1);\r\n  }\r\n\r\n  strokeRect(gfx, stroke, x, y, w, h) {\r\n    gfx.strokeStyle = stroke;\r\n    gfx.strokeRect(\r\n      x * this.character.width,\r\n      y * this.character.height,\r\n      w * this.character.width + 1,\r\n      h * this.character.height + 1);\r\n  }\r\n\r\n  renderCanvasBackground() {\r\n    var minCursor = Cursor.min(this.frontCursor, this.backCursor),\r\n      maxCursor = Cursor.max(this.frontCursor, this.backCursor),\r\n      tokenFront = new Cursor(),\r\n      tokenBack = new Cursor(),\r\n      clearFunc = this.theme.regular.backColor ? \"fillRect\" : \"clearRect\",\r\n      OFFSETY = OFFSET / this.character.height;\r\n\r\n    if (this.theme.regular.backColor) {\r\n      this._bgfx.fillStyle = this.theme.regular.backColor;\r\n    }\r\n\r\n    this._bgfx[clearFunc](0, 0, this.imageWidth, this.imageHeight);\r\n    this._bgfx.save();\r\n    this._bgfx.translate(\r\n      (this.gridBounds.x - this.scroll.x) * this.character.width + this.padding, -this.scroll.y * this.character.height + this.padding);\r\n\r\n\r\n    // draw the current row highlighter\r\n    if (this.focused) {\r\n      this.fillRect(this._bgfx, this.theme.regular.currentRowBackColor ||\r\n        DefaultTheme.regular.currentRowBackColor,\r\n        0, minCursor.y + OFFSETY,\r\n        this.gridBounds.width,\r\n        maxCursor.y - minCursor.y + 1);\r\n    }\r\n\r\n    for (var y = 0; y < this._tokenRows.length; ++y) {\r\n      // draw the tokens on this row\r\n      var row = this._tokenRows[y];\r\n\r\n      for (var i = 0; i < row.length; ++i) {\r\n        var t = row[i];\r\n        tokenBack.x += t.value.length;\r\n        tokenBack.i += t.value.length;\r\n\r\n        // skip drawing tokens that aren't in view\r\n        if (this.scroll.y <= y && y < this.scroll.y + this.gridBounds.height &&\r\n          this.scroll.x <= tokenBack.x && tokenFront.x < this.scroll.x +\r\n          this.gridBounds.width) {\r\n          // draw the selection box\r\n          var inSelection = minCursor.i <= tokenBack.i && tokenFront.i <\r\n            maxCursor.i;\r\n          if (inSelection) {\r\n            var selectionFront = Cursor.max(minCursor,\r\n              tokenFront);\r\n            var selectionBack = Cursor.min(maxCursor, tokenBack);\r\n            var cw = selectionBack.i - selectionFront.i;\r\n            this.fillRect(this._bgfx, this.theme.regular.selectedBackColor ||\r\n              DefaultTheme.regular.selectedBackColor,\r\n              selectionFront.x, selectionFront.y + OFFSETY,\r\n              cw, 1);\r\n          }\r\n        }\r\n\r\n        tokenFront.copy(tokenBack);\r\n      }\r\n\r\n      tokenFront.x = 0;\r\n      ++tokenFront.y;\r\n      tokenBack.copy(tokenFront);\r\n    }\r\n\r\n    // draw the cursor caret\r\n    if (this.focused) {\r\n      var cc = this.theme.cursorColor || \"black\";\r\n      var w = 1 / this.character.width;\r\n      this.fillRect(this._bgfx, cc, minCursor.x, minCursor.y + OFFSETY, w, 1);\r\n      this.fillRect(this._bgfx, cc, maxCursor.x, maxCursor.y + OFFSETY, w, 1);\r\n    }\r\n    this._bgfx.restore();\r\n  }\r\n\r\n  renderCanvasForeground() {\r\n    var tokenFront = new Cursor(),\r\n      tokenBack = new Cursor();\r\n\r\n    this._fgfx.clearRect(0, 0, this.imageWidth, this.imageHeight);\r\n    this._fgfx.save();\r\n    this._fgfx.translate((this.gridBounds.x - this.scroll.x) * this.character.width + this.padding, this.padding);\r\n    for (var y = 0; y < this._tokenRows.length; ++y) {\r\n      // draw the tokens on this row\r\n      var line = this.lines[y] + this.padding,\r\n        row = this._tokenRows[y],\r\n        drawn = false,\r\n        textY = (y - this.scroll.y) * this.character.height;\r\n\r\n      for (var i = 0; i < row.length; ++i) {\r\n        var t = row[i];\r\n        tokenBack.x += t.value.length;\r\n        tokenBack.i += t.value.length;\r\n\r\n        // skip drawing tokens that aren't in view\r\n        if (this.scroll.y <= y && y < this.scroll.y + this.gridBounds.height &&\r\n          this.scroll.x <= tokenBack.x && tokenFront.x < this.scroll.x +\r\n          this.gridBounds.width) {\r\n\r\n          // draw the text\r\n          if (this.useCaching && this._rowCache[line] !== undefined) {\r\n            if (i === 0) {\r\n              this._fgfx.putImageData(this._rowCache[line], this.padding, textY + this.padding + OFFSET);\r\n            }\r\n          }\r\n          else {\r\n            var style = this.theme[t.type] || {};\r\n            var font = (style.fontWeight || this.theme.regular.fontWeight || \"\") +\r\n              \" \" + (style.fontStyle || this.theme.regular.fontStyle || \"\") +\r\n              \" \" + this.character.height + \"px \" + this.theme.fontFamily;\r\n            this._fgfx.font = font.trim();\r\n            this._fgfx.fillStyle = style.foreColor || this.theme.regular.foreColor;\r\n            this.drawText(this._fgfx, t.value,\r\n              tokenFront.x * this.character.width,\r\n              textY);\r\n            drawn = true;\r\n          }\r\n        }\r\n\r\n        tokenFront.copy(tokenBack);\r\n      }\r\n\r\n      tokenFront.x = 0;\r\n      ++tokenFront.y;\r\n      tokenBack.copy(tokenFront);\r\n      if (this.useCaching && drawn && this._rowCache[line] === undefined) {\r\n        this._rowCache[line] = this._fgfx.getImageData(\r\n          this.padding,\r\n          textY + this.padding + OFFSET,\r\n          this.imageWidth - 2 * this.padding,\r\n          this.character.height);\r\n      }\r\n    }\r\n\r\n    this._fgfx.restore();\r\n  }\r\n\r\n  // provides a hook for TextInput to be able to override text drawing and spit out password blanking characters\r\n  drawText(ctx, txt, x, y) {\r\n    ctx.fillText(txt, x, y);\r\n  }\r\n\r\n\r\n  renderCanvasTrim() {\r\n    var tokenFront = new Cursor(),\r\n      tokenBack = new Cursor(),\r\n      maxLineWidth = 0;\r\n\r\n    this._tgfx.clearRect(0, 0, this.imageWidth, this.imageHeight);\r\n    this._tgfx.save();\r\n    this._tgfx.translate(this.padding, this.padding);\r\n    this._tgfx.save();\r\n    this._tgfx.lineWidth = 2;\r\n    this._tgfx.translate(0, -this.scroll.y * this.character.height);\r\n    for (var y = 0, lastLine = -1; y < this._tokenRows.length; ++y) {\r\n      var row = this._tokenRows[y];\r\n\r\n      for (var i = 0; i < row.length; ++i) {\r\n        var t = row[i];\r\n        tokenBack.x += t.value.length;\r\n        tokenBack.i += t.value.length;\r\n        tokenFront.copy(tokenBack);\r\n      }\r\n\r\n      maxLineWidth = Math.max(maxLineWidth, tokenBack.x);\r\n      tokenFront.x = 0;\r\n      ++tokenFront.y;\r\n      tokenBack.copy(tokenFront);\r\n\r\n      if (this.showLineNumbers && this.scroll.y <= y && y < this.scroll.y + this.gridBounds.height) {\r\n        var currentLine = row.length > 0 ? row[0].line : lastLine + 1;\r\n        // draw the left gutter\r\n        var lineNumber = currentLine.toString();\r\n        while (lineNumber.length < this._lineCountWidth) {\r\n          lineNumber = \" \" + lineNumber;\r\n        }\r\n        this.fillRect(this._tgfx,\r\n          this.theme.regular.selectedBackColor ||\r\n          DefaultTheme.regular.selectedBackColor,\r\n          0, y,\r\n          this.gridBounds.x, 1);\r\n        this._tgfx.font = \"bold \" + this.character.height + \"px \" +\r\n          this.theme.fontFamily;\r\n\r\n        if (currentLine > lastLine) {\r\n          this._tgfx.fillStyle = this.theme.regular.foreColor;\r\n          this._tgfx.fillText(\r\n            lineNumber,\r\n            0, y * this.character.height);\r\n        }\r\n        lastLine = currentLine;\r\n      }\r\n    }\r\n\r\n    this._tgfx.restore();\r\n\r\n    if (this.showLineNumbers) {\r\n      this.strokeRect(this._tgfx,\r\n        this.theme.regular.foreColor ||\r\n        DefaultTheme.regular.foreColor,\r\n        0, 0,\r\n        this.gridBounds.x, this.gridBounds.height);\r\n    }\r\n\r\n    // draw the scrollbars\r\n    if (this.showScrollBars) {\r\n      var drawWidth = this.gridBounds.width * this.character.width - this.padding,\r\n        drawHeight = this.gridBounds.height * this.character.height,\r\n        scrollX = (this.scroll.x * drawWidth) / maxLineWidth + this.gridBounds.x * this.character.width,\r\n        scrollY = (this.scroll.y * drawHeight) / this._tokenRows.length;\r\n\r\n      this._tgfx.fillStyle = this.theme.regular.selectedBackColor ||\r\n        DefaultTheme.regular.selectedBackColor;\r\n      // horizontal\r\n      var bw;\r\n      if (!this.wordWrap && maxLineWidth > this.gridBounds.width) {\r\n        var scrollBarWidth = drawWidth * (this.gridBounds.width / maxLineWidth),\r\n          by = this.gridBounds.height * this.character.height;\r\n        bw = Math.max(this.character.width, scrollBarWidth);\r\n        this._tgfx.fillRect(scrollX, by, bw, this.character.height);\r\n        this._tgfx.strokeRect(scrollX, by, bw, this.character.height);\r\n      }\r\n\r\n      //vertical\r\n      if (this._tokenRows.length > this.gridBounds.height) {\r\n        var scrollBarHeight = drawHeight * (this.gridBounds.height / this._tokenRows.length),\r\n          bx = this.image - this._VSCROLL_WIDTH * this.character.width - 2 * this.padding,\r\n          bh = Math.max(this.character.height, scrollBarHeight);\r\n        bw = this._VSCROLL_WIDTH * this.character.width;\r\n        this._tgfx.fillRect(bx, scrollY, bw, bh);\r\n        this._tgfx.strokeRect(bx, scrollY, bw, bh);\r\n      }\r\n    }\r\n\r\n    this._tgfx.lineWidth = 2;\r\n    this._tgfx.restore();\r\n    this._tgfx.strokeRect(1, 1, this.imageWidth - 2, this.imageHeight - 2);\r\n    if (!this.focused) {\r\n      this._tgfx.fillStyle = this.theme.regular.unfocused || DefaultTheme.regular.unfocused;\r\n      this._tgfx.fillRect(0, 0, this.imageWidth, this.imageHeight);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.tokens && this.theme) {\r\n      this.refreshGridBounds();\r\n      var boundsChanged = this.gridBounds.toString() !== this._lastGridBounds,\r\n        textChanged = this._lastText !== this.value,\r\n        characterWidthChanged = this.character.width !== this._lastCharacterWidth,\r\n        characterHeightChanged = this.character.height !== this._lastCharacterHeight,\r\n        paddingChanged = this.padding !== this._lastPadding,\r\n        cursorChanged = !this._lastFrontCursor || !this._lastBackCursor || this.frontCursor.i !== this._lastFrontCursor.i || this._lastBackCursor.i !== this.backCursor.i,\r\n        scrollChanged = this.scroll.x !== this._lastScrollX || this.scroll.y !== this._lastScrollY,\r\n        fontChanged = this.context.font !== this._lastFont,\r\n        themeChanged = this.theme.name !== this._lastThemeName,\r\n        focusChanged = this.focused !== this._lastFocused,\r\n\r\n        changeBounds = null,\r\n\r\n        layoutChanged = this.resized || boundsChanged || textChanged || characterWidthChanged || characterHeightChanged || paddingChanged,\r\n        backgroundChanged = layoutChanged || cursorChanged || scrollChanged || themeChanged,\r\n        foregroundChanged = backgroundChanged || textChanged,\r\n        trimChanged = backgroundChanged || focusChanged,\r\n        imageChanged = foregroundChanged || backgroundChanged || trimChanged;\r\n\r\n      if (layoutChanged) {\r\n        this.performLayout(this.gridBounds);\r\n        this._rowCache = {};\r\n      }\r\n\r\n      if (imageChanged) {\r\n        if (cursorChanged && !(layoutChanged || scrollChanged || themeChanged || focusChanged)) {\r\n          var top = Math.min(this.frontCursor.y, this._lastFrontCursor.y, this.backCursor.y, this._lastBackCursor.y) - this.scroll.y + this.gridBounds.y,\r\n            bottom = Math.max(this.frontCursor.y, this._lastFrontCursor.y, this.backCursor.y, this._lastBackCursor.y) - this.scroll.y + 1;\r\n          changeBounds = new Rectangle(\r\n            0,\r\n            top * this.character.height,\r\n            this.bounds.width,\r\n            (bottom - top) * this.character.height + 2);\r\n        }\r\n\r\n        if (backgroundChanged) {\r\n          this.renderCanvasBackground();\r\n        }\r\n        if (foregroundChanged) {\r\n          this.renderCanvasForeground();\r\n        }\r\n        if (trimChanged) {\r\n          this.renderCanvasTrim();\r\n        }\r\n\r\n        this.context.clearRect(0, 0, this.imageWidth, this.imageHeight);\r\n        this.context.drawImage(this._bgCanvas, 0, 0);\r\n        this.context.drawImage(this._fgCanvas, 0, 0);\r\n        this.context.drawImage(this._trimCanvas, 0, 0);\r\n        this.invalidate(changeBounds);\r\n      }\r\n\r\n      this._lastGridBounds = this.gridBounds.toString();\r\n      this._lastText = this.value;\r\n      this._lastCharacterWidth = this.character.width;\r\n      this._lastCharacterHeight = this.character.height;\r\n      this._lastWidth = this.imageWidth;\r\n      this._lastHeight = this.imageHeight;\r\n      this._lastPadding = this.padding;\r\n      this._lastFrontCursor = this.frontCursor.clone();\r\n      this._lastBackCursor = this.backCursor.clone();\r\n      this._lastFocused = this.focused;\r\n      this._lastFont = this.context.font;\r\n      this._lastThemeName = this.theme.name;\r\n      this._lastScrollX = this.scroll.x;\r\n      this._lastScrollY = this.scroll.y;\r\n    }\r\n  }\r\n}\r\n","const piOver180 = Math.PI / 180.0,\r\n  rad45 = Math.PI * 0.25,\r\n  defaultOrientation = new Float32Array([0, 0, 0, 1]),\r\n  defaultPosition = new Float32Array([0, 0, 0]);\r\n\r\n// Borrowed from glMatrix.\r\nfunction mat4_perspectiveFromFieldOfView(out, fov, near, far) {\r\n  var upTan = Math.tan(fov ? (fov.upDegrees * piOver180) : rad45),\r\n  downTan = Math.tan(fov ? (fov.downDegrees * piOver180) : rad45),\r\n  leftTan = Math.tan(fov ? (fov.leftDegrees * piOver180) : rad45),\r\n  rightTan = Math.tan(fov ? (fov.rightDegrees * piOver180) : rad45),\r\n  xScale = 2.0 / (leftTan + rightTan),\r\n  yScale = 2.0 / (upTan + downTan);\r\n\r\n  out[0] = xScale;\r\n  out[1] = 0.0;\r\n  out[2] = 0.0;\r\n  out[3] = 0.0;\r\n  out[4] = 0.0;\r\n  out[5] = yScale;\r\n  out[6] = 0.0;\r\n  out[7] = 0.0;\r\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\r\n  out[9] = ((upTan - downTan) * yScale * 0.5);\r\n  out[10] = far / (near - far);\r\n  out[11] = -1.0;\r\n  out[12] = 0.0;\r\n  out[13] = 0.0;\r\n  out[14] = (far * near) / (near - far);\r\n  out[15] = 0.0;\r\n  return out;\r\n}\r\n\r\nfunction mat4_fromRotationTranslation(out, q, v) {\r\n  // Quaternion math\r\n  var x = q[0], y = q[1], z = q[2], w = q[3],\r\n      x2 = x + x,\r\n      y2 = y + y,\r\n      z2 = z + z,\r\n\r\n      xx = x * x2,\r\n      xy = x * y2,\r\n      xz = x * z2,\r\n      yy = y * y2,\r\n      yz = y * z2,\r\n      zz = z * z2,\r\n      wx = w * x2,\r\n      wy = w * y2,\r\n      wz = w * z2;\r\n\r\n  out[0] = 1 - (yy + zz);\r\n  out[1] = xy + wz;\r\n  out[2] = xz - wy;\r\n  out[3] = 0;\r\n  out[4] = xy - wz;\r\n  out[5] = 1 - (xx + zz);\r\n  out[6] = yz + wx;\r\n  out[7] = 0;\r\n  out[8] = xz + wy;\r\n  out[9] = yz - wx;\r\n  out[10] = 1 - (xx + yy);\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n\r\n  return out;\r\n};\r\n\r\nfunction mat4_translate(out, a, v) {\r\n  var x = v[0], y = v[1], z = v[2],\r\n      a00, a01, a02, a03,\r\n      a10, a11, a12, a13,\r\n      a20, a21, a22, a23;\r\n\r\n  if (a === out) {\r\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\r\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\r\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\r\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\r\n  } else {\r\n    a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];\r\n    a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];\r\n    a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];\r\n\r\n    out[0] = a00; out[1] = a01; out[2] = a02; out[3] = a03;\r\n    out[4] = a10; out[5] = a11; out[6] = a12; out[7] = a13;\r\n    out[8] = a20; out[9] = a21; out[10] = a22; out[11] = a23;\r\n\r\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\r\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\r\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\r\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\r\n  }\r\n\r\n  return out;\r\n};\r\n\r\nfunction mat4_invert(out, a) {\r\n  var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],\r\n      a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],\r\n      a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],\r\n      a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],\r\n\r\n      b00 = a00 * a11 - a01 * a10,\r\n      b01 = a00 * a12 - a02 * a10,\r\n      b02 = a00 * a13 - a03 * a10,\r\n      b03 = a01 * a12 - a02 * a11,\r\n      b04 = a01 * a13 - a03 * a11,\r\n      b05 = a02 * a13 - a03 * a12,\r\n      b06 = a20 * a31 - a21 * a30,\r\n      b07 = a20 * a32 - a22 * a30,\r\n      b08 = a20 * a33 - a23 * a30,\r\n      b09 = a21 * a32 - a22 * a31,\r\n      b10 = a21 * a33 - a23 * a31,\r\n      b11 = a22 * a33 - a23 * a32,\r\n\r\n      // Calculate the determinant\r\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n  return out;\r\n};\r\n\r\nfunction updateEyeMatrices(projection, view, pose, parameters, vrDisplay) {\r\n  mat4_perspectiveFromFieldOfView(projection, parameters ? parameters.fieldOfView : null, vrDisplay.depthNear, vrDisplay.depthFar);\r\n\r\n  var orientation = pose.orientation || defaultOrientation;\r\n  var position = pose.position || defaultPosition;\r\n\r\n  mat4_fromRotationTranslation(view, orientation, position);\r\n  if (parameters)\r\n    mat4_translate(view, view, parameters.offset);\r\n  mat4_invert(view, view);\r\n}\r\n\r\n\r\nexport default function frameDataFromPose(frameData, pose, vrDisplay) {\r\n  if (!frameData || !pose)\r\n    return false;\r\n\r\n  frameData.pose = pose;\r\n  frameData.timestamp = pose.timestamp;\r\n\r\n  updateEyeMatrices(\r\n      frameData.leftProjectionMatrix, frameData.leftViewMatrix,\r\n      pose, vrDisplay.getEyeParameters(\"left\"), vrDisplay);\r\n  updateEyeMatrices(\r\n      frameData.rightProjectionMatrix, frameData.rightViewMatrix,\r\n      pose, vrDisplay.getEyeParameters(\"right\"), vrDisplay);\r\n\r\n  return true;\r\n};","pliny.class({\r\n  parent: \"Primrose.Displays\",\r\n  name: \"VRFrameData\",\r\n  description: \"A polyfill for the WebVR standard VRFrameData object.\"\r\n});\r\n\r\nexport default class VRFrameData {\r\n  constructor () {\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Displays.VRFrameData\",\r\n      name: \"leftProjectionMatrix\",\r\n      type: \"Float32Array\",\r\n      description: \"The projection matrix for the left eye.\"\r\n    });\r\n    this.leftProjectionMatrix = new Float32Array(16);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Displays.VRFrameData\",\r\n      name: \"rightProjectionMatrix\",\r\n      type: \"Float32Array\",\r\n      description: \"The projection matrix for the right eye.\"\r\n    });\r\n    this.leftViewMatrix = new Float32Array(16);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Displays.VRFrameData\",\r\n      name: \"leftViewMatrix\",\r\n      type: \"Float32Array\",\r\n      description: \"The view matrix for the left eye.\"\r\n    });\r\n    this.rightProjectionMatrix = new Float32Array(16);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Displays.VRFrameData\",\r\n      name: \"rightViewMatrix\",\r\n      type: \"Float32Array\",\r\n      description: \"The view matrix for the right eye.\"\r\n    });\r\n    this.rightViewMatrix = new Float32Array(16);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Displays.VRFrameData\",\r\n      name: \"pose\",\r\n      type: \"VRPose\",\r\n      description: \"Legacy VRPose data.\"\r\n    });\r\n    this.pose = null;\r\n  }\r\n};","/*\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport frameDataFromPose from \"./frameDataFromPose\";\r\nimport VRFrameData from \"./VRFrameData\";\r\nimport isiOS from \"../../flags/isiOS\";\r\nimport isMobile from \"../../flags/isMobile\";\r\nimport immutable from \"../../util/immutable\";\r\nimport mutable from \"../../util/mutable\";\r\nimport FullScreen from \"../../util/FullScreen\";\r\nimport standardFullScreenBehavior from \"../../util/standardFullScreenBehavior\";\r\nimport standardExitFullScreenBehavior from \"../../util/standardExitFullScreenBehavior\";\r\n\r\nconst defaultLeftBounds = [0, 0, 0.5, 1],\r\n  defaultRightBounds = [0.5, 0, 0.5, 1];\r\n\r\n// Start at a higher number to reduce chance of conflict.\r\nlet nextDisplayId = 1000,\r\n  hasShowDeprecationWarning = false;\r\n\r\n\r\nexport default class VRDisplay {\r\n  constructor(name) {\r\n    this._currentLayers = [];\r\n\r\n    Object.defineProperties(this, {\r\n      capabilities: immutable(Object.defineProperties({}, {\r\n        hasPosition: immutable(false),\r\n        hasOrientation: immutable(isMobile),\r\n        hasExternalDisplay: immutable(false),\r\n        canPresent: immutable(true),\r\n        maxLayers: immutable(1)\r\n      })),\r\n      displayId: immutable(nextDisplayId++),\r\n      displayName: immutable(name),\r\n      isConnected: immutable(true),\r\n      stageParameters: immutable(null),\r\n      isPresenting: immutable(() => FullScreen.isActive ),\r\n\r\n      depthNear: mutable(0.01, \"number\"),\r\n      depthFar: mutable(10000.0, \"number\"),\r\n\r\n      isPolyfilled: immutable(true)\r\n    });\r\n\r\n    this._frameData = null;\r\n    this._poseData = null;\r\n  }\r\n\r\n  getFrameData(frameData) {\r\n    if(!this._frameData) {\r\n      this._frameData = frameDataFromPose(frameData, this.getPose(), this);\r\n    }\r\n    return this._frameData;\r\n  }\r\n\r\n  getPose() {\r\n    if(!this._poseData){\r\n      this._poseData = this._getPose();\r\n    }\r\n    return this._poseData;\r\n  }\r\n\r\n  requestAnimationFrame(callback) {\r\n    return window.requestAnimationFrame(callback);\r\n  }\r\n\r\n  cancelAnimationFrame(id) {\r\n    return window.cancelAnimationFrame(id);\r\n  }\r\n\r\n  requestPresent(layers) {\r\n    for (var i = 0; i < this.capabilities.maxLayers && i < layers.length; ++i) {\r\n      this._currentLayers[i] = layers[i];\r\n    }\r\n    const elem = layers[0].source;\r\n    return standardFullScreenBehavior(elem);\r\n  }\r\n\r\n  exitPresent() {\r\n    this._currentLayers.splice(0);\r\n    return standardExitFullScreenBehavior();\r\n  }\r\n\r\n  getLayers() {\r\n    return this._currentLayers.slice();\r\n  }\r\n\r\n  submitFrame(pose) {\r\n    this._frameData = null;\r\n    this._poseData = null;\r\n  }\r\n\r\n};\r\n","import isMobile from \"../../flags/isMobile\";\r\nimport VRDisplay from \"./VRDisplay\";\r\n\r\nlet defaultFieldOfView = 100;\r\n\r\nfunction defaultPose() {\r\n  return {\r\n    position: [0, 0, 0],\r\n    orientation: [0, 0, 0, 1],\r\n    linearVelocity: null,\r\n    linearAcceleration: null,\r\n    angularVelocity: null,\r\n    angularAcceleration: null\r\n  };\r\n}\r\n\r\nexport default class StandardMonitorVRDisplay extends VRDisplay {\r\n\r\n  static get DEFAULT_FOV () {\r\n    return defaultFieldOfView;\r\n  }\r\n\r\n  static set DEFAULT_FOV (v) {\r\n    defaultFieldOfView = v;\r\n  }\r\n\r\n  constructor(display) {\r\n    super(\"Full Screen\");\r\n    this._display = display;\r\n  }\r\n\r\n  submitFrame(pose) {\r\n    if(this._display && this._display.isPolyfilled) {\r\n      this._display.submitFrame(pose);\r\n    }\r\n  }\r\n\r\n  getPose() {\r\n    var display = isMobile && this._display;\r\n    if(display){\r\n      return display.getPose();\r\n    }\r\n    else{\r\n      return defaultPose();\r\n    }\r\n  }\r\n\r\n  resetPose(){\r\n    var display = isMobile && this._display;\r\n    if(display){\r\n      return display.resetPose();\r\n    }\r\n  }\r\n\r\n  getEyeParameters (side) {\r\n    if (side === \"left\") {\r\n      const curLayer = this.getLayers()[0],\r\n        elem = curLayer && curLayer.source || document.body,\r\n        width = elem.clientWidth,\r\n        height = elem.clientHeight;\r\n\r\n      let vFOV, hFOV;\r\n      if(height > width) {\r\n        vFOV = defaultFieldOfView / 2,\r\n        hFOV = calcFoV(vFOV, width, height);\r\n      }\r\n      else {\r\n        hFOV = defaultFieldOfView / 2,\r\n        vFOV = calcFoV(hFOV, height, width);\r\n      }\r\n\r\n      return {\r\n        renderWidth: width * devicePixelRatio,\r\n        renderHeight: height * devicePixelRatio,\r\n        offset: new Float32Array([0, 0, 0]),\r\n        fieldOfView: {\r\n          upDegrees: vFOV,\r\n          downDegrees: vFOV,\r\n          leftDegrees: hFOV,\r\n          rightDegrees: hFOV\r\n        }\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nfunction calcFoV(aFoV, aDim, bDim){\r\n  return 180 * Math.atan(Math.tan(aFoV * Math.PI / 180) * aDim / bDim) / Math.PI;\r\n}\r\n","pliny.function({\r\n  parent: \"Primrose.DOM\",\r\n  name: \"makeHidingContainer\",\r\n  description: \"Takes an element and shoves it into a containing element that\\n\\\r\nis 0x0 pixels in size, with the overflow hidden. Sometimes, we need an element\\n\\\r\nlike a TextArea in the DOM to be able to receive key events, but we don't want the\\n\\\r\nuser to see it, so the makeHidingContainer function makes it easy to make it disappear.\",\r\n  parameters: [{\r\n    name: \"id\",\r\n    type: \"(String|Element)\",\r\n    description: \"A vague reference to\\n\\\r\nthe element. Either a String id where the element can be had, a String id to give\\n\\\r\na newly created element if it does not exist, or an Element to manipulate and validate.\"\r\n  }, {\r\n    name: \"obj\",\r\n    type: \"Element\",\r\n    description: \"The child element to stow in the hiding container.\"\r\n  }],\r\n  returns: \"The hiding container element, not yet inserted into the DOM.\"\r\n});\r\n\r\nimport cascadeElement from \"./cascadeElement\";\r\nexport default function makeHidingContainer(id, obj) {\r\n  var elem = cascadeElement(id, \"div\", window.HTMLDivElement);\r\n  elem.style.position = \"absolute\";\r\n  elem.style.left = 0;\r\n  elem.style.top = 0;\r\n  elem.style.width = 0;\r\n  elem.style.height = 0;\r\n  elem.style.overflow = \"hidden\";\r\n  elem.appendChild(obj);\r\n  return elem;\r\n}","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n    name: \"InputProcessor\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nconst SETTINGS_TO_ZERO = [\"heading\", \"pitch\", \"roll\", \"pointerPitch\", \"headX\", \"headY\", \"headZ\"];\r\n\r\nfunction initState(){\r\n  this.inputState = {\r\n    buttons: [],\r\n    axes: [],\r\n    ctrl: false,\r\n    alt: false,\r\n    shift: false,\r\n    meta: false\r\n  };\r\n  this.lastInputState = {\r\n    buttons: [],\r\n    axes: [],\r\n    ctrl: false,\r\n    alt: false,\r\n    shift: false,\r\n    meta: false\r\n  };\r\n}\r\n\r\nfunction filterMetaKey(k) {\r\n  for (let i = 0; i < Keys.MODIFIER_KEYS.length; ++i) {\r\n    const m = Keys.MODIFIER_KEYS[i];\r\n    if (Math.abs(k) === Keys[m.toLocaleUpperCase()]) {\r\n      return Math.sign(k) * (i + 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction filterValue(elem){\r\n  const t = typeof elem;\r\n  let index = 0,\r\n    toggle = false,\r\n    sign = 1;\r\n\r\n  if(t === \"number\"){\r\n    index = Math.abs(elem) - 1;\r\n    toggle = elem < 0;\r\n    sign = (elem < 0) ? -1 : 1;\r\n  }\r\n  else if(t === \"string\") {\r\n    if(elem[0] === \"-\") {\r\n      sign = -1;\r\n      elem = elem.substring(1);\r\n    }\r\n    index = this.axisNames.indexOf(elem);\r\n  }\r\n  else {\r\n    throw new Error(\"Cannot clone command spec. Element was type: \" + t, elem);\r\n  }\r\n\r\n  return {\r\n    index: index,\r\n    toggle: toggle,\r\n    sign: sign\r\n  };\r\n}\r\n\r\nfunction swap(a, b){\r\n  for(let i = 0; i < this.inputState.buttons.length; ++i){\r\n    this[a].buttons[i] = this[b].buttons[i];\r\n  }\r\n  for(let i = 0; i < this.inputState.axes.length; ++i){\r\n    this[a].axes[i] = this[b].axes[i];\r\n  }\r\n  for (let i = 0; i < Keys.MODIFIER_KEYS.length; ++i) {\r\n    const m = Keys.MODIFIER_KEYS[i];\r\n    this[a][m] = this[b][m];\r\n  }\r\n}\r\n\r\nfunction resetInputState(){\r\n  swap.call(this, \"inputState\", \"lastInputState\");\r\n}\r\n\r\nfunction recordLastState(){\r\n  swap.call(this, \"lastInputState\", \"inputState\");\r\n}\r\n\r\nclass CommandState{\r\n  constructor(){\r\n    this.value = null;\r\n    this.pressed = false;\r\n    this.wasPressed = false;\r\n    this.fireAgain = false;\r\n    this.lt = 0;\r\n    this.ct = 0;\r\n    this.repeatCount = 0;\r\n  }\r\n}\r\n\r\nimport Keys from \"../Keys\";\r\nimport { EventDispatcher } from \"three\";\r\n\r\nexport default class InputProcessor extends EventDispatcher {\r\n\r\n  constructor(name, commands, axisNames, userActionEvent) {\r\n    super();\r\n    this.name = name;\r\n    this.commands = {};\r\n    this.commandNames = [];\r\n    this.enabled = true;\r\n    this.paused = false;\r\n    this.ready = true;\r\n    this.inPhysicalUse = false;\r\n    initState.call(this);\r\n\r\n    const readMetaKeys = (event) => {\r\n      for (let i = 0; i < Keys.MODIFIER_KEYS.length; ++i) {\r\n        const m = Keys.MODIFIER_KEYS[i];\r\n        this.inputState[m] = event[m + \"Key\"];\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", readMetaKeys, false);\r\n    window.addEventListener(\"keyup\", readMetaKeys, false);\r\n    window.addEventListener(\"focus\", readMetaKeys, false);\r\n\r\n    this.axisNames = axisNames || [];\r\n\r\n    for (let i = 0; i < this.axisNames.length; ++i) {\r\n      this.inputState.axes[i] = 0;\r\n    }\r\n\r\n    for (const cmdName in commands) {\r\n      this.addCommand(cmdName, commands[cmdName]);\r\n    }\r\n\r\n    for (let i = 0; i < Keys.MODIFIER_KEYS.length; ++i) {\r\n      this.inputState[Keys.MODIFIER_KEYS[i]] = false;\r\n    }\r\n\r\n    this.userActionHandlers = null;\r\n    if(userActionEvent){\r\n      window.addEventListener(userActionEvent, (evt) => {\r\n        if(this.userActionHandlers) {\r\n          for (let i = 0; i < this.userActionHandlers.length; ++i) {\r\n            this.userActionHandlers[i](evt);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  get inPhysicalUse() {\r\n    return this._inPhysicalUse;\r\n  }\r\n\r\n  set inPhysicalUse(v) {\r\n    const wasInPhysicalUse = this._inPhysicalUse;\r\n    this._inPhysicalUse = v;\r\n    if(!wasInPhysicalUse && v){\r\n      this.emit(\"activate\");\r\n    }\r\n  }\r\n\r\n  addCommand(name, cmd) {\r\n    cmd.name = name;\r\n    cmd = this.cloneCommand(cmd);\r\n    if (typeof cmd.repetitions === \"undefined\") {\r\n      cmd.repetitions = 1;\r\n    }\r\n    cmd.state = new CommandState();\r\n    this.commands[name] = cmd;\r\n    this.commandNames.push(name);\r\n  }\r\n\r\n  cloneCommand(cmd) {\r\n    return {\r\n      name: cmd.name,\r\n      disabled: !!cmd.disabled,\r\n      dt: cmd.dt || 0,\r\n      deadzone: cmd.deadzone || 0,\r\n      threshold: cmd.threshold || 0,\r\n      repetitions: cmd.repetitions,\r\n      scale: cmd.scale,\r\n      offset: cmd.offset,\r\n      min: cmd.min,\r\n      max: cmd.max,\r\n      integrate: !!cmd.integrate,\r\n      delta: !!cmd.delta,\r\n      axes: this.maybeClone(cmd.axes),\r\n      commands: cmd.commands && cmd.commands.slice() || [],\r\n      buttons: this.maybeClone(cmd.buttons),\r\n      metaKeys: this.maybeClone(cmd.metaKeys && cmd.metaKeys.map(filterMetaKey)),\r\n      commandDown: cmd.commandDown,\r\n      commandUp: cmd.commandUp\r\n    };\r\n  }\r\n\r\n  maybeClone(arr) {\r\n    var output = [];\r\n    if (arr) {\r\n      for (var i = 0; i < arr.length; ++i) {\r\n        output[i] = filterValue.call(this, arr[i]);\r\n      }\r\n    }\r\n    return output;\r\n  }\r\n\r\n  update(dt) {\r\n    if (this.enabled && this.ready && this.inPhysicalUse && !this.paused && dt > 0) {\r\n\r\n      this.inputState.buttons[Keys.ANY] = false;\r\n      for (const n in this.inputState.buttons) {\r\n        if (this.inputState.buttons[n]) {\r\n          this.inputState.buttons[Keys.ANY] = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      let stateMod = recordLastState;\r\n      for (var name in this.commands) {\r\n        var cmd = this.commands[name];\r\n        cmd.state.wasPressed = cmd.state.pressed;\r\n        cmd.state.pressed = false;\r\n        if (!cmd.disabled) {\r\n          let pressed = true,\r\n            value = 0;\r\n          if (cmd.metaKeys) {\r\n            for (let n = 0; n < cmd.metaKeys.length && pressed; ++n) {\r\n              var m = cmd.metaKeys[n];\r\n              pressed = pressed &&\r\n                (this.inputState[Keys.MODIFIER_KEYS[m.index]] &&\r\n                  !m.toggle ||\r\n                  !this.inputState[Keys.MODIFIER_KEYS[m.index]] &&\r\n                  m.toggle);\r\n            }\r\n          }\r\n\r\n          if (pressed) {\r\n            if (cmd.buttons.length > 0) {\r\n              for (let n = 0; n < cmd.buttons.length; ++n) {\r\n                var btn = cmd.buttons[n],\r\n                  code = btn.index + 1,\r\n                  p = !!this.inputState.buttons[code];\r\n\r\n                const temp = p ? btn.sign : 0;\r\n                pressed = pressed && (p && !btn.toggle || !p && btn.toggle);\r\n                if (Math.abs(temp) > Math.abs(value)) {\r\n                  value = temp;\r\n                }\r\n              }\r\n            }\r\n\r\n            if (cmd.buttons.length === 0 || value !== 0) {\r\n              if (cmd.axes.length > 0) {\r\n                value = 0;\r\n                for (let n = 0; n < cmd.axes.length; ++n) {\r\n                  var a = cmd.axes[n];\r\n                  const temp = a.sign * this.inputState.axes[a.index];\r\n                  if (Math.abs(temp) > Math.abs(value)) {\r\n                    value = temp;\r\n                  }\r\n                }\r\n              }\r\n              else if(cmd.commands.length > 0){\r\n                value = 0;\r\n                for (let n = 0; n < cmd.commands.length; ++n) {\r\n                  const temp = this.getValue(cmd.commands[n]);\r\n                  if (Math.abs(temp) > Math.abs(value)) {\r\n                    value = temp;\r\n                  }\r\n                }\r\n              }\r\n\r\n              if (cmd.scale !== undefined) {\r\n                value *= cmd.scale;\r\n              }\r\n\r\n              if (cmd.offset !== undefined) {\r\n                value += cmd.offset;\r\n              }\r\n\r\n              if (cmd.deadzone && Math.abs(value) < cmd.deadzone) {\r\n                value = 0;\r\n              }\r\n\r\n              if (cmd.integrate) {\r\n                value = this.getValue(cmd.name) + value * dt;\r\n              }\r\n              else if (cmd.delta) {\r\n                var ov = value;\r\n                if (cmd.state.lv !== undefined) {\r\n                  value = (value - cmd.state.lv);\r\n                }\r\n                cmd.state.lv = ov;\r\n              }\r\n\r\n              if (cmd.min !== undefined && value < cmd.min){\r\n                value = cmd.min;\r\n                stateMod = resetInputState;\r\n              }\r\n\r\n              if (cmd.max !== undefined && value > cmd.max) {\r\n                value = cmd.max;\r\n                stateMod = resetInputState;\r\n              }\r\n\r\n              if (cmd.threshold) {\r\n                pressed = pressed && (value > cmd.threshold);\r\n              }\r\n            }\r\n          }\r\n\r\n          cmd.state.pressed = pressed;\r\n          cmd.state.value = value;\r\n          cmd.state.lt += dt;\r\n\r\n          cmd.state.fireAgain = cmd.state.pressed &&\r\n            cmd.state.lt >= cmd.dt &&\r\n            (cmd.repetitions === -1 || cmd.state.repeatCount < cmd.repetitions);\r\n\r\n          if (cmd.state.fireAgain) {\r\n            cmd.state.lt = 0;\r\n            ++cmd.state.repeatCount;\r\n          }\r\n          else if (!cmd.state.pressed) {\r\n            cmd.state.repeatCount = 0;\r\n          }\r\n        }\r\n      }\r\n      stateMod.call(this);\r\n\r\n      this.fireCommands();\r\n    }\r\n  }\r\n\r\n  zero() {\r\n    initState.call(this);\r\n    for(const key in this.commands){\r\n      this.commands[key].state = new CommandState();\r\n    }\r\n  }\r\n\r\n  fireCommands() {\r\n    if (this.ready && !this.paused) {\r\n      for (var name in this.commands) {\r\n        var cmd = this.commands[name];\r\n        if (cmd.state.fireAgain && cmd.commandDown) {\r\n          cmd.commandDown(this.name);\r\n        }\r\n\r\n        if (!cmd.state.pressed && cmd.state.wasPressed && cmd.commandUp) {\r\n          cmd.commandUp(this.name);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setProperty(key, name, value) {\r\n    if (this.commands[name]) {\r\n      this.commands[name][key] = value;\r\n    }\r\n  }\r\n\r\n  setDeadzone(name, value) {\r\n    this.setProperty(\"deadzone\", name, value);\r\n  }\r\n\r\n  setScale(name, value) {\r\n    this.setProperty(\"scale\", name, value);\r\n  }\r\n\r\n  setDT(name, value) {\r\n    this.setProperty(\"dt\", name, value);\r\n  }\r\n\r\n  setMin(name, value) {\r\n    this.setProperty(\"min\", name, value);\r\n  }\r\n\r\n  setMax(name, value) {\r\n    this.setProperty(\"max\", name, value);\r\n  }\r\n\r\n  addMetaKey(name, value) {\r\n    this.addToArray(\"metaKeys\", name, filterMetaKey(value));\r\n  }\r\n\r\n  addAxis(name, value) {\r\n    this.addToArray(\"axes\", name, value);\r\n  }\r\n\r\n  addButton(name, value) {\r\n    this.addToArray(\"buttons\", name, value);\r\n  }\r\n\r\n  removeMetaKey(name, value) {\r\n    this.removeFromArray(\"metaKeys\", name, value);\r\n  }\r\n\r\n  removeAxis(name, value) {\r\n    this.removeFromArray(\"axes\", name, value);\r\n  }\r\n\r\n  removeButton(name, value) {\r\n    this.removeFromArray(\"buttons\", name, value);\r\n  }\r\n\r\n  invertAxis(name, value) {\r\n    this.invertInArray(\"axes\", name, value);\r\n  }\r\n\r\n  invertButton(name, value) {\r\n    this.invertInArray(\"buttons\", name, value);\r\n  }\r\n\r\n  invertMetaKey(name, value) {\r\n    this.invertInArray(\"metaKeys\", name, value);\r\n  }\r\n\r\n  addToArray(key, name, value) {\r\n    if (this.commands[name] && this.commands[name][key]) {\r\n      this.commands[name][key].push(filterValue(value));\r\n    }\r\n  }\r\n\r\n  removeFromArray(key, name, value) {\r\n    if (this.commands[name] && this.commands[name][key]) {\r\n      --value;\r\n      const arr = this.commands[name][key];\r\n      for(let i = 0; i < arr.length; ++i){\r\n        const elem = arr[i];\r\n        if(elem.index === value){\r\n          return arr.splice(i, 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  invertInArray(key, name, value) {\r\n    if (this.commands[name] && this.commands[name][key]) {\r\n      var arr = this.commands[name][key],\r\n        n = arr.indexOf(value);\r\n      for(let i = 0; i < arr.length; ++i){\r\n        const elem = arr[i];\r\n        if(elem.index === value){\r\n          elem.sign *= -1;\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  pause(v) {\r\n    this.paused = v;\r\n  }\r\n\r\n  isPaused() {\r\n    return this.paused;\r\n  }\r\n\r\n  enable(k, v) {\r\n    if (v === undefined || v === null) {\r\n      v = k;\r\n      k = null;\r\n    }\r\n\r\n    if (k) {\r\n      this.setProperty(\"disabled\", k, !v);\r\n    }\r\n    else {\r\n      this.enabled = v;\r\n    }\r\n  }\r\n\r\n  isEnabled(name) {\r\n    return name && this.commands[name] && !this.commands[name].disabled;\r\n  }\r\n\r\n  getAxis(name) {\r\n    var i = this.axisNames.indexOf(name);\r\n    if (i > -1) {\r\n      var value = this.inputState.axes[i] || 0;\r\n      return value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  setAxis(name, value) {\r\n    var i = this.axisNames.indexOf(name);\r\n    if (i > -1 && (this.inPhysicalUse || value !== 0)) {\r\n      this.inputState.axes[i] = value;\r\n    }\r\n  }\r\n\r\n  setButton(index, pressed) {\r\n    if(this.inPhysicalUse || pressed){\r\n      this.inputState.buttons[index] = pressed;\r\n    }\r\n  }\r\n\r\n  isDown(name) {\r\n    return this.enabled &&\r\n      this.isEnabled(name) &&\r\n      this.commands[name].state.pressed;\r\n  }\r\n\r\n  isUp(name) {\r\n    return this.enabled &&\r\n      this.isEnabled(name) &&\r\n      this.commands[name].state.pressed;\r\n  }\r\n\r\n  getValue(name) {\r\n    return this.enabled &&\r\n        this.isEnabled(name) &&\r\n        (this.commands[name].state.value || this.getAxis(name)) ||\r\n        0;\r\n  }\r\n\r\n  setValue(name, value) {\r\n    var j = this.axisNames.indexOf(name);\r\n    if (!this.commands[name] && j > -1) {\r\n      this.setAxis(name, value);\r\n    }\r\n    else if (this.commands[name] && !this.commands[name].disabled) {\r\n      this.commands[name].state.value = value;\r\n    }\r\n  }\r\n}\r\n","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"OperatingSystem\",\r\n    description: \"A description of how a specific operating system handles keyboard shortcuts.\",\r\n    parameters: [{\r\n      name: \"osName\",\r\n      type: \"String\",\r\n      description: \"A friendly name for the operating system.\"\r\n    }, {\r\n      name: \"pre1\",\r\n      type: \"String\",\r\n      description: \"Standard keyboard modifier.\"\r\n    }, {\r\n      name: \"pre2\",\r\n      type: \"String\",\r\n      description: \"Key modifier for moving the cursor by whole words.\"\r\n    }, {\r\n      name: \"redo\",\r\n      type: \"String\",\r\n      description: \"Key sequence to redo changes in text that were undone.\"\r\n    }, {\r\n      name: \"pre3\",\r\n      type: \"String\",\r\n      description: \"Key modifier for home and end.\"\r\n    }, {\r\n      name: \"home\",\r\n      type: \"String\",\r\n      description: \"Key sequence to send cursor to the beginning of the current line.\"\r\n    }, {\r\n      name: \"end\",\r\n      type: \"String\",\r\n      description: \"Key sequence to send cursor to the end of the current line.\"\r\n    }, {\r\n      name: \"pre5\",\r\n      type: \"String\",\r\n      description: \"Modifiers for the fullHome and fullEnd commands.\"\r\n    }]\r\n});\r\n\r\nimport Keys from \"../../Keys\";\r\n\r\nfunction setCursorCommand(obj, mod, key, func, cur) {\r\n  var name = mod + \"_\" + key;\r\n  obj[name] = function (prim, tokenRows) {\r\n    prim[\"cursor\" + func](tokenRows, prim[cur + \"Cursor\"]);\r\n  };\r\n}\r\n\r\nfunction makeCursorCommand(obj, baseMod, key, func) {\r\n  setCursorCommand(obj, baseMod || \"NORMAL\", key, func, \"front\");\r\n  setCursorCommand(obj, baseMod + \"SHIFT\", key, func, \"back\");\r\n}\r\n\r\nexport default class OperatingSystem {\r\n  constructor(osName, pre1, pre2, redo, pre3, home, end, pre5) {\r\n    this.name = osName;\r\n\r\n    var pre4 = pre3;\r\n    pre3 = pre3.length > 0 ? pre3 : \"NORMAL\";\r\n\r\n    this[pre1 + \"_a\"] = \"SELECT_ALL\";\r\n    this[pre1 + \"_c\"] = \"COPY\";\r\n    this[pre1 + \"_x\"] = \"CUT\";\r\n    this[pre1 + \"_v\"] = \"PASTE\";\r\n    this[redo] = \"REDO\";\r\n    this[pre1 + \"_z\"] = \"UNDO\";\r\n    this[pre1 + \"_DOWNARROW\"] = \"WINDOW_SCROLL_DOWN\";\r\n    this[pre1 + \"_UPARROW\"] = \"WINDOW_SCROLL_UP\";\r\n    this[pre2 + \"_LEFTARROW\"] = \"NORMAL_SKIPLEFT\";\r\n    this[pre2 + \"SHIFT_LEFTARROW\"] = \"SHIFT_SKIPLEFT\";\r\n    this[pre2 + \"_RIGHTARROW\"] = \"NORMAL_SKIPRIGHT\";\r\n    this[pre2 + \"SHIFT_RIGHTARROW\"] = \"SHIFT_SKIPRIGHT\";\r\n    this[pre3 + \"_HOME\"] = \"NORMAL_HOME\";\r\n    this[pre4 + \"SHIFT_HOME\"] = \"SHIFT_HOME\";\r\n    this[pre3 + \"_END\"] = \"NORMAL_END\";\r\n    this[pre4 + \"SHIFT_END\"] = \"SHIFT_END\";\r\n    this[pre5 + \"_HOME\"] = \"CTRL_HOME\";\r\n    this[pre5 + \"SHIFT_HOME\"] = \"CTRLSHIFT_HOME\";\r\n    this[pre5 + \"_END\"] = \"CTRL_END\";\r\n    this[pre5 + \"SHIFT_END\"] = \"CTRLSHIFT_END\";\r\n  }\r\n\r\n  makeCommandName(evt, codePage) {\r\n    const key = evt.keyCode;\r\n    if (key !== Keys.CTRL &&\r\n      key !== Keys.ALT &&\r\n      key !== Keys.META_L &&\r\n      key !== Keys.META_R &&\r\n      key !== Keys.SHIFT) {\r\n\r\n      let commandName = codePage.deadKeyState;\r\n\r\n      if (evt.ctrlKey) {\r\n        commandName += \"CTRL\";\r\n      }\r\n      if (evt.altKey) {\r\n        commandName += \"ALT\";\r\n      }\r\n      if (evt.metaKey) {\r\n        commandName += \"META\";\r\n      }\r\n      if (evt.shiftKey) {\r\n        commandName += \"SHIFT\";\r\n      }\r\n      if (commandName === codePage.deadKeyState) {\r\n        commandName += \"NORMAL\";\r\n      }\r\n\r\n      commandName += \"_\" + codePage.keyNames[key];\r\n\r\n      return this[commandName] || commandName;\r\n    }\r\n  }\r\n};","pliny.value({\r\n  parent: \"Primrose.Text.OperatingSystems\",\r\n  name: \"Windows\",\r\n  description: \"Keyboard shortcuts for the Windows operating system.\"\r\n});\r\n\r\nimport OperatingSystem from \"./OperatingSystem\";\r\nexport default new OperatingSystem(\r\n  \"Windows\", \"CTRL\", \"CTRL\", \"CTRL_y\",\r\n  \"\", \"HOME\", \"END\",\r\n  \"CTRL\", \"HOME\", \"END\");","pliny.value({\r\n  parent: \"Primrose.Text.OperatingSystems\",\r\n  name: \"macOS\",\r\n  description: \"Keyboard shortcuts for Apple macOS nee OSX.\"\r\n});\r\n\r\nimport OperatingSystem from \"./OperatingSystem\";\r\nexport default new OperatingSystem(\r\n  \"macOS\", \"META\", \"ALT\", \"METASHIFT_z\",\r\n  \"META\", \"LEFTARROW\", \"RIGHTARROW\",\r\n  \"META\", \"UPARROW\", \"DOWNARROW\");","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n  name: \"CodePage\",\r\n  description: \"A code page is a description of how a certain cultural locale's keyboard works. Keys send \\\"key codes\\\" to the operating system, and the operating system then translates this into \\\"virtual key codes\\\" (as the keyboard's own code system is arbitrary and proprietary). The operating system's virtual key codes attempt to express the intended meaning of the user's key striking activity.\\n\\\r\n\\n\\\r\nAs we work in the browser and not at the operating system level, we do not receive these virtual key codes. The browser does yet another translation into \\\"key events\\\" that are nominally standardized. Unfortunately, the standard is incomplete with regards to the full breadth of cultural locales in the world, and the current state of browser support for the standard is subopitmal. So we have to reinterpret what the browser tells us to get a better idea of what the user actually meant. And that reinterpretation is this CodePage class.\",\r\n  parameters: [{\r\n    name: \"codePageName\",\r\n    type: \"String\",\r\n    description: \"A readable name for the CodePage, to be used in options UIs.\",\r\n  }, {\r\n    name: \"lang\",\r\n    type: \"String\",\r\n    description: \"The IETF standard language tag describing the locale for which this CodePage was created. See: https://en.wikipedia.org/wiki/IETF_language_tag.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Object\",\r\n    description: \"The CodePage description, an object literal expressing how different key events with different modifier keys result into different character codes or dead key state transitions. See: https://en.wikipedia.org/wiki/Dead_key.\"\r\n  }]\r\n});\r\n\r\nimport Keys from \"../../Keys\";\r\nexport default class CodePage {\r\n  constructor(codePageName, lang, options) {\r\n    this.name = codePageName;\r\n    this.language = lang;\r\n\r\n    var commands = {\r\n      NORMAL: {\r\n        \"65\": \"a\",\r\n        \"66\": \"b\",\r\n        \"67\": \"c\",\r\n        \"68\": \"d\",\r\n        \"69\": \"e\",\r\n        \"70\": \"f\",\r\n        \"71\": \"g\",\r\n        \"72\": \"h\",\r\n        \"73\": \"i\",\r\n        \"74\": \"j\",\r\n        \"75\": \"k\",\r\n        \"76\": \"l\",\r\n        \"77\": \"m\",\r\n        \"78\": \"n\",\r\n        \"79\": \"o\",\r\n        \"80\": \"p\",\r\n        \"81\": \"q\",\r\n        \"82\": \"r\",\r\n        \"83\": \"s\",\r\n        \"84\": \"t\",\r\n        \"85\": \"u\",\r\n        \"86\": \"v\",\r\n        \"87\": \"w\",\r\n        \"88\": \"x\",\r\n        \"89\": \"y\",\r\n        \"90\": \"z\"\r\n      },\r\n      SHIFT: {\r\n        \"65\": \"A\",\r\n        \"66\": \"B\",\r\n        \"67\": \"C\",\r\n        \"68\": \"D\",\r\n        \"69\": \"E\",\r\n        \"70\": \"F\",\r\n        \"71\": \"G\",\r\n        \"72\": \"H\",\r\n        \"73\": \"I\",\r\n        \"74\": \"J\",\r\n        \"75\": \"K\",\r\n        \"76\": \"L\",\r\n        \"77\": \"M\",\r\n        \"78\": \"N\",\r\n        \"79\": \"O\",\r\n        \"80\": \"P\",\r\n        \"81\": \"Q\",\r\n        \"82\": \"R\",\r\n        \"83\": \"S\",\r\n        \"84\": \"T\",\r\n        \"85\": \"U\",\r\n        \"86\": \"V\",\r\n        \"87\": \"W\",\r\n        \"88\": \"X\",\r\n        \"89\": \"Y\",\r\n        \"90\": \"Z\"\r\n      }\r\n    };\r\n\r\n    for(var key in options){\r\n      commands[key] = Object.assign({}, commands[key], options[key]);\r\n    }\r\n\r\n    var char, code, cmdName;\r\n    for (var i = 0; i <= 9; ++i) {\r\n      code = Keys[\"NUMPAD\" + i];\r\n      commands.NORMAL[code] = i.toString();\r\n    }\r\n\r\n    commands.NORMAL[Keys.MULTIPLY] = \"*\";\r\n    commands.NORMAL[Keys.ADD] = \"+\";\r\n    commands.NORMAL[Keys.SUBTRACT] = \"-\";\r\n    commands.NORMAL[Keys.DECIMALPOINT] = \".\";\r\n    commands.NORMAL[Keys.DIVIDE] = \"/\";\r\n\r\n    this.keyNames = {};\r\n    this.commandNames = [];\r\n    for (char in Keys) {\r\n      code = Keys[char];\r\n      if (!isNaN(code)) {\r\n        this.keyNames[code] = char;\r\n      }\r\n    }\r\n\r\n    function overwriteText(txt, prim, lines) {\r\n      prim.selectedText = txt;\r\n    }\r\n\r\n    for (var type in commands) {\r\n      var codes = commands[type];\r\n      if (typeof (codes) === \"object\") {\r\n        for (code in codes) {\r\n          if (code.indexOf(\"_\") > -1) {\r\n            var parts = code.split(' '),\r\n              browser = parts[0];\r\n            code = parts[1];\r\n            char = commands.NORMAL[code];\r\n            cmdName = browser + \"_\" + type + \" \" + char;\r\n          }\r\n          else {\r\n            char = commands.NORMAL[code];\r\n            cmdName = type + \"_\" + char;\r\n          }\r\n          this.commandNames.push(cmdName);\r\n          this.keyNames[code] = char;\r\n          var func = codes[code];\r\n          if (typeof func !== \"function\") {\r\n            func = overwriteText.bind(null, func);\r\n          }\r\n          this[cmdName] = func.bind(this);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.lastDeadKeyState = this.deadKeyState = \"\";\r\n  }\r\n\r\n  resetDeadKeyState() {\r\n    if(this.deadKeyState === this.lastDeadKeyState) {\r\n      this.deadKeyState = \"\";\r\n    }\r\n  }\r\n};\r\n\r\nCodePage.DEAD = function (key) {\r\n  return function (prim) {\r\n    this.lastDeadKeyState = this.deadKeyState;\r\n    this.deadKeyState = \"DEAD\" + key;\r\n  };\r\n};","pliny.record({\r\n  parent: \"Primrose.Text.CodePages\",\r\n  name: \"DE_QWERTZ\",\r\n  description: \"CodePage for `Deutsch: QWERTZ` locale.\"\r\n});\r\n\r\nimport CodePage from \"./CodePage\";\r\nexport default new CodePage(\"Deutsch: QWERTZ\", \"de\", {\r\n  deadKeys: [220, 221, 160, 192],\r\n  NORMAL: {\r\n    \"32\": \" \",\r\n    \"48\": \"0\",\r\n    \"49\": \"1\",\r\n    \"50\": \"2\",\r\n    \"51\": \"3\",\r\n    \"52\": \"4\",\r\n    \"53\": \"5\",\r\n    \"54\": \"6\",\r\n    \"55\": \"7\",\r\n    \"56\": \"8\",\r\n    \"57\": \"9\",\r\n    \"60\": \"<\",\r\n    \"63\": \"ß\",\r\n    \"160\": CodePage.DEAD(3),\r\n    \"163\": \"#\",\r\n    \"171\": \"+\",\r\n    \"173\": \"-\",\r\n    \"186\": \"ü\",\r\n    \"187\": \"+\",\r\n    \"188\": \",\",\r\n    \"189\": \"-\",\r\n    \"190\": \".\",\r\n    \"191\": \"#\",\r\n    \"192\": CodePage.DEAD(4),\r\n    \"219\": \"ß\",\r\n    \"220\": CodePage.DEAD(1),\r\n    \"221\": CodePage.DEAD(2),\r\n    \"222\": \"ä\",\r\n    \"226\": \"<\"\r\n  },\r\n  DEAD1NORMAL: {\r\n    \"65\": \"â\",\r\n    \"69\": \"ê\",\r\n    \"73\": \"î\",\r\n    \"79\": \"ô\",\r\n    \"85\": \"û\",\r\n    \"190\": \".\"\r\n  },\r\n  DEAD2NORMAL: {\r\n    \"65\": \"á\",\r\n    \"69\": \"é\",\r\n    \"73\": \"í\",\r\n    \"79\": \"ó\",\r\n    \"83\": \"s\",\r\n    \"85\": \"ú\",\r\n    \"89\": \"ý\"\r\n  },\r\n  SHIFT: {\r\n    \"32\": \" \",\r\n    \"48\": \"=\",\r\n    \"49\": \"!\",\r\n    \"50\": \"\\\"\",\r\n    \"51\": \"§\",\r\n    \"52\": \"$\",\r\n    \"53\": \"%\",\r\n    \"54\": \"&\",\r\n    \"55\": \"/\",\r\n    \"56\": \"(\",\r\n    \"57\": \")\",\r\n    \"60\": \">\",\r\n    \"63\": \"?\",\r\n    \"163\": \"'\",\r\n    \"171\": \"*\",\r\n    \"173\": \"_\",\r\n    \"186\": \"Ü\",\r\n    \"187\": \"*\",\r\n    \"188\": \";\",\r\n    \"189\": \"_\",\r\n    \"190\": \":\",\r\n    \"191\": \"'\",\r\n    \"192\": \"Ö\",\r\n    \"219\": \"?\",\r\n    \"222\": \"Ä\",\r\n    \"226\": \">\"\r\n  },\r\n  CTRLALT: {\r\n    \"48\": \"}\",\r\n    \"50\": \"²\",\r\n    \"51\": \"³\",\r\n    \"55\": \"{\",\r\n    \"56\": \"[\",\r\n    \"57\": \"]\",\r\n    \"60\": \"|\",\r\n    \"63\": \"\\\\\",\r\n    \"69\": \"€\",\r\n    \"77\": \"µ\",\r\n    \"81\": \"@\",\r\n    \"171\": \"~\",\r\n    \"187\": \"~\",\r\n    \"219\": \"\\\\\",\r\n    \"226\": \"|\"\r\n  },\r\n  CTRLALTSHIFT: {\r\n    \"63\": \"ẞ\",\r\n    \"219\": \"ẞ\"\r\n  },\r\n  DEAD3NORMAL: {\r\n    \"65\": \"a\",\r\n    \"69\": \"e\",\r\n    \"73\": \"i\",\r\n    \"79\": \"o\",\r\n    \"85\": \"u\",\r\n    \"190\": \".\"\r\n  },\r\n  DEAD4NORMAL: {\r\n    \"65\": \"a\",\r\n    \"69\": \"e\",\r\n    \"73\": \"i\",\r\n    \"79\": \"o\",\r\n    \"83\": \"s\",\r\n    \"85\": \"u\",\r\n    \"89\": \"y\"\r\n  }\r\n});","pliny.record({\r\n  parent: \"Primrose.Text.CodePages\",\r\n  name: \"EN_UKX\",\r\n  description: \"CodePage for the `English: UK Extended` locale.\"\r\n});\r\n\r\nimport CodePage from \"./CodePage\";\r\nexport default new CodePage(\"English: UK Extended\", \"en-GB\", {\r\n  CTRLALT: {\r\n    \"52\": \"€\",\r\n    \"65\": \"á\",\r\n    \"69\": \"é\",\r\n    \"73\": \"í\",\r\n    \"79\": \"ó\",\r\n    \"85\": \"ú\",\r\n    \"163\": \"\\\\\",\r\n    \"192\": \"¦\",\r\n    \"222\": \"\\\\\",\r\n    \"223\": \"¦\"\r\n  },\r\n  CTRLALTSHIFT: {\r\n    \"65\": \"Á\",\r\n    \"69\": \"É\",\r\n    \"73\": \"Í\",\r\n    \"79\": \"Ó\",\r\n    \"85\": \"Ú\",\r\n    \"222\": \"|\"\r\n  },\r\n  NORMAL: {\r\n    \"32\": \" \",\r\n    \"48\": \"0\",\r\n    \"49\": \"1\",\r\n    \"50\": \"2\",\r\n    \"51\": \"3\",\r\n    \"52\": \"4\",\r\n    \"53\": \"5\",\r\n    \"54\": \"6\",\r\n    \"55\": \"7\",\r\n    \"56\": \"8\",\r\n    \"57\": \"9\",\r\n    \"59\": \";\",\r\n    \"61\": \"=\",\r\n    \"163\": \"#\",\r\n    \"173\": \"-\",\r\n    \"186\": \";\",\r\n    \"187\": \"=\",\r\n    \"188\": \",\",\r\n    \"189\": \"-\",\r\n    \"190\": \".\",\r\n    \"191\": \"/\",\r\n    \"192\": \"'\",\r\n    \"219\": \"[\",\r\n    \"220\": \"\\\\\",\r\n    \"221\": \"]\",\r\n    \"222\": \"#\",\r\n    \"223\": \"`\"\r\n  },\r\n  SHIFT: {\r\n    \"32\": \" \",\r\n    \"48\": \")\",\r\n    \"49\": \"!\",\r\n    \"50\": \"\\\"\",\r\n    \"51\": \"£\",\r\n    \"52\": \"$\",\r\n    \"53\": \"%\",\r\n    \"54\": \"^\",\r\n    \"55\": \"&\",\r\n    \"56\": \"*\",\r\n    \"57\": \"(\",\r\n    \"59\": \":\",\r\n    \"61\": \"+\",\r\n    \"163\": \"~\",\r\n    \"173\": \"_\",\r\n    \"186\": \":\",\r\n    \"187\": \"+\",\r\n    \"188\": \"<\",\r\n    \"189\": \"_\",\r\n    \"190\": \">\",\r\n    \"191\": \"?\",\r\n    \"192\": \"@\",\r\n    \"219\": \"{\",\r\n    \"220\": \"|\",\r\n    \"221\": \"}\",\r\n    \"222\": \"~\",\r\n    \"223\": \"¬\"\r\n  }\r\n});","pliny.record({\r\n  parent: \"Primrose.Text.CodePages\",\r\n  name: \"EN_US\",\r\n  description: \"CodePage for the `English: USA` locale.\"\r\n});\r\n\r\nimport CodePage from \"./CodePage\";\r\nexport default new CodePage(\"English: USA\", \"en-US\", {\r\n  NORMAL: {\r\n    \"32\": \" \",\r\n    \"48\": \"0\",\r\n    \"49\": \"1\",\r\n    \"50\": \"2\",\r\n    \"51\": \"3\",\r\n    \"52\": \"4\",\r\n    \"53\": \"5\",\r\n    \"54\": \"6\",\r\n    \"55\": \"7\",\r\n    \"56\": \"8\",\r\n    \"57\": \"9\",\r\n    \"59\": \";\",\r\n    \"61\": \"=\",\r\n    \"173\": \"-\",\r\n    \"186\": \";\",\r\n    \"187\": \"=\",\r\n    \"188\": \",\",\r\n    \"189\": \"-\",\r\n    \"190\": \".\",\r\n    \"191\": \"/\",\r\n    \"219\": \"[\",\r\n    \"220\": \"\\\\\",\r\n    \"221\": \"]\",\r\n    \"222\": \"'\"\r\n  },\r\n  SHIFT: {\r\n    \"32\": \" \",\r\n    \"48\": \")\",\r\n    \"49\": \"!\",\r\n    \"50\": \"@\",\r\n    \"51\": \"#\",\r\n    \"52\": \"$\",\r\n    \"53\": \"%\",\r\n    \"54\": \"^\",\r\n    \"55\": \"&\",\r\n    \"56\": \"*\",\r\n    \"57\": \"(\",\r\n    \"59\": \":\",\r\n    \"61\": \"+\",\r\n    \"173\": \"_\",\r\n    \"186\": \":\",\r\n    \"187\": \"+\",\r\n    \"188\": \"<\",\r\n    \"189\": \"_\",\r\n    \"190\": \">\",\r\n    \"191\": \"?\",\r\n    \"219\": \"{\",\r\n    \"220\": \"|\",\r\n    \"221\": \"}\",\r\n    \"222\": \"\\\"\"\r\n  }\r\n});","pliny.record({\r\n  parent: \"Primrose.Text.CodePages\",\r\n  name: \"FR_AZERTY\",\r\n  description: \"CodePage for the `Français: AZERTY` locale.\"\r\n});\r\n\r\nimport CodePage from \"./CodePage\";\r\nexport default new CodePage(\"Français: AZERTY\", \"fr\", {\r\n  deadKeys: [221, 50, 55],\r\n  NORMAL: {\r\n    \"32\": \" \",\r\n    \"48\": \"à\",\r\n    \"49\": \"&\",\r\n    \"50\": \"é\",\r\n    \"51\": \"\\\"\",\r\n    \"52\": \"'\",\r\n    \"53\": \"(\",\r\n    \"54\": \"-\",\r\n    \"55\": \"è\",\r\n    \"56\": \"_\",\r\n    \"57\": \"ç\",\r\n    \"186\": \"$\",\r\n    \"187\": \"=\",\r\n    \"188\": \",\",\r\n    \"190\": \";\",\r\n    \"191\": \":\",\r\n    \"192\": \"ù\",\r\n    \"219\": \")\",\r\n    \"220\": \"*\",\r\n    \"221\": CodePage.DEAD(1),\r\n    \"222\": \"²\",\r\n    \"223\": \"!\",\r\n    \"226\": \"<\"\r\n  },\r\n  SHIFT: {\r\n    \"32\": \" \",\r\n    \"48\": \"0\",\r\n    \"49\": \"1\",\r\n    \"50\": \"2\",\r\n    \"51\": \"3\",\r\n    \"52\": \"4\",\r\n    \"53\": \"5\",\r\n    \"54\": \"6\",\r\n    \"55\": \"7\",\r\n    \"56\": \"8\",\r\n    \"57\": \"9\",\r\n    \"186\": \"£\",\r\n    \"187\": \"+\",\r\n    \"188\": \"?\",\r\n    \"190\": \".\",\r\n    \"191\": \"/\",\r\n    \"192\": \"%\",\r\n    \"219\": \"°\",\r\n    \"220\": \"µ\",\r\n    \"223\": \"§\",\r\n    \"226\": \">\"\r\n  },\r\n  CTRLALT: {\r\n    \"48\": \"@\",\r\n    \"50\": CodePage.DEAD(2),\r\n    \"51\": \"#\",\r\n    \"52\": \"{\",\r\n    \"53\": \"[\",\r\n    \"54\": \"|\",\r\n    \"55\": CodePage.DEAD(3),\r\n    \"56\": \"\\\\\",\r\n    \"57\": \"^\",\r\n    \"69\": \"€\",\r\n    \"186\": \"¤\",\r\n    \"187\": \"}\",\r\n    \"219\": \"]\"\r\n  },\r\n  DEAD1NORMAL: {\r\n    \"65\": \"â\",\r\n    \"69\": \"ê\",\r\n    \"73\": \"î\",\r\n    \"79\": \"ô\",\r\n    \"85\": \"û\"\r\n  },\r\n  DEAD2NORMAL: {\r\n    \"65\": \"ã\",\r\n    \"78\": \"ñ\",\r\n    \"79\": \"õ\"\r\n  },\r\n  DEAD3NORMAL: {\r\n    \"48\": \"à\",\r\n    \"50\": \"é\",\r\n    \"55\": \"è\",\r\n    \"65\": \"à\",\r\n    \"69\": \"è\",\r\n    \"73\": \"ì\",\r\n    \"79\": \"ò\",\r\n    \"85\": \"ù\"\r\n  }\r\n});","pliny.namespace({\r\n  parent: \"Primrose.Text\",\r\n  name: \"CodePages\",\r\n  description: \"The CodePages namespace contains international keyboard parameters.\"\r\n});\r\n\r\nimport CodePage from \"./CodePage\";\r\nimport DE_QWERTZ from \"./DE_QWERTZ\";\r\nimport EN_UKX from \"./EN_UKX\";\r\nimport EN_US from \"./EN_US\";\r\nimport FR_AZERTY from \"./FR_AZERTY\";\r\n\r\nexport {\r\n  CodePage,\r\n  DE_QWERTZ,\r\n  EN_UKX,\r\n  EN_US,\r\n  FR_AZERTY\r\n};\r\n\r\nexport default {\r\n  CodePage,\r\n  DE_QWERTZ,\r\n  EN_UKX,\r\n  EN_US,\r\n  FR_AZERTY\r\n};","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n    name: \"Keyboard\",\r\n    baseClass: \"Primrose.Input.InputProcessor\",\r\n    description: \"| [under construction]\",\r\n    parameters: [{\r\n      name: \"\",\r\n      type: \"\",\r\n      description: \"\"\r\n    }, {\r\n      name: \"\",\r\n      type: \"\",\r\n      description: \"\"\r\n    }, {\r\n      name: \"\",\r\n      type: \"\",\r\n      description: \"\"\r\n    }, {\r\n      name: \"\",\r\n      type: \"\",\r\n      description: \"\"\r\n    }]\r\n});\r\n\r\nimport InputProcessor from \"./InputProcessor\";\r\nimport isFirefox from \"../../flags/isFirefox\";\r\nimport isChrome from \"../../flags/isChrome\";\r\nimport isIE from \"../../flags/isIE\";\r\nimport isOpera from \"../../flags/isOpera\";\r\nimport isSafari from \"../../flags/isSafari\";\r\nimport isMacOS from \"../../flags/isMacOS\";\r\nimport Windows from \"../Text/OperatingSystems/Windows\";\r\nimport macOS from \"../Text/OperatingSystems/macOS\";\r\nimport CodePages from \"../Text/CodePages\";\r\nexport default class Keyboard extends InputProcessor {\r\n  constructor(input, commands) {\r\n    super(\"Keyboard\", commands);\r\n\r\n    this._operatingSystem = null;\r\n    this.browser = isChrome ? \"CHROMIUM\" : (isFirefox ? \"FIREFOX\" : (isIE ? \"IE\" : (isOpera ? \"OPERA\" : (isSafari ? \"SAFARI\" : \"UNKNOWN\"))));\r\n    this._codePage = null;\r\n    this.resetDeadKeyState = () => this.codePage.resetDeadKeyState();\r\n  }\r\n\r\n  consumeEvent(evt) {\r\n    this.inPhysicalUse = true;\r\n    const isKeyDown = evt.type === \"keydown\";\r\n    this.setButton(evt.keyCode, isKeyDown);\r\n    if(isKeyDown) {\r\n      evt.cmdName = this.operatingSystem.makeCommandName(evt, this.codePage);\r\n      evt.altCmdName = this.browser + \"_\" + evt.cmdName;\r\n      evt.cmdText = this.codePage[evt.cmdName];\r\n      evt.altCmdText = this.codePage[evt.altCmdName];\r\n      evt.resetDeadKeyState = this.resetDeadKeyState;\r\n    }\r\n  }\r\n\r\n  get operatingSystem() {\r\n    return this._operatingSystem;\r\n  }\r\n\r\n  set operatingSystem(os) {\r\n    this._operatingSystem = os || (isMacOS ? macOS : Windows);\r\n  }\r\n\r\n  get codePage() {\r\n    return this._codePage;\r\n  }\r\n\r\n  set codePage(cp) {\r\n    var key,\r\n      code,\r\n      char,\r\n      name;\r\n    this._codePage = cp;\r\n    if (!this._codePage) {\r\n      var lang = (navigator.languages && navigator.languages[0]) ||\r\n        navigator.language ||\r\n        navigator.userLanguage ||\r\n        navigator.browserLanguage;\r\n\r\n      if (!lang || lang === \"en\") {\r\n        lang = \"en-US\";\r\n      }\r\n\r\n      for (key in CodePages) {\r\n        cp = CodePages[key];\r\n        if (cp.language === lang) {\r\n          this._codePage = cp;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (!this._codePage) {\r\n        this._codePage = CodePages.EN_US;\r\n      }\r\n    }\r\n  }\r\n}\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"Mouse\",\r\n  baseClass: \"Primrose.Input.InputProcessor\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport InputProcessor from \"./InputProcessor\";\r\nimport isChrome from \"../../flags/isChrome\";\r\nimport PointerLock from \"../../util/PointerLock\";\r\nexport default class Mouse extends InputProcessor {\r\n  constructor(DOMElement, commands) {\r\n    super(\"Mouse\", commands, [\"BUTTONS\", \"X\", \"Y\", \"Z\", \"W\"], \"mousedown\");\r\n    this.timer = null;\r\n\r\n    var setState = (stateChange, event) => {\r\n      this.inPhysicalUse = true;\r\n      var state = event.buttons;\r\n      for(let button = 0; button < Mouse.NUM_BUTTONS; ++button) {\r\n        var isDown = state & 0x1 !== 0;\r\n        if(isDown && stateChange || !isDown && !stateChange){\r\n          this.setButton(button, stateChange);\r\n        }\r\n        state >>= 1;\r\n      }\r\n      this.setAxis(\"BUTTONS\", event.buttons << 10);\r\n      if(event.target === DOMElement){\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    DOMElement.addEventListener(\"mousedown\", setState.bind(this, true), false);\r\n    DOMElement.addEventListener(\"mouseup\", setState.bind(this, false), false);\r\n    DOMElement.addEventListener(\"contextmenu\", (event) => !(event.ctrlKey && event.shiftKey) && event.preventDefault(), false);\r\n    DOMElement.addEventListener(\"mousemove\", (event) => {\r\n      setState(true, event);\r\n\r\n      if (PointerLock.isActive) {\r\n        var mx = event.movementX,\r\n          my = event.movementY;\r\n\r\n        if (mx === undefined) {\r\n          mx = event.webkitMovementX || event.mozMovementX || 0;\r\n          my = event.webkitMovementY || event.mozMovementY || 0;\r\n        }\r\n        this.setAxis(\"X\", this.getAxis(\"X\") + mx);\r\n        this.setAxis(\"Y\", this.getAxis(\"Y\") + my);\r\n      }\r\n      else {\r\n        this.setAxis(\"X\", event.layerX);\r\n        this.setAxis(\"Y\", event.layerY);\r\n      }\r\n    }, false);\r\n\r\n    DOMElement.addEventListener(\"wheel\", (event) => {\r\n      if (isChrome) {\r\n        this.W += event.deltaX;\r\n        this.Z += event.deltaY;\r\n      }\r\n      else if (event.shiftKey) {\r\n        this.W += event.deltaY;\r\n      }\r\n      else {\r\n        this.Z += event.deltaY;\r\n      }\r\n      if(event.target === DOMElement){\r\n        event.preventDefault();\r\n      }\r\n    }, false);\r\n  }\r\n};\r\n\r\nMouse.NUM_BUTTONS = 3;\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"PoseInputProcessor\",\r\n  baseClass: \"Primrose.Input.InputProcessor\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nconst DEFAULT_POSE = {\r\n    position: [0, 0, 0],\r\n    orientation: [0, 0, 0, 1]\r\n  },\r\n  EMPTY_SCALE = new Vector3(),\r\n  IE_CORRECTION = new Quaternion(1, 0, 0, 0);\r\n\r\nimport { Vector3, Quaternion, Matrix4 } from \"three\";\r\nimport InputProcessor from \"./InputProcessor\";\r\nimport isMobile from \"../../flags/isMobile\";\r\nimport isIE from \"../../flags/isIE\";\r\nexport default class PoseInputProcessor extends InputProcessor {\r\n  constructor(name, commands, axisNames) {\r\n    super(name, commands, axisNames);\r\n\r\n    this.currentDevice = null;\r\n    this.lastPose = null;\r\n    this.currentPose = null;\r\n    this.posePosition = new Vector3();\r\n    this.poseQuaternion = new Quaternion();\r\n    this.position = new Vector3();\r\n    this.quaternion = new Quaternion();\r\n    this.matrix = new Matrix4();\r\n  }\r\n\r\n  get hasPose() {\r\n    return !!this.currentPose;\r\n  }\r\n\r\n  update(dt) {\r\n    super.update(dt);\r\n\r\n    if (this.currentDevice) {\r\n      var pose = this.currentPose || this.lastPose || DEFAULT_POSE;\r\n      this.lastPose = pose;\r\n      this.inPhysicalUse = this.hasOrientation || this.inPhysicalUse;\r\n      var orient = this.currentPose && this.currentPose.orientation,\r\n        pos = this.currentPose && this.currentPose.position;\r\n      if (orient) {\r\n        this.poseQuaternion.fromArray(orient);\r\n        if(isMobile && isIE){\r\n          this.poseQuaternion.multiply(IE_CORRECTION);\r\n        }\r\n      }\r\n      else {\r\n        this.poseQuaternion.set(0, 0, 0, 1);\r\n      }\r\n      if (pos) {\r\n        this.posePosition.fromArray(pos);\r\n      }\r\n      else {\r\n        this.posePosition.set(0, 0, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateStage(stageMatrix) {\r\n    this.matrix.makeRotationFromQuaternion(this.poseQuaternion);\r\n    this.matrix.setPosition(this.posePosition);\r\n    this.matrix.multiplyMatrices(stageMatrix, this.matrix);\r\n    this.matrix.decompose(this.position, this.quaternion, EMPTY_SCALE);\r\n  }\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"Gamepad\",\r\n  baseClass: \"Primrose.Input.PoseInputProcessor\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nfunction playPattern(devices, pattern, pause){\r\n  if(pattern.length > 0){\r\n    const length = pattern.shift();\r\n    if(!pause){\r\n      for(var i = 0; i < devices.length; ++i){\r\n        devices[0].vibrate(1, length);\r\n      }\r\n    }\r\n    setTimeout(playPattern, length, devices, pattern, !pause);\r\n  }\r\n}\r\n\r\nimport PoseInputProcessor from \"./PoseInputProcessor\"\r\nexport default class Gamepad extends PoseInputProcessor {\r\n  static ID(pad) {\r\n    var id = pad.id;\r\n    if (id === \"OpenVR Gamepad\") {\r\n      id = \"Vive\";\r\n    }\r\n    else if (id.indexOf(\"Rift\") === 0) {\r\n      id = \"Rift\";\r\n    }\r\n    else if (id.indexOf(\"Unknown\") === 0) {\r\n      id = \"Unknown\";\r\n    }\r\n    else {\r\n      id = \"Gamepad\";\r\n    }\r\n    id = (id + \"_\" + (pad.index || 0))\r\n      .replace(/\\s+/g, \"_\");\r\n    return id;\r\n  }\r\n\r\n  static isMotionController(pad){\r\n    if(pad) {\r\n      const obj = pad.capabilities || pad.pose;\r\n      return obj && obj.hasOrientation;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  constructor(mgr, pad, axisOffset, commands) {\r\n    var padID = Gamepad.ID(pad);\r\n    super(padID, commands, [\"LSX\", \"LSY\", \"RSX\", \"RSY\", \"IDK1\", \"IDK2\", \"Z\", \"BUTTONS\"]);\r\n    mgr.registerPad(padID, this)\r\n\r\n    this.currentDevice = pad;\r\n    this.axisOffset = axisOffset;\r\n  }\r\n\r\n  get hasOrientation() {\r\n    return Gamepad.isMotionController(this.currentDevice);\r\n  }\r\n\r\n  getPose() {\r\n    return this.currentPose;\r\n  }\r\n\r\n  checkDevice(pad) {\r\n    this.inPhysicalUse = true;\r\n    var i, j, buttonMap = 0;\r\n    this.currentDevice = pad;\r\n    this.currentPose = this.hasOrientation && this.currentDevice.pose;\r\n    for (i = 0, j = pad.buttons.length; i < pad.buttons.length; ++i, ++j) {\r\n      var btn = pad.buttons[i];\r\n      this.setButton(i, btn.pressed);\r\n      if (btn.pressed) {\r\n        buttonMap |= 0x1 << i;\r\n      }\r\n\r\n      this.setButton(j, btn.touched);\r\n      if(btn.touched){\r\n        buttonMap |= 0x1 << j;\r\n      }\r\n    }\r\n    this.setAxis(\"BUTTONS\", buttonMap);\r\n    for (i = 0; i < pad.axes.length; ++i) {\r\n      var axisName = this.axisNames[this.axisOffset * pad.axes.length + i],\r\n        axisValue = pad.axes[i];\r\n      this.setAxis(axisName, axisValue);\r\n    }\r\n  }\r\n\r\n  vibratePattern(pattern) {\r\n    if(this.currentDevice){\r\n      if (this.currentDevice.vibrate) {\r\n        this.currentDevice.vibrate(pattern);\r\n      }\r\n      else if(this.currentDevice.haptics && this.currentDevice.haptics.length > 0) {\r\n        playPattern(this.currentDevice.haptics, pattern);\r\n      }\r\n    }\r\n  }\r\n\r\n  get haptics() {\r\n    return this.currentDevice && this.currentDevice.haptics;\r\n  }\r\n}\r\n\r\npliny.enumeration({\r\n  parent: \"Primrose.Input.Gamepad\",\r\n  name: \"XBOX_360_BUTTONS\",\r\n  description: \"Labeled names for each of the different control features of the Xbox 360 controller.\"\r\n});\r\nGamepad.XBOX_360_BUTTONS = {\r\n  A: 1,\r\n  B: 2,\r\n  X: 3,\r\n  Y: 4,\r\n  LEFT_BUMPER: 5,\r\n  RIGHT_BUMPER: 6,\r\n  LEFT_TRIGGER: 7,\r\n  RIGHT_TRIGGER: 8,\r\n  BACK: 9,\r\n  START: 10,\r\n  LEFT_STICK: 11,\r\n  RIGHT_STICK: 12,\r\n  UP_DPAD: 13,\r\n  DOWN_DPAD: 14,\r\n  LEFT_DPAD: 15,\r\n  RIGHT_DPAD: 16\r\n};\r\n\r\npliny.enumeration({\r\n  parent: \"Primrose.Input.Gamepad\",\r\n  name: \"XBOX_ONE_BUTTONS\",\r\n  description: \"Labeled names for each of the different control features of the Xbox 360 controller.\"\r\n});\r\nGamepad.XBOX_ONE_BUTTONS = {\r\n  A: 1,\r\n  B: 2,\r\n  X: 3,\r\n  Y: 4,\r\n  LEFT_BUMPER: 5,\r\n  RIGHT_BUMPER: 6,\r\n  LEFT_TRIGGER: 7,\r\n  RIGHT_TRIGGER: 8,\r\n  BACK: 9,\r\n  START: 10,\r\n  LEFT_STICK: 11,\r\n  RIGHT_STICK: 12,\r\n  UP_DPAD: 13,\r\n  DOWN_DPAD: 14,\r\n  LEFT_DPAD: 15,\r\n  RIGHT_DPAD: 16\r\n};\r\n\r\npliny.enumeration({\r\n  parent: \"Primrose.Input.Gamepad\",\r\n  name: \"VIVE_BUTTONS\",\r\n  description: \"Labeled names for each of the different control buttons of the HTC Vive Motion Controllers.\"\r\n});\r\nGamepad.VIVE_BUTTONS = {\r\n  TOUCHPAD_PRESSED: 0,\r\n  TRIGGER_PRESSED: 1,\r\n  GRIP_PRESSED: 2,\r\n  MENU_PRESSED: 3,\r\n\r\n  TOUCHPAD_TOUCHED: 4,\r\n  //TRIGGER_TOUCHED: 5, // doesn't ever actually trigger in the current version of Chromium - STM 6/22/2016\r\n  GRIP_TOUCHED: 6,\r\n  MENU_TOUCHED: 7\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"GamepadManager\",\r\n  baseClass: \"THREE.EventDispatcher\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nconst blackList = [\r\n\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2910.0 Safari/537.36\"\r\n];\r\n\r\n\r\nnavigator.getGamepads = navigator.getGamepads ||\r\n  navigator.webkitGetGamepads;\r\n\r\nimport { EventDispatcher } from \"three\";\r\nimport Gamepad from \"./Gamepad\";\r\nexport default class GamepadManager extends EventDispatcher {\r\n\r\n  static get isAvailable() {\r\n    return blackList.indexOf(navigator.userAgent) === -1\r\n     && !!navigator.getGamepads;\r\n  }\r\n\r\n  constructor(){\r\n    super();\r\n    this.currentDevices = [];\r\n    this.currentDeviceIDs = [];\r\n    this.currentManagers = {};\r\n  }\r\n\r\n  poll() {\r\n    if(GamepadManager.isAvailable){\r\n      var maybePads = navigator.getGamepads(),\r\n        pads = [],\r\n        padIDs = [],\r\n        newPads = [],\r\n        oldPads = [],\r\n        i, padID;\r\n\r\n      if (maybePads) {\r\n        for (i = 0; i < maybePads.length; ++i) {\r\n          var maybePad = maybePads[i];\r\n          if (maybePad) {\r\n            padID = Gamepad.ID(maybePad);\r\n            var padIdx = this.currentDeviceIDs.indexOf(padID);\r\n            pads.push(maybePad);\r\n            padIDs.push(padID);\r\n            if (padIdx === -1) {\r\n              newPads.push(maybePad);\r\n              this.currentDeviceIDs.push(padID);\r\n              this.currentDevices.push(maybePad);\r\n              delete this.currentManagers[padID];\r\n            }\r\n            else {\r\n              this.currentDevices[padIdx] = maybePad;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      for (i = this.currentDeviceIDs.length - 1; i >= 0; --i) {\r\n        padID = this.currentDeviceIDs[i];\r\n        var mgr = this.currentManagers[padID],\r\n          pad = this.currentDevices[i];\r\n        if (padIDs.indexOf(padID) === -1) {\r\n          oldPads.push(padID);\r\n          this.currentDevices.splice(i, 1);\r\n          this.currentDeviceIDs.splice(i, 1);\r\n        }\r\n        else if (mgr) {\r\n          mgr.checkDevice(pad);\r\n        }\r\n      }\r\n\r\n      newPads.forEach(this.emit.bind(this, \"gamepadconnected\"));\r\n      oldPads.forEach(this.emit.bind(this, \"gamepaddisconnected\"));\r\n    }\r\n  }\r\n\r\n  registerPad(id, mgr){\r\n    this.currentManagers[id] = mgr;\r\n  }\r\n\r\n  get pads() {\r\n    return this.currentDevices;\r\n  }\r\n}\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"Touch\",\r\n  baseClass: \"Primrose.Input.InputProcessor\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nconst TEMP = new Vector2();\r\n\r\nimport { Vector2 } from \"three\";\r\nimport InputProcessor from \"./InputProcessor\";\r\nexport default class Touch extends InputProcessor {\r\n  constructor(DOMElement, commands) {\r\n    var axes = [\"FINGERS\"];\r\n    for (var i = 0; i < 10; ++i) {\r\n      axes.push(\"X\" + i);\r\n      axes.push(\"Y\" + i);\r\n      axes.push(\"LX\" + i);\r\n      axes.push(\"LY\" + i);\r\n      axes.push(\"DX\" + i);\r\n      axes.push(\"DY\" + i);\r\n    }\r\n    super(\"Touch\", commands, axes, \"touchend\");\r\n\r\n    var setState = (stateChange, setAxis, event) => {\r\n      this.inPhysicalUse = true;\r\n      // We have to find the minimum identifier value because iOS uses a very\r\n      // large number that changes after every gesture. Every other platform\r\n      // just numbers them 0 through 9.\r\n      let touches = event.changedTouches,\r\n        minIdentifier = Number.MAX_VALUE;\r\n      for (let i = 0; i < touches.length; ++i) {\r\n        minIdentifier = Math.min(minIdentifier, touches[i].identifier);\r\n      }\r\n\r\n      for (let i = 0; i < touches.length; ++i) {\r\n        const t = touches[i],\r\n          id = t.identifier - minIdentifier,\r\n          x = t.pageX,\r\n          y = t.pageY;\r\n        this.setAxis(\"X\" + id, x);\r\n        this.setAxis(\"Y\" + id, y);\r\n        this.setButton(\"FINGER\" + t.identifier, stateChange);\r\n\r\n        if(setAxis){\r\n          const lx = this.getAxis(\"LX\" + id),\r\n            ly = this.getAxis(\"LY\" + id);\r\n          this.setAxis(\"DX\" + id, x - lx);\r\n          this.setAxis(\"DY\" + id, y - ly);\r\n        }\r\n\r\n        this.setAxis(\"LX\" + id, x);\r\n        this.setAxis(\"LY\" + id, y);\r\n      }\r\n\r\n      touches = event.touches;\r\n      let fingerState = 0;\r\n      for (let i = 0; i < touches.length; ++i) {\r\n        const t = touches[i];\r\n        fingerState |= 1 << t.identifier;\r\n      }\r\n      this.setAxis(\"FINGERS\", fingerState);\r\n\r\n      if(event.target === DOMElement){\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    DOMElement.addEventListener(\"touchstart\", setState.bind(this, true, false), false);\r\n    DOMElement.addEventListener(\"touchend\", setState.bind(this, false, true), false);\r\n    DOMElement.addEventListener(\"touchmove\", setState.bind(this, true, true), false);\r\n  }\r\n\r\n  update(dt) {\r\n    super.update(dt);\r\n    for (let id = 0; id < 10; ++id) {\r\n      const x = this.getAxis(\"X\" + id),\r\n        y = this.getAxis(\"Y\" + id),\r\n        lx = this.getAxis(\"LX\" + id),\r\n        ly = this.getAxis(\"LY\" + id);\r\n      this.setAxis(\"DX\" + id, x - lx);\r\n      this.setAxis(\"DY\" + id, y - ly);\r\n      this.setAxis(\"LX\" + id, x);\r\n      this.setAxis(\"LY\" + id, y);\r\n    }\r\n  }\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"Speech\",\r\n  baseClass: \"Primrose.Input.InputProcessor\",\r\n  description: \"Connects to a the webkitSpeechRecognition API and manages callbacks based on keyword sets related to the callbacks. Note that the webkitSpeechRecognition API requires a network connection, as the processing is done on an external server.\",\r\n  parameters: [{\r\n    name: \"commands\",\r\n    type: \"Array\",\r\n    description: \"The `commands` parameter specifies a collection of keywords tied to callbacks that will be called when one of the keywords are heard. Each callback can be associated with multiple keywords, to be able to increase the accuracy of matches by combining words and phrases that sound similar.\\n\\\r\n\\n\\\r\nEach command entry is a simple object following the pattern:\\n\\\r\n\\n\\\r\n    {\\n\\\r\n      \\\"keywords\\\": [\\\"phrase no. 1\\\", \\\"phrase no. 2\\\", ...],\\n\\\r\n      \\\"command\\\": <callbackFunction>\\n\\\r\n    }\\n\\\r\n\\n\\\r\nThe `keywords` property is an array of strings for which SpeechInput will listen. If any of the words or phrases in the array matches matches the heard command, the associated callbackFunction will be executed.\\n\\\r\n\\n\\\r\nThe `command` property is the callback function that will be executed. It takes no parameters.\"\r\n    }]\r\n});\r\n\r\nimport InputProcessor from \"./InputProcessor\";\r\nexport default class Speech extends InputProcessor {\r\n  constructor(commands) {\r\n    super(\"Speech\", commands);\r\n    var running = false,\r\n      recognition = null,\r\n      errorMessage = null;\r\n\r\n    function warn() {\r\n      var msg = \"Failed to initialize speech engine. Reason: \" + errorMessage.message;\r\n      console.error(msg);\r\n      return false;\r\n    }\r\n\r\n    function start() {\r\n      if (!available) {\r\n        return warn();\r\n      }\r\n      else if (!running) {\r\n        running = true;\r\n        recognition.start();\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    function stop() {\r\n      if (!available) {\r\n        return warn();\r\n      }\r\n      if (running) {\r\n        recognition.stop();\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    this.check = function () {\r\n      if (this.enabled && !running) {\r\n        start();\r\n      }\r\n      else if (!this.enabled && running) {\r\n        stop();\r\n      }\r\n    };\r\n\r\n    this.getErrorMessage = function () {\r\n      return errorMessage;\r\n    };\r\n\r\n    try {\r\n      if (window.SpeechRecognition) {\r\n        // just in case this ever gets standardized\r\n        recognition = new SpeechRecognition();\r\n      }\r\n      else {\r\n        // purposefully don't check the existance so it errors out and setup fails.\r\n        recognition = new webkitSpeechRecognition();\r\n      }\r\n      recognition.continuous = true;\r\n      recognition.interimResults = true;\r\n      recognition.lang = \"en-US\";\r\n      var restart = false;\r\n      recognition.addEventListener(\"start\", function () {\r\n        console.log(\"speech started\");\r\n        command = \"\";\r\n      }.bind(this), true);\r\n\r\n      recognition.addEventListener(\"error\", function (evt) {\r\n        restart = true;\r\n        console.log(\"speech error\", evt);\r\n        running = false;\r\n        command = \"speech error\";\r\n      }.bind(this), true);\r\n\r\n      recognition.addEventListener(\"end\", function (evt) {\r\n        console.log(\"speech ended\", evt);\r\n        running = false;\r\n        command = \"speech ended\";\r\n        if (restart) {\r\n          restart = false;\r\n          this.enable(true);\r\n        }\r\n      }.bind(this), true);\r\n\r\n      recognition.addEventListener(\"result\", function (evt) {\r\n        var newCommand = [];\r\n        var result = evt.results[evt.resultIndex];\r\n        var max = 0;\r\n        var maxI = -1;\r\n        if (result && result.isFinal) {\r\n          for (var i = 0; i < result.length; ++i) {\r\n            var alt = result[i];\r\n            if (alt.confidence > max) {\r\n              max = alt.confidence;\r\n              maxI = i;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (max > 0.85) {\r\n          newCommand.push(result[maxI].transcript.trim());\r\n        }\r\n\r\n        newCommand = newCommand.join(\" \");\r\n\r\n        if (newCommand !== this.inputState) {\r\n          this.inputState.text = newCommand;\r\n        }\r\n        this.update();\r\n      }.bind(this), true);\r\n\r\n      available = true;\r\n    }\r\n    catch (exp) {\r\n      console.error(exp);\r\n      errorMessage = exp;\r\n      available = false;\r\n    }\r\n  }\r\n\r\n  static maybeClone(arr) {\r\n    return (arr && arr.slice()) || [];\r\n  }\r\n\r\n  cloneCommand(cmd) {\r\n    return {\r\n      name: cmd.name,\r\n      preamble: cmd.preamble,\r\n      keywords: Speech.maybeClone(cmd.keywords),\r\n      commandUp: cmd.commandUp,\r\n      disabled: cmd.disabled\r\n    };\r\n  }\r\n\r\n  evalCommand(cmd, cmdState, metaKeysSet, dt) {\r\n    if (metaKeysSet && this.inputState.text) {\r\n      for (var i = 0; i < cmd.keywords.length; ++i) {\r\n        if (this.inputState.text.indexOf(cmd.keywords[i]) === 0 && (cmd.preamble || cmd.keywords[i].length === this.inputState.text.length)) {\r\n          cmdState.pressed = true;\r\n          cmdState.value = this.inputState.text.substring(cmd.keywords[i].length)\r\n            .trim();\r\n          this.inputState.text = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  enable(k, v) {\r\n    super.enable(k, v);\r\n    this.check();\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Displays.SensorFusion\",\r\n  name: \"SensorSample\",\r\n  description: \"A combination of a sensor reading and a timestamp.\",\r\n  parameters: [{\r\n    name: \"sample\",\r\n    type: \"Object\",\r\n    description: \"The sensor reading we want to record. Can be any value, really, as it's just read back out again, correlated with a timestamp.\"\r\n  },{\r\n    name: \"timestampS\",\r\n    type: \"Number\",\r\n    description: \"The time at which the sensor sample was recorded. It's important that all timestamps between values that are meant to be compared together be recorded from the source, as there are multiple sources of \\\"time\\\" in the browser, with subtly different meanings, precisions, and starting points.\"\r\n  }]\r\n});\r\n\r\nexport default class SensorSample {\r\n  constructor (sample, timestampS) {\r\n    this.set(sample, timestampS);\r\n  }\r\n\r\n  set(sample, timestampS) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Displays.SensorFusion.SensorSample\",\r\n      name: \"set\",\r\n      description: \"Mutably set the current state of the object.\",\r\n      parameters: [{\r\n        name: \"sample\",\r\n        type: \"Object\",\r\n        description: \"The sensor reading we want to record. Can be any value, really, as it's just read back out again, correlated with a timestamp.\"\r\n      },{\r\n        name: \"timestampS\",\r\n        type: \"Number\",\r\n        description: \"The time at which the sensor sample was recorded. It's important that all timestamps between values that are meant to be compared together be recorded from the source, as there are multiple sources of \\\"time\\\" in the browser, with subtly different meanings, precisions, and starting points.\"\r\n      }]\r\n    });\r\n\r\n    this.sample = sample;\r\n    this.timestampS = timestampS;\r\n  }\r\n\r\n  copy(sensorSample) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.Displays.SensorFusion.SensorSample\",\r\n      name: \"copy\",\r\n      description: \"Mutably copy the current state of the object from another `SensorSample` object.\",\r\n      parameters: [{\r\n        name: \"sensorSample\",\r\n        type: \"Primrose.Displays.SensorFusion.SensorSample\",\r\n        description: \"The object to copy.\"\r\n      }]\r\n    });\r\n\r\n    this.set(sensorSample.sample, sensorSample.timestampS);\r\n  }\r\n};","/*\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport SensorSample from \"./SensorSample\";\r\nimport { Math as _Math, Quaternion, Vector3 } from \"three\";\r\nimport isTimestampDeltaValid from \"../../../util/isTimestampDeltaValid\";\r\nimport isiOS from \"../../../flags/isiOS\";\r\n\r\nconst { RAD2DEG } = _Math;\r\n\r\n/**\r\n * An implementation of a simple complementary filter, which fuses gyroscope and accelerometer data from the 'devicemotion' event.\r\n *\r\n * Accelerometer data is very noisy, but stable over the long term. Gyroscope data is smooth, but tends to drift over the long term.\r\n *\r\n * This fusion is relatively simple:\r\n * 1. Get orientation estimates from accelerometer by applying a low-pass filter on that data.\r\n * 2. Get orientation estimates from gyroscope by integrating over time.\r\n * 3. Combine the two estimates, weighing (1) in the long term, but (2) for the short term.\r\n */\r\nexport default class ComplementaryFilter {\r\n  constructor(kFilter) {\r\n    this.kFilter = kFilter;\r\n\r\n    // Raw sensor measurements.\r\n    this.currentAccelMeasurement = new SensorSample();\r\n    this.currentGyroMeasurement = new SensorSample();\r\n    this.previousGyroMeasurement = new SensorSample();\r\n\r\n    // Set default look direction to be in the correct direction.\r\n    if (isiOS) {\r\n      this.filterQ = new Quaternion(-1, 0, 0, 1);\r\n    } else {\r\n      this.filterQ = new Quaternion(1, 0, 0, 1);\r\n    }\r\n    this.previousFilterQ = new Quaternion();\r\n    this.previousFilterQ.copy(this.filterQ);\r\n\r\n    // Orientation based on the accelerometer.\r\n    this.accelQ = new Quaternion();\r\n    // Whether or not the orientation has been initialized.\r\n    this.isOrientationInitialized = false;\r\n    // Running estimate of gravity based on the current orientation.\r\n    this.estimatedGravity = new Vector3();\r\n    // Measured gravity based on accelerometer.\r\n    this.measuredGravity = new Vector3();\r\n\r\n    // Debug only quaternion of gyro-based orientation.\r\n    this.gyroIntegralQ = new Quaternion();\r\n  }\r\n\r\n  addAccelMeasurement(vector, timestampS) {\r\n    this.currentAccelMeasurement.set(vector, timestampS);\r\n  }\r\n\r\n  addGyroMeasurement(vector, timestampS) {\r\n    this.currentGyroMeasurement.set(vector, timestampS);\r\n\r\n    var deltaT = timestampS - this.previousGyroMeasurement.timestampS;\r\n    if (isTimestampDeltaValid(deltaT)) {\r\n      this.run_();\r\n    }\r\n\r\n    this.previousGyroMeasurement.copy(this.currentGyroMeasurement);\r\n  }\r\n\r\n  run_() {\r\n\r\n    if (!this.isOrientationInitialized) {\r\n      this.accelQ = this.accelToQuaternion_(this.currentAccelMeasurement.sample);\r\n      this.previousFilterQ.copy(this.accelQ);\r\n      this.isOrientationInitialized = true;\r\n      return;\r\n    }\r\n\r\n    var deltaT = this.currentGyroMeasurement.timestampS -\r\n        this.previousGyroMeasurement.timestampS;\r\n\r\n    // Convert gyro rotation vector to a quaternion delta.\r\n    var gyroDeltaQ = this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample, deltaT);\r\n    this.gyroIntegralQ.multiply(gyroDeltaQ);\r\n\r\n    // filter_1 = K * (filter_0 + gyro * dT) + (1 - K) * accel.\r\n    this.filterQ.copy(this.previousFilterQ);\r\n    this.filterQ.multiply(gyroDeltaQ);\r\n\r\n    // Calculate the delta between the current estimated gravity and the real\r\n    // gravity vector from accelerometer.\r\n    var invFilterQ = new Quaternion();\r\n    invFilterQ.copy(this.filterQ);\r\n    invFilterQ.inverse();\r\n\r\n    this.estimatedGravity.set(0, 0, -1);\r\n    this.estimatedGravity.applyQuaternion(invFilterQ);\r\n    this.estimatedGravity.normalize();\r\n\r\n    this.measuredGravity.copy(this.currentAccelMeasurement.sample);\r\n    this.measuredGravity.normalize();\r\n\r\n    // Compare estimated gravity with measured gravity, get the delta quaternion\r\n    // between the two.\r\n    var deltaQ = new Quaternion();\r\n    deltaQ.setFromUnitVectors(this.estimatedGravity, this.measuredGravity);\r\n    deltaQ.inverse();\r\n\r\n    // Calculate the SLERP target: current orientation plus the measured-estimated\r\n    // quaternion delta.\r\n    var targetQ = new Quaternion();\r\n    targetQ.copy(this.filterQ);\r\n    targetQ.multiply(deltaQ);\r\n\r\n    // SLERP factor: 0 is pure gyro, 1 is pure accel.\r\n    this.filterQ.slerp(targetQ, 1 - this.kFilter);\r\n\r\n    this.previousFilterQ.copy(this.filterQ);\r\n  }\r\n\r\n  getOrientation() {\r\n    return this.filterQ;\r\n  }\r\n\r\n  accelToQuaternion_(accel) {\r\n    var normAccel = new Vector3();\r\n    normAccel.copy(accel);\r\n    normAccel.normalize();\r\n    var quat = new Quaternion();\r\n    quat.setFromUnitVectors(new Vector3(0, 0, -1), normAccel);\r\n    quat.inverse();\r\n    return quat;\r\n  }\r\n\r\n  gyroToQuaternionDelta_(gyro, dt) {\r\n    // Extract axis and angle from the gyroscope data.\r\n    var quat = new Quaternion();\r\n    var axis = new Vector3();\r\n    axis.copy(gyro);\r\n    axis.normalize();\r\n    quat.setFromAxisAngle(axis, gyro.length() * dt);\r\n    return quat;\r\n  }\r\n};\r\n","/*\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\npliny.class({\r\n  parent: \"Primrose.Displays\",\r\n  name: \"PosePredictor\",\r\n  description: \"Given an orientation and the gyroscope data, predicts the future orientation of the head. This makes rendering appear faster. Also see: http://msl.cs.uiuc.edu/~lavalle/papers/LavYerKatAnt14.pdf\",\r\n  parameters: [{\r\n    name: \"predictionTimeS\",\r\n    type: \"Number\",\r\n    description: \"time from head movement to the appearance of the corresponding image.\"\r\n  }]\r\n});\r\n\r\nimport { Quaternion, Vector3 } from \"three\";\r\nimport { Math as _Math } from \"three\";\r\n\r\nconst { DEG2RAD, RAD2DEG } = _Math;\r\nconst AXIS = new Vector3();\r\n\r\nexport default class PosePredictor {\r\n  constructor(predictionTimeS) {\r\n    this.predictionTimeS = predictionTimeS;\r\n    this.previousQ = new Quaternion();\r\n    this.previousTimestampS = null;\r\n    this.deltaQ = new Quaternion();\r\n  }\r\n\r\n  getPrediction(currentQ, gyro, timestampS, outQ) {\r\n    if (!this.previousTimestampS) {\r\n      this.previousQ.copy(currentQ);\r\n      this.previousTimestampS = timestampS;\r\n      return currentQ;\r\n    }\r\n\r\n    // Calculate axis and angle based on gyroscope rotation rate data.\r\n    AXIS.copy(gyro);\r\n    AXIS.normalize();\r\n\r\n    var angularSpeed = gyro.length();\r\n\r\n    // If we're rotating slowly, don't do prediction.\r\n    if (angularSpeed < DEG2RAD * 20) {\r\n      outQ.copy(currentQ);\r\n      this.previousQ.copy(currentQ);\r\n      return;\r\n    }\r\n\r\n    // Get the predicted angle based on the time delta and latency.\r\n    var deltaT = timestampS - this.previousTimestampS;\r\n    var predictAngle = angularSpeed * this.predictionTimeS;\r\n\r\n    this.deltaQ.setFromAxisAngle(AXIS, predictAngle);\r\n    outQ.copy(this.previousQ);\r\n    outQ.multiply(this.deltaQ);\r\n\r\n    this.previousQ.copy(currentQ);\r\n    this.previousTimestampS = timestampS;\r\n  }\r\n}\r\n","/*\r\n * Copyright 2015 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport ComplementaryFilter from \"./ComplementaryFilter\";\r\nimport PosePredictor from \"./PosePredictor\";\r\nimport { Quaternion, Vector3 } from \"three\";\r\nimport { Math as _Math } from \"three\";\r\nimport isTimestampDeltaValid from \"../../../util/isTimestampDeltaValid\";\r\nimport isLandscape from \"../../../flags/isLandscape\";\r\nimport isiOS from \"../../../flags/isiOS\";\r\nimport isFirefox from \"../../../flags/isFirefox\";\r\nimport isMobile from \"../../../flags/isMobile\";\r\n\r\n\r\nconst isFirefoxAndroid = isFirefox && isMobile;\r\nconst { DEG2RAD } = _Math;\r\n\r\n/**\r\n * The pose sensor, implemented using DeviceMotion APIs.\r\n */\r\nexport default class FusionPoseSensor {\r\n  constructor(options) {\r\n    options = Object.assign({\r\n      // Complementary filter coefficient. 0 for accelerometer, 1 for gyro.\r\n      K_FILTER: 0.98,\r\n\r\n      // How far into the future to predict during fast motion (in seconds).\r\n      PREDICTION_TIME_S: 0.040\r\n    }, options);\r\n\r\n    this.deviceId = 'webvr-polyfill:fused';\r\n    this.deviceName = 'VR Position Device (webvr-polyfill:fused)';\r\n\r\n    this.accelerometer = new Vector3();\r\n    this.gyroscope = new Vector3();\r\n\r\n    window.addEventListener('devicemotion', this.onDeviceMotionChange_.bind(this));\r\n    window.addEventListener('orientationchange', this.onScreenOrientationChange_.bind(this));\r\n\r\n    this.filter = new ComplementaryFilter(options.K_FILTER);\r\n    this.posePredictor = new PosePredictor(options.PREDICTION_TIME_S);\r\n\r\n    this.filterToWorldQ = new Quaternion();\r\n\r\n    // Set the filter to world transform, depending on OS.\r\n    if (isiOS) {\r\n      this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), Math.PI / 2);\r\n    } else {\r\n      this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);\r\n    }\r\n\r\n    this.inverseWorldToScreenQ = new Quaternion();\r\n    this.worldToScreenQ = new Quaternion();\r\n    this.originalPoseAdjustQ = new Quaternion();\r\n    this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0, 0, 1),\r\n                                             -window.orientation * DEG2RAD);\r\n\r\n    this.setScreenTransform_();\r\n    // Adjust this filter for being in landscape mode.\r\n    if (isLandscape()) {\r\n      this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);\r\n    }\r\n\r\n    // Keep track of a reset transform for resetSensor.\r\n    this.resetQ = new Quaternion();\r\n\r\n    this.orientationOut_ = new Float32Array(4);\r\n    this.predictedQ = new Quaternion();\r\n    this.previousTimestampS = null;\r\n  }\r\n\r\n  getPosition() {\r\n    // This PoseSensor doesn't support position\r\n    return null;\r\n  }\r\n\r\n  getOrientation() {\r\n    // Convert from filter space to the the same system used by the deviceorientation event.\r\n    var orientation = this.filter.getOrientation();\r\n\r\n    // Predict orientation.\r\n    this.posePredictor.getPrediction(orientation, this.gyroscope, this.previousTimestampS, this.predictedQ);\r\n\r\n    // Convert to THREE coordinate system: -Z forward, Y up, X right.\r\n    var out = new Quaternion();\r\n    out.copy(this.filterToWorldQ);\r\n    out.multiply(this.resetQ);\r\n    out.multiply(this.predictedQ);\r\n    out.multiply(this.worldToScreenQ);\r\n\r\n    this.orientationOut_[0] = out.x;\r\n    this.orientationOut_[1] = out.y;\r\n    this.orientationOut_[2] = out.z;\r\n    this.orientationOut_[3] = out.w;\r\n    return this.orientationOut_;\r\n  }\r\n\r\n  getPose() {\r\n    return {\r\n      position: this.getPosition(),\r\n      orientation: this.getOrientation(),\r\n      linearVelocity: null,\r\n      linearAcceleration: null,\r\n      angularVelocity: null,\r\n      angularAcceleration: null\r\n    };\r\n  }\r\n\r\n  resetPose() {\r\n    // Reduce to inverted yaw-only.\r\n    this.resetQ.copy(this.filter.getOrientation());\r\n    this.resetQ.x = 0;\r\n    this.resetQ.y = 0;\r\n    this.resetQ.z *= -1;\r\n    this.resetQ.normalize();\r\n\r\n    // Take into account extra transformations in landscape mode.\r\n    if (isLandscape()) {\r\n      this.resetQ.multiply(this.inverseWorldToScreenQ);\r\n    }\r\n\r\n    // Take into account original pose.\r\n    this.resetQ.multiply(this.originalPoseAdjustQ);\r\n  }\r\n\r\n  onDeviceMotionChange_(deviceMotion) {\r\n    const accGravity = deviceMotion.accelerationIncludingGravity,\r\n      rotRate = deviceMotion.rotationRate;\r\n    let timestampS = deviceMotion.timeStamp / 1000;\r\n\r\n    // Firefox Android timeStamp returns one thousandth of a millisecond.\r\n    if (isFirefoxAndroid) {\r\n      timestampS /= 1000;\r\n    }\r\n\r\n    var deltaS = timestampS - this.previousTimestampS;\r\n    if (isTimestampDeltaValid(deltaS)) {\r\n      this.accelerometer.set(-accGravity.x, -accGravity.y, -accGravity.z);\r\n      this.gyroscope.set(rotRate.alpha, rotRate.beta, rotRate.gamma);\r\n\r\n      // With iOS and Firefox Android, rotationRate is reported in degrees, so we first convert to radians.\r\n      if (isiOS || isFirefoxAndroid) {\r\n        this.gyroscope.multiplyScalar(DEG2RAD);\r\n      }\r\n\r\n      this.filter.addAccelMeasurement(this.accelerometer, timestampS);\r\n      this.filter.addGyroMeasurement(this.gyroscope, timestampS);\r\n    }\r\n    else if (this.previousTimestampS !== null){\r\n      console.warn(\"Invalid timestamps detected. Time step between successive gyroscope sensor samples is very small or not monotonic\");\r\n    }\r\n\r\n    this.previousTimestampS = timestampS;\r\n  }\r\n\r\n  onScreenOrientationChange_(screenOrientation) {\r\n    this.setScreenTransform_();\r\n  }\r\n\r\n  setScreenTransform_() {\r\n    this.worldToScreenQ.set(0, 0, 0, 1);\r\n    switch (window.orientation) {\r\n      case 0:\r\n        break;\r\n      case 90:\r\n        this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), -Math.PI / 2);\r\n        break;\r\n      case -90:\r\n        this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), Math.PI / 2);\r\n        break;\r\n      case 180:\r\n        // TODO.\r\n        break;\r\n    }\r\n    this.inverseWorldToScreenQ.copy(this.worldToScreenQ);\r\n    this.inverseWorldToScreenQ.inverse();\r\n  }\r\n}\r\n","/*\r\n * Copyright 2016 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport FusionPoseSensor from \"./SensorFusion/FusionPoseSensor\";\r\nimport VRDisplay from \"./VRDisplay\";\r\nimport isiOS from \"../../flags/isiOS\";\r\nimport isLandscape from \"../../flags/isLandscape\";\r\n\r\nlet Eye = {\r\n  LEFT: \"left\",\r\n  RIGHT: \"right\"\r\n},\r\n  ipd = 0.03,\r\n  neckLength = 0,\r\n  neckDepth = 0;\r\n\r\nexport default class CardboardVRDisplay extends VRDisplay {\r\n\r\n  static get IPD() {\r\n    return ipd;\r\n  }\r\n\r\n  static set IPD(v) {\r\n    ipd = v;\r\n  }\r\n\r\n  static get NECK_LENGTH() {\r\n    return neckLength;\r\n  }\r\n\r\n  static set NECK_LENGTH(v) {\r\n    neckLength = v;\r\n  }\r\n\r\n  static get NECK_DEPTH() {\r\n    return neckDepth;\r\n  }\r\n\r\n  static set NECK_DEPTH(v) {\r\n    neckDepth = v;\r\n  }\r\n\r\n  constructor(options) {\r\n    super(\"Google Cardboard\");\r\n    this.DOMElement = null;\r\n\r\n    // \"Private\" members.\r\n    this.poseSensor_ = options && options.overrideOrientation || new FusionPoseSensor(options);\r\n  }\r\n\r\n  _getPose() {\r\n    return this.poseSensor_.getPose();\r\n  }\r\n\r\n  resetPose() {\r\n    this.poseSensor_.resetPose();\r\n  }\r\n\r\n  getEyeParameters(whichEye) {\r\n    var offset = [ipd, neckLength, neckDepth];\r\n\r\n    if (whichEye == Eye.LEFT) {\r\n      offset[0] *= -1.0;\r\n    }\r\n\r\n    var width = screen.width,\r\n      height = screen.height;\r\n\r\n    if(this.DOMElement){\r\n      width = this.DOMElement.clientWidth;\r\n      height = this.DOMElement.clientHeight;\r\n    }\r\n    else if(isiOS && isLandscape()) {\r\n      var temp = width;\r\n      width = height;\r\n      height = temp;\r\n    }\r\n\r\n    width *= devicePixelRatio;\r\n    height *= devicePixelRatio;\r\n\r\n    return {\r\n      fieldOfView: {\r\n        upDegrees: 40,\r\n        leftDegrees: 40,\r\n        rightDegrees: 40,\r\n        downDegrees: 40\r\n      },\r\n      offset: offset,\r\n      renderWidth: 0.5 * width,\r\n      renderHeight: height,\r\n    }\r\n  }\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Automator\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport { EventDispatcher } from \"three\";\r\n\r\nexport default class Automator extends EventDispatcher {\r\n\r\n  constructor(root = window) {\r\n    super();\r\n    this.root = root;\r\n    this.frames = [];\r\n    this.startT = null;\r\n  }\r\n\r\n  update(t) {\r\n    if (this.startT === null) {\r\n      this.startT = t;\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    this.frames.splice(0);\r\n    this.startT = null;\r\n  }\r\n\r\n  get length() {\r\n    return this.frames.length;\r\n  }\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Obj\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nexport default class Obj {\r\n  constructor(path, root = window) {\r\n    this.path = path;\r\n\r\n    const parts = path.split(\".\"),\r\n      key = parts[parts.length - 1];\r\n\r\n    const find = (fill) => {\r\n      let head = root;\r\n\r\n      for (let i = 0; i < parts.length - 1; ++i) {\r\n        const part = parts[i];\r\n        if (head[part] === undefined || head[part] === null) {\r\n          if (fill) {\r\n            if (/^\\d+$/.test(parts[i + 1])) {\r\n              head[part] = [];\r\n            }\r\n            else {\r\n              head[part] = {};\r\n            }\r\n          }\r\n          else {\r\n            head = null;\r\n            break;\r\n          }\r\n        }\r\n        head = head[part];\r\n      }\r\n\r\n      return head;\r\n    };\r\n\r\n    this.get = () => {\r\n      var obj = find(false);\r\n      return obj && obj[key];\r\n    };\r\n\r\n    this.set = (v) => {\r\n      var obj = find(true);\r\n      if (obj) {\r\n        obj[key] = v;\r\n      }\r\n    };\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Record\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport Obj from \"./Obj\";\r\n\r\nexport default class Record extends Obj {\r\n\r\n  constructor(path, value, root) {\r\n    super(path, root);\r\n    this.value = value;\r\n  }\r\n\r\n  write() {\r\n    if (this.value !== this.get()) {\r\n      this.set(this.value);\r\n    }\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Frame\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport Record from \"./Record\";\r\n\r\n/*\r\n  A collection of all the recorded state values at a single point in time.\r\n*/\r\nexport default class Frame {\r\n\r\n  static parse(timestamp, obj, root) {\r\n    const stack = [{\r\n        path: \"\",\r\n        value: obj\r\n      }],\r\n      records = [];\r\n\r\n    while (stack.length > 0) {\r\n      const {\r\n        path,\r\n        value\r\n      } = stack.shift();\r\n\r\n      if (typeof value === \"object\") {\r\n        for (const key in value) {\r\n          let newPath = path;\r\n          if (path.length > 0) {\r\n            newPath += \".\";\r\n          }\r\n          newPath += key;\r\n          stack.push({\r\n            path: newPath,\r\n            value: value[key]\r\n          });\r\n        }\r\n      }\r\n      else {\r\n        records.push(new Record(path, value, root));\r\n      }\r\n    }\r\n\r\n    return new Frame(timestamp, records);\r\n  }\r\n\r\n  constructor(timestamp, records) {\r\n    this.t = timestamp;\r\n    this.records = records;\r\n  }\r\n\r\n  write() {\r\n    for (var i = 0; i < this.records.length; ++i) {\r\n      this.records[i].write();\r\n    }\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Player\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport Automator from \"./Automator\";\r\nimport Frame from \"./Frame\";\r\n\r\nexport default class Player extends Automator {\r\n\r\n  constructor(root) {\r\n    super(root);\r\n    this.frameIndex = -1;\r\n  }\r\n\r\n  parse(json) {\r\n    this.load(JSON.parse(json));\r\n  }\r\n\r\n  load(objs) {\r\n    const frames = [];\r\n\r\n    for (var t in objs) {\r\n      frames.push(Frame.parse(t, objs[t], this.root));\r\n    }\r\n\r\n    this.append(frames);\r\n  }\r\n\r\n  reset() {\r\n    super.reset();\r\n    this.frameIndex = -1;\r\n  }\r\n\r\n  update(t) {\r\n    super.update(t);\r\n\r\n    t += this.minT - this.startT;\r\n\r\n    const oldFrameIndex = this.frameIndex;\r\n    while (this.frameIndex < this.frames.length - 1 &&\r\n      t >= this.frames[this.frameIndex + 1].t) {\r\n      ++this.frameIndex;\r\n    }\r\n\r\n    if (this.frameIndex !== oldFrameIndex && 0 <= this.frameIndex && this.frameIndex < this.frames.length) {\r\n      const frame = this.frames[this.frameIndex];\r\n      frame.write();\r\n      this.emit(\"frame\", frame);\r\n    }\r\n  }\r\n\r\n  append(frames) {\r\n    if (frames) {\r\n      this.frames.push.apply(this.frames, frames);\r\n      this.minT = this.frames.map((f) => f.t)\r\n        .reduce((a, b) => Math.min(a, b), Number.MAX_VALUE);\r\n    }\r\n  }\r\n\r\n  reverse() {\r\n    const maxT = this.frames.map((f) => f.t)\r\n      .reduce((a, b) => Math.max(a, b), Number.MIN_VALUE);\r\n    this.frames.reverse();\r\n    for (var i = 0; i < this.frames.length; ++i) {\r\n      var frame = this.frames[i];\r\n      frame.t = maxT - frame.t + this.minT;\r\n    }\r\n  }\r\n\r\n  get done() {\r\n    return this.frameIndex >= this.frames.length - 1;\r\n  }\r\n};","import Player from \"../Replay/Player\";\r\n\r\nexport default class MockVRDisplay {\r\n  constructor(data) {\r\n\r\n    var timestamp = null,\r\n      displayName = null,\r\n      startOn = null;\r\n\r\n    Object.defineProperties(this, {\r\n      displayName: {\r\n        get: () => \"Mock \" + displayName,\r\n        set: (v) => displayName = v\r\n      }\r\n    });\r\n\r\n    const dataPack = {\r\n      currentDisplay: this,\r\n      currentEyeParams: {\r\n        left: {\r\n          fieldOfView: {\r\n            downDegrees: null,\r\n            leftDegrees: null,\r\n            rightDegrees: null,\r\n            upDegrees: null\r\n          },\r\n          renderWidth: null,\r\n          renderHeight: null,\r\n          offset: null\r\n        },\r\n        right: {\r\n          fieldOfView: {\r\n            downDegrees: null,\r\n            leftDegrees: null,\r\n            rightDegrees: null,\r\n            upDegrees: null\r\n          },\r\n          renderWidth: null,\r\n          renderHeight: null,\r\n          offset: null\r\n        }\r\n      },\r\n      currentPose: {\r\n        timestamp: null,\r\n        orientation: null,\r\n        position: null\r\n      }\r\n    };\r\n\r\n    Object.defineProperties(dataPack.currentPose, {\r\n      timestamp: {\r\n        get: () => timestamp,\r\n        set: (v) => timestamp = v\r\n      },\r\n      timeStamp: {\r\n        get: () => timestamp,\r\n        set: (v) => timestamp = v\r\n      }\r\n    });\r\n\r\n    const player = new Player(dataPack);\r\n    player.load(data);\r\n    player.update(0);\r\n\r\n    this.requestAnimationFrame = (thunk) => window.requestAnimationFrame((t) => {\r\n      if (startOn === null) {\r\n        startOn = t;\r\n      }\r\n      player.update(t - startOn);\r\n      thunk(t);\r\n    });\r\n\r\n    this.getPose = () => dataPack.currentPose;\r\n    this.getEyeParameters = (side) => dataPack.currentEyeParams[side];\r\n    this.resetPose = () => {};\r\n  }\r\n\r\n\r\n  cancelAnimationFrame(handle) {\r\n    window.cancelAnimationFrame(handle);\r\n  }\r\n};\r\n","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"getObject\",\r\n  description: \"Get a JSON object from a server.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Make a GET request for a JSON object.\",\r\n    description: `Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\r\n\r\n## Code:\r\n\r\n    grammar(\"JavaScript\");\r\n    Primrose.HTTP.getObject(\"localFile.json\", {\r\n        progress: console.log.bind(console, \"progress\")\r\n      })\r\n      .then(console.log.bind(console, \"done\"))\r\n      .catch(console.error.bind(console)));\r\n\r\n## Results:\r\n> Object {field1: 1, field2: \"Field2\"}`\r\n  }]\r\n});\r\n\r\nimport get from \"./get\";\r\nexport default function getObject(url, options) {\r\n  return get(\"json\", url, options);\r\n};","import frameDataFromPose from \"./frameDataFromPose\";\r\nimport CardboardVRDisplay from \"./CardboardVRDisplay\";\r\nimport MockVRDisplay from \"./MockVRDisplay\";\r\nimport StandardMonitorVRDisplay from \"./StandardMonitorVRDisplay\";\r\nimport VRDisplay from \"./VRDisplay\";\r\nimport VRFrameData from \"./VRFrameData\";\r\n\r\nimport isMobile from \"../../flags/isMobile\";\r\nimport isGearVR from \"../../flags/isGearVR\";\r\nimport isiOS from \"../../flags/isiOS\";\r\n\r\nimport FullScreen from \"../../util/FullScreen\";\r\n\r\nimport getObject from \"../HTTP/getObject\";\r\n\r\nconst hasNativeWebVR = \"getVRDisplays\" in navigator,\r\n  allDisplays = [],\r\n  isCardboardCompatible = isMobile && !isGearVR;\r\n\r\nlet polyFillDevicesPopulated = false,\r\n  standardMonitorPopulated = false;\r\n\r\nfunction upgrade1_0_to_1_1(){\r\n  // Put a shim in place to update the API to 1.1 if needed.\r\n  if (\"VRDisplay\" in window && !(\"VRFrameData\" in window)) {\r\n    // Provide the VRFrameData object.\r\n    window.VRFrameData = VRFrameData;\r\n\r\n    // A lot of Chrome builds don't have depthNear and depthFar, even\r\n    // though they're in the WebVR 1.0 spec. Patch them in if they're not present.\r\n    if(!(\"depthNear\" in window.VRDisplay.prototype)) {\r\n      window.VRDisplay.prototype.depthNear = 0.01;\r\n    }\r\n\r\n    if(!(\"depthFar\" in window.VRDisplay.prototype)) {\r\n      window.VRDisplay.prototype.depthFar = 10000.0;\r\n    }\r\n\r\n    window.VRDisplay.prototype.getFrameData = function(frameData) {\r\n      return frameDataFromPose(frameData, this.getPose(), this);\r\n    };\r\n  }\r\n}\r\n\r\nfunction getPolyfillDisplays(options) {\r\n  if (!polyFillDevicesPopulated) {\r\n    if (isCardboardCompatible || options.forceStereo) {\r\n      FullScreen.addChangeListener(fireVRDisplayPresentChange);\r\n      allDisplays.push(new CardboardVRDisplay(options));\r\n    }\r\n\r\n    polyFillDevicesPopulated = true;\r\n  }\r\n\r\n  return new Promise(function(resolve, reject) {\r\n    try {\r\n      resolve(allDisplays);\r\n    } catch (e) {\r\n      reject(e);\r\n    }\r\n  });\r\n}\r\n\r\nfunction fireVRDisplayPresentChange() {\r\n  var event = new CustomEvent('vrdisplaypresentchange', {detail: {vrdisplay: this}});\r\n  window.dispatchEvent(event);\r\n}\r\n\r\nfunction installPolyfill(options){\r\n  let oldGetVRDisplays = null;\r\n  if(hasNativeWebVR) {\r\n    oldGetVRDisplays = navigator.getVRDisplays;\r\n  }\r\n  else{\r\n    oldGetVRDisplays = () => Promise.resolve([]);\r\n  }\r\n\r\n  // Provide navigator.getVRDisplays.\r\n  navigator.getVRDisplays = function () {\r\n    return oldGetVRDisplays.call(navigator)\r\n      .then((displays) => {\r\n        if(displays.length === 0 || navigator.userAgent === \"Mozilla/5.0 (Linux; Android 6.0.1; SM-G930V Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2664.0 Mobile Safari/537.36\") {\r\n          options.overrideOrientation = displays[0];\r\n          return getPolyfillDisplays(options);\r\n        }\r\n        else {\r\n          return displays;\r\n        }\r\n      });\r\n    };\r\n\r\n  // Provide the VRDisplay object.\r\n  window.VRDisplay = window.VRDisplay || VRDisplay;\r\n\r\n  // Provide navigator.vrEnabled.\r\n  Object.defineProperty(navigator, \"vrEnabled\", {\r\n    get: function () {\r\n      return isCardboardCompatible &&\r\n        (FullScreen.available || isiOS); // just fake it for iOS\r\n    }\r\n  });\r\n}\r\n\r\nfunction installStandardMonitor(options) {\r\n  if(!standardMonitorPopulated && !isGearVR){\r\n    var oldGetVRDisplays = navigator.getVRDisplays;\r\n    navigator.getVRDisplays = function () {\r\n      return oldGetVRDisplays.call(navigator)\r\n        .then((displays) => {\r\n          var created = false;\r\n          for(var i = 0; i < displays.length && !created; ++i){\r\n            var dsp = displays[i];\r\n            created = dsp instanceof StandardMonitorVRDisplay;\r\n          }\r\n          if (!created) {\r\n            if(options && options.defaultFOV) {\r\n              StandardMonitorVRDisplay.DEFAULT_FOV = options.defaultFOV;\r\n            }\r\n            displays.unshift(new StandardMonitorVRDisplay(displays[0]));\r\n          }\r\n          return displays;\r\n        });\r\n    };\r\n\r\n    standardMonitorPopulated = true;\r\n  }\r\n}\r\n\r\nfunction installMockDisplay(options) {\r\n  var data = options && options.replayData;\r\n  if(data){\r\n    var oldGetVRDisplays = navigator.getVRDisplays;\r\n    navigator.getVRDisplays = () => oldGetVRDisplays.call(navigator)\r\n      .then((displays) => {\r\n        const mockDeviceExists = displays\r\n          .map((d) => d instanceof MockVRDisplay)\r\n          .reduce((a, b) => a || b, false);\r\n\r\n        if (mockDeviceExists) {\r\n          return displays;\r\n        }\r\n        else {\r\n          var done = (obj) => {\r\n            displays.push(new MockVRDisplay(obj));\r\n            resolve(displays);\r\n          };\r\n\r\n          if (typeof data === \"object\") {\r\n            return Promise.resolve(data);\r\n          }\r\n          else if (/\\.json$/.test(data)) {\r\n            return getObject(data);\r\n          }\r\n          else {\r\n            return Promise.resolve(JSON.parse(data));\r\n          }\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\nexport default function install(options) {\r\n  options = Object.assign({\r\n      // Forces availability of VR mode, even for non-mobile devices.\r\n      FORCE_ENABLE_VR: false\r\n    }, options);\r\n\r\n  installPolyfill(options);\r\n  installStandardMonitor(options);\r\n  installMockDisplay(options);\r\n  upgrade1_0_to_1_1();\r\n};","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"VR\",\r\n  baseClass: \"Primrose.Input.PoseInputProcessor\",\r\n  description: \"An input manager for gamepad devices.\",\r\n  parameters: [{\r\n    name: \"avatarHeight\",\r\n    type: \"Number\",\r\n    description: \"The default height to use for the user, if the HMD doesn't provide a stage transform.\"\r\n  }]\r\n});\r\n\r\nconst DEFAULT_POSE = {\r\n    position: [0, 0, 0],\r\n    orientation: [0, 0, 0, 1]\r\n  };\r\n\r\nimport { Vector3, Matrix4 } from \"three\";\r\nimport PoseInputProcessor from \"./PoseInputProcessor\";\r\nimport isChrome from \"../../flags/isChrome\";\r\nimport isFirefox from \"../../flags/isFirefox\";\r\nimport isiOS from \"../../flags/isiOS\";\r\nimport isMobile from \"../../flags/isMobile\";\r\nimport PointerLock from \"../../util/PointerLock\";\r\nimport Orientation from \"../../util/Orientation\";\r\nimport standardFullScreenBehavior from \"../../util/standardFullScreenBehavior\";\r\nimport standardLockBehavior from \"../../util/standardLockBehavior\";\r\nimport installPolyfills from \"../Displays/install\";\r\nimport StandardMonitorVRDisplay from \"../Displays/StandardMonitorVRDisplay\";\r\nimport CardboardVRDisplay from \"../Displays/CardboardVRDisplay\";\r\nexport default class VR extends PoseInputProcessor {\r\n\r\n  static isStereoDisplay(display) {\r\n    const leftParams = display.getEyeParameters(\"left\"),\r\n        rightParams = display.getEyeParameters(\"right\");\r\n    return !!(leftParams && rightParams);\r\n  }\r\n\r\n  constructor(options) {\r\n    super(\"VR\");\r\n\r\n    this.options = options;\r\n    this.displays = [];\r\n    this._transformers = [];\r\n    this.lastLastTimerDevice = null;\r\n    this.lastTimerDevice = null;\r\n    this.timerDevice = null;\r\n    this.timer = null;\r\n    this.currentDeviceIndex = -1;\r\n    this.movePlayer = new Matrix4();\r\n    this.stage = null;\r\n    this.lastStageWidth = null;\r\n    this.lastStageDepth = null;\r\n    this.isStereo = false;\r\n    installPolyfills(options);\r\n\r\n\r\n    if(this.options.nonstandardIPD !== null){\r\n      CardboardVRDisplay.IPD = this.options.nonstandardIPD;\r\n    }\r\n    if(this.options.nonstandardNeckLength !== null){\r\n      CardboardVRDisplay.NECK_LENGTH = this.options.nonstandardNeckLength;\r\n    }\r\n    if(this.options.nonstandardNeckDepth !== null){\r\n      CardboardVRDisplay.NECK_DEPTH = this.options.nonstandardNeckDepth;\r\n    }\r\n\r\n    this.ready = navigator.getVRDisplays()\r\n      .then((displays) => {\r\n        this.displays.push.apply(this.displays, displays);\r\n        this.connect(0);\r\n        return this.displays;\r\n      });\r\n  }\r\n\r\n  get isNativeMobileWebVR() {\r\n    return this.isNativeWebVR && isChrome && isMobile;\r\n  }\r\n\r\n  get isNativeWebVR() {\r\n    return this.currentDevice && !this.currentDevice.isPolyfilled;\r\n  }\r\n\r\n  connect(selectedIndex) {\r\n    this.currentDevice = null;\r\n    this.currentDeviceIndex = selectedIndex;\r\n    this.currentPose = null;\r\n    if (0 <= selectedIndex && selectedIndex <= this.displays.length) {\r\n      this.currentDevice = this.displays[selectedIndex];\r\n      this.currentPose = this.currentDevice.getPose();\r\n      this.isStereo = VR.isStereoDisplay(this.currentDevice);\r\n    }\r\n  }\r\n\r\n  requestPresent(opts) {\r\n    if (!this.currentDevice) {\r\n      return Promise.reject(\"No display\");\r\n    }\r\n    else {\r\n      let layers = opts,\r\n        elem = opts[0].source;\r\n\r\n      if (!(layers instanceof Array)) {\r\n        layers = [layers];\r\n      }\r\n\r\n      // A hack to deal with a bug in the current build of Chromium\r\n      if (this.isNativeMobileWebVR && this.isStereo) {\r\n        layers = layers[0];\r\n      }\r\n\r\n      var promise = this.currentDevice.requestPresent(layers);\r\n      if(isMobile || !isFirefox) {\r\n        promise = promise.then(standardLockBehavior);\r\n      }\r\n      return promise;\r\n    }\r\n  }\r\n\r\n  cancel() {\r\n    let promise = null;\r\n    if (this.isPresenting) {\r\n      promise = this.currentDevice.exitPresent();\r\n      this.currentDevice = null;\r\n      this.currentDeviceIndex = -1;\r\n      this.currentPose = null;\r\n    }\r\n    else {\r\n      promise = Promise.resolve();\r\n    }\r\n\r\n    if (this.isNativeMobileWebVR) {\r\n      promise = promise.then(Orientation.unlock);\r\n    }\r\n\r\n    return promise\r\n      .then(PointerLock.exit)\r\n      .catch((exp) => console.warn(exp))\r\n      .then(() => this.connect(0));\r\n  }\r\n\r\n  zero() {\r\n    super.zero();\r\n    if (this.currentDevice) {\r\n      this.currentDevice.resetPose();\r\n    }\r\n  }\r\n\r\n  update(dt) {\r\n    var x, z, stage;\r\n\r\n    if (this.currentDevice) {\r\n      this.currentPose = this.currentDevice.getPose();\r\n      stage = this.currentDevice.stageParameters;\r\n    }\r\n    else{\r\n      stage = null;\r\n    }\r\n\r\n    super.update(dt);\r\n\r\n    if (stage) {\r\n      this.movePlayer.fromArray(stage.sittingToStandingTransform);\r\n      x = stage.sizeX;\r\n      z = stage.sizeZ;\r\n    }\r\n    else {\r\n      this.movePlayer.makeTranslation(0, this.options.avatarHeight, 0);\r\n      x = 0;\r\n      z = 0;\r\n    }\r\n\r\n    var s = {\r\n      matrix: this.movePlayer,\r\n      sizeX: x,\r\n      sizeZ: z\r\n    };\r\n\r\n    if (!this.stage || s.sizeX !== this.stage.sizeX || s.sizeZ !== this.stage.sizeZ) {\r\n      this.stage = s;\r\n    }\r\n  }\r\n\r\n  get hasStage() {\r\n    return this.stage && this.stage.sizeX * this.stage.sizeZ > 0;\r\n  }\r\n\r\n  submitFrame() {\r\n    if(this.currentDevice) {\r\n      this.currentDevice.submitFrame(this.currentPose);\r\n    }\r\n  }\r\n\r\n  startAnimation(callback){\r\n    if(this.currentDevice) {\r\n      this.lastLastTimerDevice = this.lastTimerDevice;\r\n      this.lastTimerDevice = this.timerDevice;\r\n      this.timerDevice = this.currentDevice;\r\n      this.timer = this.currentDevice.requestAnimationFrame(callback);\r\n      return this.timer;\r\n    }\r\n  }\r\n\r\n  cancelAnimation() {\r\n    if(this.timerDevice && this.timer) {\r\n      this.timerDevice.cancelAnimationFrame(this.timer);\r\n      this.timer = null;\r\n    }\r\n  }\r\n\r\n  getTransforms(near, far) {\r\n    if (this.currentDevice) {\r\n      if (!this._transformers[this.currentDeviceIndex]) {\r\n        this._transformers[this.currentDeviceIndex] = new ViewCameraTransform(this.currentDevice);\r\n      }\r\n      this.currentDevice.depthNear = near;\r\n      this.currentDevice.depthFar = far;\r\n      return this._transformers[this.currentDeviceIndex].getTransforms(near, far);\r\n    }\r\n  }\r\n\r\n  get canMirror() {\r\n    return this.currentDevice && this.currentDevice.capabilities.hasExternalDisplay;\r\n  }\r\n\r\n  get isPolyfilled() {\r\n    return this.currentDevice && this.currentDevice.isPolyfilled;\r\n  }\r\n\r\n  get isPresenting() {\r\n    return this.currentDevice && this.currentDevice.isPresenting;\r\n  }\r\n\r\n  get hasOrientation() {\r\n    return this.currentDevice && this.currentDevice.capabilities.hasOrientation;\r\n  }\r\n\r\n  get currentCanvas() {\r\n    if(this.isPresenting) {\r\n      var layers = this.currentDevice.getLayers();\r\n      if(layers.length > 0){\r\n        return layers[0].source;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nclass ViewCameraTransform {\r\n  static makeTransform(eye, near, far) {\r\n    return {\r\n      translation: new Vector3().fromArray(eye.offset),\r\n      projection: ViewCameraTransform.fieldOfViewToProjectionMatrix(eye.fieldOfView, near, far),\r\n      viewport: {\r\n        left: 0,\r\n        top: 0,\r\n        width: eye.renderWidth,\r\n        height: eye.renderHeight\r\n      }\r\n    };\r\n  }\r\n\r\n  static fieldOfViewToProjectionMatrix(fov, zNear, zFar) {\r\n    var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0),\r\n      downTan = Math.tan(fov.downDegrees * Math.PI / 180.0),\r\n      leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0),\r\n      rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0),\r\n      xScale = 2.0 / (leftTan + rightTan),\r\n      yScale = 2.0 / (upTan + downTan),\r\n      matrix = new Matrix4();\r\n\r\n    matrix.elements[0] = xScale;\r\n    matrix.elements[1] = 0.0;\r\n    matrix.elements[2] = 0.0;\r\n    matrix.elements[3] = 0.0;\r\n    matrix.elements[4] = 0.0;\r\n    matrix.elements[5] = yScale;\r\n    matrix.elements[6] = 0.0;\r\n    matrix.elements[7] = 0.0;\r\n    matrix.elements[8] = -((leftTan - rightTan) * xScale * 0.5);\r\n    matrix.elements[9] = ((upTan - downTan) * yScale * 0.5);\r\n    matrix.elements[10] = -(zNear + zFar) / (zFar - zNear);\r\n    matrix.elements[11] = -1.0;\r\n    matrix.elements[12] = 0.0;\r\n    matrix.elements[13] = 0.0;\r\n    matrix.elements[14] = -(2.0 * zFar * zNear) / (zFar - zNear);\r\n    matrix.elements[15] = 0.0;\r\n\r\n    return matrix;\r\n  }\r\n\r\n  constructor(display) {\r\n    this.display = display;\r\n  }\r\n\r\n  getTransforms(near, far) {\r\n    const l = this.display.getEyeParameters(\"left\"),\r\n      r = this.display.getEyeParameters(\"right\"),\r\n      params = [ViewCameraTransform.makeTransform(l, near, far)];\r\n    if (r) {\r\n      params.push(ViewCameraTransform.makeTransform(r, near, far));\r\n    }\r\n    for (let i = 1; i < params.length; ++i) {\r\n      params[i].viewport.left = params[i - 1].viewport.left + params[i - 1].viewport.width;\r\n    }\r\n    return params;\r\n  }\r\n}\r\n","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"number\",\r\n  description: \"Returns a random floating-point number on a given range [min, max), i.e. min is inclusive, max is exclusive. As random as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.\",\r\n  parameters: [{\r\n    name: \"min\",\r\n    type: \"Number\",\r\n    description: \"The included minimum side of the range of numbers.\"\r\n  }, {\r\n    name: \"max\",\r\n    type: \"Number\",\r\n    description: \"The excluded maximum side of the range of numbers.\"\r\n  }, {\r\n    name: \"power\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The power to which to raise the random number before scaling and translating into the desired range. Values greater than 1 skew output values to the minimum of the range. Values less than 1 skew output values to the maximum of the range.\",\r\n    default: 1\r\n  }],\r\n  returns: \"Number\",\r\n  examples: [{\r\n    name: \"Generate a random number on the range [-1, 1).\",\r\n    description: \"To generate a random number on a closed range, call the `Primrose.Random.number` function as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.number(-1, 1));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> -0.4869012129493058  \\n\\\r\n> 0.5300767715089023  \\n\\\r\n> 0.11962601682171226  \\n\\\r\n> -0.22012147679924965  \\n\\\r\n> 0.48508461797609925  \\n\\\r\n> -0.8488651723600924  \\n\\\r\n> 0.15711558377370238  \\n\\\r\n> -0.3644236018881202  \\n\\\r\n> 0.4486056035384536  \\n\\\r\n> -0.9659552359953523\"\r\n  }]\r\n});\r\n\r\nexport default function number(min, max, power) {\r\n  power = power || 1;\r\n  if (max === undefined) {\r\n    max = min;\r\n    min = 0;\r\n  }\r\n  const delta = max - min,\r\n    n = Math.pow(Math.random(), power);\r\n  return min + n * delta;\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"int\",\r\n  description: \"Returns a random integer number on a given range [min, max), i.e. min is inclusive, max is exclusive. Includes a means to skew the results in one direction or another. The number is as good as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.\",\r\n  parameters: [{\r\n    name: \"min\",\r\n    type: \"Number\",\r\n    description: \"The included minimum side of the range of numbers.\"\r\n  }, {\r\n    name: \"max\",\r\n    type: \"Number\",\r\n    description: \"The excluded maximum side of the range of numbers.\"\r\n  }, {\r\n    name: \"power\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"The power to which to raise the random number before scaling and translating into the desired range. Values greater than 1 skew output values to the minimum of the range. Values less than 1 skew output values to the maximum of the range.\",\r\n    default: 1\r\n  }],\r\n  returns: \"Number\",\r\n  examples: [{\r\n    name: \"Generate a random integer numbers on the range [-10, 10).\",\r\n    description: \"To generate a random integer on a closed range, call the `Primrose.Random.integer` function as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.int(-10, 10));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> -3  \\n\\\r\n> 1  \\n\\\r\n> -2  \\n\\\r\n> 8  \\n\\\r\n> 7  \\n\\\r\n> 4  \\n\\\r\n> 5  \\n\\\r\n> -9  \\n\\\r\n> 4  \\n\\\r\n> 0\"\r\n  }, {\r\n    name: \"Generate skewed random integer numbers on the range [-100, 100).\",\r\n    description: \"To generate a random integer skewed to one end of the range on a closed range, call the `Primrose.Random.integer` function with the `power` parameter as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.int(-100, 100, 5));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> -100  \\n\\\r\n> -100  \\n\\\r\n> -78  \\n\\\r\n> -81  \\n\\\r\n> -99  \\n\\\r\n> 18  \\n\\\r\n> -100  \\n\\\r\n> -100  \\n\\\r\n> -100  \\n\\\r\n> 52\"\r\n  }]\r\n});\r\n\r\nimport randNum from \"./number\";\r\nexport default function int(min, max, power) {\r\n  return Math.floor(randNum(min, max, power));\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"color\",\r\n  description: \"Returns a random hex RGB number to be used as a color.\",\r\n  returns: \"Number\",\r\n  examples: [{\r\n    name: \"Generate a random color.\",\r\n    description: \"To generate colors at random, call the `Primrose.Random.color()` function:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.color().toString(16));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> 351233\\n\\\r\n> 3e8e9\\n\\\r\n> 8a85a6\\n\\\r\n> 5fad58\\n\\\r\n> 17fe2b\\n\\\r\n> d4b42b\\n\\\r\n> e986bf\\n\\\r\n> 38541a\\n\\\r\n> 5a19db\\n\\\r\n> 5f5c50\"\r\n  }]\r\n});\r\n\r\nimport randInt from \"./int\";\r\nexport default function color() {\r\n  var r = randInt(0, 256),\r\n    g = randInt(0, 256),\r\n    b = randInt(0, 256);\r\n  return r << 16 | g << 8 | b;\r\n};","pliny.class({\r\n  parent: \"Primrose.Network\",\r\n  name: \"RemoteUser\",\r\n  baseClass: \"THREE.EventDispatcher\",\r\n  description: \"A networked user.\",\r\n  parameters: [{\r\n    name: \"userName\",\r\n    type: \"String\",\r\n    description: \"The name of the user.\"\r\n  }, {\r\n    name: \"modelFactory\",\r\n    type: \"Primrose.Controls.ModelFactory\",\r\n    description: \"The factory for creating avatars for the user.\"\r\n  }, {\r\n    name: \"nameMaterial\",\r\n    type: \"Number\",\r\n    description: \"The color to use with `colored()` to set as the material for the NAME object that will float above the user's avatar.\"\r\n  }, {\r\n    name: \"requestICEPath\",\r\n    type: \"string\",\r\n    description: \"A request path at which to retrieve the extra ICE servers to use with the connection.\"\r\n  }, {\r\n    name: \"microphone\",\r\n    type: \"Promise\",\r\n    description: \"A promise that resolves with an audio stream that can be sent to the remote user, representing the local user's voice chat.\"\r\n  }, {\r\n    name: \"localUserName\",\r\n    type: \"String\",\r\n    description: \"The name of the user initiating the peer connection.\"\r\n  }]\r\n});\r\n\r\nimport { EventDispatcher } from \"three\";\r\nimport randColor from \"../Random/color\";\r\nimport colored from \"../../live-api/colored\";\r\nimport Audio3D from \"../Audio/Audio3D\";\r\nimport { Quaternion, Vector3 } from \"three\";\r\n\r\nexport default class RemoteUser extends EventDispatcher {\r\n\r\n  constructor(userName, modelFactory, nameMaterial, disableWebRTC, requestICEPath, microphone, localUserName, goSecond) {\r\n    super();\r\n    this.time = 0;\r\n\r\n    this.userName = userName;\r\n    this.peeringError = null;\r\n    this.peering = false;\r\n    this.peered = false;\r\n    this.stage = modelFactory.clone();\r\n    this.stage.traverse((obj) => {\r\n      if (obj.name === \"AvatarBelt\") {\r\n        colored(obj, randColor());\r\n      }\r\n      else if (obj.name === \"AvatarHead\") {\r\n        this.head = obj;\r\n      }\r\n    });\r\n\r\n    this.nameObject = colored(text3D(0.1, userName), nameMaterial);\r\n    var bounds = this.nameObject.geometry.boundingBox.max;\r\n    this.nameObject.rotation.set(0, Math.PI, 0);\r\n    this.nameObject.position.set(bounds.x / 2, bounds.y, 0);\r\n    this.head.add(this.nameObject);\r\n\r\n    this.dStageQuaternion = new Quaternion();\r\n    this.dHeadPosition = new Vector3();\r\n    this.dHeadQuaternion = new Quaternion();\r\n\r\n    this.lastStageQuaternion = new Quaternion();\r\n    this.lastHeadPosition = new Vector3();\r\n    this.lastHeadQuaternion = new Quaternion();\r\n\r\n    this.headPosition = {\r\n      arr1: [],\r\n      arr2: [],\r\n      last: this.lastHeadPosition,\r\n      delta: this.dHeadPosition,\r\n      curr: this.head.position\r\n    };\r\n    this.headQuaternion = {\r\n      arr1: [],\r\n      arr2: [],\r\n      last: this.lastHeadQuaternion,\r\n      delta: this.dHeadQuaternion,\r\n      curr: this.head.quaternion\r\n    };\r\n\r\n    this.audioChannel = null;\r\n    this.audioElement = null;\r\n    this.audioStream = null;\r\n    this.gain = null;\r\n    this.panner = null;\r\n    this.analyzer = null;\r\n  }\r\n\r\n  setAudio(audio, audioSource){\r\n    if(audioSource instanceof Element){\r\n      this.audioElement = audioSource;\r\n      Audio3D.setAudioProperties(this.audioElement);\r\n      this.audioStream = audio.context.createMediaElementSource(this.audioElement);\r\n    }\r\n    else {\r\n      this.audioElement = Audio3D.setAudioStream(audioSource, \"audio\" + this.userName);\r\n      this.audioStream = audio.context.createMediaStreamSource(audioSource);\r\n    }\r\n    this.gain = audio.context.createGain();\r\n    this.panner = audio.context.createPanner();\r\n\r\n    this.audioStream.connect(this.gain);\r\n    this.gain.connect(this.panner);\r\n    this.panner.connect(audio.mainVolume);\r\n    this.panner.coneInnerAngle = 180;\r\n    this.panner.coneOuterAngle = 360;\r\n    this.panner.coneOuterGain = 0.1;\r\n    this.panner.panningModel = \"HRTF\";\r\n    this.panner.distanceModel = \"exponential\";\r\n  }\r\n\r\n  unpeer() {\r\n    pliny.method({\r\n      parent: \"Pliny.RemoteUser\",\r\n      name: \"unpeer\",\r\n      description: \"Cleans up after a user has left the room, removing the audio channels that were created for the user.\"\r\n    });\r\n\r\n    if (this.audioChannel) {\r\n      this.audioChannel.close();\r\n      if (this.audioElement) {\r\n        document.body.removeChild(this.audioElement);\r\n        if (this.panner) {\r\n          this.panner.disconnect();\r\n          this.gain.disconnect();\r\n          this.audioStream.disconnect();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  _updateV(v, dt, fade) {\r\n    v.curr.toArray(v.arr1);\r\n    v.delta.toArray(v.arr2);\r\n    for (var i = 0; i < v.arr1.length; ++i) {\r\n      if (fade) {\r\n        v.arr2[i] *= RemoteUser.FADE_FACTOR;\r\n      }\r\n      v.arr1[i] += v.arr2[i] * dt;\r\n    }\r\n\r\n    v.curr.fromArray(v.arr1);\r\n    v.delta.fromArray(v.arr2);\r\n  }\r\n\r\n  _predict(v, state, off) {\r\n    v.delta.fromArray(state, off);\r\n    v.delta.toArray(v.arr1);\r\n    v.curr.toArray(v.arr2);\r\n    for (var i = 0; i < v.arr1.length; ++i) {\r\n      v.arr1[i] = (v.arr1[i] - v.arr2[i]) * RemoteUser.NETWORK_DT_INV;\r\n    }\r\n    v.delta.fromArray(v.arr1);\r\n  }\r\n\r\n  update(dt) {\r\n    pliny.method({\r\n      parent: \"Pliny.RemoteUser\",\r\n      name: \"update\",\r\n      description: \"Moves the avatar by its velocity for a set amount of time. Updates the audio panner information.\",\r\n      parameters: [{\r\n        name: \"dt\",\r\n        type: \"Number\",\r\n        description: \"The amount of time since the last update to the user.\"\r\n      }]\r\n    });\r\n\r\n    this.time += dt;\r\n    var fade = this.time >= RemoteUser.NETWORK_DT;\r\n    this._updateV(this.headPosition, dt, fade);\r\n    this._updateV(this.headQuaternion, dt, fade);\r\n    this.stage.rotation.setFromQuaternion(this.headQuaternion.curr);\r\n    this.stage.rotation.x = 0;\r\n    this.stage.rotation.z = 0;\r\n    this.stage.position.copy(this.headPosition.curr);\r\n    this.stage.position.y = 0;\r\n    if (this.panner) {\r\n      this.panner.setPosition(this.stage.position.x, this.stage.position.y, this.stage.position.z);\r\n      this.panner.setOrientation(Math.sin(this.stage.rotation.y), 0, Math.cos(this.stage.rotation.y));\r\n    }\r\n  }\r\n\r\n  setState(v) {\r\n    pliny.property({\r\n      parent: \"Pliny.RemoteUser\",\r\n      name: \"state\",\r\n      description: \"After receiving a network update, sets the current state of the remote user so that, by the time the next network update comes around, the user will be where it is predicted to be.\",\r\n      parameters: [{\r\n        name: \"v\",\r\n        type: \"Array\",\r\n        description: \"The raw state array from the network (includes the un-read first username field).\"\r\n      }]\r\n    });\r\n\r\n    this.time = 0;\r\n    this._predict(this.headPosition, v, 1);\r\n    this._predict(this.headQuaternion, v, 4);\r\n  }\r\n\r\n  toString(digits) {\r\n    return this.stage.position.curr.toString(digits) + \" \" + this.headPosition.curr.toString(digits);\r\n  }\r\n}\r\n\r\nRemoteUser.FADE_FACTOR = 0.5;\r\nRemoteUser.NETWORK_DT = 0.10;\r\nRemoteUser.NETWORK_DT_INV = 1 / RemoteUser.NETWORK_DT;\r\n","pliny.class({\r\n  parent: \"Primrose.Network\",\r\n  name: \"Manager\",\r\n  baseClass: \"THREE.EventDispatcher\",\r\n  parameters: [{\r\n    name: \"localUser\",\r\n    type: \"Primrose.Input.FPSInput\",\r\n    description: \"The object that represents the player's location in the scene.\"\r\n  }, {\r\n    name: \"audio\",\r\n    type: \"Primrose.Output.Audio3D\",\r\n    description: \"The audio manager being used in the current Environment.\"\r\n  }, {\r\n    name: \"factories\",\r\n    type: \"Primrose.Controls.ModelFactory\",\r\n    description: \"Model factory for creating avatars for new remote users.\"\r\n  }]\r\n});\r\n\r\nimport { EventDispatcher } from \"three\";\r\nimport RemoteUser from \"./RemoteUser\";\r\n\r\nexport default class Manager extends EventDispatcher {\r\n  constructor(localUser, audio, factories, options) {\r\n    super();\r\n    this.localUser = localUser;\r\n    this.audio = audio;\r\n    this.factories = factories;\r\n    this.options = options;\r\n    this.lastNetworkUpdate = 0;\r\n    this.oldState = [];\r\n    this.users = {};\r\n    this.waitForLastUser = Promise.resolve();\r\n    this._socket = null;\r\n    this.userName = null;\r\n    this.microphone = null;\r\n    this.audioHeap = {};\r\n  }\r\n\r\n  update(dt) {\r\n    if (this._socket && this.deviceIndex === 0) {\r\n      this.lastNetworkUpdate += dt;\r\n      if (this.lastNetworkUpdate >= RemoteUser.NETWORK_DT) {\r\n        this.lastNetworkUpdate -= RemoteUser.NETWORK_DT;\r\n        for (var i = 0; i < this.localUser.newState.length; ++i) {\r\n          if (this.oldState[i] !== this.localUser.newState[i]) {\r\n            this._socket.emit(\"userState\", this.localUser.newState);\r\n            this.oldState = this.localUser.newState;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    for (const key in this.users) {\r\n      const user = this.users[key];\r\n      user.update(dt);\r\n      if(this.audioHeap[key]){\r\n        user.setAudio(this.audio, this.audioHeap[key]);\r\n        delete this.audioHeap[key];\r\n      }\r\n    }\r\n  }\r\n\r\n  updateUser(state) {\r\n    const key = state[0];\r\n    if (key !== this.userName) {\r\n      const user = this.users[key];\r\n      if (user) {\r\n        user.setState(state);\r\n      }\r\n    }\r\n    else if (this.deviceIndex > 0) {\r\n      this.localUser.stage.position.fromArray(state, 1);\r\n      this.localUser.stage.quaternion.fromArray(state, 4);\r\n      this.localUser.head.position.fromArray(state, 8);\r\n      this.localUser.head.quaternion.fromArray(state, 11);\r\n    }\r\n  }\r\n\r\n  connect(socket, userName) {\r\n    this.userName = userName.toLocaleUpperCase();\r\n    if (!this.microphone) {\r\n      this.microphone = navigator.mediaDevices.getUserMedia({\r\n          audio: true,\r\n          video: false\r\n        })\r\n        .catch(console.warn.bind(console, \"Can't get audio\"));\r\n    }\r\n    if (!this._socket) {\r\n      this._socket = socket;\r\n      this._socket.on(\"userList\", this.listUsers.bind(this));\r\n      this._socket.on(\"userJoin\", this.addUser.bind(this));\r\n      this._socket.on(\"deviceAdded\", this.addDevice.bind(this));\r\n      this._socket.on(\"deviceIndex\", this.setDeviceIndex.bind(this));\r\n      this._socket.on(\"chat\", this.receiveChat.bind(this));\r\n      this._socket.on(\"userState\", this.updateUser.bind(this));\r\n      this._socket.on(\"userLeft\", this.removeUser.bind(this));\r\n      this._socket.on(\"connection_lost\", this.lostConnection.bind(this));\r\n      this._socket.emit(\"listUsers\");\r\n      this._socket.emit(\"getDeviceIndex\");\r\n    }\r\n  }\r\n\r\n  disconnect() {\r\n    this.userName = null;\r\n    this._socket.close();\r\n    this._socket = null;\r\n  }\r\n\r\n  addUser(state, goSecond) {\r\n    console.log(\"User %s logging on.\", state[0]);\r\n    var toUserName = state[0],\r\n      user = new RemoteUser(toUserName, this.factories.avatar, this.options.foregroundColor, this.options.disableWebRTC, this.options.webRTC, this.microphone, this.userName, goSecond);\r\n    this.users[toUserName] = user;\r\n    this.updateUser(state);\r\n    this.emit(\"addavatar\", user);\r\n  }\r\n\r\n  removeUser(key) {\r\n    console.log(\"User %s logging off.\", key);\r\n    var user = this.users[key];\r\n    if (user) {\r\n      if(user.peered){\r\n        user.unpeer();\r\n      }\r\n      delete this.users[key];\r\n      this.emit(\"removeavatar\", user);\r\n    }\r\n  }\r\n\r\n  listUsers(newUsers) {\r\n    Object.keys(this.users)\r\n      .forEach(this.removeUser.bind(this));\r\n    while (newUsers.length > 0) {\r\n      this.addUser(newUsers.shift(), true);\r\n    }\r\n    this.emit(\"authorizationsucceeded\");\r\n  }\r\n\r\n  receiveChat(evt) {\r\n    console.log(\"chat\", evt);\r\n  }\r\n\r\n  lostConnection() {\r\n    this.deviceIndex = null;\r\n  }\r\n\r\n  addDevice(index) {\r\n    console.log(\"addDevice\", index);\r\n  }\r\n\r\n  setDeviceIndex(index) {\r\n    this.deviceIndex = index;\r\n  }\r\n\r\n  setAudioFromUser(userName, audioElement){\r\n    this.audioHeap[userName] = audioElement;\r\n  }\r\n}\r\n","pliny.value({\r\n  parent: \"Primrose.Text.Grammars\",\r\n  name: \"PlainText\",\r\n  description: \"A grammar that makes displaying plain text work with the text editor designed for syntax highlighting.\"\r\n});\r\n\r\nimport Grammar from \"./Grammar\";\r\nexport default new Grammar(\"PlainText\", [\r\n  [\"newlines\", /(?:\\r\\n|\\r|\\n)/]\r\n]);","import { Vector3 } from \"three\";\r\n\r\nimport sphere from \"../../live-api/sphere\"\r\n\r\nconst DIFF = new Vector3(),\r\n  MAX_MOVE_DISTANCE = 5,\r\n  MAX_MOVE_DISTANCE_SQ = MAX_MOVE_DISTANCE * MAX_MOVE_DISTANCE,\r\n  MAX_TELEPORT_WAGGLE = 0.5,\r\n  TELEPORT_PAD_RADIUS = 0.4,\r\n  TELEPORT_COOLDOWN = 250;\r\n\r\nexport default class Teleporter {\r\n  constructor(env) {\r\n\r\n    this.enabled = true;\r\n    this._environment = env;\r\n\r\n    this._startPoint = new Vector3();\r\n    this._moveDistance = 0;\r\n\r\n    this._start = this._start.bind(this);\r\n    this._exit = this._exit.bind(this);\r\n    this._move = this._move.bind(this);\r\n    this._end = this._end.bind(this);\r\n\r\n    env.ground.on(\"exit\", this._exit)\r\n      .on(\"gazecancel\", this._exit)\r\n      .on(\"gazecomplete\", this._exit)\r\n      .on(\"pointerend\", this._exit)\r\n\r\n      .on(\"pointerstart\", this._start)\r\n      .on(\"gazestart\", this._start)\r\n\r\n      .on(\"pointermove\", this._move)\r\n      .on(\"gazemove\", this._move)\r\n\r\n      .on(\"select\", this._end);\r\n\r\n\r\n    this.disk = sphere(TELEPORT_PAD_RADIUS, 128, 3)\r\n      .colored(0xff0000, {\r\n        unshaded: true\r\n      })\r\n      .named(\"disk\")\r\n      .addTo(env.scene);\r\n\r\n    this.disk.geometry.computeBoundingBox();\r\n    this.disk.geometry.vertices.forEach((v) => {\r\n      v.y = 0.1 * (v.y - this.disk.geometry.boundingBox.min.y);\r\n    });\r\n    this.disk.geometry.computeBoundingBox();\r\n\r\n    this.disk.visible = false;\r\n  }\r\n\r\n  _exit(evt) {\r\n    this.disk.visible = false;\r\n  }\r\n\r\n  _start(evt){\r\n    if(this.enabled){\r\n      this._updatePosition(evt);\r\n      this.disk.visible = true;\r\n      this._moveDistance = 0;\r\n    }\r\n  }\r\n\r\n  _move(evt) {\r\n    if(this.enabled) {\r\n      this._updatePosition(evt);\r\n      this.disk.visible = this._moveDistance < MAX_TELEPORT_WAGGLE;\r\n    }\r\n  }\r\n\r\n  _end(evt) {\r\n    if(this.enabled) {\r\n      this._updatePosition(evt);\r\n      if(this._moveDistance < MAX_TELEPORT_WAGGLE) {\r\n        this._environment.teleport(this.disk.position);\r\n      }\r\n    }\r\n  }\r\n\r\n  _updatePosition(evt) {\r\n    this._startPoint.copy(this.disk.position);\r\n    this.disk.position.copy(evt.hit.point)\r\n      .sub(this._environment.head.position);\r\n\r\n    var distSq = this.disk.position.x * this.disk.position.x + this.disk.position.z * this.disk.position.z;\r\n    if (distSq > MAX_MOVE_DISTANCE_SQ) {\r\n      var dist = Math.sqrt(distSq),\r\n        factor = MAX_MOVE_DISTANCE / dist,\r\n        y = this.disk.position.y;\r\n      this.disk.position.y = 0;\r\n      this.disk.position.multiplyScalar(factor);\r\n      this.disk.position.y = y;\r\n    }\r\n\r\n    this.disk.position.add(this._environment.head.position);\r\n\r\n    const len = DIFF.copy(this.disk.position)\r\n      .sub(this._startPoint)\r\n      .length();\r\n    this._moveDistance += len;\r\n  }\r\n};\r\n","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Constants\",\r\n  description: \"Useful values that are used frequently.\"\r\n})\r\n\r\npliny.value({\r\n  parent: \"Primrose.Constants\",\r\n  name: \"PIXEL_SCALES\",\r\n  description: \"Scaling factors for changing the resolution of the display when the render quality level changes.\"\r\n});\r\nexport const PIXEL_SCALES = [\r\n  0.5,\r\n  0.25,\r\n  0.333333,\r\n  0.5,\r\n  1\r\n];\r\n\r\npliny.value({\r\n  parent: \"Primrose.Constants\",\r\n  name: \"SKINS\",\r\n  type: \"Array of Number\",\r\n  description: \"A selection of color values that closely match skin colors of people.\"\r\n});\r\nexport const SKINS = [0xFFDFC4, 0xF0D5BE, 0xEECEB3, 0xE1B899, 0xE5C298, 0xFFDCB2, 0xE5B887, 0xE5A073, 0xE79E6D, 0xDB9065, 0xCE967C, 0xC67856, 0xBA6C49, 0xA57257, 0xF0C8C9, 0xDDA8A0, 0xB97C6D, 0xA8756C, 0xAD6452, 0x5C3836, 0xCB8442, 0xBD723C, 0x704139, 0xA3866A, 0x870400, 0x710101, 0x430000, 0x5B0001, 0x302E2E ];\r\n\r\npliny.value({\r\n  parent: \"Primrose.Constants\",\r\n  name: \"SYS_FONTS\",\r\n  type: \"String\",\r\n  description: \"A selection of fonts that will match whatever the user's operating system normally uses.\"\r\n});\r\nexport const SYS_FONTS = \"-apple-system, '.SFNSText-Regular', 'San Francisco', 'Roboto', 'Segoe UI', 'Helvetica Neue', 'Lucida Grande', sans-serif\";\r\n\r\npliny.enumeration({\r\n  parent: \"Primrose.Constants\",\r\n  name: \"Quality\",\r\n  description: \"Graphics quality settings.\"\r\n});\r\nexport const Quality = {\r\n  NONE: 0,\r\n  VERYLOW: 1,\r\n  LOW: 2,\r\n  MEDIUM: 3,\r\n  HIGH: 4,\r\n  MAXIMUM: PIXEL_SCALES.length - 1\r\n};\r\n\r\n\r\npliny.value({\r\n  parent: \"Primrose.Constants\",\r\n  name: \"NAMES\",\r\n  type: \"Array of String\",\r\n  description: \"Just a list of nice names.\"\r\n});\r\nexport const NAMES = [\r\n  \"Dahlia\",\r\n  \"Zinnia\",\r\n  \"Camellia\",\r\n  \"Ren\",\r\n  \"Lotus\",\r\n  \"Azalea\",\r\n  \"Kunal\",\r\n  \"Saffron\",\r\n  \"Jessamine\",\r\n  \"Basil\",\r\n  \"Indigo\",\r\n  \"Violet\",\r\n  \"Iris\",\r\n  \"Holly\",\r\n  \"Yarrow\",\r\n  \"Hazel\",\r\n  \"Cypress\",\r\n  \"Amaranth\",\r\n  \"Aster\",\r\n  \"Emerald\",\r\n  \"Ash\",\r\n  \"Boxwood\",\r\n  \"Birchwood\",\r\n  \"Ebony\",\r\n  \"Forsythia\",\r\n  \"Hawthorn\",\r\n  \"Hemlock\",\r\n  \"Locust\",\r\n  \"Juniper\",\r\n  \"Linden\",\r\n  \"Magnolia\",\r\n  \"Laurel\",\r\n  \"Oak\",\r\n  \"Alder\",\r\n  \"Sycamore\",\r\n  \"Blackhaw\"\r\n];\r\n\r\nexport default {\r\n  PIXEL_SCALES,\r\n  SKINS,\r\n  SYS_FONTS,\r\n  NAMES,\r\n  Quality\r\n};","/// NOTE: maybe BrowserEnvironment should be a subclass of THREE.Scene.\r\n\r\n\r\nimport { packageName, version, homepage } from \"../../package.json\";\r\nconsole.info(`[${packageName} v${version}]:> see ${homepage} for more information.`);\r\n\r\npliny.class({\r\n  parent: \"Primrose\",\r\n  name: \"BrowserEnvironment\",\r\n  description: \"Make a Virtual Reality app in your web browser!\\n\\\r\n\\n\\\r\nThe `BrowserEnvironment` class provides a plethora of options for setting up new scenes and customizing the VR experience to your system. It is the starting point for all of your projects. It is named `BrowserEnvironment` as one day their may be an `AltspaceVREnvironment` or a `HiFidelityEnvironment`.\",\r\n  parameters: [{\r\n    name: \"options\",\r\n    type: \"Primrose.BrowserEnvironment.optionsHash\",\r\n    description: \"Settings to change how the environment looks and behaves. See [`Primrose.BrowserEnvironment.optionsHash`](#Primrose_BrowserEnvironment_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\npliny.record({\r\n  parent: \"Primrose.BrowserEnvironment\",\r\n  name: \"optionsHash\",\r\n  description: \"Settings to change how the environment looks and behaves.\",\r\n  parameters: [{\r\n    name: \"antialias\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: true,\r\n    description: \"Enable or disable anti-aliasing\"\r\n  }, {\r\n    name: \"quality\",\r\n    type: \"Primrose.Constants.Quality\",\r\n    optional: true,\r\n    default: \"Primrose.Constants.Quality.MAXIMUM\",\r\n    description: \"The quality level at which to start rendering.\"\r\n  }, {\r\n    name: \"fullScreenButtonContainer\",\r\n    type: \"String\",\r\n    optional: true,\r\n    description: \"A DOM query selector that, if provided, will have buttons added to it for each of the fullscreen modes.\"\r\n  }, {\r\n    name: \"useGaze\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Whether or not to used timed ring cursors.\"\r\n  }, {\r\n    name: \"useFog\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Whether or not to use fog in the scene to limit view distance.\"\r\n  }, {\r\n    name: \"avatarHeight\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1.65,\r\n    description: \"The default height of the user's avatar, if the VR system doesn't provide a height.\"\r\n  }, {\r\n    name: \"walkSpeed\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 2,\r\n    description: \"The number of meters per second at which the user runs.\"\r\n  }, {\r\n    name: \"disableKeyboard\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Set to true to disable keyboard-based input.\"\r\n  }, {\r\n    name: \"enableShadows\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"Set to true to enable the use of shadows on objects in the scene.\"\r\n  }, {\r\n    name: \"shadowMapSize\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1024,\r\n    description: \"The size to use for the width and height of the shadow map that will be generated.\"\r\n  }, {\r\n    name: \"shadowRadius\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1,\r\n    description: \"The number of pixels of blurring to perform at the edge of the shadows.\"\r\n  }, {\r\n    name: \"progress\",\r\n    type: \"Function\",\r\n    optional: true,\r\n    description: \"Callback function for recording model download progress.\"\r\n  }, {\r\n    name: \"gravity\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 9.8,\r\n    description: \"The acceleration applied to falling objects.\"\r\n  }, {\r\n    name: \"gazeLength\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 1.5,\r\n    description: \"The amount of time in seconds to require gazes on objects before triggering the gaze event.\"\r\n  }, {\r\n    name: \"disableMirroring\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"By default, what we see in the VR view will get mirrored to a regular view on the primary screen. Set to true to improve performance.\"\r\n  }, {\r\n    name: \"disableDefaultLighting\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    description: \"By default, a single light is added to the scene,\"\r\n  }, {\r\n    name: \"backgroundColor\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 0xafbfff,\r\n    description: \"The color that WebGL clears the background with before drawing.\"\r\n  }, {\r\n    name: \"skyTexture\",\r\n    type: \"String or Array of String\",\r\n    optional: true,\r\n    description: \"The texture(s) to use for the sky.\"\r\n  }, {\r\n    name: \"groundTexture\",\r\n    type: \"String\",\r\n    optional: true,\r\n    description: \"The texture to use for the ground.\"\r\n  }, {\r\n    name: \"groundModel\",\r\n    type: \"String\",\r\n    optional: true,\r\n    description: \"A model file to use for the ground.\"\r\n  }, {\r\n    name: \"nearPlane\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 0.01,\r\n    description: \"The near plane of the camera.\"\r\n  }, {\r\n    name: \"drawDistance\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 100,\r\n    description: \"The distance from the near plane to the far plane of the camera.\"\r\n  }, {\r\n    name: \"defaultFOV\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    default: 75,\r\n    description: \"The field of view to use in non-VR settings.\"\r\n  }, {\r\n    name: \"ambientSound\",\r\n    type: \"String\",\r\n    optional: true,\r\n    description: \"The sound to play on loop in the background.\"\r\n  }, {\r\n    name: \"canvasElement\",\r\n    type: \"HTMLCanvasElement\",\r\n    optional: true,\r\n    default: \"frontBuffer\",\r\n    description: \"HTML5 canvas element to which to render, if one had already been created.\"\r\n  }, {\r\n    name: \"renderer\",\r\n    type: \"THREE.WebGLRenderer\",\r\n    optional: true,\r\n    description: \"Three.js renderer, if one had already been created.\"\r\n  }, {\r\n    name: \"context\",\r\n    type: \"WebGLRenderingContext\",\r\n    optional: true,\r\n    description: \"A WebGL context to use, if one had already been created.\"\r\n  }, {\r\n    name: \"scene\",\r\n    type: \"THREE.Scene\",\r\n    optional: true,\r\n    description: \"Three.js scene, if one had already been created.\"\r\n  }, {\r\n\r\n    name: \"nonstandardNeckLength\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"When creating a neck model, this is how high the neck runs. This is an experimental feature for setting the height of a user's \\\"neck\\\" on orientation-only systems (such as Google Cardboard and Samsung Gear VR) to create a more realistic feel.\"\r\n  }, {\r\n    name: \"nonstandardNeckDepth\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"When creating a neck model, this is the distance from the center meridian of the neck to the eyes.\"\r\n  }, {\r\n    name: \"showHeadPointer\",\r\n    type: \"Boolean\",\r\n    optional: true,\r\n    default: true,\r\n    description: \"Whether or not to show a pointer tracking the gaze direction.\"\r\n  }, {\r\n    name: \"nonstandardIPD\",\r\n    type: \"Number\",\r\n    optional: true,\r\n    description: \"When creating a neck model, this is the how far apart to set the eyes. I highly suggest you don't go down the road that requires setting this. I will not help you understand what it does, because I would rather you just not use it.\"\r\n  }]\r\n});\r\n\r\nimport isiOS from \"../flags/isiOS\";\r\nimport isMobile from \"../flags/isMobile\";\r\n\r\nimport box from \"../live-api/box\";\r\nimport brick from \"../live-api/brick\";\r\nimport colored from \"../live-api/colored\";\r\nimport hub from \"../live-api/hub\";\r\nimport textured from \"../live-api/textured\";\r\nimport sphere from \"../live-api/sphere\";\r\n\r\nimport PointerLock from \"../util/PointerLock\";\r\nimport identity from \"../util/identity\";\r\n\r\nimport Angle from \"./Angle\";\r\nimport Pointer from \"./Pointer\";\r\nimport Keys from \"./Keys\";\r\n\r\nimport Text2Speech from \"./Audio/Speech\";\r\nimport Audio3D from \"./Audio/Audio3D\";\r\nimport Music from \"./Audio/Music\";\r\n\r\nimport { updateAll, eyeBlankAll } from \"./Controls/BaseTextured\";\r\nimport Button2D from \"./Controls/Button2D\";\r\nimport Button3D from \"./Controls/Button3D\";\r\nimport ButtonFactory from \"./Controls/ButtonFactory\";\r\nimport Entity from \"./Controls/Entity\";\r\nimport Ground from \"./Controls/Ground\";\r\nimport Sky from \"./Controls/Sky\";\r\nimport Image from \"./Controls/Image\";\r\nimport Surface from \"./Controls/Surface\";\r\nimport TextBox from \"./Controls/TextBox\";\r\n\r\nimport StandardMonitorVRDisplay from \"./Displays/StandardMonitorVRDisplay\";\r\n\r\nimport cascadeElement from \"./DOM/cascadeElement\";\r\nimport makeHidingContainer from \"./DOM/makeHidingContainer\";\r\n\r\nimport ModelFactory from \"./Graphics/ModelFactory\";\r\n\r\nimport Keyboard from \"./Input/Keyboard\";\r\nimport Mouse from \"./Input/Mouse\";\r\nimport Gamepad from \"./Input/Gamepad\";\r\nimport GamepadManager from \"./Input/GamepadManager\";\r\nimport Touch from \"./Input/Touch\";\r\nimport Speech from \"./Input/Speech\";\r\nimport VR from \"./Input/VR\";\r\n\r\nimport NetworkManager from \"./Network/Manager\";\r\n\r\nimport PlainText from \"./Text/Grammars/PlainText\";\r\n\r\nimport Teleporter from \"./Tools/Teleporter\";\r\n\r\nimport { Quality, PIXEL_SCALES } from \"./Constants\";\r\n\r\n\r\nimport { EventDispatcher, Object3D, BackSide, PCFSoftShadowMap, FogExp2, Scene, PerspectiveCamera, TextGeometry, Quaternion, Color, Euler, Vector3, Matrix4, WebGLRenderer } from \"three\";\r\n\r\nconst MILLISECONDS_TO_SECONDS = 0.001,\r\n  TELEPORT_DISPLACEMENT = new Vector3(),\r\n  DISPLACEMENT = new Vector3(),\r\n  EULER_TEMP = new Euler(),\r\n  QUAT_TEMP = new Quaternion(),\r\n  WEDGE = Math.PI / 3;\r\n\r\nexport default class BrowserEnvironment extends EventDispatcher {\r\n  constructor(options) {\r\n    super();\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"options\",\r\n      type: \"Object\",\r\n      description: \"A manager for messages sent across the network.\"\r\n    });\r\n    this.options = Object.assign({}, BrowserEnvironment.DEFAULTS, options);\r\n\r\n    this.options.foregroundColor = this.options.foregroundColor || complementColor(new Color(this.options.backgroundColor))\r\n      .getHex();\r\n\r\n    this.deltaTime = 1;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"network\",\r\n      type: \"Primrose.Network.Manager\",\r\n      description: \"A manager for messages sent across the network.\"\r\n    });\r\n    this.network = null;\r\n\r\n    if(this.options.nonstandardIPD !== null){\r\n      this.options.nonstandardIPD *= 0.5;\r\n    }\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"audioQueue\",\r\n      type: \"Array\",\r\n      description: \"Remote user Audio elements that joined as peers before the `BrowserEnvironment` could finish loading all of the assets.\"\r\n    });\r\n    this.audioQueue = [];\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"zero\",\r\n      description: \"Zero and reset sensor data.\"\r\n    });\r\n    this.zero = () => {\r\n      if (!this.lockMovement) {\r\n        for (let i = 0; i < this.managers.length; ++i) {\r\n          this.managers[i].zero();\r\n        }\r\n        if (this.quality === Quality.NONE) {\r\n          this.quality = Quality.HIGH;\r\n        }\r\n      }\r\n    };\r\n\r\n    let missedFrames = 0;\r\n    const update = (dt) => {\r\n      dt *= MILLISECONDS_TO_SECONDS;\r\n      if(dt > 0) {\r\n        const fps = Math.round(1 / dt);\r\n        dt = 1 / fps;\r\n        this.deltaTime = Math.min(this.deltaTime, dt);\r\n\r\n\r\n        // if we missed way too many frames in one go, just update once, otherwise we'll end up locking up the system.\r\n        let numFrames = dt / this.deltaTime;\r\n        if(numFrames > 1) {\r\n          missedFrames += numFrames;\r\n          if(numFrames > 10) {\r\n            numFrames = 1;\r\n          }\r\n        }\r\n        else if(missedFrames > 0) {\r\n          missedFrames -= 0.1;\r\n        }\r\n\r\n        if(missedFrames >= 10) {\r\n          this.deltaTime = dt;\r\n          missedFrames = 0;\r\n        }\r\n\r\n        updateFade(dt);\r\n\r\n        for(let frame = 0; frame < numFrames; ++frame) {const hadGamepad = this.hasGamepad;\r\n          if(this.gamepadMgr) {\r\n            this.gamepadMgr.poll();\r\n          }\r\n          for (let i = 0; i < this.managers.length; ++i) {\r\n            this.managers[i].update(dt);\r\n          }\r\n\r\n          if (!hadGamepad && this.hasGamepad) {\r\n            this.Mouse.inPhysicalUse = false;\r\n          }\r\n\r\n          this.head.showPointer = this.VR.hasOrientation && this.options.showHeadPointer;\r\n          this.mousePointer.visible = this.VR.isPresenting;\r\n          this.mousePointer.showPointer = !this.hasMotionControllers;\r\n\r\n          let heading = 0,\r\n            pitch = 0,\r\n            strafe = 0,\r\n            drive = 0;\r\n          for (let i = 0; i < this.managers.length; ++i) {\r\n            const mgr = this.managers[i];\r\n            if(mgr.enabled){\r\n              if(mgr.name !== \"Mouse\"){\r\n                heading += mgr.getValue(\"heading\");\r\n              }\r\n              pitch += mgr.getValue(\"pitch\");\r\n              strafe += mgr.getValue(\"strafe\");\r\n              drive += mgr.getValue(\"drive\");\r\n            }\r\n          }\r\n\r\n          if(this.hasMouse || this.hasTouch) {\r\n            let mouseHeading = null;\r\n            if (this.VR.hasOrientation) {\r\n              mouseHeading = this.mousePointer.rotation.y;\r\n              const newMouseHeading = WEDGE * Math.floor((mouseHeading / WEDGE) + 0.5);\r\n              if(newMouseHeading !== 0){\r\n                this.Mouse.commands.U.offset -= this.Mouse.getValue(\"U\") - 1;\r\n              }\r\n              mouseHeading = newMouseHeading + this.Mouse.commands.U.offset * 2;\r\n            }\r\n            else{\r\n              mouseHeading = this.Mouse.getValue(\"heading\");\r\n            }\r\n            heading += mouseHeading;\r\n          }\r\n          if (this.VR.hasOrientation) {\r\n            pitch = 0;\r\n          }\r\n\r\n          // move stage according to heading and thrust\r\n          EULER_TEMP.set(pitch, heading, 0, \"YXZ\");\r\n          this.stage.quaternion.setFromEuler(EULER_TEMP);\r\n\r\n          // update the stage's velocity\r\n          this.velocity.set(strafe, 0, drive);\r\n\r\n          QUAT_TEMP.copy(this.head.quaternion);\r\n          EULER_TEMP.setFromQuaternion(QUAT_TEMP);\r\n          EULER_TEMP.x = 0;\r\n          EULER_TEMP.z = 0;\r\n          QUAT_TEMP.setFromEuler(EULER_TEMP);\r\n\r\n          this.moveStage(DISPLACEMENT\r\n            .copy(this.velocity)\r\n            .multiplyScalar(dt)\r\n            .applyQuaternion(QUAT_TEMP)\r\n            .add(this.head.position));\r\n\r\n          this.stage.position.y = this.ground.getHeightAt(this.stage.position) || 0;\r\n          this.stage.position.y += this.options.avatarHeight;\r\n          for (let i = 0; i < this.motionDevices.length; ++i) {\r\n            this.motionDevices[i].posePosition.y -= this.options.avatarHeight;\r\n          }\r\n\r\n          // update the motionDevices\r\n          this.stage.updateMatrix();\r\n          this.matrix.multiplyMatrices(this.stage.matrix, this.VR.stage.matrix);\r\n          for (let i = 0; i < this.motionDevices.length; ++i) {\r\n            this.motionDevices[i].updateStage(this.matrix);\r\n          }\r\n\r\n          for (let i = 0; i < this.pointers.length; ++i) {\r\n            this.pointers[i].update();\r\n          }\r\n\r\n          // record the position and orientation of the user\r\n          this.newState = [];\r\n          this.head.updateMatrix();\r\n          this.stage.rotation.x = 0;\r\n          this.stage.rotation.z = 0;\r\n          this.stage.quaternion.setFromEuler(this.stage.rotation);\r\n          this.stage.updateMatrix();\r\n          this.head.position.toArray(this.newState, 0);\r\n          this.head.quaternion.toArray(this.newState, 3);\r\n\r\n          if(frame === 0) {\r\n            updateAll();\r\n            let userActionHandlers = null;\r\n            for (let i = 0; i < this.pointers.length; ++i) {\r\n              userActionHandlers = this.pointers[i].resolvePicking(this.scene);\r\n            }\r\n            for (let i = 0; i < this.managers.length; ++i) {\r\n              this.managers[i].userActionHandlers = userActionHandlers;\r\n            }\r\n            this.ground.moveTo(this.head.position);\r\n            this.sky.position.copy(this.head.position);\r\n            moveUI();\r\n          }\r\n\r\n          pliny.event({\r\n            parent: \"Primrose.BrowserEnvironment\",\r\n            name: \"update\",\r\n            description: \"Fires after every animation update.\"\r\n          });\r\n          try {\r\n            this.emit(\"update\");\r\n          }\r\n          catch(exp){\r\n            // don't let user script kill the runtime\r\n            console.error(\"User update errored\", exp);\r\n          }\r\n\r\n          if(frame === 0 && this.network){\r\n            this.network.update(dt);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"turns\",\r\n      type: \"Primrose.Angle\",\r\n      description: \"A slewing angle that loosely follows the user around.\"\r\n    });\r\n    this.turns = new Angle(0);\r\n    const followEuler = new Euler(),\r\n      maxX = -Math.PI / 4,\r\n      maxY = Math.PI / 6;\r\n\r\n    const moveUI = (dt) => {\r\n      var y = this.vicinity.position.y,\r\n        p = this.options.vicinityFollowRate,\r\n        q = 1 - p;\r\n      this.vicinity.position.lerp(this.head.position, p);\r\n      this.vicinity.position.y = y;\r\n\r\n      followEuler.setFromQuaternion(this.head.quaternion);\r\n      this.turns.radians = followEuler.y;\r\n      followEuler.set(maxX, this.turns.radians, 0, \"YXZ\");\r\n      this.ui.quaternion.setFromEuler(followEuler)\r\n      this.ui.position.y = this.ui.position.y * q + this.head.position.y * p;\r\n    };\r\n\r\n    var animate = (t) => {\r\n      var dt = t - lt,\r\n        i, j;\r\n      lt = t;\r\n      update(dt);\r\n      render();\r\n      RAF(animate);\r\n    };\r\n\r\n    var render = () => {\r\n      this.camera.position.set(0, 0, 0);\r\n      this.camera.quaternion.set(0, 0, 0, 1);\r\n      this.audio.setPlayer(this.head.mesh);\r\n      this.renderer.clear(true, true, true);\r\n\r\n      var trans = this.VR.getTransforms(\r\n        this.options.nearPlane,\r\n        this.options.nearPlane + this.options.drawDistance);\r\n      for (var i = 0; trans && i < trans.length; ++i) {\r\n        eyeBlankAll(i);\r\n\r\n        var st = trans[i],\r\n          v = st.viewport;\r\n\r\n        this.renderer.setViewport(\r\n          v.left * resolutionScale,\r\n          v.top * resolutionScale,\r\n          v.width * resolutionScale,\r\n          v.height * resolutionScale);\r\n\r\n        this.camera.projectionMatrix.copy(st.projection);\r\n        if (this.mousePointer.unproject) {\r\n          this.mousePointer.unproject.getInverse(st.projection);\r\n        }\r\n        this.camera.translateOnAxis(st.translation, 1);\r\n        this.renderer.render(this.scene, this.camera);\r\n        this.camera.translateOnAxis(st.translation, -1);\r\n      }\r\n      this.VR.submitFrame();\r\n    };\r\n\r\n    var modifyScreen = () => {\r\n      var near = this.options.nearPlane,\r\n        far = near + this.options.drawDistance,\r\n        p = this.VR && this.VR.getTransforms(near, far);\r\n\r\n      if (p) {\r\n        var canvasWidth = 0,\r\n          canvasHeight = 0;\r\n\r\n        for (var i = 0; i < p.length; ++i) {\r\n          canvasWidth += p[i].viewport.width;\r\n          canvasHeight = Math.max(canvasHeight, p[i].viewport.height);\r\n        }\r\n\r\n        this.mousePointer.setSize(canvasWidth, canvasHeight);\r\n\r\n        canvasWidth = Math.floor(canvasWidth * resolutionScale);\r\n        canvasHeight = Math.floor(canvasHeight * resolutionScale);\r\n\r\n        this.renderer.domElement.width = canvasWidth;\r\n        this.renderer.domElement.height = canvasHeight;\r\n        if (!this.timer) {\r\n          render();\r\n        }\r\n      }\r\n    };\r\n\r\n    //\r\n    // Initialize local variables\r\n    //\r\n\r\n    var lt = 0,\r\n      currentHeading = 0,\r\n      qPitch = new Quaternion(),\r\n      vEye = new Vector3(),\r\n      vBody = new Vector3(),\r\n      modelFiles = {\r\n        scene: this.options.sceneModel,\r\n        avatar: this.options.avatarModel,\r\n        button: this.options.button && typeof this.options.button.model === \"string\" && this.options.button.model,\r\n        font: this.options.font\r\n      },\r\n      resolutionScale = 1;\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"factories\",\r\n      type: \"Object\",\r\n      description: \"A database of object factories, generally used to create 3D models.\"\r\n    });\r\n    this.factories = {\r\n      avatar: null\r\n    };\r\n\r\n    function setColor(model, color) {\r\n      return model.children[0].material.color.set(color);\r\n    }\r\n\r\n    function complementColor(color) {\r\n      var rgb = color.clone();\r\n      var hsl = rgb.getHSL();\r\n      hsl.h = hsl.h + 0.5;\r\n      hsl.l = 1 - hsl.l;\r\n      while (hsl.h > 1) hsl.h -= 1;\r\n      rgb.setHSL(hsl.h, hsl.s, hsl.l);\r\n      return rgb;\r\n    }\r\n\r\n    var modelsReady = ModelFactory.loadObjects(modelFiles, this.options.progress.thunk)\r\n      .then((models) => {\r\n        window.text3D = function (font, size, text) {\r\n          var geom = new TextGeometry(text, {\r\n            font: font,\r\n            size: size,\r\n            height: size / 5,\r\n            curveSegments: 2\r\n          });\r\n          geom.computeBoundingSphere();\r\n          geom.computeBoundingBox();\r\n          return geom;\r\n        }.bind(window, models.font);\r\n\r\n        if (models.scene) {\r\n          buildScene(models.scene);\r\n        }\r\n\r\n        if (models.avatar) {\r\n          this.factories.avatar = new ModelFactory(models.avatar);\r\n        }\r\n\r\n        pliny.property({\r\n          parent: \"Primrose.BrowserEnvironment\",\r\n          name: \"buttonFactory\",\r\n          type: \"Primrose.Controls.ButtonFactory\",\r\n          description: \"A factory for creating the geometry for individual 3D buttons whenever they are needed.\"\r\n        })\r\n        if (models.button) {\r\n          this.buttonFactory = new ButtonFactory(\r\n            models.button,\r\n            this.options.button.options);\r\n        }\r\n      })\r\n      .catch((err) => console.error(err))\r\n      .then(() => this.buttonFactory = this.buttonFactory || ButtonFactory.DEFAULT);\r\n\r\n    //\r\n    // Initialize public properties\r\n    //\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"speech\",\r\n      type: \"Primrose.Audio.Speech\",\r\n      description: \"A text-2-speech system.\"\r\n    });\r\n    this.speech = new Text2Speech(this.options.speech);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"audio\",\r\n      type: \"Primrose.Audio.Audio3D\",\r\n      description: \"An audio graph that keeps track of 3D information.\"\r\n    });\r\n    this.audio = new Audio3D();\r\n\r\n    if (this.options.ambientSound) {\r\n      this.audio.load3DSound(this.options.ambientSound, true, -1, 1, -1)\r\n        .then((aud) => {\r\n          if (!(aud.source instanceof MediaElementAudioSourceNode)) {\r\n            aud.volume.gain.value = 0.1;\r\n            aud.source.start();\r\n          }\r\n        })\r\n        .catch(console.error.bind(console, \"Audio3D loadSource\"));\r\n    }\r\n\r\n    var documentReady = null;\r\n    if (document.readyState === \"complete\") {\r\n      documentReady = Promise.resolve(\"already\");\r\n    }\r\n    else {\r\n      documentReady = new Promise((resolve, reject) => {\r\n        document.addEventListener(\"readystatechange\", (evt) => {\r\n          if (document.readyState === \"complete\") {\r\n            resolve(\"had to wait for it\");\r\n          }\r\n        }, false);\r\n      });\r\n    }\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"music\",\r\n      type: \"Primrose.Audio.Music\",\r\n      description: \"A primitive sort of synthesizer for making simple music.\"\r\n    });\r\n    this.music = new Music(this.audio);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"currentControl\",\r\n      type: \"Primrose.Control.Entity\",\r\n      description: \"The currently selected control, by a user-click or some other function.\"\r\n    });\r\n    this.currentControl = null;\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"fadeOut\",\r\n      returns: \"Promise\",\r\n      description: \"Causes the fully rendered view fade out to the color provided `options.backgroundColor`\"\r\n    });\r\n    let fadeOutPromise = null,\r\n      fadeOutPromiseResolver = null,\r\n      fadeInPromise = null,\r\n      fadeInPromiseResolver = null;\r\n    this.fadeOut = () => {\r\n      if(fadeInPromise) {\r\n        return Promise.reject(\"Currently fading in.\");\r\n      }\r\n      if(!fadeOutPromise) {\r\n        this.fader.visible = true;\r\n        this.fader.material.opacity = 0;\r\n        this.fader.material.needsUpdate = true;\r\n        fadeOutPromise = new Promise((resolve, reject) =>\r\n          fadeOutPromiseResolver = (obj) => {\r\n            fadeOutPromise = null;\r\n            fadeOutPromiseResolver = null;\r\n            resolve(obj);\r\n          });\r\n      }\r\n      return fadeOutPromise;\r\n    };\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"fadeIn\",\r\n      returns: \"Promise\",\r\n      description: \"Causes the faded out cube to disappear.\"\r\n    });\r\n    this.fadeIn = () => {\r\n      if(fadeOutPromise) {\r\n        return Promise.reject(\"Currently fading out.\");\r\n      }\r\n      if(!fadeInPromise){\r\n        fadeInPromise = new Promise((resolve, reject) =>\r\n          fadeInPromiseResolver = (obj) => {\r\n            fadeInPromise = null;\r\n            fadeInPromiseResolver = null;\r\n            this.fader.visible = false;\r\n            resolve(obj);\r\n          });\r\n      }\r\n      return fadeInPromise;\r\n    };\r\n\r\n    const updateFade = (dt) => {\r\n      if(fadeOutPromise || fadeInPromise) {\r\n        const m = this.fader.material,\r\n          f = this.options.fadeRate * dt;\r\n        m.needsUpdate = true;\r\n        if(fadeOutPromise) {\r\n          m.opacity += f;\r\n          if(1 <= m.opacity){\r\n            m.opacity = 1;\r\n            fadeOutPromiseResolver();\r\n          }\r\n        }\r\n        else {\r\n          m.opacity -= f;\r\n          if(m.opacity <= 0){\r\n            m.opacity = 0;\r\n            fadeInPromiseResolver();\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"teleportAvailable\",\r\n      type: \"Boolean\",\r\n      description: \"Returns true when the system is not currently fading out or in.`\"\r\n    });\r\n    this.teleportAvailable = true;\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"transition\",\r\n      returns: \"Promise\",\r\n      description: \"Perform an action in between a fade-out and a fade-in. Useful for hiding actions that might cause the view update to freeze, so the user doesn't get sick.\",\r\n      parameters: [{\r\n        name: \"thunk\",\r\n        type: \"Function\",\r\n        description: \"A callback function, to be executed between the fade-out and fade-in effects.\"\r\n      }]\r\n    });\r\n    this.transition = (thunk, check, immediate) => {\r\n      if(immediate) {\r\n        thunk();\r\n        return Promise.resolve();\r\n      }\r\n      else if(!check || check()){\r\n        return this.fadeOut()\r\n          .then(thunk)\r\n          .then(this.fadeIn)\r\n          .catch(console.warn.bind(console, \"Error transitioning\"));\r\n      }\r\n    };\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"teleport\",\r\n      returns: \"Promise\",\r\n      description: \"Move the user to a position, using the fade-out/fade-in transition effect.\",\r\n      parameters: [{\r\n        name: \"pos\",\r\n        type: \"THREE.Vector3\",\r\n        description: \"The point at which to move the user.\"\r\n      }, {\r\n        name: \"immediate\",\r\n        type: \"Boolean\",\r\n        optional: true,\r\n        default: false,\r\n        description: \"If true, skips the transition effect.\"\r\n      }]\r\n    });\r\n    this.teleport = (pos, immediate) => this.transition(\r\n      () => this.moveStage(pos),\r\n      () => this.teleportAvailable && TELEPORT_DISPLACEMENT.copy(pos)\r\n        .sub(this.head.position)\r\n        .length() > 0.2,\r\n      immediate);\r\n\r\n    const delesectControl = () => {\r\n      if(this.currentControl) {\r\n        this.currentControl.removeEventListener(\"blur\", delesectControl);\r\n        this.Keyboard.enabled = true;\r\n        this.Mouse.commands.pitch.disabled =\r\n        this.Mouse.commands.heading.disabled = this.VR.isPresenting;\r\n        this.currentControl.blur();\r\n        this.currentControl = null;\r\n      }\r\n    };\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"consumeEvent\",\r\n      description: \"Handles pointer interactions and differentiates between teleportation and selecting controls on the screen.\",\r\n      parameters: [{\r\n        name: \"evt\",\r\n        type: \"Event\",\r\n        description: \"A pointer click event that triggered.\"\r\n      }]\r\n    });\r\n    this.consumeEvent = (evt) => {\r\n      const obj = evt.hit && evt.hit.object,\r\n        cancel = evt.type === \"exit\" || evt.cmdName === \"NORMAL_ESCAPE\";\r\n\r\n      if(evt.type === \"select\" || cancel) {\r\n\r\n        if(obj !== this.currentControl || cancel){\r\n\r\n          delesectControl();\r\n\r\n          if(!cancel && obj.isSurface){\r\n            this.currentControl = obj;\r\n            this.currentControl.focus();\r\n            this.currentControl.addEventListener(\"blur\", delesectControl);\r\n            if(this.currentControl.lockMovement) {\r\n              this.Keyboard.enabled = false;\r\n              this.Mouse.commands.pitch.disabled =\r\n              this.Mouse.commands.heading.disabled = !this.VR.isPresenting;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if(obj) {\r\n        obj.dispatchEvent(evt);\r\n      }\r\n      else if(this.currentControl){\r\n        this.currentControl.dispatchEvent(evt);\r\n      }\r\n\r\n      this.dispatchEvent(evt);\r\n    };\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"scene\",\r\n      type: \"THREE.Scene\",\r\n      description: \"The 3D scene that gets displayed to the user.\"\r\n    });\r\n    this.options.scene = this.scene = this.options.scene || new Scene();\r\n\r\n    if (this.options.useFog) {\r\n      this.scene.fog = new FogExp2(this.options.backgroundColor, 1 / Math.sqrt(this.options.drawDistance));\r\n    }\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"camera\",\r\n      type: \"THREE.PerspectiveCamera\",\r\n      description: \"The camera used to render the view.\"\r\n    });\r\n    this.camera = new PerspectiveCamera(75, 1, this.options.nearPlane, this.options.nearPlane + this.options.drawDistance);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"sky\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"If a `skyTexture` option is provided, it will be a texture cube or photosphere. If no `skyTexture` option is provided, there will only be a THREE.Object3D, to create an anchor point on which implementing scripts can add objects that follow the user's position.\"\r\n    });\r\n    this.sky = new Sky(this.options)\r\n      .addTo(this.scene);\r\n\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"ground\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"If a `groundTexture` option is provided, it will be a flat plane extending to infinity. As the user moves, the ground will shift under them by whole texture repeats, making the ground look infinite.\"\r\n    });\r\n    this.ground = new Ground(this.options)\r\n      .addTo(this.scene);\r\n\r\n    this.teleporter = new Teleporter(this);\r\n\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"ui\",\r\n      type: \"THREE.Object3D\",\r\n      description: \"An anchor point on which objects can be added that follows the user around in both position and orientation. The orientation lags following the user, so if the UI is ever in the way, the user can turn slightly and it won't follow them.\"\r\n    });\r\n    this.vicinity = hub().named(\"Vicinity\").addTo(this.scene);\r\n    this.ui = hub().named(\"UI\").addTo(this.vicinity);\r\n\r\n    var buildScene = (sceneGraph) => {\r\n      sceneGraph.buttons = [];\r\n      sceneGraph.traverse(function (child) {\r\n        if (child.isButton) {\r\n          sceneGraph.buttons.push(\r\n            new Button3D(child.parent, child.name));\r\n        }\r\n        if (child.name) {\r\n          sceneGraph[child.name] = child;\r\n        }\r\n      });\r\n      this.scene.add.apply(this.scene, sceneGraph.children);\r\n      this.scene.traverse((obj) => {\r\n        if (this.options.disableDefaultLighting && obj.material) {\r\n          if(obj.material.map){\r\n            textured(obj, obj.material.map, {\r\n              unshaded: true\r\n            });\r\n          }\r\n          else{\r\n            colored(obj, obj.material.color.getHex(), {\r\n              unshaded: true\r\n            });\r\n          }\r\n        }\r\n        if (obj.name) {\r\n          this.scene[obj.name] = obj;\r\n        }\r\n      });\r\n      if (sceneGraph.Camera) {\r\n        this.camera.position.copy(sceneGraph.Camera.position);\r\n        this.camera.quaternion.copy(sceneGraph.Camera.quaternion);\r\n      }\r\n      return sceneGraph;\r\n    };\r\n\r\n    var currentTimerObject = null;\r\n    this.timer = 0;\r\n    var RAF = (callback) => {\r\n      currentTimerObject = this.VR.currentDevice || window;\r\n      if (this.timer !== null) {\r\n        this.timer = currentTimerObject.requestAnimationFrame(callback);\r\n      }\r\n    };\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"goFullScreen\",\r\n      returns: \"Promise\",\r\n      description: \"Enter full-screen mode on one of the available displays. NOTE: due to a defect in iOS, this feature is not available on iPhones or iPads.\"\r\n    });\r\n    this.goFullScreen = (index, evt) => {\r\n      if (evt !== \"Gaze\") {\r\n        let elem = null;\r\n        if(evt === \"force\" || this.VR.canMirror || this.VR.isNativeWebVR) {\r\n          elem = this.renderer.domElement;\r\n        }\r\n        else{\r\n          elem = this.options.fullScreenElement;\r\n        }\r\n        this.VR.connect(index);\r\n        return this.VR.requestPresent([{\r\n            source: elem\r\n          }])\r\n          .catch((exp) => console.error(\"whaaat\", exp))\r\n          .then(() => elem.focus());\r\n      }\r\n    };\r\n\r\n    this.addAvatar = (user) => {\r\n      console.log(user);\r\n      this.scene.add(user.stage);\r\n      this.scene.add(user.head);\r\n    };\r\n\r\n    this.removeAvatar = (user) => {\r\n      this.scene.remove(user.stage);\r\n      this.scene.remove(user.head);\r\n    };\r\n\r\n    PointerLock.addChangeListener((evt) => {\r\n      if (this.VR.isPresenting && !PointerLock.isActive) {\r\n        this.cancelVR();\r\n      }\r\n    });\r\n\r\n    const fullScreenChange = (evt) => {\r\n      const presenting = !!this.VR.isPresenting,\r\n        cmd = (presenting ? \"remove\" : \"add\") + \"Button\";\r\n      this.Mouse[cmd](\"dx\", 0);\r\n      this.Mouse[cmd](\"dy\", 0);\r\n      this.Mouse.commands.U.disabled =\r\n        this.Mouse.commands.V.disabled = presenting && !this.VR.isStereo;\r\n      this.Mouse.commands.heading.scale = presenting ? -1 : 1;\r\n      this.Mouse.commands.pitch.scale = presenting ? -1 : 1;\r\n      if (!presenting) {\r\n        this.cancelVR();\r\n      }\r\n      modifyScreen();\r\n    };\r\n\r\n    let allowRestart = true;\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"start\",\r\n      returns: \"Promise\",\r\n      description: \"Restart animation after it has been stopped.\"\r\n    });\r\n    this.start = () => {\r\n      if(allowRestart) {\r\n        this.ready.then(() => {\r\n          this.audio.start();\r\n          lt = performance.now() * MILLISECONDS_TO_SECONDS;\r\n          this.VR.startAnimation(animate);\r\n        });\r\n      }\r\n    };\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"stop\",\r\n      description: \"Pause animation.\"\r\n    });\r\n    this.stop = (isPause) => {\r\n      if(this.VR.timer) {\r\n        allowRestart = allowRestart && isPause === true;\r\n        this.VR.stopAnimation();\r\n        this.audio.stop();\r\n        if(!allowRestart) {\r\n          console.log(\"stopped\");\r\n        }\r\n      }\r\n    };\r\n\r\n    this.pause = this.stop.bind(this, true);\r\n\r\n    window.addEventListener(\"vrdisplaypresentchange\", fullScreenChange, false);\r\n    window.addEventListener(\"resize\", modifyScreen, false);\r\n    window.addEventListener(\"blur\", this.pause, false);\r\n    window.addEventListener(\"stop\", this.stop, false);\r\n    window.addEventListener(\"focus\", this.start, false);\r\n    document.addEventListener(\"amazonPlatformReady\", ()=>{\r\n      document.addEventListener(\"pause\", this.pause, false);\r\n      document.addEventListener(\"resume\", this.start, false);\r\n    }, false);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"renderer\",\r\n      type: \"THREE.WebGLRenderer\",\r\n      description: \"The Three.js renderer being used to draw the scene.\"\r\n    });\r\n    documentReady = documentReady.then(() => {\r\n      if (this.options.renderer) {\r\n        this.renderer = this.options.renderer;\r\n      }\r\n      else {\r\n        this.renderer = new WebGLRenderer({\r\n          canvas: cascadeElement(this.options.canvasElement, \"canvas\", HTMLCanvasElement),\r\n          context: this.options.context,\r\n          antialias: this.options.antialias,\r\n          alpha: true,\r\n          logarithmicDepthBuffer: false\r\n        });\r\n        this.renderer.autoClear = false;\r\n        this.renderer.sortObjects = true;\r\n        this.renderer.setClearColor(this.options.backgroundColor);\r\n        if (!this.renderer.domElement.parentElement) {\r\n          document.body.appendChild(this.renderer.domElement);\r\n        }\r\n      }\r\n\r\n      this.options.fullScreenElement = document.querySelector(this.options.fullScreenElement) || this.renderer.domElement;\r\n      let maxTabIndex = 0;\r\n      const elementsWithTabIndex = document.querySelectorAll(\"[tabIndex]\");\r\n      for(let i = 0; i < elementsWithTabIndex.length; ++i){\r\n        maxTabIndex = Math.max(maxTabIndex, elementsWithTabIndex[i].tabIndex);\r\n      }\r\n\r\n      this.renderer.domElement.tabIndex = maxTabIndex + 1;\r\n      this.renderer.domElement.addEventListener('webglcontextlost', this.pause, false);\r\n      this.renderer.domElement.addEventListener('webglcontextrestored', this.start, false);\r\n\r\n      this.managers = [];\r\n      this.newState = [];\r\n      this.pointers = [];\r\n      this.motionDevices = [];\r\n      this.velocity = new Vector3();\r\n      this.matrix = new Matrix4();\r\n\r\n      if(!this.options.disableKeyboard) {\r\n        this.addInputManager(new Keyboard(this, {\r\n          strafeLeft: {\r\n            buttons: [\r\n              -Keys.A,\r\n              -Keys.LEFTARROW\r\n            ]\r\n          },\r\n          strafeRight: {\r\n            buttons: [\r\n              Keys.D,\r\n              Keys.RIGHTARROW\r\n            ]\r\n          },\r\n          strafe: {\r\n            commands: [\"strafeLeft\", \"strafeRight\"]\r\n          },\r\n          driveForward: {\r\n            buttons: [\r\n              -Keys.W,\r\n              -Keys.UPARROW\r\n            ]\r\n          },\r\n          driveBack: {\r\n            buttons: [\r\n              Keys.S,\r\n              Keys.DOWNARROW\r\n            ]\r\n          },\r\n          drive: {\r\n            commands: [\"driveForward\", \"driveBack\"]\r\n          },\r\n          select: {\r\n            buttons: [Keys.ENTER]\r\n          },\r\n          dSelect: {\r\n            buttons: [Keys.ENTER],\r\n            delta: true\r\n          },\r\n          zero: {\r\n            buttons: [Keys.Z],\r\n            metaKeys: [\r\n              -Keys.CTRL,\r\n              -Keys.ALT,\r\n              -Keys.SHIFT,\r\n              -Keys.META\r\n            ],\r\n            commandUp: this.emit.bind(this, \"zero\")\r\n          }\r\n        }));\r\n\r\n        this.Keyboard.operatingSystem = this.options.os;\r\n        this.Keyboard.codePage = this.options.language;\r\n      }\r\n\r\n      this.addInputManager(new Touch(this.options.fullScreenElement, {\r\n        U: { axes: [\"X0\"], min: 0, max: 2, offset: 0 },\r\n        V: { axes: [\"Y0\"], min: 0, max: 2 },\r\n        buttons: {\r\n          axes: [\"FINGERS\"]\r\n        },\r\n        dButtons: {\r\n          axes: [\"FINGERS\"],\r\n          delta: true\r\n        },\r\n        heading: {\r\n          axes: [\"DX0\"],\r\n          integrate: true\r\n        },\r\n        pitch: {\r\n          axes: [\"DY0\"],\r\n          integrate: true,\r\n          min: -Math.PI * 0.5,\r\n          max: Math.PI * 0.5\r\n        }\r\n      }));\r\n\r\n\r\n      this.addInputManager(new Mouse(this.options.fullScreenElement, {\r\n        U: { axes: [\"X\"], min: 0, max: 2, offset: 0 },\r\n        V: { axes: [\"Y\"], min: 0, max: 2 },\r\n        buttons: {\r\n          axes: [\"BUTTONS\"]\r\n        },\r\n        dButtons: {\r\n          axes: [\"BUTTONS\"],\r\n          delta: true\r\n        },\r\n        _dx: {\r\n          axes: [\"X\"],\r\n          delta: true,\r\n          scale: 0.25\r\n        },\r\n        dx: {\r\n          buttons: [0],\r\n          commands: [\"_dx\"]\r\n        },\r\n        heading: {\r\n          commands: [\"dx\"],\r\n          integrate: true\r\n        },\r\n        _dy: {\r\n          axes: [\"Y\"],\r\n          delta: true,\r\n          scale: 0.25\r\n        },\r\n        dy: {\r\n          buttons: [0],\r\n          commands: [\"_dy\"]\r\n        },\r\n        pitch: {\r\n          commands: [\"dy\"],\r\n          integrate: true,\r\n          min: -Math.PI * 0.5,\r\n          max: Math.PI * 0.5\r\n        }\r\n      }));\r\n\r\n      // toggle back and forth between touch and mouse\r\n      this.Touch.addEventListener(\"activate\", (evt) => this.Mouse.inPhysicalUse = false);\r\n      this.Mouse.addEventListener(\"activate\", (evt) => this.Touch.inPhysicalUse = false);\r\n\r\n      this.addInputManager(new VR(this.options));\r\n\r\n      this.motionDevices.push(this.VR);\r\n\r\n      if(!this.options.disableGamepad && GamepadManager.isAvailable){\r\n        this.gamepadMgr = new GamepadManager();\r\n        this.gamepadMgr.addEventListener(\"gamepadconnected\", (pad) => {\r\n          const padID = Gamepad.ID(pad);\r\n          let mgr = null;\r\n\r\n          if (padID !== \"Unknown\" && padID !== \"Rift\") {\r\n            if (Gamepad.isMotionController(pad)) {\r\n              let controllerNumber = 0;\r\n              for (let i = 0; i < this.managers.length; ++i) {\r\n                mgr = this.managers[i];\r\n                if (mgr.currentPad && mgr.currentPad.id === pad.id) {\r\n                  ++controllerNumber;\r\n                }\r\n              }\r\n\r\n              mgr = new Gamepad(this.gamepadMgr, pad, controllerNumber, {\r\n                buttons: {\r\n                  axes: [\"BUTTONS\"]\r\n                },\r\n                dButtons: {\r\n                  axes: [\"BUTTONS\"],\r\n                  delta: true\r\n                },\r\n                zero: {\r\n                  buttons: [Gamepad.VIVE_BUTTONS.GRIP_PRESSED],\r\n                  commandUp: this.emit.bind(this, \"zero\")\r\n                }\r\n              });\r\n\r\n              this.addInputManager(mgr);\r\n              this.motionDevices.push(mgr);\r\n\r\n              const shift = (this.motionDevices.length - 2) * 8,\r\n                color = 0x0000ff << shift,\r\n                highlight = 0xff0000 >> shift,\r\n                ptr = new Pointer(padID + \"Pointer\", color, 1, highlight, [mgr], null, this.options);\r\n              ptr.add(colored(box(0.1, 0.025, 0.2), color, {\r\n                emissive: highlight\r\n              }));\r\n\r\n              ptr.route(Pointer.EVENTS, this.consumeEvent.bind(this));\r\n\r\n              this.pointers.push(ptr);\r\n              this.scene.add(ptr);\r\n\r\n              this.emit(\"motioncontrollerfound\", mgr);\r\n            }\r\n            else {\r\n              mgr = new Gamepad(this.gamepadMgr, pad, 0, {\r\n                buttons: {\r\n                  axes: [\"BUTTONS\"]\r\n                },\r\n                dButtons: {\r\n                  axes: [\"BUTTONS\"],\r\n                  delta: true\r\n                },\r\n                strafe: {\r\n                  axes: [\"LSX\"],\r\n                  deadzone: 0.2\r\n                },\r\n                drive: {\r\n                  axes: [\"LSY\"],\r\n                  deadzone: 0.2\r\n                },\r\n                heading: {\r\n                  axes: [\"RSX\"],\r\n                  scale: -1,\r\n                  deadzone: 0.2,\r\n                  integrate: true\r\n                },\r\n                dHeading: {\r\n                  commands: [\"heading\"],\r\n                  delta: true\r\n                },\r\n                pitch: {\r\n                  axes: [\"RSY\"],\r\n                  scale: -1,\r\n                  deadzone: 0.2,\r\n                  integrate: true\r\n                },\r\n                zero: {\r\n                  buttons: [Gamepad.XBOX_ONE_BUTTONS.BACK],\r\n                  commandUp: this.emit.bind(this, \"zero\")\r\n                }\r\n              });\r\n              this.addInputManager(mgr);\r\n              this.mousePointer.addDevice(mgr, mgr);\r\n            }\r\n          }\r\n        });\r\n\r\n        this.gamepadMgr.addEventListener(\"gamepaddisconnected\", this.removeInputManager.bind(this));\r\n      }\r\n\r\n      this.stage = hub();\r\n\r\n      this.head = new Pointer(\"GazePointer\", 0xffff00, 0x0000ff, 0.8, [\r\n        this.VR\r\n      ], [\r\n        this.Mouse,\r\n        this.Touch,\r\n        this.Keyboard\r\n      ], this.options)\r\n        .addTo(this.scene);\r\n\r\n      this.head.route(Pointer.EVENTS, this.consumeEvent.bind(this));\r\n\r\n      this.head.rotation.order = \"YXZ\";\r\n      this.head.useGaze = this.options.useGaze;\r\n      this.pointers.push(this.head);\r\n\r\n      this.mousePointer = new Pointer(\"MousePointer\", 0xff0000, 0x00ff00, 1, [\r\n        this.Mouse,\r\n        this.Touch\r\n      ], null, this.options);\r\n      this.mousePointer.route(Pointer.EVENTS, this.consumeEvent.bind(this));\r\n      this.mousePointer.unproject = new Matrix4();\r\n      this.pointers.push(this.mousePointer);\r\n      this.head.add(this.mousePointer);\r\n\r\n      this.VR.ready.then((displays) => displays.forEach((display, i) => {\r\n        window.addEventListener(\"vrdisplayactivate\", (evt) => {\r\n          if(evt.display === display) {\r\n            const exitVR = () => {\r\n              window.removeEventListener(\"vrdisplaydeactivate\", exitVR);\r\n              this.cancelVR();\r\n            };\r\n            window.addEventListener(\"vrdisplaydeactivate\", exitVR, false);\r\n            this.goFullScreen(i);\r\n          }\r\n        }, false);\r\n      }));\r\n\r\n      this.fader = colored(box(1, 1, 1), this.options.backgroundColor, {\r\n        opacity: 0,\r\n        useFog: false,\r\n        transparent: true,\r\n        unshaded: true,\r\n        side: BackSide\r\n      });\r\n      this.fader.visible = false;\r\n      this.head.add(this.fader);\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"select\",\r\n        description: \"Fired when an object has been selected, either by a physical cursor or a gaze-based cursor. You will typically want to use this instead of pointerend or gazecomplete.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"pointerstart\",\r\n        description: \"Fired when mouse, gamepad, or touch-based pointers have their trigger buttons depressed.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"pointerend\",\r\n        description: \"Fired when mouse, gamepad, or touch-based pointers have their trigger buttons released.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"pointermove\",\r\n        description: \"Fired when mouse, gamepad, or touch-based pointers are moved away from where they were last frame.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"gazestart\",\r\n        description: \"Fired when a gaze-based cursor starts spinning on a selectable object.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"gazemove\",\r\n        description: \"Fired when a gaze-based cursor moves across an object that it is attempting to select.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"gazecomplete\",\r\n        description: \"Fired when a gaze-based cursor finishes spinning on a selectable object.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"gazecancel\",\r\n        description: \"Fired when a gaze-based cursor is moved off of the object it is attempting to select before it can finish spinning.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"exit\",\r\n        description: \"Fired when a pointer leaves an object.\"\r\n      });\r\n\r\n      pliny.event({\r\n        parent: \"Primrose.BrowserEnvironment\",\r\n        name: \"enter\",\r\n        description: \"Fired when a pointer hovers over an object.\"\r\n      });\r\n\r\n\r\n      if(!this.options.disableKeyboard) {\r\n        const keyDown =  (evt) => {\r\n            if (this.VR.isPresenting) {\r\n              if (evt.keyCode === Keys.ESCAPE && !this.VR.isPolyfilled) {\r\n                this.cancelVR();\r\n              }\r\n            }\r\n\r\n            this.Keyboard.consumeEvent(evt);\r\n            this.consumeEvent(evt);\r\n          },\r\n\r\n          keyUp = (evt) => {\r\n            this.Keyboard.consumeEvent(evt);\r\n            this.consumeEvent(evt);\r\n          },\r\n\r\n          withCurrentControl = (name) => {\r\n            return (evt) => {\r\n              if (this.currentControl) {\r\n                if (this.currentControl[name]) {\r\n                  this.currentControl[name](evt);\r\n                }\r\n                else {\r\n                  console.warn(\"Couldn't find %s on %o\", name, this.currentControl);\r\n                }\r\n              }\r\n            };\r\n          };\r\n\r\n        window.addEventListener(\"keydown\", keyDown, false);\r\n\r\n        window.addEventListener(\"keyup\", keyUp, false);\r\n\r\n\r\n        window.addEventListener(\"paste\", withCurrentControl(\"readClipboard\"), false);\r\n        window.addEventListener(\"wheel\", withCurrentControl(\"readWheel\"), false);\r\n\r\n\r\n        const focusClipboard = (evt) => {\r\n          if (this.lockMovement) {\r\n            var cmdName = this.Keyboard.operatingSystem.makeCommandName(evt, this.Keyboard.codePage);\r\n            if (cmdName === \"CUT\" || cmdName === \"COPY\") {\r\n              surrogate.style.display = \"block\";\r\n              surrogate.focus();\r\n            }\r\n          }\r\n        };\r\n\r\n        const clipboardOperation = (evt) => {\r\n          if (this.currentControl) {\r\n            this.currentControl[evt.type + \"SelectedText\"](evt);\r\n            if (!evt.returnValue) {\r\n              evt.preventDefault();\r\n            }\r\n            surrogate.style.display = \"none\";\r\n            this.currentControl.focus();\r\n          }\r\n        };\r\n\r\n        // the `surrogate` textarea makes clipboard events possible\r\n        var surrogate = cascadeElement(\"primrose-surrogate-textarea\", \"textarea\", HTMLTextAreaElement),\r\n          surrogateContainer = makeHidingContainer(\"primrose-surrogate-textarea-container\", surrogate);\r\n\r\n        surrogateContainer.style.position = \"absolute\";\r\n        surrogateContainer.style.overflow = \"hidden\";\r\n        surrogateContainer.style.width = 0;\r\n        surrogateContainer.style.height = 0;\r\n\r\n        function setFalse(evt) {\r\n          evt.returnValue = false;\r\n        }\r\n        surrogate.addEventListener(\"beforecopy\", setFalse, false);\r\n        surrogate.addEventListener(\"copy\", clipboardOperation, false);\r\n        surrogate.addEventListener(\"beforecut\", setFalse, false);\r\n        surrogate.addEventListener(\"cut\", clipboardOperation, false);\r\n        document.body.insertBefore(surrogateContainer, document.body.children[0]);\r\n\r\n        window.addEventListener(\"beforepaste\", setFalse, false);\r\n        window.addEventListener(\"keydown\", focusClipboard, true);\r\n      }\r\n\r\n      this.head.add(this.camera);\r\n\r\n      return Promise.all(this.managers\r\n        .map((mgr) => mgr.ready)\r\n        .filter(identity));;\r\n    });\r\n\r\n    this._readyParts = [\r\n      this.sky.ready,\r\n      this.ground.ready,\r\n      modelsReady,\r\n      documentReady\r\n    ];\r\n    this.ready = Promise.all(this._readyParts)\r\n      .then(() => {\r\n        this.renderer.domElement.style.cursor = \"default\";\r\n        if(this.options.enableShadows && this.sky.sun) {\r\n          this.renderer.shadowMap.enabled = true;\r\n          this.renderer.shadowMap.type = PCFSoftShadowMap;\r\n        }\r\n\r\n        this.VR.displays.forEach((display) => {\r\n          if(display.DOMElement !== undefined) {\r\n            display.DOMElement = this.renderer.domElement;\r\n          }\r\n        });\r\n\r\n        if(this.options.fullScreenButtonContainer){\r\n          this.insertFullScreenButtons(this.options.fullScreenButtonContainer);\r\n        }\r\n\r\n        this.VR.connect(0);\r\n        this.options.progress.hide();\r\n\r\n        pliny.event({\r\n          parent: \"Primrose.BrowserEnvironment\",\r\n          name: \"ready\",\r\n          description: \"Fires after the initial assets have been downloaded and the scene initialized, just before animation starts.\"\r\n        });\r\n        this.emit(\"ready\");\r\n      });\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"start\",\r\n      returns: \"Promise\",\r\n      description: \"Restart animation after it has been stopped.\"\r\n    });\r\n    this.start = () => {\r\n      this.ready.then(() => {\r\n        this.audio.start();\r\n        lt = performance.now() * MILLISECONDS_TO_SECONDS;\r\n        RAF(animate);\r\n      });\r\n    };\r\n\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"stop\",\r\n      description: \"Pause animation.\"\r\n    });\r\n    this.stop = () => {\r\n      if (currentTimerObject) {\r\n        currentTimerObject.cancelAnimationFrame(this.timer);\r\n      this.audio.stop();\r\n        this.timer = null;\r\n      }\r\n    };\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"quality\",\r\n      type: \"Primrose.Constants.Quality\",\r\n      description: \"The current render quality.\"\r\n    });\r\n    Object.defineProperties(this, {\r\n      quality: {\r\n        get: () => this.options.quality,\r\n        set: (v) => {\r\n          if (0 <= v && v < PIXEL_SCALES.length) {\r\n            this.options.quality = v;\r\n            resolutionScale = PIXEL_SCALES[v];\r\n          }\r\n          this.ready.then(modifyScreen);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.quality = this.options.quality;\r\n\r\n    if (window.alert.toString().indexOf(\"native code\") > -1) {\r\n      // overwrite the native alert functions so they can't be called while in\r\n      // full screen VR mode.\r\n\r\n      var rerouteDialog = (oldFunction, newFunction) => {\r\n        if (!newFunction) {\r\n          newFunction = function () {};\r\n        }\r\n        return (function () {\r\n          if (this.VR && this.VR.isPresenting) {\r\n            newFunction();\r\n          }\r\n          else {\r\n            oldFunction.apply(window, arguments);\r\n          }\r\n        }).bind(this);\r\n      };\r\n\r\n      window.alert = rerouteDialog(window.alert);\r\n      window.confirm = rerouteDialog(window.confirm);\r\n      window.prompt = rerouteDialog(window.prompt);\r\n    }\r\n\r\n    this.start();\r\n  }\r\n\r\n  get lockMovement(){\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"lockMovement\",\r\n      type: \"Boolean\",\r\n      description: \"True if the user is focused on a text box control. If the user is focused on a text box control, keyboard commands should not move their position.\"\r\n    });\r\n\r\n    return this.currentControl && this.currentControl.lockMovement;\r\n  }\r\n\r\n  connect(socket, userName) {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"connect\",\r\n      description: \"Connect to a server at a WebSocket using a specific userName. NOTE: this does not handle authentication or authorization. You must handle those tasks yourself. This only binds an authenticated WebSocket connection to the framework so the framework may use it to transmit user state.\",\r\n      parameters: [{\r\n        name: \"socket\",\r\n        type: \"WebSocket\",\r\n        description: \"The socket connecting us to the server.\"\r\n      }, {\r\n        name: \"userName\",\r\n        type: \"String\",\r\n        description: \"The name of the user being connected.\"\r\n      }]\r\n    });\r\n\r\n    if(!this.network){\r\n      this.network = new NetworkManager(this, this.audio, this.factories, this.options);\r\n      this.network.addEventListener(\"addavatar\", this.addAvatar);\r\n      this.network.addEventListener(\"removeavatar\", this.removeAvatar);\r\n    }\r\n    return this.network && this.network.connect(socket, userName);\r\n  }\r\n\r\n  disconnect() {\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"disconnect\",\r\n      description: \"Disconnect from the server.\"\r\n    });\r\n\r\n    return this.network && this.network.disconnect();\r\n  }\r\n\r\n  get displays() {\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"displays\",\r\n      type: \"Array of VRDisplay\",\r\n      description: \"The VRDisplays available on the system.\"\r\n    });\r\n\r\n    return this.VR.displays;\r\n  }\r\n\r\n  get fieldOfView() {\r\n    var d = this.VR.currentDevice,\r\n      eyes = [\r\n      d && d.getEyeParameters(\"left\"),\r\n      d && d.getEyeParameters(\"right\")\r\n    ].filter(identity);\r\n    if(eyes.length > 0){\r\n      return eyes.reduce((fov, eye) => Math.max(fov, eye.fieldOfView.upDegrees + eye.fieldOfView.downDegrees), 0);\r\n    }\r\n  }\r\n\r\n  set fieldOfView(v){\r\n    this.options.defaultFOV = StandardMonitorVRDisplay.DEFAULT_FOV = v;\r\n  }\r\n\r\n  get currentTime() {\r\n    return this.audio.context.currentTime;\r\n  }\r\n\r\n  addInputManager(mgr) {\r\n    for (let i = this.managers.length - 1; i >= 0; --i) {\r\n      if (this.managers[i].name === mgr.name) {\r\n        this.managers.splice(i, 1);\r\n      }\r\n    }\r\n    this.managers.push(mgr);\r\n    this[mgr.name] = mgr;\r\n  }\r\n\r\n  removeInputManager(id) {\r\n    const mgr = this[id],\r\n      mgrIdx = this.managers.indexOf(mgr);\r\n    if (mgrIdx > -1) {\r\n      this.managers.splice(mgrIdx, 1);\r\n      delete this[id];\r\n    }\r\n    console.log(\"removed\", mgr);\r\n  }\r\n\r\n  moveStage(position) {\r\n    DISPLACEMENT.copy(position)\r\n      .sub(this.head.position);\r\n\r\n    this.stage.position.add(DISPLACEMENT);\r\n  }\r\n\r\n  cancelVR() {\r\n    this.VR.cancel();\r\n    this.Touch.commands.U.offset = this.Mouse.commands.U.offset = 0;\r\n  }\r\n\r\n  get hasMotionControllers() {\r\n    return !!(this.Vive_0 && this.Vive_0.enabled && this.Vive_0.inPhysicalUse ||\r\n      this.Vive_1 && this.Vive_1.enabled && this.Vive_1.inPhysicalUse);\r\n  }\r\n\r\n  get hasGamepad() {\r\n    return !!(this.Gamepad_0 && this.Gamepad_0.enabled && this.Gamepad_0.inPhysicalUse);\r\n  }\r\n\r\n  get hasMouse() {\r\n    return !!(this.Mouse && this.Mouse.enabled && this.Mouse.inPhysicalUse);\r\n  }\r\n\r\n  get hasTouch() {\r\n    return !!(this.Touch && this.Touch.enabled && this.Touch.inPhysicalUse);\r\n  }\r\n\r\n  setAudioFromUser(userName, audioElement){\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"setAudioFromUser\",\r\n      description: \"When using a 3D-party voice chat provider, this method associates the `HTMLVideoElement` or `HTMLAudioElement` created by the chat provider with the remote user, so that their audio may be spatialized with their position.\",\r\n      parameters: [{\r\n        name: \"userName\",\r\n        type: \"String\",\r\n        description: \"The name of the user to which to add the audio.\"\r\n      }, {\r\n        name: \"audioElement\",\r\n        type: \"HTMLAudioElement or HTMLVideoElement\",\r\n        description: \"The DOM element that represents the user's audio.\"\r\n      }]\r\n    });\r\n\r\n    this.audioQueue.push([userName, audioElement]);\r\n    if(this.network){\r\n      while(this.audioQueue.length > 0){\r\n        this.network.setAudioFromUser.apply(this.network, this.audioQueue.shift());\r\n      }\r\n    }\r\n  }\r\n\r\n  insertFullScreenButtons(containerSpec){\r\n\r\n    pliny.method({\r\n      parent: \"Primrose.BrowserEnvironment\",\r\n      name: \"insertFullScreenButtons\",\r\n      description: \"Add the default UI for managing full screen state.\",\r\n      returns: \"Array of `HTMLButtonElement`s\",\r\n      parameters: [{\r\n        name: \"containerSpec\",\r\n        type: \"String\",\r\n        description: \"A query selector for the DOM element to which to add the buttons.\"\r\n      }]\r\n    });\r\n\r\n    const container = document.querySelector(containerSpec);\r\n    const newButton = (title, text, thunk) => {\r\n      const btn = document.createElement(\"button\");\r\n      btn.type = \"button\";\r\n      btn.title = title;\r\n      btn.appendChild(document.createTextNode(text));\r\n      btn.addEventListener(\"click\", thunk, false);\r\n      container.appendChild(btn);\r\n      return btn;\r\n    };\r\n\r\n    const buttons = this.displays\r\n      // We skip the Standard Monitor and Magic Window on iOS because we can't go full screen on those systems.\r\n      .map((display, i) => {\r\n        if(!isiOS || VR.isStereoDisplay(display)) {\r\n          const enterVR = this.goFullScreen.bind(this, i),\r\n            btn = newButton(display.displayName, display.displayName, enterVR),\r\n            isStereo = VR.isStereoDisplay(display);\r\n          btn.className = isStereo ? \"stereo\" : \"mono\";\r\n          return btn;\r\n        }\r\n      })\r\n      .filter(identity);\r\n\r\n    if(!/(www\\.)?primrosevr.com/.test(document.location.hostname) && !this.options.disableAdvertising) {\r\n      buttons.push(newButton(\"Primrose\", \"✿\", () => open(\"https://www.primrosevr.com\", \"_blank\")));\r\n    }\r\n    return buttons;\r\n  }\r\n}\r\n\r\nBrowserEnvironment.DEFAULTS = {\r\n  antialias: true,\r\n  quality: Quality.MAXIMUM,\r\n  useGaze: isMobile,\r\n  useFog: false,\r\n  avatarHeight: 1.65,\r\n  walkSpeed: 2,\r\n  disableKeyboard: false,\r\n  enableShadows: false,\r\n  shadowMapSize: 2048,\r\n  shadowCameraSize: 15,\r\n  shadowRadius: 1,\r\n  progress: window.Preloader || {\r\n    thunk: function() {},\r\n    hide: function() {},\r\n    resize: function() {}\r\n  },\r\n  // The rate at which the view fades in and out.\r\n  fadeRate: 5,\r\n  // The rate at which the UI shell catches up with the user's movement.\r\n  vicinityFollowRate: 0.02,\r\n  // The acceleration applied to falling objects.\r\n  gravity: 9.8,\r\n  // The amount of time in seconds to require gazes on objects before triggering the gaze event.\r\n  gazeLength: 1.5,\r\n  // By default, what we see in the VR view will get mirrored to a regular view on the primary screen. Set to true to improve performance.\r\n  disableMirroring: false,\r\n  // By default, a single light is added to the scene,\r\n  disableDefaultLighting: false,\r\n  // The color that WebGL clears the background with before drawing.\r\n  backgroundColor: 0xafbfff,\r\n  // the textures to use for the sky and ground\r\n  skyTexture: null,\r\n  groundTexture: null,\r\n  // the near plane of the camera.\r\n  nearPlane: 0.01,\r\n  // the far plane of the camera.\r\n  drawDistance: 100,\r\n  // the field of view to use in non-VR settings.\r\n  defaultFOV: StandardMonitorVRDisplay.DEFAULT_FOV,\r\n  // The sound to play on loop in the background.\r\n  ambientSound: null,\r\n  // HTML5 canvas element, if one had already been created.\r\n  canvasElement: \"frontBuffer\",\r\n  // Three.js renderer, if one had already been created.\r\n  renderer: null,\r\n  // A WebGL context to use, if one had already been created.\r\n  context: null,\r\n  // Three.js scene, if one had already been created.\r\n  scene: null,\r\n  // This is an experimental feature for setting the height of a user's \"neck\" on orientation-only systems (such as Google Cardboard and Samsung Gear VR) to create a more realistic feel.\r\n  nonstandardNeckLength: null,\r\n  nonstandardNeckDepth: null,\r\n  showHeadPointer: true,\r\n  // WARNING: I highly suggest you don't go down the road that requires the following settings this. I will not help you understand what they do, because I would rather you just not use them.\r\n  nonstandardIPD: null,\r\n  disableAdvertising: false\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Model\",\r\n  baseClass: \"Primrose.Controls.Entity\",\r\n  description: \"An object loaded from a model file.\"\r\n});\r\n\r\n\r\nimport Entity from \"./Entity\";\r\nimport ModelFactory from \"../Graphics/ModelFactory\";\r\nimport cache from \"../../util/cache\";\r\n\r\nlet COUNTER = 0;\r\n\r\nexport default class Model extends Entity {\r\n\r\n  constructor(file, options) {\r\n    name = options && options.id || \"Primrose.Controls.Model[\" + (COUNTER++) + \"]\";\r\n    super(name, options);\r\n    this._file = file;\r\n    this._model = null;\r\n  }\r\n\r\n  get _ready() {\r\n    return super._ready.then(() => cache(this._file, () =>\r\n      ModelFactory.loadModel(this._file, this.options.type, this.options.progress))\r\n    .then((factory) => {\r\n      this._model = factory.clone();\r\n      this.add(this._model);\r\n      return this;\r\n    }))\r\n  }\r\n\r\n};","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"PlainText\",\r\n  description: \"A texture that uses Canvas2D calls to draw simple, monochrome text to a polygon.\",\r\n  parameters: [{\r\n    name: \"text\",\r\n    type: \"String\",\r\n    description: \"The initial text to render on the PlainText control.\"\r\n  }, {\r\n    name: \"size\",\r\n    type: \"Number\",\r\n    description: \"The font size at which to render the text.\"\r\n  }, {\r\n    name: \"fgcolor\",\r\n    type: \"String\",\r\n    description: \"A Canvas2D fillStyle description to use for drawing the text.\"\r\n  }, {\r\n    name: \"bgcolor\",\r\n    type: \"String\",\r\n    description: \"A Canvas2D fillStyle description to use for drawing the background behind the text.\"\r\n  }, {\r\n    name: \"x\",\r\n    type: \"Number\",\r\n    description: \"The X component of the position at which to set the PlainText control's polygon mesh.\"\r\n  }, {\r\n    name: \"y\",\r\n    type: \"Number\",\r\n    description: \"The Y component of the position at which to set the PlainText control's polygon mesh.\"\r\n  }, {\r\n    name: \"z\",\r\n    type: \"Number\",\r\n    description: \"The Z component of the position at which to set the PlainText control's polygon mesh.\"\r\n  }, {\r\n    name: \"hAlign\",\r\n    type: \"String\",\r\n    description: \"The horizontal alignment of the text, \\\"left\\\", \\\"center\\\", or \\\"right\\\".\",\r\n    optional: true,\r\n    default: \"center\"\r\n  }]\r\n});\r\n\r\nimport { PlaneGeometry, Mesh, Texture, MeshBasicMaterial, FlatShading } from \"three\";\r\nexport default class PlainText {\r\n  constructor(text, size, fgcolor, bgcolor, x, y, z, hAlign = \"center\") {\r\n    text = text.replace(/\\r\\n/g, \"\\n\");\r\n    var lines = text.split(\"\\n\");\r\n    var lineHeight = (size * 1000);\r\n    var boxHeight = lineHeight * lines.length;\r\n\r\n    var textCanvas = document.createElement(\"canvas\");\r\n    var textContext = textCanvas.getContext(\"2d\");\r\n    textContext.font = lineHeight + \"px Arial\";\r\n    var width = textContext.measureText(text)\r\n      .width;\r\n\r\n    textCanvas.width = width;\r\n    textCanvas.height = boxHeight;\r\n    textContext.font = lineHeight * 0.8 + \"px Arial\";\r\n    if (bgcolor !== \"transparent\") {\r\n      textContext.fillStyle = bgcolor;\r\n      textContext.fillRect(0, 0, textCanvas.width, textCanvas.height);\r\n    }\r\n    textContext.fillStyle = fgcolor;\r\n\r\n    for (var i = 0; i < lines.length; ++i) {\r\n      textContext.fillText(lines[i], 0, i * lineHeight);\r\n    }\r\n\r\n    var texture = new Texture(textCanvas);\r\n    texture.needsUpdate = true;\r\n\r\n    var material = new MeshBasicMaterial({\r\n      map: texture,\r\n      transparent: bgcolor === \"transparent\",\r\n      useScreenCoordinates: false,\r\n      color: 0xffffff,\r\n      shading: FlatShading\r\n    });\r\n\r\n    var textGeometry = new PlaneGeometry(size * width / lineHeight,\r\n      size * lines.length);\r\n    textGeometry.computeBoundingBox();\r\n    textGeometry.computeVertexNormals();\r\n\r\n    var textMesh = new Mesh(textGeometry, material);\r\n    if (hAlign === \"left\") {\r\n      x -= textGeometry.boundingBox.min.x;\r\n    }\r\n    else if (hAlign === \"right\") {\r\n      x += textGeometry.boundingBox.min.x;\r\n    }\r\n    textMesh.position.set(x, y, z);\r\n    return textMesh;\r\n  }\r\n}\r\n","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n  name: \"Progress\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nconst SIZE = 1,\r\n  INSET = 0.8,\r\n  PROPORTION = 10,\r\n  SIZE_SMALL = SIZE / PROPORTION,\r\n  INSET_LARGE = (1 - (1 - INSET) / PROPORTION);\r\n\r\nimport colored from \"../../live-api/colored\";\r\nimport box from \"../../live-api/box\";\r\nimport { BackSide } from \"three\";\r\nexport default class Progress {\r\n\r\n  constructor(majorColor, minorColor) {\r\n    majorColor = majorColor || 0xffffff;\r\n    minorColor = minorColor || 0x000000;\r\n    var geom = box(SIZE, SIZE_SMALL, SIZE_SMALL);\r\n\r\n    this.totalBar = geom\r\n      .colored(minorColor, {\r\n        unshaded: true,\r\n        side: BackSide\r\n      });\r\n\r\n    this.valueBar = geom\r\n      .colored(majorColor, {\r\n        unshaded: true\r\n      })\r\n      .scl(0, INSET, INSET)\r\n      .addTo(this.totalBar);\r\n\r\n    this.fileState = null;\r\n    this.reset();\r\n  }\r\n\r\n  reset(){\r\n    this.fileState = {};\r\n    this.value = 0;\r\n  }\r\n\r\n  get visible(){\r\n    return this.totalBar.visible;\r\n  }\r\n\r\n  set visible(v){\r\n    this.totalBar.visible = v;\r\n  }\r\n\r\n  get position(){\r\n    return this.totalBar.position;\r\n  }\r\n\r\n  get quaternion(){\r\n    return this.totalBar.quaternion;\r\n  }\r\n\r\n  get value(){\r\n    return this.valueBar.scale.x / INSET_LARGE;\r\n  }\r\n\r\n  set value(v){\r\n    this.valueBar.scale.x = v * INSET_LARGE;\r\n    this.valueBar.position.x = -SIZE * (1 - v) * INSET_LARGE / 2;\r\n  }\r\n\r\n  onProgress(evt){\r\n    const file = evt.target.responseURL || evt.target.currentSrc;\r\n    if(file && evt.loaded !== undefined){\r\n      if(!this.fileState[file]){\r\n        this.fileState[file] = {};\r\n      }\r\n      const f = this.fileState[file];\r\n      f.loaded = evt.loaded;\r\n      f.total = evt.total;\r\n    }\r\n\r\n    let total = 0, loaded = 0;\r\n    for(let key in this.fileState){\r\n      const f = this.fileState[key];\r\n      total += f.total;\r\n      loaded += f.loaded;\r\n    }\r\n\r\n    if(total > 0){\r\n      this.value = loaded / total;\r\n    }\r\n    else{\r\n      this.value = 0;\r\n    }\r\n  }\r\n}\r\n","pliny.record({\r\n  parent: \"Primrose.Text.CommandPacks\",\r\n  name: \"TextInput\",\r\n  description: \"A concrete instantiation of the single-line text editor commands provided by BasicTextInput.\"\r\n});\r\n\r\n////\r\n// For all of these commands, the \"current\" cursor is:\r\n// If SHIFT is not held, then \"front\".\r\n// If SHIFT is held, then \"back\"\r\n//\r\nimport BasicTextInput from \"./BasicTextInput\";\r\nexport default new BasicTextInput(\"Text Line input commands\");","pliny.class({\r\n  parent: \"Primrose.Controls\",\r\n    name: \"TextInput\",\r\n    description: \"plain text input box.\",\r\n    baseClass: \"Primrose.Controls.TextBox\",\r\n    parameters: [{\r\n      name: \"idOrCanvasOrContext\",\r\n      type: \"String or HTMLCanvasElement or CanvasRenderingContext2D\",\r\n      description: \"Either an ID of an element that exists, an element, or the ID to set on an element that is to be created.\"\r\n    }, {\r\n      name: \"options\",\r\n      type: \"Object\",\r\n      description: \"Named parameters for creating the TextInput.\"\r\n    }]\r\n});\r\n\r\nvar COUNTER = 0;\r\n\r\nimport TextBox from \"./TextBox\";\r\nimport PlainText from \"../Text/Grammars/PlainText\";\r\nimport TextInputCommands from \"../Text/CommandPacks/TextInput\";\r\nexport default class TextInput extends TextBox {\r\n  constructor(options) {\r\n    super(Object.assign({}, {\r\n        id: \"Primrose.Controls.TextInput[\" + (COUNTER++) + \"]\",\r\n        padding: 5,\r\n        singleLine: true,\r\n        disableWordWrap: true,\r\n        hideLineNumbers: true,\r\n        hideScrollBars: true,\r\n        tabWidth: 1,\r\n        tokenizer: PlainText,\r\n        commands: TextInputCommands\r\n      }), options);\r\n\r\n    this.passwordCharacter = this.options.passwordCharacter;\r\n  }\r\n\r\n  get value() {\r\n    return super.value;\r\n  }\r\n\r\n  set value(v) {\r\n    v = v || \"\";\r\n    v = v.replace(/\\r?\\n/g, \"\");\r\n    super.value = v;\r\n  }\r\n\r\n  get selectedText() {\r\n    return super.selectedText;\r\n  }\r\n\r\n  set selectedText(v) {\r\n    v = v || \"\";\r\n    v = v.replace(/\\r?\\n/g, \"\");\r\n    super.selectedText = v;\r\n  }\r\n\r\n  drawText(ctx, txt, x, y) {\r\n    if (this.passwordCharacter) {\r\n      var val = \"\";\r\n      for (var i = 0; i < txt.length; ++i) {\r\n        val += this.passwordCharacter;\r\n      }\r\n      txt = val;\r\n    }\r\n    super.drawText(ctx, txt, x, y);\r\n  }\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Controls\",\r\n  description: \"Various 3D control objects.\"\r\n});\r\n\r\nimport Button2D from \"./Button2D\";\r\nimport Button3D from \"./Button3D\";\r\nimport ButtonFactory from \"./ButtonFactory\";\r\nimport Entity from \"./Entity\";\r\nimport Ground from \"./Ground\";\r\nimport Image from \"./Image\";\r\nimport Label from \"./Label\";\r\nimport Model from \"./Model\";\r\nimport PlainText from \"./PlainText\";\r\nimport Progress from \"./Progress\";\r\nimport Sky from \"./Sky\";\r\nimport Surface from \"./Surface\";\r\nimport TextBox from \"./TextBox\";\r\nimport TextInput from \"./TextInput\";\r\nimport Video from \"./Video\";\r\n\r\nexport {\r\n  Button2D,\r\n  Button3D,\r\n  ButtonFactory,\r\n  Entity,\r\n  Ground,\r\n  Image,\r\n  Label,\r\n  Model,\r\n  PlainText,\r\n  Progress,\r\n  Sky,\r\n  Surface,\r\n  TextBox,\r\n  TextInput,\r\n  Video\r\n};\r\n\r\nexport default {\r\n  Button2D,\r\n  Button3D,\r\n  ButtonFactory,\r\n  Entity,\r\n  Ground,\r\n  Image,\r\n  Label,\r\n  Model,\r\n  PlainText,\r\n  Progress,\r\n  Sky,\r\n  Surface,\r\n  TextBox,\r\n  TextInput,\r\n  Video\r\n};","import CardboardVRDisplay from \"./CardboardVRDisplay\";\r\nimport frameDataFromPose from \"./frameDataFromPose\";\r\nimport install from \"./install\";\r\nimport MockVRDisplay from \"./MockVRDisplay\";\r\nimport StandardMonitorVRDisplay from \"./StandardMonitorVRDisplay\";\r\nimport VRDisplay from \"./VRDisplay\";\r\nimport VRFrameData from \"./VRFrameData\";\r\n\r\nexport {\r\n  CardboardVRDisplay,\r\n  frameDataFromPose,\r\n  install,\r\n  MockVRDisplay,\r\n  StandardMonitorVRDisplay,\r\n  VRDisplay,\r\n  VRFrameData\r\n};\r\n\r\nexport default {\r\n  CardboardVRDisplay,\r\n  frameDataFromPose,\r\n  install,\r\n  MockVRDisplay,\r\n  StandardMonitorVRDisplay,\r\n  VRDisplay,\r\n  VRFrameData\r\n};","pliny.function({\r\n  parent: \"Primrose.DOM\",\r\n  name: \"findEverything\",\r\n  description: \"Searches an element for all sub elements that have a named ID,\\n\\\r\nusing that ID as the name of a field in a hashmap to store a reference to the element.\\n\\\r\nBasically, a quick way to get at all the named elements in a page. Returns an object full\\n\\\r\nof element references, with fields named by the ID of the elements that were found.\\n\\\r\n\\n\\\r\n> NOTE: You may name your IDs pretty much anything you want, but for ease of use,\\n\\\r\n> you should name them in a camalCase fashion. See [CamelCase - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/CamelCase).\",\r\n  parameters: [{\r\n    name: \"elem\",\r\n    type: \"Element\",\r\n    optional: true,\r\n    description: \"the root element from which to search.\",\r\n    default: \"`document`.\"\r\n  }, {\r\n    name: \"obj\",\r\n    type: \"Object\",\r\n    optional: true,\r\n    description: \"the object in which to store the element references. If no object is provided, one will be created.\"\r\n  }],\r\n  returns: \"Object\",\r\n  examples: [{\r\n    name: \"Get all child elements.\",\r\n    description: \"Assuming the following HTML snippet:\\n\\\r\n\\n\\\r\n  grammar(\\\"HTML\\\");\\n\\\r\n  <div>\\n\\\r\n    <div id=\\\"First\\\">first element</div>\\n\\\r\n    <section id=\\\"second-elem\\\">\\n\\\r\n      Second element\\n\\\r\n      <img id=\\\"img1\\\" src=\\\"img.png\\\">\\n\\\r\n    </section>\\n\\\r\n  </div>\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var elems = Primrose.DOM.findEverything();\\n\\\r\n  console.log(elems.First.innerHTML);\\n\\\r\n  console.log(elems[\\\"second-elem\\\"].textContent);\\n\\\r\n  console.log(elems.img1.src);\\n\\\r\n\\n\\\r\n## Results:\\n\\\r\n> first element  \\n\\\r\n> Second element  \\n\\\r\n> img.png\"\r\n  }]\r\n});\r\n\r\nexport default function findEverything(elem, obj) {\r\n  elem = elem || document;\r\n  obj = obj || {};\r\n  var arr = elem.querySelectorAll(\"*\");\r\n  for (var i = 0; i < arr.length; ++i) {\r\n    var e = arr[i];\r\n    if (e.id && e.id.length > 0) {\r\n      obj[e.id] = e;\r\n      if (e.parentElement) {\r\n        e.parentElement[e.id] = e;\r\n      }\r\n    }\r\n  }\r\n  return obj;\r\n}","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"DOM\",\r\n  description: \"A few functions for manipulating DOM.\"\r\n});\r\n\r\nimport cascadeElement from \"./cascadeElement\";\r\nimport findEverything from \"./findEverything\";\r\nimport makeHidingContainer from \"./makeHidingContainer\";\r\n\r\nexport {\r\n  cascadeElement,\r\n  findEverything,\r\n  makeHidingContainer\r\n};\r\n\r\nexport default {\r\n  cascadeElement,\r\n  findEverything,\r\n  makeHidingContainer\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Graphics\",\r\n  description: \"The Graphics namespace contains classes and functions that with 3D geometry.\"\r\n});\r\n\r\nimport fixGeometry from \"./fixGeometry\";\r\nimport InsideSphereGeometry from \"./InsideSphereGeometry\";\r\nimport loadTexture from \"./loadTexture\";\r\nimport ModelFactory from \"./ModelFactory\";\r\n\r\nexport {\r\n  fixGeometry,\r\n  InsideSphereGeometry,\r\n  loadTexture,\r\n  ModelFactory\r\n};\r\n\r\nexport default {\r\n  fixGeometry,\r\n  InsideSphereGeometry,\r\n  loadTexture,\r\n  ModelFactory\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"del\",\r\n  description: \"Process an HTTP DELETE request.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"type\",\r\n    type: \"String\",\r\n    description: `How the response should be interpreted. One of [\"text\", \"json\", \"arraybuffer\"]. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).`,\r\n    default: `\"text\"`\r\n  }, {\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\nimport XHR from \"./XHR\";\r\nexport default function del(type, url, options) {\r\n  return XHR(\"DELETE\", type, url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"delObject\",\r\n  description: \"Delete something on the server, and receive JSON in response.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }]\r\n});\r\n\r\nimport del from \"./del\";\r\nexport default function delObject(url, options) {\r\n  return del(\"json\", url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"getText\",\r\n  description: \"Get plain text from a server. Returns a promise that will be resolve with the text retrieved from the server.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information.\"\r\n  }],\r\n  examples: [{\r\n    name: \"Make a GET request for plain text.\",\r\n    description: `Use this to load arbitrary files and do whatever you want with them.\r\n\r\n## Code:\r\n\r\n    grammar(\"JavaScript\");\r\n    Primrose.HTTP.getText(\"localFile.json\",\r\n      console.log.bind(console, \"progress\"),\r\n      console.log.bind(console, \"done\"),\r\n      console.error.bind(console));\r\n\r\n## Results:\r\n> \"Object {field1: 1, field2: \\\\\"Field2\\\\\"}\"`\r\n  }]\r\n});\r\n\r\nimport get from \"./get\";\r\nexport default function getText(url, options) {\r\n  return get(\"text\", url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"post\",\r\n  description: \"Process an HTTP POST request.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"type\",\r\n    type: \"String\",\r\n    description: `How the response should be interpreted. One of [\"text\", \"json\", \"arraybuffer\"]. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).`,\r\n    default: `\"text\"`\r\n  }, {\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information. The `data` field is not optional.\"\r\n  }]\r\n});\r\n\r\nimport XHR from \"./XHR\";\r\nexport default function post(type, url, options) {\r\n  return XHR(\"POST\", type, url, options);\r\n};","pliny.function({\r\n  parent: \"Primrose.HTTP\",\r\n  name: \"postObject\",\r\n  description: \"Send a JSON object to a server.\",\r\n  returns: \"Promise\",\r\n  parameters: [{\r\n    name: \"url\",\r\n    type: \"String\",\r\n    description: \"The resource to which the request is being sent.\"\r\n  }, {\r\n    name: \"options\",\r\n    type: \"Primrose.HTTP.XHR.optionsHash\",\r\n    optional: true,\r\n    description: \"Options for passing data or tracking progress. See [`Primrose.HTTP.XHR.optionsHash`](#Primrose_HTTP_XHR_optionsHash) for more information. The `data` field is not optional.\"\r\n  }]\r\n});\r\n\r\nimport post from \"./post\";\r\nexport default function postObject(url, options) {\r\n  return post(\"json\", url, options);\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"HTTP\",\r\n  description: \"A collection of basic XMLHttpRequest wrappers.\"\r\n});\r\n\r\nimport del from \"./del\";\r\nimport delObject from \"./delObject\";\r\nimport get from \"./get\";\r\nimport getBuffer from \"./getBuffer\";\r\nimport getObject from \"./getObject\";\r\nimport getText from \"./getText\";\r\nimport post from \"./post\";\r\nimport postObject from \"./postObject\";\r\nimport XHR from \"./XHR\";\r\n\r\nexport {\r\n  del,\r\n  delObject,\r\n  get,\r\n  getBuffer,\r\n  getObject,\r\n  getText,\r\n  post,\r\n  postObject,\r\n  XHR\r\n};\r\n\r\nexport default {\r\n  del,\r\n  delObject,\r\n  get,\r\n  getBuffer,\r\n  getObject,\r\n  getText,\r\n  post,\r\n  postObject,\r\n  XHR\r\n};","pliny.class({\r\n  parent: \"Primrose.Input\",\r\n  name: \"Location\",\r\n  baseClass: \"Primrose.Input.InputProcessor\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport InputProcessor from \"./InputProcessor\";\r\nexport default class Location extends InputProcessor {\r\n  constructor(commands, options) {\r\n    super(\"Location\", commands, [\"LONGITUDE\", \"LATITUDE\", \"ALTITUDE\", \"HEADING\", \"SPEED\"]);\r\n\r\n    this.options = Object.assign({}, Location.DEFAULTS, options);\r\n\r\n    this.available = !!navigator.geolocation;\r\n    if (this.available) {\r\n      navigator.geolocation.watchPosition(\r\n        this.setState.bind(this),\r\n        () => this.available = false,\r\n        this.options);\r\n    }\r\n  }\r\n\r\n  setState(location) {\r\n    this.inPhysicalUse = true;\r\n    for (var p in location.coords) {\r\n      var k = p.toUpperCase();\r\n      if (this.axisNames.indexOf(k) > -1) {\r\n        this.setAxis(k, location.coords[p]);\r\n      }\r\n    }\r\n    this.update();\r\n  }\r\n};\r\n\r\nLocation.DEFAULTS = {\r\n  enableHighAccuracy: true,\r\n  maximumAge: 30000,\r\n  timeout: 25000\r\n};\r\n","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Input\",\r\n  description: \"The Input namespace contains classes that handle user input, for use in navigating the 3D environment.\"\r\n});\r\n\r\nimport Gamepad from \"./Gamepad\";\r\nimport GamepadManager from \"./GamepadManager\";\r\nimport InputProcessor from \"./InputProcessor\";\r\nimport Keyboard from \"./Keyboard\";\r\nimport Location from \"./Location\";\r\nimport Mouse from \"./Mouse\";\r\nimport PoseInputProcessor from \"./PoseInputProcessor\";\r\nimport Speech from \"./Speech\";\r\nimport Touch from \"./Touch\";\r\nimport VR from \"./VR\";\r\n\r\nexport {\r\n  Gamepad,\r\n  InputProcessor,\r\n  Keyboard,\r\n  Location,\r\n  Mouse,\r\n  PoseInputProcessor,\r\n  Speech,\r\n  Touch,\r\n  VR\r\n};\r\n\r\nexport default {\r\n  Gamepad,\r\n  InputProcessor,\r\n  Keyboard,\r\n  Location,\r\n  Mouse,\r\n  PoseInputProcessor,\r\n  Speech,\r\n  Touch,\r\n  VR\r\n};\r\n","pliny.class({\r\n  parent: \"Primrose\",\r\n  name: \"WebRTCSocket\",\r\n  baseClass: \"THREE.EventDispatcher\",\r\n  description: \"Manages the negotiation between peer users to set up bidirectional audio between the two.\",\r\n  parameters: [{\r\n    name: \"requestICEPath\",\r\n    type: \"string\",\r\n    description: \"A request path at which to retrieve the extra ICE servers to use with the connection.\"\r\n  }, {\r\n    name: \"fromUserName\",\r\n    type: \"String\",\r\n    description: \"The name of the local user, from which the peering is being initiated.\"\r\n  }, {\r\n    name: \"fromUserIndex\",\r\n    type: \"Number\",\r\n    description: \"For users with multiple devices logged in at one time, this is the index of the device that is performing the peering operation.\"\r\n  }, {\r\n    name: \"toUserName\",\r\n    type: \"String\",\r\n    description: \"The name of the remote user, to which the peering is being requested.\"\r\n  }, {\r\n    name: \"toUserIndex\",\r\n    type: \"Number\",\r\n    description: \"For users with multiple devices logged in at one time, this is the index of the device that is receiving the peering operation.\"\r\n  }]\r\n});\r\n\r\nimport { EventDispatcher } from \"three\";\r\n\r\n\r\nconst PEERING_TIMEOUT_LENGTH = 30000;\r\n\r\n// some useful information:\r\n// - https://www.webrtc-experiment.com/docs/STUN-or-TURN.html\r\n// - http://www.html5rocks.com/en/tutorials/webrtc/infrastructure/#after-signaling-using-ice-to-cope-with-nats-and-firewalls\r\n// - https://github.com/coturn/rfc5766-turn-server/\r\nlet ICE_SERVERS = [{\r\n  urls: [\r\n    \"stun:stun.l.google.com:19302\",\r\n    \"stun:stun1.l.google.com:19302\",\r\n    \"stun:stun2.l.google.com:19302\",\r\n    \"stun:stun3.l.google.com:19302\",\r\n    \"stun:stun4.l.google.com:19302\"\r\n  ]\r\n}];\r\n\r\nlet INSTANCE_COUNT = 0;\r\n\r\n\r\nexport default class WebRTCSocket extends EventDispatcher {\r\n  // Be forewarned, the WebRTC lifecycle is very complex and editing this class is likely to break it.\r\n  constructor(requestICEPath, fromUserName, fromUserIndex, toUserName, toUserIndex, goSecond) {\r\n    super();\r\n    // These logging constructs are basically off by default, but you will need them if you ever need to debug the WebRTC workflow.\r\n    let attemptCount = 0;\r\n    const MAX_LOG_LEVEL = 5,\r\n      instanceNumber = ++INSTANCE_COUNT,\r\n      print = function (name, level, format) {\r\n        if (level < MAX_LOG_LEVEL) {\r\n          const args = [\r\n            \"%s: \" + format,\r\n            level\r\n          ];\r\n          for (var i = 3; i < arguments.length; ++i) {\r\n            args.push(arguments[i]);\r\n          }\r\n          console[name].apply(console, args);\r\n        }\r\n        return arguments[3];\r\n      };\r\n\r\n    this.myResult = null;\r\n    this.theirResult = null;\r\n    this._timeout = null;\r\n    this._log = print.bind(null, \"log\");\r\n    this._error = print.bind(null, \"error\", 0, \"\");\r\n    this.fromUserName = fromUserName;\r\n    this.fromUserIndex = fromUserIndex;\r\n    this.toUserName = toUserName;\r\n    this.toUserIndex = toUserIndex;\r\n    this.rtc = null;\r\n    this.goFirst = !goSecond;\r\n    this.progress = {\r\n      offer: {\r\n        created: false,\r\n        received: false\r\n      },\r\n      answer: {\r\n        created: false,\r\n        received: false\r\n      }\r\n    };\r\n    // If the user leaves the page, we want to at least fire off the close signal and perhaps\r\n    // not completely surprise the remote user.\r\n    window.addEventListener(\"unload\", this.close.bind(this));\r\n\r\n    let resolve = null, reject = null;\r\n\r\n    const done = (isError) => {\r\n      this._log(2, \"Tearing down event handlers\");\r\n      this.stopTimeout();\r\n      this.rtc.onsignalingstatechange = null;\r\n      this.rtc.oniceconnectionstatechange = null;\r\n      this.rtc.onnegotiationneeded = null;\r\n      this.rtc.onicecandidate = null;\r\n\r\n      this.teardown();\r\n      if (isError) {\r\n        this.close();\r\n      }\r\n    };\r\n\r\n    // A pass-through function to include in the promise stream to see if the channels have all been set up correctly and ready to go.\r\n    const check = (obj) => {\r\n      if (this.complete) {\r\n        this._log(1, \"Timeout avoided.\");\r\n        done();\r\n        resolve();\r\n      }\r\n      return obj;\r\n    };\r\n\r\n    // When an offer or an answer is received, it's pretty much the same exact processing. Either type of object gets checked to see if it was expected, then unwrapped.\r\n    this.peering_answer = (description) => {\r\n      this._log(1, \"description\", description);\r\n      // Check to see if we expected this sort of message from this user.\r\n      this.recordProgress(description.item, \"received\");\r\n\r\n      // The description we received is always the remote description, regardless of whether or not it's an offer or an answer.\r\n      return this.rtc.setRemoteDescription(new RTCSessionDescription(description.item))\r\n\r\n        // check to see if we're done.\r\n        .then(check)\r\n\r\n        // and if there are any errors, bomb out and shut everything down.\r\n        .catch(this.peering_error);\r\n    };\r\n\r\n    // When an offer or an answer is created, it's pretty much the same exact processing. Either type of object gets wrapped with a context identifying which peer channel is being negotiated, and then transmitted through the negotiation server to the remote user.\r\n    this.descriptionCreated = (description) => {\r\n      this.recordProgress(description, \"created\");\r\n\r\n      // The description we create is always the local description, regardless of whether or not it's an offer\r\n      // or an answer.\r\n      return this.rtc.setLocalDescription(description)\r\n        // Let the remote user know what happened.\r\n        .then(() => this.emit(description.type, description))\r\n        // check to see if we're done.\r\n        .then(check)\r\n        // and if there are any errors, bomb out and shut everything down.\r\n        .catch(this.peering_error);\r\n    };\r\n\r\n    // A catch-all error handler to shut down the world if an error we couldn't handle happens.\r\n    this.peering_error = (exp) => {\r\n      this._error(exp);\r\n      this.emit(\"cancel\", exp);\r\n      this._log(1, \"Timeout avoided, but only because of an error.\");\r\n      done(true);\r\n      reject(exp);\r\n    };\r\n\r\n    // A catch-all error handler to shut down the world if an error we couldn't handle happens.\r\n    this.peering_cancel = (exp) => {\r\n      this._error(exp);\r\n      this._log(1, \"Timeout avoided, but only because of an error.\");\r\n      done(true);\r\n      reject(exp);\r\n    };\r\n\r\n    // When an offer is received, we need to create an answer in reply.\r\n    this.peering_offer = (offer) => {\r\n      this._log(1, \"offer\", offer);\r\n      var promise = this.peering_answer(offer);\r\n      if (promise) {\r\n        return promise.then(() => this.rtc.createAnswer())\r\n          .then(this.descriptionCreated);\r\n      }\r\n    };\r\n\r\n    // ICE stands for Interactive Connectivity Establishment. It's basically a description of a local end-point,\r\n    // with enough information for the remote user to be able to connect to it.\r\n    this.peering_ice = (ice) => {\r\n      this._log(1, \"ice\", ice);\r\n      var candidate = new RTCIceCandidate(ice.item);\r\n      return this.rtc.addIceCandidate(candidate)\r\n        .catch(this._error);\r\n    };\r\n\r\n    this.peering_peer = (evt) => {\r\n      this._log(1, \"peering\", evt);\r\n      this.hasRTC.then(() => this.issueRequest());\r\n    };\r\n\r\n    // This is where things get gnarly\r\n    this.hasRTC = Primrose.HTTP.getObject(requestICEPath)\r\n      .then((config) => {\r\n        config.iceServers.push.apply(config.iceServers, ICE_SERVERS);\r\n        for(let i = config.iceServers.length - 1; i >= 0; --i){\r\n          const server = config.iceServers[i];\r\n          if(!server.urls || server.urls.length === 0){\r\n            config.iceServers.splice(i, 1);\r\n          }\r\n          else {\r\n            if(server.url && !server.urls){\r\n              server.urls = [server.url];\r\n              delete server.url;\r\n            }\r\n            if(server.username && server.credential){\r\n              server.credentialType = \"token\";\r\n            }\r\n          }\r\n        }\r\n        config.iceCandidatePoolSize = 100;\r\n        this._log(1, config);\r\n        this.rtc = new RTCPeerConnection(config);\r\n        // This is just for debugging purposes.\r\n        this.rtc.onsignalingstatechange = (evt) => this._log(1, \"[%s] Signal State: %s\", instanceNumber, this.rtc.signalingState);\r\n        this.rtc.oniceconnectionstatechange = (evt) => this._log(1, \"[%s] ICE Connection %s, Gathering %s\", instanceNumber, this.rtc.iceConnectionState, this.rtc.iceGatheringState);\r\n\r\n        // All of the literature you'll read on WebRTC show creating an offer right after creating a data channel or adding a stream to the peer connection. This is wrong. The correct way is to wait for the API to tell you that negotiation is necessary, and only then create the offer. There is a race-condition between the signaling state of the WebRTCPeerConnection and creating an offer after creating a channel if we don't wait for the appropriate time.\r\n        this.rtc.onnegotiationneeded = (evt) => this.createOffer()\r\n          .then(this.descriptionCreated);\r\n\r\n        // The API is going to figure out end-point configurations for us by communicating with the STUN servers and seeing which end-points are visible and which require network address translation.\r\n        this.rtc.onicecandidate = (evt) => {\r\n          // There is an error condition where sometimes the candidate returned in this event handler will be null.\r\n          if (evt.candidate) {\r\n            // Then let the remote user know of our folly.\r\n            this.emit(\"ice\", evt.candidate);\r\n          }\r\n        };\r\n      });\r\n\r\n      this.ready = this.hasRTC.then(() => new Promise((resolver, rejecter) => {\r\n        resolve = resolver;\r\n        reject = rejecter;\r\n        this.emit(\"peer\");\r\n      }));\r\n  }\r\n\r\n  emit(type, evt){\r\n    super.emit(type, {\r\n      fromUserName: this.fromUserName,\r\n      fromUserIndex: this.fromUserIndex,\r\n      toUserName: this.toUserName,\r\n      toUserIndex: this.toUserIndex,\r\n      item: evt\r\n    });\r\n  }\r\n\r\n  startTimeout() {\r\n    if (this._timeout === null) {\r\n      this._log(1, \"Timing out in \" + Math.floor(PEERING_TIMEOUT_LENGTH / 1000) + \" seconds.\");\r\n      this._timeout = setTimeout(this.peering_error.bind(this, \"Gave up waiting on the peering connection.\"), PEERING_TIMEOUT_LENGTH);\r\n    }\r\n  }\r\n\r\n  stopTimeout() {\r\n    if (this._timeout !== null) {\r\n      clearTimeout(this._timeout);\r\n      this._timeout = null;\r\n    }\r\n  }\r\n\r\n  createOffer() {\r\n    return this.rtc.createOffer(this.offerOptions);\r\n  }\r\n\r\n  recordProgress(description, method) {\r\n    pliny.method({\r\n      parent: \"Primrose.WebRTCSocket\",\r\n      name: \"recordProgress\",\r\n      description: \"mark that we made progress towards our goals.\",\r\n      parameters: [{\r\n        name: \"description\",\r\n        type: \"RTCSessionDescription\",\r\n        description: \"An answer or offer object.\"\r\n      }, {\r\n        name: \"method\",\r\n        type: \"String\",\r\n        description: \"Whether or not the description had been 'created' or 'received' here.\"\r\n      }]\r\n    });\r\n    this._log(2, \"Logging progress [%s]: %s %s -> true\", description.type, method, this.progress[description.type][method]);\r\n    this.progress[description.type][method] = true;\r\n  }\r\n\r\n  close() {\r\n    pliny.method({\r\n      parent: \"Primrose.WebRTCSocket\",\r\n      name: \"close\",\r\n      description: \"shut down the peer connection, if it was succesful in being created.\"\r\n    });\r\n    if (this.rtc && this.rtc.signalingState !== \"closed\") {\r\n      this.rtc.close();\r\n      this.rtc = null;\r\n    }\r\n  }\r\n\r\n  teardown() {\r\n    pliny.method({\r\n      parent: \"Primrose.WebRTCSocket\",\r\n      name: \"teardown\",\r\n      description: \"Whether ending succesfully or failing, the processing is mostly the same: teardown all the event handlers.\"\r\n    });\r\n\r\n    throw new Error(\"Not implemented.\");\r\n  }\r\n\r\n  get complete() {\r\n    pliny.property({\r\n      parent: \"Primrose.WebRTCSocket\",\r\n      name: \"complete\",\r\n      returns: \"Boolean\",\r\n      description: \"Override this method in subClasses to indicate when the peering process is complete. The peering process is complete when all offers are answered.\"\r\n    });\r\n\r\n    return !this.rtc || this.rtc.signalingState === \"closed\";\r\n  }\r\n\r\n  issueRequest() {\r\n    pliny.property({\r\n      parent: \"Primrose.WebRTCSocket\",\r\n      name: \"issueRequest\",\r\n      description: \"Override this method in subClasses to trigger the peering process.\"\r\n    });\r\n\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n}\r\n\r\nWebRTCSocket.PEERING_EVENTS = [\"peer\", \"cancel\", \"offer\", \"ice\", \"answer\"];\r\n","\r\n\r\npliny.class({\r\n  parent: \"Primrose.Network\",\r\n    name: \"AudioChannel\",\r\n    baseClass: \"Primrose.WebRTCSocket\",\r\n    description: \"Manages the negotiation between peer users to set up bidirectional audio between the two.\",\r\n    parameters: [{\r\n      name: \"requestICEPath\",\r\n      type: \"string\",\r\n      description: \"A request path at which to retrieve the extra ICE servers to use with the connection.\"\r\n    }, {\r\n      name: \"fromUserName\",\r\n      type: \"String\",\r\n      description: \"The name of the local user, from which the peering is being initiated.\"\r\n    }, {\r\n      name: \"toUserName\",\r\n      type: \"String\",\r\n      description: \"The name of the remote user, to which the peering is being requested.\"\r\n    }, {\r\n      name: \"outAudio\",\r\n      type: \"Promise\",\r\n      description: \"An audio stream from the local user to send to the remote user.\"\r\n    }]\r\n});\r\n\r\nimport WebRTCSocket from \"./WebRTCSocket\";\r\nimport isIE from \"../../flags/isIE\";\r\n\r\nconst ENABLE_OPUS_HACK = true;\r\n\r\nfunction preferOpus(description) {\r\n  if (ENABLE_OPUS_HACK && description) {\r\n    var sdp = description.sdp;\r\n    var sdpLines = sdp.split('\\r\\n');\r\n    var mLineIndex = null;\r\n    // Search for m line.\r\n    for (var i = 0; i < sdpLines.length; i++) {\r\n      if (sdpLines[i].search('m=audio') !== -1) {\r\n        mLineIndex = i;\r\n        break;\r\n      }\r\n    }\r\n    if (mLineIndex === null) return sdp;\r\n\r\n    // If Opus is available, set it as the default in m line.\r\n    for (var j = 0; j < sdpLines.length; j++) {\r\n      if (sdpLines[j].search('opus/48000') !== -1) {\r\n        var opusPayload = extractSdp(sdpLines[j], /:(\\d+) opus\\/48000/i);\r\n        if (opusPayload) sdpLines[mLineIndex] = setDefaultCodec(sdpLines[mLineIndex], opusPayload);\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Remove CN in m line and sdp.\r\n    sdpLines = removeCN(sdpLines, mLineIndex);\r\n\r\n    description.sdp = sdpLines.join('\\r\\n');\r\n  }\r\n  return description;\r\n}\r\n\r\nfunction extractSdp(sdpLine, pattern) {\r\n  var result = sdpLine.match(pattern);\r\n  return (result && result.length == 2) ? result[1] : null;\r\n}\r\n\r\nfunction setDefaultCodec(mLine, payload) {\r\n  var elements = mLine.split(' ');\r\n  var newLine = [];\r\n  var index = 0;\r\n  for (var i = 0; i < elements.length; i++) {\r\n    if (index === 3) // Format of media starts from the fourth.\r\n      newLine[index++] = payload; // Put target payload to the first.\r\n    if (elements[i] !== payload) newLine[index++] = elements[i];\r\n  }\r\n  return newLine.join(' ');\r\n}\r\n\r\nfunction removeCN(sdpLines, mLineIndex) {\r\n  var mLineElements = sdpLines[mLineIndex].split(' ');\r\n  // Scan from end for the convenience of removing an item.\r\n  for (var i = sdpLines.length - 1; i >= 0; i--) {\r\n    var payload = extractSdp(sdpLines[i], /a=rtpmap:(\\d+) CN\\/\\d+/i);\r\n    if (payload) {\r\n      var cnPos = mLineElements.indexOf(payload);\r\n      if (cnPos !== -1) {\r\n        // Remove CN payload from m line.\r\n        mLineElements.splice(cnPos, 1);\r\n      }\r\n      // Remove CN line in sdp\r\n      sdpLines.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  sdpLines[mLineIndex] = mLineElements.join(' ');\r\n  return sdpLines;\r\n}\r\nexport default class AudioChannel extends WebRTCSocket {\r\n  constructor(requestICEPath, fromUserName, toUserName, outAudio, goSecond) {\r\n    console.log(\"attempting to peer audio from %s to %s. %s goes first.\", fromUserName, toUserName, goSecond ? toUserName : fromUserName);\r\n    super(requestICEPath, fromUserName, 0, toUserName, 0, goSecond);\r\n    this.outAudio = outAudio;\r\n    this.inAudio = null;\r\n    this.startTimeout();\r\n  }\r\n\r\n  issueRequest() {\r\n    console.log(\"going first\", this.goFirst);\r\n    // Adding an audio stream to the peer connection is different between Firefox (which supports the latest\r\n    //  version of the API) and Chrome.\r\n    const addStream = () => {\r\n      this._log(0, \"adding stream\", this.outAudio, this.rtc.addTrack);\r\n\r\n      // Make sure we actually have audio to send to the remote.\r\n      this.outAudio.then((aud) => {\r\n        if (this.rtc.addTrack) {\r\n          aud.getAudioTracks()\r\n            .forEach((track) => this.rtc.addTrack(track, aud));\r\n        }\r\n        else {\r\n          this.rtc.addStream(aud);\r\n        }\r\n\r\n        if(isIE){\r\n          this.createOffer()\r\n            .then(this.descriptionCreated);\r\n        }\r\n      });\r\n    };\r\n\r\n    // Receiving an audio stream from the peer connection is just a\r\n    const onStream = (stream) => {\r\n      this.inAudio = stream;\r\n      if (!this.goFirst) {\r\n        this._log(0, \"Creating the second stream from %s to %s\", this.fromUserName, this.toUserName);\r\n        this.stopTimeout();\r\n        this._log(1, \"Restarting timeout.\");\r\n        this.startTimeout();\r\n        addStream();\r\n      }\r\n    };\r\n\r\n    // Wait to receive an audio track.\r\n    if(\"ontrack\" in this.rtc){\r\n      this.rtc.ontrack = (evt) => onStream(evt.streams[0]);\r\n    }\r\n    else{\r\n      this.rtc.onaddstream = (evt) => onStream(evt.stream);\r\n    }\r\n\r\n    // If we're the boss, tell people about it.\r\n    if (this.goFirst) {\r\n      this._log(0, \"Creating the first stream from %s to %s\", this.fromUserName, this.toUserName);\r\n      addStream();\r\n    }\r\n  }\r\n\r\n  // The peering process is complete when all offers are answered.\r\n  get complete() {\r\n    if (this.goFirst) {\r\n      this._log(1, \"[First]: offer created: %s, answer recv: %s -> offer recv: %s -> answer created: %s.\",\r\n        this.progress.offer.created,\r\n        this.progress.answer.received,\r\n        this.progress.offer.received,\r\n        this.progress.answer.created,\r\n        this.rtc.signalingState);\r\n    }\r\n    else {\r\n      this._log(1, \"[Second]: offer recv: %s, answer created: %s -> offer created: %s -> answer recv: %s.\",\r\n        this.progress.offer.received,\r\n        this.progress.answer.created,\r\n        this.progress.offer.created,\r\n        this.progress.answer.received,\r\n        this.rtc.signalingState);\r\n    }\r\n\r\n    return super.complete || (this.progress.offer.received &&\r\n      this.progress.offer.created &&\r\n      this.progress.answer.received &&\r\n      this.progress.answer.created);\r\n  }\r\n\r\n  teardown() {\r\n    if (\"ontrack\" in this.rtc) {\r\n      this.rtc.ontrack = null;\r\n    }\r\n    else {\r\n      this.rtc.onaddstream = null;\r\n    }\r\n  }\r\n\r\n  createOffer() {\r\n    return super.createOffer()\r\n      .then(preferOpus);\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Network\",\r\n    name: \"DataChannel\",\r\n    baseClass: \"Primrose.WebRTCSocket\",\r\n    description: \"Manages the negotiation between peer users to set up bidirectional audio between the two.\",\r\n    parameters: [{\r\n      name: \"requestICEPath\",\r\n      type: \"string\",\r\n      description: \"A request path at which to retrieve the extra ICE servers to use with the connection.\"\r\n    }, {\r\n      name: \"fromUserName\",\r\n      type: \"String\",\r\n      description: \"The name of the local user, from which the peering is being initiated.\"\r\n    }, {\r\n      name: \"fromUserIndex\",\r\n      type: \"Number\",\r\n      description: \"For users with multiple devices logged in at one time, this is the index of the device that is performing the peering operation.\"\r\n    }, {\r\n      name: \"toUserName\",\r\n      type: \"String\",\r\n      description: \"The name of the remote user, to which the peering is being requested.\"\r\n    }, {\r\n      name: \"toUserIndex\",\r\n      type: \"Number\",\r\n      description: \"For users with multiple devices logged in at one time, this is the index of the device that is receiving the peering operation.\"\r\n    }]\r\n});\r\n\r\nimport WebRTCSocket from \"./WebRTCSocket\";\r\n\r\nlet INSTANCE_COUNT = 0;\r\n\r\nexport default class DataChannel extends WebRTCSocket {\r\n  constructor(requestICEPath, fromUserName, fromUserIndex, toUserName, toUserIndex, goSecond) {\r\n    super(requestICEPath, fromUserName, fromUserIndex, toUserName, toUserIndex, goSecond);\r\n\r\n    pliny.property({\r\n      parent: \"Primrose.Network.DataChannel\",\r\n      name: \"dataChannel\",\r\n      type: \"RTCDataChannel\",\r\n      description: \"A bidirectional data channel from the remote user to the local user.\"\r\n    });\r\n    this.dataChannel = null;\r\n  }\r\n\r\n  issueRequest() {\r\n    if (this.goFirst) {\r\n      this._log(0, \"Creating data channel\");\r\n      this.dataChannel = this.rtc.createDataChannel();\r\n    }\r\n    else {\r\n      this.ondatachannel = (evt) => {\r\n        this._log(0, \"Receving data channel\");\r\n        this.dataChannel = evt.channel;\r\n      };\r\n    }\r\n  }\r\n\r\n  get complete() {\r\n    if (this.goFirst) {\r\n      this._log(1, \"[First]: OC %s -> AR %s.\",\r\n        this.progress.offer.created,\r\n        this.progress.answer.received);\r\n    }\r\n    else {\r\n      this._log(1, \"[Second]: OC %s -> AR %s.\",\r\n        this.progress.offer.created,\r\n        this.progress.answer.received);\r\n    }\r\n    return super.complete ||\r\n      (this.goFirst && this.progress.offer.created && this.progress.answer.received ||\r\n        !this.goFirst && this.progress.offer.received && this.progress.answer.created);\r\n  }\r\n\r\n  teardown() {\r\n    this.rtc.ondatachannel = null;\r\n  }\r\n}","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Network\",\r\n  description: \"The Network namespace contains classes for communicating events between entities in a graph relationship across different types of communication boundaries: in-thread, cross-thread, cross-WAN, and cross-LAN.\"\r\n});\r\n\r\nimport AudioChannel from \"./AudioChannel\";\r\nimport DataChannel from \"./DataChannel\";\r\nimport Manager from \"./Manager\";\r\nimport RemoteUser from \"./RemoteUser\";\r\nimport WebRTCSocket from \"./WebRTCSocket\";\r\n\r\nexport {\r\n  AudioChannel,\r\n  DataChannel,\r\n  Manager,\r\n  RemoteUser,\r\n  WebRTCSocket\r\n};\r\n\r\nexport default {\r\n  AudioChannel,\r\n  DataChannel,\r\n  Manager,\r\n  RemoteUser,\r\n  WebRTCSocket\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"ID\",\r\n  description: \"Returns a randomized string to be used as a general purpose identifier. Collisions are possible, but should be rare.\",\r\n  returns: \"String\",\r\n  examples: [{\r\n    name: \"Generate 10 random identifiers.\",\r\n    description: \"To generate a randomized identifier, call the `Primrose.Random.ID()` function as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.ID());\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> 25xzdqnhg1ma2qsb3k1n61or\\n\\\r\n> 1hyajmimpyjb4chvge5ng66r\\n\\\r\n> cq3dy9qnkwhneza3vr3haor\\n\\\r\n> g3l5k2kfwmxjrxjwg0uj714i\\n\\\r\n> 7qsta7cutxke8t88pahy3nmi\\n\\\r\n> h75g0nj0d4gh7zsyowxko6r\\n\\\r\n> 7pbej49fhhd5icimp3krzfr\\n\\\r\n> 3vnlovkkvyvmetsjcyirizfr\\n\\\r\n> icrehedvz97dpgkusfumzpvi\\n\\\r\n> 9p06sytn6dfearuibsnn4s4i\"\r\n  }]\r\n});\r\n\r\nexport default function ID() {\r\n  return (Math.random() * Math.log(Number.MAX_VALUE))\r\n    .toString(36)\r\n    .replace(\".\", \"\");\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"item\",\r\n  description: \"Returns a random element from an array.\",\r\n  parameters: [{\r\n    name: \"arr\",\r\n    type: \"Array\",\r\n    description: \"The array form which to pick items.\"\r\n  }],\r\n  returns: \"Any\",\r\n  examples: [{\r\n    name: \"Select a random element from an array.\",\r\n    description: \"To pick an item from an array at random, call the `Primrose.Random.item` function with the `power` parameter as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  var numbers = [\\n\\\r\n    \\\"one\\\",\\n\\\r\n    \\\"two\\\",\\n\\\r\n    \\\"three\\\",\\n\\\r\n    \\\"four\\\",\\n\\\r\n    \\\"five\\\"\\n\\\r\n  ];\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.item(numbers));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> three  \\n\\\r\n> four  \\n\\\r\n> four  \\n\\\r\n> two  \\n\\\r\n> three  \\n\\\r\n> two  \\n\\\r\n> five  \\n\\\r\n> four  \\n\\\r\n> three  \\n\\\r\n> two\"\r\n  }]\r\n});\r\n\r\nimport randInt from \"./int\";\r\nexport default function item(arr) {\r\n  return arr[randInt(arr.length)];\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"steps\",\r\n  description: \"Returns a random integer number on a given range [min, max), i.e. min is inclusive, max is exclusive, sticking to a number of steps in between. Useful for randomly generating music note values on pentatonic scales. As random as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.\",\r\n  parameters: [{\r\n    name: \"min\",\r\n    type: \"Number\",\r\n    description: \"The included minimum side of the range of numbers.\"\r\n  }, {\r\n    name: \"max\",\r\n    type: \"Number\",\r\n    description: \"The excluded maximum side of the range of numbers.\"\r\n  }, {\r\n    name: \"steps\",\r\n    type: \"Number\",\r\n    description: \"The number of steps between individual integers, e.g. if min is even and step is even, then no odd numbers will be generated.\"\r\n  }],\r\n  returns: \"Number\",\r\n  examples: [{\r\n    name: \"Generate random, even numbers.\",\r\n    description: \"To generate numbers on a closed range with a constant step size between them, call the `Primrose.Random.step` function as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.steps(0, 100, 2));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> 86  \\n\\\r\n> 32  \\n\\\r\n> 86  \\n\\\r\n> 56  \\n\\\r\n> 4  \\n\\\r\n> 96  \\n\\\r\n> 68  \\n\\\r\n> 92  \\n\\\r\n> 4  \\n\\\r\n> 36\"\r\n  }]\r\n});\r\n\r\nimport randInt from \"./int\";\r\nexport default function steps(min, max, steps) {\r\n  return min + randInt(0, (1 + max - min) / steps) * steps;\r\n};","pliny.function({\r\n  parent: \"Primrose.Random\",\r\n  name: \"vector\",\r\n  description: \"Returns a random THREE.Vector3 of floating-point numbers on a given range [min, max), i.e. min is inclusive, max is exclusive. As random as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.\",\r\n  parameters: [{\r\n    name: \"min\",\r\n    type: \"Number\",\r\n    description: \"The included minimum side of the range of numbers.\"\r\n  }, {\r\n    name: \"max\",\r\n    type: \"Number\",\r\n    description: \"The excluded maximum side of the range of numbers.\"\r\n  }],\r\n  returns: \"THREE.Vector3\",\r\n  examples: [{\r\n    name: \"Generate a random vector on the range [-1, 1).\",\r\n    description: \"To generate a random vector on a closed range, call the `Primrose.Random.vector` function as shown:\\n\\\r\n\\n\\\r\n## Code:\\n\\\r\n\\n\\\r\n  grammar(\\\"JavaScript\\\");\\n\\\r\n  for(var i = 0; i < 10; ++i){\\n\\\r\n    console.log(Primrose.Random.vector(-1, 1).toString(\\\"test\\\", 3));\\n\\\r\n  }\\n\\\r\n\\n\\\r\n## Result (note that this is just one possible outcome):\\n\\\r\n> <-0.486, 0.530, 0.119>\\n\\\r\n> <-0.220, 0.485, -0.848>\\n\\\r\n> <0.157, -0.364, 0.448>\"\r\n  }]\r\n});\r\n\r\nimport randNum from \"./number\";\r\nimport { Vector3 } from \"three\";\r\nexport default function vector(min, max){\r\n  return new Vector3().set(\r\n    randNum(min, max),\r\n    randNum(min, max),\r\n    randNum(min, max)\r\n  );\r\n};\r\n","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Random\",\r\n  description: \"Functions for handling random numbers of different criteria, or selecting random elements of arrays.\"\r\n});\r\n\r\nimport color from \"./color\";\r\nimport ID from \"./ID\";\r\nimport int from \"./int\";\r\nimport item from \"./item\";\r\nimport number from \"./number\";\r\nimport steps from \"./steps\";\r\nimport vector from \"./vector\";\r\n\r\nexport {\r\n  color,\r\n  ID,\r\n  int,\r\n  item,\r\n  number,\r\n  steps,\r\n  vector\r\n};\r\n\r\nexport default {\r\n  color,\r\n  ID,\r\n  int,\r\n  item,\r\n  number,\r\n  steps,\r\n  vector\r\n};","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Watcher\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport Obj from \"./Obj\";\r\nimport Record from \"./Record\";\r\n\r\nexport default class Watcher extends Obj {\r\n  constructor(path, root) {\r\n    super(path, root);\r\n\r\n    let lastValue = null;\r\n    this.read = () => {\r\n      const value = this.get();\r\n      if (value !== this.lastValue) {\r\n        this.lastValue = value;\r\n        return new Record(this.path, value, root);\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    };\r\n  }\r\n};","pliny.class({\r\n  parent: \"Primrose.Replay\",\r\n  name: \"Recorder\",\r\n  description: \"| [under construction]\"\r\n});\r\n\r\nimport Automator from \"./Automator\";\r\nimport Watcher from \"./Watcher\";\r\nimport Frame from \"./Frame\";\r\n\r\nexport default class Recorder extends Automator {\r\n  constructor(watchers, root) {\r\n    super(root);\r\n    this.watchers = watchers.map((path) => new Watcher(path, this.root));\r\n  }\r\n\r\n  update(t) {\r\n    super.update(t);\r\n    const records = this.watchers\r\n      .map((w) => w.read())\r\n      .filter((r) => r);\r\n\r\n    var frame = new Frame(t - this.startT, records);\r\n    this.frames.push(frame);\r\n    this.emit(\"frame\", frame);\r\n  }\r\n\r\n  toJSON() {\r\n    const output = {};\r\n\r\n    this.frames.forEach((frame) => {\r\n      output[frame.t] = {};\r\n      for (var i = 0; i < frame.records.length; ++i) {\r\n        var record = frame.records[i];\r\n        if (record.value !== null) {\r\n          const parts = record.path.split(\".\"),\r\n            key = parts[parts.length - 1];\r\n          let head = output[frame.t];\r\n          for (let j = 0; j < parts.length - 1; ++j) {\r\n            var part = parts[j];\r\n            if (head[part] === undefined || head[part] === null) {\r\n              if (/^\\d+$/.test(parts[j + 1])) {\r\n                head[part] = [];\r\n              }\r\n              else {\r\n                head[part] = {};\r\n              }\r\n            }\r\n            head = head[part];\r\n          }\r\n          head[key] = record.value;\r\n        }\r\n      }\r\n    });\r\n\r\n    return JSON.stringify(output);\r\n  }\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Replay\",\r\n  description: \"Record and playback data.\"\r\n});\r\n\r\nimport Automator from \"./Automator\";\r\nimport Frame from \"./Frame\";\r\nimport Obj from \"./Obj\";\r\nimport Player from \"./Player\";\r\nimport Record from \"./Record\";\r\nimport Recorder from \"./Recorder\";\r\nimport Watcher from \"./Watcher\";\r\n\r\nexport {\r\n  Automator,\r\n  Frame,\r\n  Obj,\r\n  Player,\r\n  Record,\r\n  Recorder,\r\n  Watcher\r\n};\r\n\r\nexport default {\r\n  Automator,\r\n  Frame,\r\n  Obj,\r\n  Player,\r\n  Record,\r\n  Recorder,\r\n  Watcher\r\n};","pliny.namespace({\r\n  parent: \"Primrose.Text\",\r\n  name: \"CommandPacks\",\r\n  description: \"The CommandPacks namespace contains sets of keyboard shortcuts for different types of text-oriented controls.\"\r\n});\r\n\r\nimport BasicTextInput from \"./BasicTextInput\";\r\nimport CommandPack from \"./CommandPack\";\r\nimport TextEditor from \"./TextEditor\";\r\nimport TextInput from \"./TextInput\";\r\n\r\nexport {\r\n  BasicTextInput,\r\n  CommandPack,\r\n  TextEditor,\r\n  TextInput\r\n};\r\n\r\nexport default {\r\n  BasicTextInput,\r\n  CommandPack,\r\n  TextEditor,\r\n  TextInput\r\n};","pliny.value({\r\n  parent: \"Primrose.Text.Grammars\",\r\n  name: \"Basic\",\r\n  description: \"A grammar and an interpreter for a BASIC-like language.\"\r\n});\r\n\r\nimport Grammar from \"./Grammar\";\r\nimport Token from \"../Token\";\r\n\r\nconst eval2 = eval;\r\n\r\nconst Basic = new Grammar(\"BASIC\",\r\n  // Grammar rules are applied in the order they are specified.\r\n  [\r\n    // Text needs at least the newlines token, or else every line will attempt to render as a single line and the line count won't work.\r\n    [\"newlines\", /(?:\\r\\n|\\r|\\n)/],\r\n    // BASIC programs used to require the programmer type in her own line numbers. The start at the beginning of the line.\r\n    [\"lineNumbers\", /^\\d+\\s+/],\r\n    // Comments were lines that started with the keyword \"REM\" (for REMARK) and ran to the end of the line. They did not have to be numbered, because they were not executable and were stripped out by the interpreter.\r\n    [\"startLineComments\", /^REM\\s/],\r\n    // Both double-quoted and single-quoted strings were not always supported, but in this case, I'm just demonstrating how it would be done for both.\r\n    [\"strings\", /\"(?:\\\\\"|[^\"])*\"/],\r\n    [\"strings\", /'(?:\\\\'|[^'])*'/],\r\n    // Numbers are an optional dash, followed by a optional digits, followed by optional period, followed by 1 or more required digits. This allows us to match both integers and decimal numbers, both positive and negative, with or without leading zeroes for decimal numbers between (-1, 1).\r\n    [\"numbers\", /-?(?:(?:\\b\\d*)?\\.)?\\b\\d+\\b/],\r\n    // Keywords are really just a list of different words we want to match, surrounded by the \"word boundary\" selector \"\\b\".\r\n    [\"keywords\",\r\n      /\\b(?:RESTORE|REPEAT|RETURN|LOAD|LABEL|DATA|READ|THEN|ELSE|FOR|DIM|LET|IF|TO|STEP|NEXT|WHILE|WEND|UNTIL|GOTO|GOSUB|ON|TAB|AT|END|STOP|PRINT|INPUT|RND|INT|CLS|CLK|LEN)\\b/\r\n    ],\r\n    // Sometimes things we want to treat as keywords have different meanings in different locations. We can specify rules for tokens more than once.\r\n    [\"keywords\", /^DEF FN/],\r\n    // These are all treated as mathematical operations.\r\n    [\"operators\",\r\n      /(?:\\+|;|,|-|\\*\\*|\\*|\\/|>=|<=|=|<>|<|>|OR|AND|NOT|MOD|\\(|\\)|\\[|\\])/\r\n    ],\r\n    // Once everything else has been matched, the left over blocks of words are treated as variable and function names.\r\n    [\"identifiers\", /\\w+\\$?/]\r\n  ]);\r\nvar oldTokenize = Basic.tokenize;\r\nBasic.tokenize = function (code) {\r\n  return oldTokenize.call(this, code.toUpperCase());\r\n};\r\n\r\nBasic.interpret = function (sourceCode, input, output, errorOut, next,\r\n  clearScreen, loadFile, done) {\r\n  var tokens = this.tokenize(sourceCode),\r\n    EQUAL_SIGN = new Token(\"=\", \"operators\"),\r\n    counter = 0,\r\n    isDone = false,\r\n    program = {},\r\n    lineNumbers = [],\r\n    currentLine = [],\r\n    lines = [currentLine],\r\n    data = [],\r\n    returnStack = [],\r\n    forLoopCounters = {},\r\n    dataCounter = 0,\r\n    state = {\r\n      INT: function (v) {\r\n        return v | 0;\r\n      },\r\n      RND: function () {\r\n        return Math.random();\r\n      },\r\n      CLK: function () {\r\n        return Date.now() / 3600000;\r\n      },\r\n      LEN: function (id) {\r\n        return id.length;\r\n      },\r\n      LINE: function () {\r\n        return lineNumbers[counter];\r\n      },\r\n      TAB: function (v) {\r\n        var str = \"\";\r\n        for (var i = 0; i < v; ++i) {\r\n          str += \" \";\r\n        }\r\n        return str;\r\n      },\r\n      POW: function (a, b) {\r\n        return Math.pow(a, b);\r\n      }\r\n    };\r\n\r\n  function toNum(ln) {\r\n    return new Token(ln.toString(), \"numbers\");\r\n  }\r\n\r\n  function toStr(str) {\r\n    return new Token(\"\\\"\" + str.replace(\"\\n\", \"\\\\n\")\r\n      .replace(\"\\\"\", \"\\\\\\\"\") + \"\\\"\", \"strings\");\r\n  }\r\n\r\n  var tokenMap = {\r\n    \"OR\": \"||\",\r\n    \"AND\": \"&&\",\r\n    \"NOT\": \"!\",\r\n    \"MOD\": \"%\",\r\n    \"<>\": \"!=\"\r\n  };\r\n\r\n  while (tokens.length > 0) {\r\n    var token = tokens.shift();\r\n    if (token.type === \"newlines\") {\r\n      currentLine = [];\r\n      lines.push(currentLine);\r\n    }\r\n    else if (token.type !== \"regular\" && token.type !== \"comments\") {\r\n      token.value = tokenMap[token.value] || token.value;\r\n      currentLine.push(token);\r\n    }\r\n  }\r\n\r\n  for (var i = 0; i < lines.length; ++i) {\r\n    var line = lines[i];\r\n    if (line.length > 0) {\r\n      var lastLine = lineNumbers[lineNumbers.length - 1];\r\n      var lineNumber = line.shift();\r\n\r\n      if (lineNumber.type !== \"lineNumbers\") {\r\n        line.unshift(lineNumber);\r\n\r\n        if (lastLine === undefined) {\r\n          lastLine = -1;\r\n        }\r\n\r\n        lineNumber = toNum(lastLine + 1);\r\n      }\r\n\r\n      lineNumber = parseFloat(lineNumber.value);\r\n      if (lastLine && lineNumber <= lastLine) {\r\n        throw new Error(\"expected line number greater than \" + lastLine +\r\n          \", but received \" + lineNumber + \".\");\r\n      }\r\n      else if (line.length > 0) {\r\n        lineNumbers.push(lineNumber);\r\n        program[lineNumber] = line;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  function process(line) {\r\n    if (line && line.length > 0) {\r\n      var op = line.shift();\r\n      if (op) {\r\n        if (commands.hasOwnProperty(op.value)) {\r\n          return commands[op.value](line);\r\n        }\r\n        else if (!isNaN(op.value)) {\r\n          return setProgramCounter([op]);\r\n        }\r\n        else if (state[op.value] ||\r\n          (line.length > 0 && line[0].type === \"operators\" &&\r\n            line[0].value === \"=\")) {\r\n          line.unshift(op);\r\n          return translate(line);\r\n        }\r\n        else {\r\n          error(\"Unknown command. >>> \" + op.value);\r\n        }\r\n      }\r\n    }\r\n    return pauseBeforeComplete();\r\n  }\r\n\r\n  function error(msg) {\r\n    errorOut(\"At line \" + lineNumbers[counter] + \": \" + msg);\r\n  }\r\n\r\n  function getLine(i) {\r\n    var lineNumber = lineNumbers[i];\r\n    var line = program[lineNumber];\r\n    return line && line.slice();\r\n  }\r\n\r\n  function evaluate(line) {\r\n    var script = \"\";\r\n    for (var i = 0; i < line.length; ++i) {\r\n      var t = line[i];\r\n      var nest = 0;\r\n      if (t.type === \"identifiers\" &&\r\n        typeof state[t.value] !== \"function\" &&\r\n        i < line.length - 1 &&\r\n        line[i + 1].value === \"(\") {\r\n        for (var j = i + 1; j < line.length; ++j) {\r\n          var t2 = line[j];\r\n          if (t2.value === \"(\") {\r\n            if (nest === 0) {\r\n              t2.value = \"[\";\r\n            }\r\n            ++nest;\r\n          }\r\n          else if (t2.value === \")\") {\r\n            --nest;\r\n            if (nest === 0) {\r\n              t2.value = \"]\";\r\n            }\r\n          }\r\n          else if (t2.value === \",\" && nest === 1) {\r\n            t2.value = \"][\";\r\n          }\r\n\r\n          if (nest === 0) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      script += t.value;\r\n    }\r\n    //with ( state ) { // jshint ignore:line\r\n    try {\r\n      return eval2(script); // jshint ignore:line\r\n    }\r\n    catch (exp) {\r\n      console.error(exp);\r\n      console.debug(line.join(\", \"));\r\n      console.error(script);\r\n      error(exp.message + \": \" + script);\r\n    }\r\n    //}\r\n  }\r\n\r\n  function declareVariable(line) {\r\n    var decl = [],\r\n      decls = [decl],\r\n      nest = 0,\r\n      i;\r\n    for (i = 0; i < line.length; ++i) {\r\n      var t = line[i];\r\n      if (t.value === \"(\") {\r\n        ++nest;\r\n      }\r\n      else if (t.value === \")\") {\r\n        --nest;\r\n      }\r\n      if (nest === 0 && t.value === \",\") {\r\n        decl = [];\r\n        decls.push(decl);\r\n      }\r\n      else {\r\n        decl.push(t);\r\n      }\r\n    }\r\n    for (i = 0; i < decls.length; ++i) {\r\n      decl = decls[i];\r\n      var id = decl.shift();\r\n      if (id.type !== \"identifiers\") {\r\n        error(\"Identifier expected: \" + id.value);\r\n      }\r\n      else {\r\n        var val = null,\r\n          j;\r\n        id = id.value;\r\n        if (decl[0].value === \"(\" && decl[decl.length - 1].value === \")\") {\r\n          var sizes = [];\r\n          for (j = 1; j < decl.length - 1; ++j) {\r\n            if (decl[j].type === \"numbers\") {\r\n              sizes.push(decl[j].value | 0);\r\n            }\r\n          }\r\n          if (sizes.length === 0) {\r\n            val = [];\r\n          }\r\n          else {\r\n            val = new Array(sizes[0]);\r\n            var queue = [val];\r\n            for (j = 1; j < sizes.length; ++j) {\r\n              var size = sizes[j];\r\n              for (var k = 0,\r\n                  l = queue.length; k < l; ++k) {\r\n                var arr = queue.shift();\r\n                for (var m = 0; m < arr.length; ++m) {\r\n                  arr[m] = new Array(size);\r\n                  if (j < sizes.length - 1) {\r\n                    queue.push(arr[m]);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        state[id] = val;\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  function print(line) {\r\n    var endLine = \"\\n\";\r\n    var nest = 0;\r\n    line = line.map(function (t, i) {\r\n      t = t.clone();\r\n      if (t.type === \"operators\") {\r\n        if (t.value === \",\") {\r\n          if (nest === 0) {\r\n            t.value = \"+ \\\", \\\" + \";\r\n          }\r\n        }\r\n        else if (t.value === \";\") {\r\n          t.value = \"+ \\\" \\\"\";\r\n          if (i < line.length - 1) {\r\n            t.value += \" + \";\r\n          }\r\n          else {\r\n            endLine = \"\";\r\n          }\r\n        }\r\n        else if (t.value === \"(\") {\r\n          ++nest;\r\n        }\r\n        else if (t.value === \")\") {\r\n          --nest;\r\n        }\r\n      }\r\n      return t;\r\n    });\r\n    var txt = evaluate(line);\r\n    if (txt === undefined) {\r\n      txt = \"\";\r\n    }\r\n    output(txt + endLine);\r\n    return true;\r\n  }\r\n\r\n  function setProgramCounter(line) {\r\n    var lineNumber = parseFloat(evaluate(line));\r\n    counter = -1;\r\n    while (counter < lineNumbers.length - 1 &&\r\n      lineNumbers[counter + 1] < lineNumber) {\r\n      ++counter;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function checkConditional(line) {\r\n    var thenIndex = -1,\r\n      elseIndex = -1,\r\n      i;\r\n    for (i = 0; i < line.length; ++i) {\r\n      if (line[i].type === \"keywords\" && line[i].value === \"THEN\") {\r\n        thenIndex = i;\r\n      }\r\n      else if (line[i].type === \"keywords\" && line[i].value === \"ELSE\") {\r\n        elseIndex = i;\r\n      }\r\n    }\r\n    if (thenIndex === -1) {\r\n      error(\"Expected THEN clause.\");\r\n    }\r\n    else {\r\n      var condition = line.slice(0, thenIndex);\r\n      for (i = 0; i < condition.length; ++i) {\r\n        var t = condition[i];\r\n        if (t.type === \"operators\" && t.value === \"=\") {\r\n          t.value = \"==\";\r\n        }\r\n      }\r\n      var thenClause,\r\n        elseClause;\r\n      if (elseIndex === -1) {\r\n        thenClause = line.slice(thenIndex + 1);\r\n      }\r\n      else {\r\n        thenClause = line.slice(thenIndex + 1, elseIndex);\r\n        elseClause = line.slice(elseIndex + 1);\r\n      }\r\n      if (evaluate(condition)) {\r\n        return process(thenClause);\r\n      }\r\n      else if (elseClause) {\r\n        return process(elseClause);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function pauseBeforeComplete() {\r\n    output(\"PROGRAM COMPLETE - PRESS RETURN TO FINISH.\");\r\n    input(function () {\r\n      isDone = true;\r\n      if (done) {\r\n        done();\r\n      }\r\n    });\r\n    return false;\r\n  }\r\n\r\n  function labelLine(line) {\r\n    line.push(EQUAL_SIGN);\r\n    line.push(toNum(lineNumbers[counter]));\r\n    return translate(line);\r\n  }\r\n\r\n  function waitForInput(line) {\r\n    var toVar = line.pop();\r\n    if (line.length > 0) {\r\n      print(line);\r\n    }\r\n    input(function (str) {\r\n      str = str.toUpperCase();\r\n      var valueToken = null;\r\n      if (!isNaN(str)) {\r\n        valueToken = toNum(str);\r\n      }\r\n      else {\r\n        valueToken = toStr(str);\r\n      }\r\n      evaluate([toVar, EQUAL_SIGN, valueToken]);\r\n      if (next) {\r\n        next();\r\n      }\r\n    });\r\n    return false;\r\n  }\r\n\r\n  function onStatement(line) {\r\n    var idxExpr = [],\r\n      idx = null,\r\n      targets = [];\r\n    try {\r\n      while (line.length > 0 &&\r\n        (line[0].type !== \"keywords\" ||\r\n          line[0].value !== \"GOTO\")) {\r\n        idxExpr.push(line.shift());\r\n      }\r\n\r\n      if (line.length > 0) {\r\n        line.shift(); // burn the goto;\r\n\r\n        for (var i = 0; i < line.length; ++i) {\r\n          var t = line[i];\r\n          if (t.type !== \"operators\" ||\r\n            t.value !== \",\") {\r\n            targets.push(t);\r\n          }\r\n        }\r\n\r\n        idx = evaluate(idxExpr) - 1;\r\n\r\n        if (0 <= idx && idx < targets.length) {\r\n          return setProgramCounter([targets[idx]]);\r\n        }\r\n      }\r\n    }\r\n    catch (exp) {\r\n      console.error(exp);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function gotoSubroutine(line) {\r\n    returnStack.push(toNum(lineNumbers[counter + 1]));\r\n    return setProgramCounter(line);\r\n  }\r\n\r\n  function setRepeat() {\r\n    returnStack.push(toNum(lineNumbers[counter]));\r\n    return true;\r\n  }\r\n\r\n  function conditionalReturn(cond) {\r\n    var ret = true;\r\n    var val = returnStack.pop();\r\n    if (val && cond) {\r\n      ret = setProgramCounter([val]);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  function untilLoop(line) {\r\n    var cond = !evaluate(line);\r\n    return conditionalReturn(cond);\r\n  }\r\n\r\n  function findNext(str) {\r\n    for (i = counter + 1; i < lineNumbers.length; ++i) {\r\n      var l = getLine(i);\r\n      if (l[0].value === str) {\r\n        return i;\r\n      }\r\n    }\r\n    return lineNumbers.length;\r\n  }\r\n\r\n  function whileLoop(line) {\r\n    var cond = evaluate(line);\r\n    if (!cond) {\r\n      counter = findNext(\"WEND\");\r\n    }\r\n    else {\r\n      returnStack.push(toNum(lineNumbers[counter]));\r\n    }\r\n    return true;\r\n  }\r\n\r\n  var FOR_LOOP_DELIMS = [\"=\", \"TO\", \"STEP\"];\r\n\r\n  function forLoop(line) {\r\n    var n = lineNumbers[counter];\r\n    var varExpr = [];\r\n    var fromExpr = [];\r\n    var toExpr = [];\r\n    var skipExpr = [];\r\n    var arrs = [varExpr, fromExpr, toExpr, skipExpr];\r\n    var a = 0;\r\n    var i = 0;\r\n    for (i = 0; i < line.length; ++i) {\r\n      var t = line[i];\r\n      if (t.value === FOR_LOOP_DELIMS[a]) {\r\n        if (a === 0) {\r\n          varExpr.push(t);\r\n        }\r\n        ++a;\r\n      }\r\n      else {\r\n        arrs[a].push(t);\r\n      }\r\n    }\r\n\r\n    var skip = 1;\r\n    if (skipExpr.length > 0) {\r\n      skip = evaluate(skipExpr);\r\n    }\r\n\r\n    if (forLoopCounters[n] === undefined) {\r\n      forLoopCounters[n] = evaluate(fromExpr);\r\n    }\r\n\r\n    var end = evaluate(toExpr);\r\n    var cond = forLoopCounters[n] <= end;\r\n    if (!cond) {\r\n      delete forLoopCounters[n];\r\n      counter = findNext(\"NEXT\");\r\n    }\r\n    else {\r\n      varExpr.push(toNum(forLoopCounters[n]));\r\n      process(varExpr);\r\n      forLoopCounters[n] += skip;\r\n      returnStack.push(toNum(lineNumbers[counter]));\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function stackReturn() {\r\n    return conditionalReturn(true);\r\n  }\r\n\r\n  function loadCodeFile(line) {\r\n    loadFile(evaluate(line))\r\n      .then(next);\r\n    return false;\r\n  }\r\n\r\n  function noop() {\r\n    return true;\r\n  }\r\n\r\n  function loadData(line) {\r\n    while (line.length > 0) {\r\n      var t = line.shift();\r\n      if (t.type !== \"operators\") {\r\n        data.push(t.value);\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function readData(line) {\r\n    if (data.length === 0) {\r\n      var dataLine = findNext(\"DATA\");\r\n      process(getLine(dataLine));\r\n    }\r\n    var value = data[dataCounter];\r\n    ++dataCounter;\r\n    line.push(EQUAL_SIGN);\r\n    line.push(toNum(value));\r\n    return translate(line);\r\n  }\r\n\r\n  function restoreData() {\r\n    dataCounter = 0;\r\n    return true;\r\n  }\r\n\r\n  function defineFunction(line) {\r\n    var name = line.shift()\r\n      .value;\r\n    var signature = \"\";\r\n    var body = \"\";\r\n    var fillSig = true;\r\n    for (var i = 0; i < line.length; ++i) {\r\n      var t = line[i];\r\n      if (t.type === \"operators\" && t.value === \"=\") {\r\n        fillSig = false;\r\n      }\r\n      else if (fillSig) {\r\n        signature += t.value;\r\n      }\r\n      else {\r\n        body += t.value;\r\n      }\r\n    }\r\n    name = \"FN\" + name;\r\n    var script = \"(function \" + name + signature + \"{ return \" + body +\r\n      \"; })\";\r\n    state[name] = eval2(script); // jshint ignore:line\r\n    return true;\r\n  }\r\n\r\n  function translate(line) {\r\n    evaluate(line);\r\n    return true;\r\n  }\r\n\r\n  var commands = {\r\n    DIM: declareVariable,\r\n    LET: translate,\r\n    PRINT: print,\r\n    GOTO: setProgramCounter,\r\n    IF: checkConditional,\r\n    INPUT: waitForInput,\r\n    END: pauseBeforeComplete,\r\n    STOP: pauseBeforeComplete,\r\n    REM: noop,\r\n    \"'\": noop,\r\n    CLS: clearScreen,\r\n    ON: onStatement,\r\n    GOSUB: gotoSubroutine,\r\n    RETURN: stackReturn,\r\n    LOAD: loadCodeFile,\r\n    DATA: loadData,\r\n    READ: readData,\r\n    RESTORE: restoreData,\r\n    REPEAT: setRepeat,\r\n    UNTIL: untilLoop,\r\n    \"DEF FN\": defineFunction,\r\n    WHILE: whileLoop,\r\n    WEND: stackReturn,\r\n    FOR: forLoop,\r\n    NEXT: stackReturn,\r\n    LABEL: labelLine\r\n  };\r\n\r\n  return function () {\r\n    if (!isDone) {\r\n      var goNext = true;\r\n      while (goNext) {\r\n        var line = getLine(counter);\r\n        goNext = process(line);\r\n        ++counter;\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\n\r\nexport default Basic;","pliny.value({\r\n  parent: \"Primrose.Text.Grammars\",\r\n  name: \"HTML\",\r\n  description: \"A grammar for HyperText Markup Language.\"\r\n});\r\n\r\nimport Grammar from \"./Grammar\";\r\nexport default new Grammar(\"HTML\", [\r\n  [\"newlines\", /(?:\\r\\n|\\r|\\n)/],\r\n  [\"startBlockComments\", /(?:<|&lt;)!--/],\r\n  [\"endBlockComments\", /--(?:>|&gt;)/],\r\n  [\"stringDelim\", /(\"|')/],\r\n  [\"numbers\", /-?(?:(?:\\b\\d*)?\\.)?\\b\\d+\\b/],\r\n  [\"keywords\",\r\n    /(?:<|&lt;)\\/?(html|base|head|link|meta|style|title|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|hgroup|nav|section|dd|div|dl|dt|figcaption|figure|hr|li|main|ol|p|pre|ul|a|abbr|b|bdi|bdo|br|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|rtc|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|object|param|source|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|menuitem|summary|content|element|shadow|template|acronym|applet|basefont|big|blink|center|command|content|dir|font|frame|frameset|isindex|keygen|listing|marquee|multicol|nextid|noembed|plaintext|spacer|strike|tt|xmp)\\b/\r\n  ],\r\n  [\"members\", /(\\w+)=/]\r\n]);","pliny.value({\r\n  parent: \"Primrose.Text.Grammars\",\r\n  name: \"TestResults\",\r\n  description: \"A grammar for displaying the results of Unit Tests.\"\r\n});\r\n\r\nimport Grammar from \"./Grammar\";\r\nexport default new Grammar(\"TestResults\", [\r\n  [\"newlines\", /(?:\\r\\n|\\r|\\n)/, true],\r\n  [\"numbers\", /(\\[)(o+)/, true],\r\n  [\"numbers\", /(\\d+ succeeded), 0 failed/, true],\r\n  [\"numbers\", /^    Successes:/, true],\r\n  [\"functions\", /(x+)\\]/, true],\r\n  [\"functions\", /[1-9]\\d* failed/, true],\r\n  [\"functions\", /^    Failures:/, true],\r\n  [\"comments\", /(\\d+ms:)(.*)/, true],\r\n  [\"keywords\", /(Test results for )(\\w+):/, true],\r\n  [\"strings\", /        \\w+/, true]\r\n]);","pliny.namespace({\r\n  parent: \"Primrose.Text\",\r\n  name: \"Grammars\",\r\n  description: \"The Grammars namespace contains grammar parsers for different types of programming languages, to enable syntax highlighting.\"\r\n});\r\n\r\nimport Basic from \"./Basic\";\r\nimport Grammar from \"./Grammar\";\r\nimport HTML from \"./HTML\";\r\nimport JavaScript from \"./JavaScript\";\r\nimport PlainText from \"./PlainText\";\r\nimport TestResults from \"./TestResults\";\r\n\r\nexport {\r\n  Basic,\r\n  Grammar,\r\n  HTML,\r\n  JavaScript,\r\n  PlainText,\r\n  TestResults\r\n};\r\n\r\nexport default {\r\n  Basic,\r\n  Grammar,\r\n  HTML,\r\n  JavaScript,\r\n  PlainText,\r\n  TestResults\r\n};","pliny.value({\r\n  parent: \"Primrose.Text.OperatingSystems\",\r\n  name: \"Linux\",\r\n  description: \"Keyboard shortcuts for the Linux operating system (actually just a reference to the Windows shortcuts).\"\r\n});\r\n\r\nimport Windows from \"./Windows\";\r\nexport default Windows;","pliny.namespace({\r\n  parent: \"Primrose.Text\",\r\n  name: \"OperatingSystems\",\r\n  description: \"The OperatingSystems namespace contains sets of keyboard shortcuts for different operating systems.\"\r\n});\r\n\r\nimport Linux from \"./Linux\";\r\nimport macOS from \"./macOS\";\r\nimport OperatingSystem from \"./OperatingSystem\";\r\nimport Windows from \"./Windows\";\r\n\r\nexport {\r\n  Linux,\r\n  macOS,\r\n  OperatingSystem,\r\n  Windows\r\n};\r\n\r\nexport default {\r\n  Linux,\r\n  macOS,\r\n  OperatingSystem,\r\n  Windows\r\n};","pliny.class({\r\n  parent: \"Primrose.Text\",\r\n    name: \"Terminal\",\r\n    description: \"| [under construction]\"\r\n});\r\n\r\nimport getText from \"../HTTP/getText\";\r\nimport PlainText from \"./Grammars/PlainText\";\r\nimport isMacOS from \"../../flags/isMacOS\";\r\nexport default class Terminal {\r\n  constructor(inputEditor, outputEditor) {\r\n    outputEditor = outputEditor || inputEditor;\r\n\r\n    var inputCallback = null,\r\n      currentProgram = null,\r\n      originalGrammar = null,\r\n      currentEditIndex = 0,\r\n      pageSize = 40,\r\n      outputQueue = [],\r\n      buffer = \"\",\r\n      restoreInput = inputEditor === outputEditor,\r\n      self = this;\r\n\r\n    this.running = false;\r\n    this.waitingForInput = false;\r\n\r\n    function toEnd(editor) {\r\n      editor.selectionStart = editor.selectionEnd = editor.value.length;\r\n      editor.scrollIntoView(editor.frontCursor);\r\n    }\r\n\r\n    function done() {\r\n      if (self.running) {\r\n        flush();\r\n        self.running = false;\r\n        if (restoreInput) {\r\n          inputEditor.tokenizer = originalGrammar;\r\n          inputEditor.value = currentProgram;\r\n        }\r\n        toEnd(inputEditor);\r\n      }\r\n    }\r\n\r\n    function clearScreen() {\r\n      outputEditor.selectionStart = outputEditor.selectionEnd = 0;\r\n      outputEditor.value = \"\";\r\n      return true;\r\n    }\r\n\r\n    function flush() {\r\n      if (buffer.length > 0) {\r\n        var lines = buffer.split(\"\\n\");\r\n        for (var i = 0; i < pageSize && lines.length > 0; ++i) {\r\n          outputQueue.push(lines.shift());\r\n        }\r\n        if (lines.length > 0) {\r\n          outputQueue.push(\" ----- more -----\");\r\n        }\r\n        buffer = lines.join(\"\\n\");\r\n      }\r\n    }\r\n\r\n    function input(callback) {\r\n      inputCallback = callback;\r\n      self.waitingForInput = true;\r\n      flush();\r\n    }\r\n\r\n    function stdout(str) {\r\n      buffer += str;\r\n    }\r\n\r\n    this.sendInput = function (evt) {\r\n      if (buffer.length > 0) {\r\n        flush();\r\n      }\r\n      else {\r\n        outputEditor.keyDown(evt);\r\n        var str = outputEditor.value.substring(currentEditIndex);\r\n        inputCallback(str.trim());\r\n        inputCallback = null;\r\n        this.waitingForInput = false;\r\n      }\r\n    };\r\n\r\n    this.execute = function () {\r\n      pageSize = 10;\r\n      originalGrammar = inputEditor.tokenizer;\r\n      if (originalGrammar && originalGrammar.interpret) {\r\n        this.running = true;\r\n        var looper,\r\n          next = function () {\r\n            if (self.running) {\r\n              setTimeout(looper, 1);\r\n            }\r\n          };\r\n\r\n        currentProgram = inputEditor.value;\r\n        looper = originalGrammar.interpret(currentProgram, input, stdout,\r\n          stdout, next, clearScreen, this.loadFile.bind(this), done);\r\n        outputEditor.tokenizer = PlainText;\r\n        clearScreen();\r\n        next();\r\n      }\r\n    };\r\n\r\n    this.loadFile = function (fileName) {\r\n      return getText(fileName.toLowerCase())\r\n        .then(function (file) {\r\n          if (isMacOS) {\r\n            file = file.replace(\"CTRL+SHIFT+SPACE\", \"CMD+OPT+E\");\r\n          }\r\n          inputEditor.value = currentProgram = file;\r\n          return file;\r\n        });\r\n    };\r\n\r\n    this.update = function () {\r\n      if (outputQueue.length > 0) {\r\n        outputEditor.value += outputQueue.shift() + \"\\n\";\r\n        toEnd(outputEditor);\r\n        currentEditIndex = outputEditor.selectionStart;\r\n      }\r\n    };\r\n  }\r\n}","pliny.record({\r\n  parent: \"Primrose.Text.Themes\",\r\n  name: \"Dark\",\r\n  description: \"A dark background with a light foreground for text.\"\r\n});\r\n\r\nexport default {\r\n  name: \"Dark\",\r\n  fontFamily: \"'Droid Sans Mono', 'Consolas', 'Lucida Console', 'Courier New', 'Courier', monospace\",\r\n  cursorColor: \"white\",\r\n  fontSize: 16,\r\n  lineNumbers: {\r\n    foreColor: \"white\"\r\n  },\r\n  regular: {\r\n    backColor: \"black\",\r\n    foreColor: \"#c0c0c0\",\r\n    currentRowBackColor: \"#202020\",\r\n    selectedBackColor: \"#404040\",\r\n    unfocused: \"rgba(0, 0, 255, 0.25)\"\r\n  },\r\n  strings: {\r\n    foreColor: \"#aa9900\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  regexes: {\r\n    foreColor: \"#aa0099\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  numbers: {\r\n    foreColor: \"green\"\r\n  },\r\n  comments: {\r\n    foreColor: \"yellow\",\r\n    fontStyle: \"italic\"\r\n  },\r\n  keywords: {\r\n    foreColor: \"cyan\"\r\n  },\r\n  functions: {\r\n    foreColor: \"brown\",\r\n    fontWeight: \"bold\"\r\n  },\r\n  members: {\r\n    foreColor: \"green\"\r\n  },\r\n  error: {\r\n    foreColor: \"red\",\r\n    fontStyle: \"underline italic\"\r\n  }\r\n};","pliny.namespace({\r\n  parent: \"Primrose.Text\",\r\n  name: \"Themes\",\r\n  description: \"The Themes namespace contains color themes for text-oriented controls, for use when coupled with a parsing grammar.\"\r\n});\r\n\r\nimport Dark from \"./Dark\";\r\nimport Default from \"./Default\";\r\n\r\nexport {\r\n  Dark,\r\n  Default\r\n};\r\n\r\nexport default {\r\n  Dark,\r\n  Default\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Text\",\r\n  description: \"The Text namespace contains classes everything regarding the Primrose source code editor.\"\r\n});\r\n\r\nimport CodePages from \"./CodePages\";\r\nimport CommandPacks from \"./CommandPacks\";\r\nimport Cursor from \"./Cursor\";\r\nimport Grammars from \"./Grammars\";\r\nimport OperatingSystems from \"./OperatingSystems\";\r\nimport Point from \"./Point\";\r\nimport Rectangle from \"./Rectangle\";\r\nimport Rule from \"./Rule\";\r\nimport Size from \"./Size\";\r\nimport Terminal from \"./Terminal\";\r\nimport Themes from \"./Themes\";\r\nimport Token from \"./Token\";\r\n\r\nexport {\r\n  CodePages,\r\n  CommandPacks,\r\n  Cursor,\r\n  Grammars,\r\n  OperatingSystems,\r\n  Point,\r\n  Rectangle,\r\n  Rule,\r\n  Size,\r\n  Terminal,\r\n  Themes,\r\n  Token\r\n};\r\n\r\nexport default {\r\n  CodePages,\r\n  CommandPacks,\r\n  Cursor,\r\n  Grammars,\r\n  OperatingSystems,\r\n  Point,\r\n  Rectangle,\r\n  Rule,\r\n  Size,\r\n  Terminal,\r\n  Themes,\r\n  Token\r\n};","pliny.namespace({\r\n  parent: \"Primrose\",\r\n  name: \"Tools\",\r\n  description: \"A collection of tools to be able to manipulate objects.\"\r\n});\r\n\r\nimport Teleporter from \"./Teleporter\";\r\n\r\nexport {\r\n  Teleporter\r\n};\r\n\r\nexport default {\r\n  Teleporter\r\n};","pliny.namespace({\r\n  name: \"Primrose\",\r\n  description: \"Primrose helps you make VR applications for web browsers as easy as making other types of interactive web pages.\\n\\\r\n\\n\\\r\nThis top-level namespace contains classes for manipulating and viewing 3D environments.\"\r\n});\r\n\r\nimport Angle from \"./Angle\";\r\nimport Audio from \"./Audio\";\r\nimport BrowserEnvironment from \"./BrowserEnvironment\";\r\nimport Constants from \"./Constants\";\r\nimport Controls from \"./Controls\";\r\nimport Displays from \"./Displays\";\r\nimport DOM from \"./DOM\";\r\nimport Graphics from \"./Graphics\";\r\nimport HTTP from \"./HTTP\";\r\nimport Input from \"./Input\";\r\nimport Keys from \"./Keys\";\r\nimport Network from \"./Network\";\r\nimport Pointer from \"./Pointer\";\r\nimport Random from \"./Random\";\r\nimport Replay from \"./Replay\";\r\nimport Text from \"./Text\";\r\nimport Tools from \"./Tools\";\r\n\r\nexport {\r\n  Angle,\r\n  Audio,\r\n  BrowserEnvironment,\r\n  Constants,\r\n  Controls,\r\n  Displays,\r\n  DOM,\r\n  Graphics,\r\n  HTTP,\r\n  Input,\r\n  Keys,\r\n  Network,\r\n  Pointer,\r\n  Random,\r\n  Replay,\r\n  Text,\r\n  Tools\r\n};\r\n\r\nexport default {\r\n  Angle,\r\n  Audio,\r\n  BrowserEnvironment,\r\n  Constants,\r\n  Controls,\r\n  Displays,\r\n  DOM,\r\n  Graphics,\r\n  HTTP,\r\n  Input,\r\n  Keys,\r\n  Network,\r\n  Pointer,\r\n  Random,\r\n  Replay,\r\n  Text,\r\n  Tools\r\n};","/*\r\n * Copyright (C) 2014 - 2016 Sean T. McBeth <sean@notiontheory.com>\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\nimport * as flags from \"./flags\";\r\nimport * as liveAPI from \"./live-api\";\r\nimport * as util from \"./util\";\r\nObject.assign(window, flags, liveAPI, util);\r\n// Do this just for side effects, we are monkey-patching Three.js classes with our own utilities.\r\nimport \"./THREE\";\r\nimport \"promise-polyfill/promise\";\r\nexport { default } from \"./Primrose\";"],"names":["pliny","value","window","opera","navigator","userAgent","indexOf","chrome","isOpera","InstallTrigger","document","documentMode","self","top","test","function","isLandscape","Math","abs","orientation","testUserAgent","a","substring","vendor","Object","prototype","toString","call","HTMLElement","isChrome","isSafari","namespace","hub","Object3D","_cache","cache","hash","makeObject","onCacheHit","record","material","textureDescription","options","undefined","assign","FrontSide","materialDescription","color","unshaded","side","opacity","roughness","metalness","emissive","wireframe","useFog","materialOptions","transparent","MaterialType","MeshStandardMaterial","shading","FlatShading","MeshBasicMaterial","mat","Number","set","loadTexture","id","url","progress","textureLoader","Array","length","CubeTextureLoader","HTMLImageElement","src","TextureLoader","setCrossOrigin","Promise","resolve","reject","load","Texture","seenElements","WeakMap","seenElementCount","textured","geometry","txt","txtRepeatX","txtRepeatY","anisotropy","txtType","txtID","has","get","err","Error","scaleTextureWidth","scaleTextureHeight","texturePromise","retValue","HTMLCanvasElement","HTMLVideoElement","isTexture","obj","type","Mesh","isMesh","shadow","receiveShadow","castShadow","attributes","uv","array","arr","i","itemSize","trace","promise","then","texture","wrapS","wrapT","RepeatWrapping","repeat","isCubeTexture","envMap","map","needsUpdate","colored","isObject3D","box","width","height","t","u","v","BoxBufferGeometry","brick","m","axis","add","index","Symbol","class","Entity","name","isEntity","ready","_ready","disabled","fixGeometry","maxU","maxV","attrs","_bufferGeometry","j","faceVertexUvs","faces","face","uvs","k","x","y","quad","s","PlaneBufferGeometry","InsideSphereGeometry","radius","widthSegments","heightSegments","phiStart","phiLength","thetaStart","thetaLength","parameters","max","floor","PI","vertices","verticesRow","uvsRow","vertex","Vector3","cos","sin","z","push","Vector2","v1","v2","v3","v4","n1","clone","normalize","n2","n3","n4","uv1","uv2","uv3","uv4","Face3","computeFaceNormals","f","normal","multiplyScalar","vertexNormals","boundingSphere","Sphere","Geometry","SLICE","shell","r","slices","rings","phi","theta","COUNTER","entities","updateAll","forEach","entity","eyeBlank","update","eyeBlankAll","eye","BaseTextured","files","join","_files","_meshes","_textures","_currentImageIndex","_geometry","visible","babelHelpers.get","_loadFiles","mesh","blending","processedVideos","findAndFixVideo","evt","vids","querySelectorAll","removeEventListener","fixVideo","vid","isiOS","addEventListener","Video","videos","_elements","spec","video","querySelector","createElement","srcObject","onprogress","onloadedmetadata","muted","loop","setAttribute","preload","loadOptions","parentElement","body","insertBefore","children","log","minFilter","LinearFilter","play","elem","currentTime","_lastTime","camera","mediaDevices","enumerateDevices","catch","console","error","bind","devices","filter","d","kind","device","getUserMedia","deviceId","ideal","stream","circle","sections","start","end","CircleBufferGeometry","cloud","verts","c","geom","PointsMaterial","Points","cylinder","rT","rB","rS","hS","openEnded","thetaEnd","CylinderBufferGeometry","light","intensity","distance","decay","PointLight","quat","w","Quaternion","identity","range","n","m2","s2","t2","output","Function","ring","rInner","rOuter","sectors","RingBufferGeometry","raycaster","Raycaster","sphere","SphereGeometry","Vector4","findProperty","AsyncLockRequest","elementOpts","changeEventOpts","errorEventOpts","requestMethodOpts","exitMethodOpts","_elementName","_requestMethodName","documentElement","_exitMethodName","_changeTimeout","_changeEventName","_errorEventName","_events","exit","request","thunk","bubbles","act","onSuccess","tearDown","element","onError","stop","removeChangeListener","removeErrorListener","addChangeListener","addErrorListener","setTimeout","extraParam","_withChange","isActive","deleteSetting","settingName","localStorage","removeItem","FullScreenLockRequest","_fullScreenEnabledProperty","getSetting","defValue","val","getItem","JSON","parse","exp","immutable","getter","MIN_TIMESTEP","MAX_TIMESTEP","isTimestampDeltaValid","timestampDeltaS","isNaN","mutable","lock","screen","mozOrientation","mozLockOrientation","locked","unlock","mozUnlockOrientation","setSetting","setItem","stringify","standardUnlockBehavior","isMobile","PointerLock","warn","standardExitFullScreenBehavior","FullScreen","standardLockBehavior","Orientation","standardFullScreenBehavior","Workerize","script","stripFunc","trim","blob","Blob","dataURI","URL","createObjectURL","Worker","func","match","matches","property","worker","createWorker","args","onmessage","e","emit","data","methodShim","eventName","method","postMessage","EventDispatcher","BufferGeometry","center","computeBoundingBox","b","boundingBox","dx","min","dy","dz","offset","urls","onLoad","onProgress","CubeTexture","loader","ImageLoader","manager","crossOrigin","setPath","path","loaded","image","images","Event","defaultPrevented","preventDefault","dispatchEvent","_listeners","listeners","listenerArray","target","watch","child","events","event","route","listener","on","Matrix4","digits","transpose","parts","toArray","sign","toFixed","MTLLoader","DefaultLoadingManager","scope","FileLoader","text","texturePath","setTexturePath","lines","split","info","delimiter_pattern","materialsInfo","line","charAt","pos","key","toLowerCase","ss","parseFloat","materialCreator","MaterialCreator","setManager","setMaterials","baseUrl","materials","materialsArray","nameLookup","wrap","convert","converted","mn","covmat","prop","save","lprop","normalizeRGB","ignoreZeroRGBs","create","materialName","createMaterial_","TMaterial","MeshPhongMaterial","params","resolveURL","setMapForType","mapType","texParams","getTextureParams","copy","scale","Color","fromArray","specular","shininess","COLOR_ON_AND_AMBIENT_OFF","attribute","matParams","items","bumpScale","splice","mapping","Loader","Handlers","appendChild","defineProperty","enter","select","useraction","pointerstart","pointerend","pointermove","gazestart","gazecancel","gazemove","gazecomplete","latLng","lat","lon","rotation","position","applyQuaternion","quaternion","named","addTo","at","rot","scl","_visible","oldV","OBJLoader","regexp","state","OBJParserState","startObject","time","_createParserState","replace","lineFirstChar","lineSecondChar","lineLength","result","trimLeft","l","vertex_pattern","exec","normal_pattern","normals","uv_pattern","face_vertex_uv_normal","addFace","face_vertex_uv","face_vertex_normal","face_vertex","lineParts","lineVertices","lineUVs","li","llen","addLineGeometry","object_pattern","substr","material_use_pattern","object","startMaterial","materialLibraries","material_library_pattern","smoothing_pattern","smooth","currentMaterial","finalize","container","Group","concat","objects","isLine","buffergeometry","addAttribute","BufferAttribute","Float32Array","computeVertexNormals","createdMaterials","mi","miLen","sourceMaterial","isLineBasicMaterial","materialLine","LineBasicMaterial","SmoothShading","addGroup","groupStart","groupCount","multiMaterial","MultiMaterial","LineSegments","timeEnd","fromDeclaration","_finalize","previousMaterial","OBJ","declared","inherited","len","parseInt","dst","ua","ub","uc","ud","na","nb","nc","nd","vLen","ia","parseVertexIndex","ib","ic","addVertex","uvLen","parseUVIndex","addUV","nLen","parseNormalIndex","addNormal","vi","addVertexLine","uvi","addUVLine","libraries","previous","isArray","groupEnd","mtllib","lastMultiMaterial","vert","Euler","debugOutputCache","debug","Matrix3","label","this","DEG2RAD","_Math","RAD2DEG","Angle","_value","_delta","_d1","_d2","_d3","newValue","degrees","XHR","headers","req","XMLHttpRequest","onerror","message","onabort","onload","status","response","open","responseType","setRequestHeader","withCredentials","send","getBuffer","cascadeElement","tag","DOMClass","Date","now","getElementById","tagName","toUpperCase","AudioContext","webkitAudioContext","VECTOR","UP","TEMP","Audio3D","audioElementCount","HTMLAudioElement","autoplay","controls","isAvailable","finishSetup","sampleRate","context","mainVolume","createGain","source","createBufferSource","buffer","createRawSound","connect","destination","playbackState","PLAYING_STATE","FINISHED_STATE","setVelocity","updateMatrixWorld","matrixWorld","mx","elements","my","mz","setPosition","applyMatrix4","setOrientation","resume","suspend","disconnect","decodeAudioData","dat","pcmData","frameCount","createBuffer","channel","getChannelData","snd","panner","createPanner","volume","sources","audio","playsinline","oncanplay","createMediaElementSource","loadSource","create3DSound","createFixedSound","PositionalSound","ctx","gn","pnr","gain","PIANO_BASE","pow","Note","osc","createOscillator","frequency","dt","ramp","piano","setValueAtTime","exponentialRampToValueAtTime","MAX_NOTE_COUNT","maxTouchPoints","TYPES","Music","numNotes","oscillators","oscs","duration","o","getOsc","off","performance","_type","Sound","audio3D","node","DEFAULT_SPEECH_SETTINGS","Speech","getVoices","voices","speechSynthesis","remoteVoices","default","localService","voiceNames","voice","onvoiceschanged","opts","msg","SpeechSynthesisUtterance","rate","pitch","onend","speak","speaking","FORWARD","LASER_WIDTH","LASER_LENGTH","GAZE_RING_DISTANCE","GAZE_RING_INNER","GAZE_RING_OUTER","VECTOR_TEMP","EULER_TEMP","QUAT_TEMP","hasGazeEvent","click","Pointer","pointerName","highlight","triggerDevices","isPointer","slice","gazeTimeout","gazeLength","unproject","picker","showPointer","velocity","gazeInner","gazeReference","gazeOuter","useGaze","lastHit","trigger","devicePixelRatio","h","commands","U","V","enabled","inPhysicalUse","getValue","lookAt","multiply","setFromEuler","curHit","curObj","lastObj","moved","point","curID","lastID","changed","enterEvt","leaveEvt","dButtons","buttons","selected","p","round","sub","hits","intersectObject","hit","origObj","parent","pickable","_check","EVENTS","enumeration","Keys","MAX_VALUE","hasOwnProperty","Point","Size","Rectangle","isRectangle","size","left","right","bottom","Surface","description","bounds","canvas","CanvasRenderingContext2D","String","isSurface","getContext","_opacity","focused","focusable","style","defineProperties","resize","fontSize","backgroundColor","imageWidth","imageHeight","imageRendering","imageSmoothingEnabled","textBaseline","subSurfaces","render","startUV","moveUV","endPointer","keyDown","keyUp","canvases","all","useDefault","subSurface","overlap","drawImage","invalidate","setSize","surfaceWidth","surfaceHeight","oldTextBaseline","oldTextAlign","textAlign","isVector2","here","inBounds","found","blur","_findSubSurface","x2","y2","startPointer","focus","movePointer","focusedElement","_forFocusedSubSurface","mapUV","clientWidth","clientHeight","elementWidth","elementHeight","head","_environment","theme","lockMovement","Label","_lastFont","_lastText","_lastCharacterWidth","_lastCharacterHeight","_lastPadding","_lastWidth","_lastHeight","_lastTextAlign","character","refreshCharacter","regular","backColor","foreColor","font","fontFamily","measureText","textChanged","characterWidthChanged","characterHeightChanged","fontChanged","alignChanged","resized","_isChanged","clearFunc","fillStyle","textY","textX","fontWeight","fontStyle","fillText","renderCanvasTrim","_theme","DefaultTheme","Button2D","_lastActivated","_activated","activatedChanged","lineWidth","strokeStyle","Primrose","Text","Themes","Default","strokeRect","Button3D","model","buttonName","DEFAULTS","minDeflection","colorUnpressed","colorPressed","base","cap","button","buttonCount","ButtonFactory","templateFile","template","toggle","btn","DEFAULT","Image","loaders","PATH_PATTERN","EXTENSION_PATTERN","ModelFactory","loadObject","fixJSONScene","json","traverse","computeBoundingSphere","fixOBJScene","group","propertyTests","setProperties","scene","extMatch","extension","ObjectLoader","FontLoader","LoaderType","elemID","newPath","dir","elemSource","innerHTML","isSkinnedMesh","animation","AnimationClip","originalAnimationClipData","heightTester","ray","direction","Ground","drawDistance","groundTexture","groundModel","enableShadows","isInfinite","origin","dim","Sky","skyTexture","shadowMapSize","shadowCameraSize","shadowRadius","_image","disableDefaultLighting","ambient","sun","AmbientLight","DirectionalLight","mapSize","updateProjectionMatrix","skyDim","skyRadius","sqrt","BackSide","reverse","combiningMarks","surrogatePair","str","capture1","capture2","res","Cursor","cursor","lastLength","word","reverseFromNewline","total","advanceN","fixCursor","pLine","CommandPack","commandPackName","BasicTextInput","additionalName","additionalCommands","prim","tokenRows","cursorLeft","frontCursor","cursorSkipLeft","cursorRight","cursorSkipRight","cursorHome","cursorEnd","backCursor","selectedText","scrollIntoView","currentToken","tabString","home","cursorFullHome","cursorFullEnd","fullhome","fullend","redo","undo","cursorUp","cursorDown","cursorPageUp","cursorPageDown","indent","tokenRow","scroll","Rule","tokens","token","midx","input","next","splitAt","mid","Token","Grammar","grammarName","rules","grammar","rule","crudeParsing","commentDelim","stringDelim","tokenize","carveOutMatchedToken","temp","createTextNode","SCROLL_SCALE","isFirefox","OFFSET","TextBox","isTextBox","useCaching","makeCursorCommand","_commandPack","_tokenRows","_tokenHashes","_tabString","_currentTouchID","_lineCountWidth","_lastGridBounds","_lastFrontCursor","_lastBackCursor","_lastScrollX","_lastScrollY","_lastFocused","_lastThemeName","_lastPointer","_browser","isIE","_pointer","_history","_historyFrame","_topLeftGutter","_bottomRightGutter","_dragging","_scrolling","_wheelScrollSpeed","subBounds","_fg","_fgCanvas","_fgfx","_bg","_bgCanvas","_bgfx","_trim","_trimCanvas","_tgfx","_rowCache","_VSCROLL_WIDTH","tabWidth","showLineNumbers","hideLineNumbers","showScrollBars","hideScrollBars","wordWrap","disableWordWrap","readOnly","multiline","singleLine","gridBounds","tokenizer","commandPack","TextEditor","padding","incY","refreshTokens","currentCursor","minDelta","clampScroll","shiftKey","deltaX","deltaY","setCursorXY","clipboard","clipboardData","setData","returnValue","copySelectedText","altCmdName","cmdName","altCmdText","cmdText","resetDeadKeyState","getData","pixel2cell","gx","gy","onBottom","onLeft","onRight","setXY","scrollHeight","sy","maxWidth","scrollWidth","sx","ceil","LN10","currentRowWidth","tokenQueue","widthLeft","breakLine","minV","dvMinV","dvMaxV","dv","gfx","fill","fillRect","stroke","minCursor","maxCursor","tokenFront","tokenBack","OFFSETY","translate","currentRowBackColor","row","inSelection","selectionFront","selectionBack","cw","selectedBackColor","cc","cursorColor","restore","clearRect","drawn","putImageData","drawText","getImageData","maxLineWidth","lastLine","currentLine","lineNumber","drawWidth","drawHeight","scrollX","scrollY","bw","scrollBarWidth","by","scrollBarHeight","bx","bh","unfocused","refreshGridBounds","boundsChanged","paddingChanged","cursorChanged","scrollChanged","themeChanged","focusChanged","changeBounds","layoutChanged","backgroundChanged","foregroundChanged","trimChanged","imageChanged","performLayout","renderCanvasBackground","renderCanvasForeground","pushUndo","_padding","_wordWrap","setGutter","_showLineNumbers","_showScrollBars","setI","_tokenizer","tk","JavaScript","_tabWidth","tw","_fontSize","piOver180","rad45","defaultOrientation","defaultPosition","mat4_perspectiveFromFieldOfView","out","fov","near","far","upTan","tan","upDegrees","downTan","downDegrees","leftTan","leftDegrees","rightTan","rightDegrees","xScale","yScale","mat4_fromRotationTranslation","q","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","mat4_translate","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","mat4_invert","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","updateEyeMatrices","projection","view","pose","vrDisplay","fieldOfView","depthNear","depthFar","frameDataFromPose","frameData","timestamp","leftProjectionMatrix","leftViewMatrix","getEyeParameters","rightProjectionMatrix","rightViewMatrix","VRFrameData","nextDisplayId","VRDisplay","_currentLayers","_frameData","_poseData","getPose","_getPose","callback","requestAnimationFrame","cancelAnimationFrame","layers","capabilities","maxLayers","defaultFieldOfView","defaultPose","StandardMonitorVRDisplay","display","_display","isPolyfilled","submitFrame","resetPose","curLayer","getLayers","vFOV","hFOV","calcFoV","aFoV","aDim","bDim","atan","makeHidingContainer","HTMLDivElement","overflow","initState","inputState","lastInputState","filterMetaKey","MODIFIER_KEYS","toLocaleUpperCase","filterValue","axisNames","swap","axes","resetInputState","recordLastState","CommandState","pressed","wasPressed","fireAgain","lt","ct","repeatCount","InputProcessor","userActionEvent","commandNames","paused","readMetaKeys","addCommand","userActionHandlers","cmd","cloneCommand","repetitions","deadzone","threshold","integrate","delta","maybeClone","metaKeys","commandDown","commandUp","ANY","stateMod","code","ov","lv","fireCommands","setProperty","addToArray","removeFromArray","invertInArray","isEnabled","getAxis","setAxis","_inPhysicalUse","wasInPhysicalUse","OperatingSystem","osName","pre1","pre2","pre3","pre5","pre4","codePage","keyCode","CTRL","ALT","META_L","META_R","SHIFT","commandName","deadKeyState","ctrlKey","altKey","metaKey","keyNames","CodePage","codePageName","lang","language","char","NORMAL","MULTIPLY","ADD","SUBTRACT","DECIMALPOINT","DIVIDE","overwriteText","codes","browser","lastDeadKeyState","DEAD","Keyboard","_operatingSystem","_codePage","isKeyDown","setButton","operatingSystem","makeCommandName","os","isMacOS","macOS","Windows","cp","languages","userLanguage","browserLanguage","CodePages","EN_US","Mouse","DOMElement","timer","setState","stateChange","NUM_BUTTONS","isDown","movementX","movementY","webkitMovementX","mozMovementX","webkitMovementY","mozMovementY","layerX","layerY","W","Z","DEFAULT_POSE","EMPTY_SCALE","IE_CORRECTION","PoseInputProcessor","currentDevice","lastPose","currentPose","posePosition","poseQuaternion","matrix","hasOrientation","orient","stageMatrix","makeRotationFromQuaternion","multiplyMatrices","decompose","playPattern","pattern","pause","shift","vibrate","Gamepad","pad","mgr","axisOffset","padID","ID","registerPad","buttonMap","touched","axisName","axisValue","haptics","isMotionController","XBOX_360_BUTTONS","XBOX_ONE_BUTTONS","VIVE_BUTTONS","blackList","getGamepads","webkitGetGamepads","GamepadManager","currentDevices","currentDeviceIDs","currentManagers","maybePads","pads","padIDs","newPads","oldPads","maybePad","padIdx","checkDevice","Touch","touches","changedTouches","minIdentifier","identifier","pageX","pageY","lx","ly","fingerState","running","recognition","errorMessage","available","check","getErrorMessage","SpeechRecognition","webkitSpeechRecognition","continuous","interimResults","restart","enable","newCommand","results","resultIndex","maxI","isFinal","alt","confidence","transcript","preamble","keywords","cmdState","metaKeysSet","SensorSample","sample","timestampS","sensorSample","ComplementaryFilter","kFilter","currentAccelMeasurement","currentGyroMeasurement","previousGyroMeasurement","filterQ","previousFilterQ","accelQ","isOrientationInitialized","estimatedGravity","measuredGravity","gyroIntegralQ","vector","deltaT","run_","accelToQuaternion_","gyroDeltaQ","gyroToQuaternionDelta_","invFilterQ","inverse","deltaQ","setFromUnitVectors","targetQ","slerp","accel","normAccel","gyro","setFromAxisAngle","AXIS","PosePredictor","predictionTimeS","previousQ","previousTimestampS","currentQ","outQ","angularSpeed","predictAngle","isFirefoxAndroid","FusionPoseSensor","deviceName","accelerometer","gyroscope","onDeviceMotionChange_","onScreenOrientationChange_","K_FILTER","posePredictor","PREDICTION_TIME_S","filterToWorldQ","inverseWorldToScreenQ","worldToScreenQ","originalPoseAdjustQ","setScreenTransform_","resetQ","orientationOut_","predictedQ","getOrientation","getPrediction","getPosition","deviceMotion","accGravity","accelerationIncludingGravity","rotRate","rotationRate","timeStamp","deltaS","alpha","beta","gamma","addAccelMeasurement","addGyroMeasurement","screenOrientation","Eye","ipd","neckLength","neckDepth","CardboardVRDisplay","poseSensor_","overrideOrientation","whichEye","LEFT","Automator","root","frames","startT","Obj","find","part","Record","Frame","stack","records","write","Player","frameIndex","objs","append","minT","oldFrameIndex","frame","apply","reduce","maxT","MIN_VALUE","MockVRDisplay","displayName","startOn","dataPack","player","currentEyeParams","handle","getObject","hasNativeWebVR","allDisplays","isCardboardCompatible","isGearVR","polyFillDevicesPopulated","standardMonitorPopulated","upgrade1_0_to_1_1","getFrameData","getPolyfillDisplays","forceStereo","fireVRDisplayPresentChange","CustomEvent","detail","vrdisplay","installPolyfill","oldGetVRDisplays","getVRDisplays","displays","installStandardMonitor","created","dsp","defaultFOV","DEFAULT_FOV","unshift","installMockDisplay","replayData","mockDeviceExists","done","install","VR","leftParams","rightParams","_transformers","lastLastTimerDevice","lastTimerDevice","timerDevice","currentDeviceIndex","movePlayer","stage","lastStageWidth","lastStageDepth","isStereo","nonstandardIPD","IPD","nonstandardNeckLength","NECK_LENGTH","nonstandardNeckDepth","NECK_DEPTH","selectedIndex","isStereoDisplay","isNativeMobileWebVR","requestPresent","isPresenting","exitPresent","stageParameters","sittingToStandingTransform","sizeX","sizeZ","makeTranslation","avatarHeight","ViewCameraTransform","getTransforms","isNativeWebVR","hasExternalDisplay","fieldOfViewToProjectionMatrix","renderWidth","renderHeight","zNear","zFar","makeTransform","viewport","number","power","random","int","randNum","randInt","g","RemoteUser","userName","modelFactory","nameMaterial","disableWebRTC","requestICEPath","microphone","localUserName","goSecond","peeringError","peering","peered","randColor","nameObject","text3D","dStageQuaternion","dHeadPosition","dHeadQuaternion","lastStageQuaternion","lastHeadPosition","lastHeadQuaternion","headPosition","headQuaternion","audioChannel","audioElement","audioStream","analyzer","audioSource","Element","setAudioProperties","setAudioStream","createMediaStreamSource","coneInnerAngle","coneOuterAngle","coneOuterGain","panningModel","distanceModel","close","removeChild","fade","curr","arr1","arr2","FADE_FACTOR","NETWORK_DT_INV","NETWORK_DT","_updateV","setFromQuaternion","_predict","Manager","localUser","factories","lastNetworkUpdate","oldState","users","waitForLastUser","_socket","audioHeap","deviceIndex","newState","user","setAudio","socket","listUsers","addUser","addDevice","setDeviceIndex","receiveChat","updateUser","removeUser","lostConnection","toUserName","avatar","foregroundColor","webRTC","unpeer","newUsers","keys","DIFF","MAX_MOVE_DISTANCE","MAX_MOVE_DISTANCE_SQ","MAX_TELEPORT_WAGGLE","TELEPORT_PAD_RADIUS","TELEPORT_COOLDOWN","Teleporter","env","_startPoint","_moveDistance","_start","_exit","_move","_end","ground","disk","_updatePosition","teleport","distSq","dist","factor","PIXEL_SCALES","SKINS","SYS_FONTS","Quality","NAMES","packageName","version","homepage","MILLISECONDS_TO_SECONDS","TELEPORT_DISPLACEMENT","DISPLACEMENT","WEDGE","BrowserEnvironment","complementColor","getHex","deltaTime","network","audioQueue","zero","managers","quality","NONE","HIGH","missedFrames","fps","numFrames","hadGamepad","hasGamepad","gamepadMgr","poll","showHeadPointer","mousePointer","hasMotionControllers","heading","strafe","drive","hasMouse","hasTouch","mouseHeading","newMouseHeading","moveStage","getHeightAt","motionDevices","updateMatrix","updateStage","pointers","resolvePicking","moveTo","sky","turns","followEuler","maxX","maxY","moveUI","vicinity","vicinityFollowRate","lerp","radians","ui","animate","setPlayer","renderer","clear","trans","nearPlane","st","setViewport","resolutionScale","projectionMatrix","getInverse","translateOnAxis","translation","modifyScreen","canvasWidth","canvasHeight","domElement","currentHeading","qPitch","vEye","vBody","modelFiles","sceneModel","avatarModel","rgb","hsl","getHSL","setHSL","modelsReady","loadObjects","models","TextGeometry","buttonFactory","speech","Text2Speech","ambientSound","load3DSound","aud","MediaElementAudioSourceNode","documentReady","readyState","music","currentControl","fadeOutPromise","fadeOutPromiseResolver","fadeInPromise","fadeInPromiseResolver","fadeOut","fader","fadeIn","updateFade","fadeRate","teleportAvailable","transition","immediate","delesectControl","consumeEvent","cancel","Scene","fog","FogExp2","PerspectiveCamera","teleporter","buildScene","sceneGraph","isButton","Camera","currentTimerObject","RAF","goFullScreen","canMirror","fullScreenElement","addAvatar","removeAvatar","remove","cancelVR","fullScreenChange","presenting","allowRestart","startAnimation","isPause","stopAnimation","WebGLRenderer","canvasElement","antialias","autoClear","sortObjects","setClearColor","maxTabIndex","elementsWithTabIndex","tabIndex","disableKeyboard","addInputManager","A","LEFTARROW","D","RIGHTARROW","UPARROW","S","DOWNARROW","ENTER","META","disableGamepad","controllerNumber","currentPad","GRIP_PRESSED","ptr","BACK","removeInputManager","order","exitVR","setFalse","ESCAPE","withCurrentControl","focusClipboard","clipboardOperation","surrogate","HTMLTextAreaElement","surrogateContainer","_readyParts","shadowMap","PCFSoftShadowMap","fullScreenButtonContainer","insertFullScreenButtons","hide","alert","rerouteDialog","oldFunction","newFunction","arguments","confirm","prompt","NetworkManager","mgrIdx","setAudioFromUser","containerSpec","newButton","title","enterVR","className","location","hostname","disableAdvertising","eyes","Vive_0","Vive_1","Gamepad_0","MAXIMUM","Preloader","Model","file","_file","_model","loadModel","factory","PlainText","fgcolor","bgcolor","hAlign","lineHeight","boxHeight","textCanvas","textContext","textGeometry","PlaneGeometry","textMesh","SIZE","INSET","PROPORTION","SIZE_SMALL","INSET_LARGE","Progress","majorColor","minorColor","totalBar","valueBar","fileState","reset","responseURL","currentSrc","TextInput","TextInputCommands","passwordCharacter","findEverything","del","delObject","getText","post","postObject","Location","geolocation","watchPosition","coords","PEERING_TIMEOUT_LENGTH","ICE_SERVERS","INSTANCE_COUNT","WebRTCSocket","fromUserName","fromUserIndex","toUserIndex","attemptCount","MAX_LOG_LEVEL","instanceNumber","print","level","format","myResult","theirResult","_timeout","_log","_error","rtc","goFirst","isError","stopTimeout","onsignalingstatechange","oniceconnectionstatechange","onnegotiationneeded","onicecandidate","teardown","complete","peering_answer","recordProgress","item","setRemoteDescription","RTCSessionDescription","peering_error","descriptionCreated","setLocalDescription","peering_cancel","peering_offer","offer","createAnswer","peering_ice","ice","candidate","RTCIceCandidate","addIceCandidate","peering_peer","hasRTC","issueRequest","HTTP","config","iceServers","server","username","credential","credentialType","iceCandidatePoolSize","RTCPeerConnection","signalingState","iceConnectionState","iceGatheringState","createOffer","resolver","rejecter","offerOptions","PEERING_EVENTS","ENABLE_OPUS_HACK","preferOpus","sdp","sdpLines","mLineIndex","search","opusPayload","extractSdp","setDefaultCodec","removeCN","sdpLine","mLine","payload","newLine","mLineElements","cnPos","AudioChannel","outAudio","inAudio","startTimeout","addStream","addTrack","getAudioTracks","track","onStream","ontrack","streams","onaddstream","answer","received","DataChannel","dataChannel","createDataChannel","ondatachannel","steps","Watcher","lastValue","read","Recorder","watchers","eval2","eval","Basic","oldTokenize","interpret","sourceCode","errorOut","clearScreen","loadFile","EQUAL_SIGN","counter","isDone","program","lineNumbers","returnStack","forLoopCounters","dataCounter","toNum","ln","toStr","tokenMap","process","op","setProgramCounter","pauseBeforeComplete","getLine","evaluate","nest","declareVariable","decl","decls","sizes","queue","endLine","checkConditional","thenIndex","elseIndex","condition","thenClause","elseClause","labelLine","waitForInput","toVar","pop","valueToken","onStatement","idxExpr","idx","targets","gotoSubroutine","setRepeat","conditionalReturn","cond","ret","untilLoop","findNext","whileLoop","FOR_LOOP_DELIMS","forLoop","varExpr","fromExpr","toExpr","skipExpr","arrs","skip","stackReturn","loadCodeFile","noop","loadData","readData","dataLine","restoreData","defineFunction","signature","fillSig","goNext","Terminal","inputEditor","outputEditor","inputCallback","currentProgram","originalGrammar","currentEditIndex","pageSize","outputQueue","restoreInput","waitingForInput","toEnd","editor","selectionStart","selectionEnd","flush","stdout","sendInput","execute","looper","fileName","flags","liveAPI","util"],"mappings":"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"}